{"version":3,"sources":["../../../../app/admin/rag/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ntype InquiryRow = {\n  id: number;\n  email?: string | null;\n  treatment_type?: string | null;\n  message?: string | null;\n};\n\nexport default function RagAdminPage() {\n  const [normalizeText, setNormalizeText] = useState(\"\");\n  const [selectedInquiryId, setSelectedInquiryId] = useState<string>(\"\");\n  const [inquiries, setInquiries] = useState<InquiryRow[]>([]);\n  const [normalizeResult, setNormalizeResult] = useState<any>(null);\n\n  const [ingestSourceType, setIngestSourceType] = useState(\"treatment\");\n  const [ingestSourceId, setIngestSourceId] = useState(\"\");\n  const [ingestResult, setIngestResult] = useState<any>(null);\n\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchLang, setSearchLang] = useState(\"en\");\n  const [searchResult, setSearchResult] = useState<any>(null);\n\n  useEffect(() => {\n    fetch(\"/api/rag/inquiries\")\n      .then((r) => r.json())\n      .then((data) => setInquiries(data?.rows || []))\n      .catch(() => setInquiries([]));\n  }, []);\n\n  const handleNormalize = async () => {\n    setNormalizeResult(null);\n    const payload: any = {};\n    if (normalizeText.trim()) payload.text = normalizeText.trim();\n    if (selectedInquiryId) payload.inquiry_id = Number(selectedInquiryId);\n    const res = await fetch(\"/api/inquiry/normalize\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    const data = await res.json();\n    setNormalizeResult(data);\n  };\n\n  const handleIngest = async () => {\n    setIngestResult(null);\n    const payload: any = { sourceTypes: [ingestSourceType] };\n    if (ingestSourceId.trim()) payload.source_id = ingestSourceId.trim();\n    const res = await fetch(\"/api/rag/ingest\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    const data = await res.json();\n    setIngestResult(data);\n  };\n\n  const handleSearch = async () => {\n    setSearchResult(null);\n    const res = await fetch(\"/api/rag/search\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        query: searchQuery.trim(),\n        lang: searchLang,\n      }),\n    });\n    const data = await res.json();\n    setSearchResult(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex\">\n      <aside className=\"w-64 bg-white border-r border-gray-200 fixed h-full p-6 flex flex-col z-20\">\n        <div className=\"text-2xl font-black text-teal-600 mb-10 flex items-center gap-2\">\n          관리자 모드\n        </div>\n        <nav className=\"space-y-2 flex-1\">\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            시장 분석 (통계)\n          </a>\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            고객 문의\n          </a>\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            병원 관리\n          </a>\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            시술 관리\n          </a>\n          <div className=\"pt-4 mt-4 border-t border-gray-100 space-y-2\">\n            <a\n              href=\"/admin\"\n              className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n            >\n              사이트 설정\n            </a>\n            <div className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 bg-teal-50 text-teal-700\">\n              RAG 테스트\n            </div>\n          </div>\n        </nav>\n        <a\n          href=\"/\"\n          className=\"flex items-center gap-2 text-gray-400 hover:text-red-500 font-bold px-2 py-2\"\n        >\n          관리자 나가기\n        </a>\n      </aside>\n\n      <div className=\"ml-64 flex-1 p-8 md:p-12 max-w-5xl space-y-10 text-sm text-gray-800\">\n        <section>\n          <h1 className=\"text-xl font-bold\">RAG 테스트</h1>\n          <p className=\"text-gray-500\">정규화/수집/검색용 최소 도구</p>\n        </section>\n\n        <section className=\"space-y-3\">\n        <h2 className=\"text-lg font-semibold\">A) 문의 정규화 테스트</h2>\n        <textarea\n          className=\"w-full border rounded p-2\"\n          rows={4}\n          placeholder=\"문의 내용을 붙여넣기...\"\n          value={normalizeText}\n          onChange={(e) => setNormalizeText(e.target.value)}\n        />\n        <div className=\"flex items-center gap-3\">\n          <select\n            className=\"border rounded p-2\"\n            value={selectedInquiryId}\n            onChange={(e) => setSelectedInquiryId(e.target.value)}\n          >\n            <option value=\"\">문의 폼 레코드 선택</option>\n            {inquiries.map((row) => (\n              <option key={row.id} value={row.id}>\n                {row.id} {row.email ? `- ${row.email}` : \"\"}\n              </option>\n            ))}\n          </select>\n          <button className=\"border px-3 py-2\" onClick={handleNormalize}>\n            정규화 실행\n          </button>\n        </div>\n        <pre className=\"bg-gray-50 border rounded p-3 overflow-auto\">\n          {normalizeResult ? JSON.stringify(normalizeResult, null, 2) : \"—\"}\n        </pre>\n      </section>\n\n        <section className=\"space-y-3\">\n        <h2 className=\"text-lg font-semibold\">B) 수집(ingest) 테스트</h2>\n        <div className=\"flex items-center gap-3\">\n          <select\n            className=\"border rounded p-2\"\n            value={ingestSourceType}\n            onChange={(e) => setIngestSourceType(e.target.value)}\n          >\n            <option value=\"treatment\">시술 (treatment)</option>\n            <option value=\"hospital\">병원 (hospital)</option>\n            <option value=\"review\">리뷰 (review)</option>\n            <option value=\"normalized_inquiry\">정규화 문의 (normalized_inquiry)</option>\n          </select>\n          <input\n            className=\"border rounded p-2 flex-1\"\n            placeholder=\"source_id (선택)\"\n            value={ingestSourceId}\n            onChange={(e) => setIngestSourceId(e.target.value)}\n          />\n          <button className=\"border px-3 py-2\" onClick={handleIngest}>\n            수집 실행\n          </button>\n        </div>\n        <pre className=\"bg-gray-50 border rounded p-3 overflow-auto\">\n          {ingestResult ? JSON.stringify(ingestResult, null, 2) : \"—\"}\n        </pre>\n      </section>\n\n        <section className=\"space-y-3\">\n        <h2 className=\"text-lg font-semibold\">C) 검색 테스트</h2>\n        <div className=\"flex items-center gap-3\">\n          <input\n            className=\"border rounded p-2 flex-1\"\n            placeholder=\"검색어...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n          <select\n            className=\"border rounded p-2\"\n            value={searchLang}\n            onChange={(e) => setSearchLang(e.target.value)}\n          >\n            <option value=\"en\">en</option>\n            <option value=\"ko\">ko</option>\n            <option value=\"ja\">ja</option>\n          </select>\n          <button className=\"border px-3 py-2\" onClick={handleSearch}>\n            검색\n          </button>\n        </div>\n        <pre className=\"bg-gray-50 border rounded p-3 overflow-auto\">\n          {searchResult ? JSON.stringify(searchResult, null, 2) : \"—\"}\n        </pre>\n      </section>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}