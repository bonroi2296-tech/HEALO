(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[729],{2517:(e,t,s)=>{"use strict";s.d(t,{d:()=>m,t:()=>x});var a=s(5155),r=s(2115),n=s(2651),l=s(2791),i=s(8822),o=s(3545),d=s(3210);let c=(0,r.createContext)(null),x=({children:e})=>{let[t,s]=(0,r.useState)([]),n=(0,r.useCallback)((e,t="info",a=3e3)=>{let r=Date.now()+Math.random(),n={id:r,message:e,type:t};s(e=>[...e,n]),setTimeout(()=>{s(e=>e.filter(e=>e.id!==r))},a)},[]),l=(0,r.useCallback)(e=>{s(t=>t.filter(t=>t.id!==e))},[]);return(0,a.jsxs)(c.Provider,{value:{toast:{success:e=>n(e,"success"),error:e=>n(e,"error"),info:e=>n(e,"info"),warning:e=>n(e,"warning")},removeToast:l},children:[e,(0,a.jsx)("div",{className:"fixed top-20 right-4 z-[200] space-y-2 pointer-events-none",children:t.map(e=>(0,a.jsx)(u,{toast:e,onRemove:l},e.id))})]})},u=({toast:e,onRemove:t})=>{let{message:s,type:r}=e,c={success:{bg:"bg-green-50",border:"border-green-200",text:"text-green-800",icon:(0,a.jsx)(n.A,{size:20,className:"text-green-600"})},error:{bg:"bg-red-50",border:"border-red-200",text:"text-red-800",icon:(0,a.jsx)(l.A,{size:20,className:"text-red-600"})},info:{bg:"bg-blue-50",border:"border-blue-200",text:"text-blue-800",icon:(0,a.jsx)(i.A,{size:20,className:"text-blue-600"})},warning:{bg:"bg-yellow-50",border:"border-yellow-200",text:"text-yellow-800",icon:(0,a.jsx)(o.A,{size:20,className:"text-yellow-600"})}},x=c[r]||c.info;return(0,a.jsxs)("div",{className:`
        ${x.bg} ${x.border} ${x.text}
        border rounded-xl shadow-lg p-4 min-w-[300px] max-w-[400px]
        flex items-start gap-3 animate-in slide-in-from-right fade-in
        pointer-events-auto
      `,children:[(0,a.jsx)("div",{className:"shrink-0 mt-0.5",children:x.icon}),(0,a.jsx)("div",{className:"flex-1 text-sm font-medium",children:s}),(0,a.jsx)("button",{onClick:()=>t(e.id),className:"shrink-0 p-1 hover:bg-black/5 rounded transition",children:(0,a.jsx)(d.A,{size:16,className:x.text})})]})},m=()=>{let e=(0,r.useContext)(c);if(!e)throw Error("useToast must be used within ToastProvider");return e.toast}},4654:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>h});var a=s(5155),r=s(2115),n=s(3321),l=s(1641),i=s(7531),o=s(8916),d=s(3210),c=s(2517),x=s(5365);let u=["knee","back","neck","shoulder","hip","wrist","ankle","head","chest","abdomen","other"],m=["<1w","1-4w","1-6m","6m-1y","1y+"];function b({setView:e}){let t=(0,n.useSearchParams)(),s=(0,n.useRouter)(),b=(0,c.d)(),h=t.get("inquiryId"),p=t.get("token"),[g,y]=(0,r.useState)({body_part:[],duration:"",severity:"",diagnosis_yesno:!1,diagnosis_text:"",medication_yesno:!1,medication_text:""}),[f,j]=(0,r.useState)([]),[N,v]=(0,r.useState)(!1),[_,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{h&&p||(b.error("Missing inquiryId or token."),s.push("/inquiry"))},[h,p,s,b]);let w=async()=>{if(h&&p){v(!0);try{let e=[];if(f.length)for(let t of f){let s=`inquiry/${Date.now()}_${t.name}`,{error:a}=await x.N.storage.from("attachments").upload(s,t);a||e.push({path:s,name:t.name,type:t.type||null})}let t={complaint:{body_part:g.body_part.length?g.body_part:null,duration:g.duration||null,severity:g.severity?Number(g.severity):null},history:{diagnosis:{has:!!g.diagnosis_yesno,text:g.diagnosis_text||""},meds:{has:!!g.medication_yesno,text:g.medication_text||""}}};e.length&&(t.attachments_extra=e);let s=await fetch("/api/inquiries/intake",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({inquiryId:Number(h),publicToken:p,intakePatch:t})}),a=await s.json().catch(()=>({}));if(!s.ok){b.error(a?.error||"Failed to save."),v(!1);return}try{sessionStorage.removeItem("inquiry_success")}catch(e){}null!=h&&fetch("/api/inquiries/event",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventType:"step2_submitted",inquiryId:Number(h)})}).catch(()=>{}),k(!0)}catch(e){console.error(e),b.error("Failed to save.")}finally{v(!1)}}};return h&&p?_?(0,a.jsxs)("div",{className:"max-w-lg mx-auto px-4 py-12 text-center",children:[(0,a.jsx)("p",{className:"text-lg font-bold text-teal-700 mb-4",children:"Additional info saved."}),(0,a.jsx)("button",{onClick:()=>e?.("home")||s.push("/"),className:"text-teal-600 font-bold hover:underline",children:"Return to Home"})]}):(0,a.jsxs)("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[(0,a.jsxs)("button",{onClick:()=>s.back(),className:"flex items-center text-sm font-bold text-gray-500 mb-6 hover:text-teal-600",children:[(0,a.jsx)(l.A,{size:16})," Back"]}),(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:"Additional info (optional)"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"Helps us match you with better hospital estimates."}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-700 mb-2",children:"Body part(s)"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:u.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{y(t=>({...t,body_part:t.body_part.includes(e)?t.body_part.filter(t=>t!==e):[...t.body_part,e]}))},className:`px-3 py-1.5 rounded-lg text-sm font-medium border ${g.body_part.includes(e)?"bg-teal-100 border-teal-500 text-teal-800":"bg-gray-50 border-gray-200 text-gray-600"}`,children:e},e))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"Duration"}),(0,a.jsxs)("select",{value:g.duration,onChange:e=>y({...g,duration:e.target.value}),className:"w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none text-sm",children:[(0,a.jsx)("option",{value:"",children:"Select..."}),m.map(e=>(0,a.jsx)("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-700 mb-1",children:"Severity (1–10)"}),(0,a.jsx)("input",{type:"number",min:1,max:10,value:g.severity,onChange:e=>y({...g,severity:e.target.value}),className:"w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none text-sm",placeholder:"e.g. 7"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-700 mb-2",children:"Prior diagnosis?"}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!g.diagnosis_yesno,onChange:e=>y({...g,diagnosis_yesno:e.target.checked}),className:"rounded accent-teal-600"}),(0,a.jsx)("span",{className:"text-sm",children:"Yes"})]}),g.diagnosis_yesno&&(0,a.jsx)("textarea",{value:g.diagnosis_text,onChange:e=>y({...g,diagnosis_text:e.target.value}),rows:2,className:"w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none text-sm",placeholder:"e.g. MRI: meniscus tear"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-bold text-gray-700 mb-2",children:"Current medications?"}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer mb-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:!!g.medication_yesno,onChange:e=>y({...g,medication_yesno:e.target.checked}),className:"rounded accent-teal-600"}),(0,a.jsx)("span",{className:"text-sm",children:"Yes"})]}),g.medication_yesno&&(0,a.jsx)("textarea",{value:g.medication_text,onChange:e=>y({...g,medication_text:e.target.value}),rows:2,className:"w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none text-sm",placeholder:"e.g. ibuprofen"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("input",{type:"file",id:"step2file",className:"hidden",onChange:e=>{let t=e.target.files?.[0];t&&j(e=>[...e,t])}}),(0,a.jsxs)("div",{onClick:()=>document.getElementById("step2file")?.click(),className:"border border-dashed border-gray-300 rounded-xl p-3 text-center hover:bg-gray-50 cursor-pointer flex items-center justify-center gap-2",children:[(0,a.jsx)(i.A,{size:18,className:"text-gray-400"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Upload more (optional)"})]}),f.length>0&&(0,a.jsx)("div",{className:"mt-2 space-y-1",children:f.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(o.A,{size:14}),(0,a.jsx)("span",{className:"truncate",children:e.name}),(0,a.jsx)("button",{type:"button",onClick:()=>j(e=>e.filter((e,s)=>s!==t)),className:"text-red-500",children:(0,a.jsx)(d.A,{size:14})})]},t))})]}),(0,a.jsx)("button",{onClick:w,disabled:N,className:"w-full bg-teal-600 text-white py-4 rounded-xl font-bold hover:bg-teal-700 disabled:opacity-50",children:N?"Saving...":"Save"})]})]}):null}function h(){let e=(0,n.useRouter)();return(0,a.jsx)(b,{setView:t=>{e.push("/")}})}},5140:(e,t,s)=>{Promise.resolve().then(s.bind(s,4654))},5365:(e,t,s)=>{"use strict";s.d(t,{N:()=>l});var a=s(4197);let r="https://xppnvkuahlrdyfvabzur.supabase.co",n="sb_publishable_ui0m9IIp-8VQUfHLCb4d1w_LcwHa0Zd";if(!r||!n){let e=[];throw r||e.push("NEXT_PUBLIC_SUPABASE_URL"),n||e.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),Error(`❌ Supabase 환경 변수가 설정되지 않았습니다!
누락된 변수: ${e.join(", ")}
프로젝트 루트에 .env.local 파일을 생성하고 다음을 추가하세요:
NEXT_PUBLIC_SUPABASE_URL=your_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_key`)}let l=(0,a.UU)(r,n)}},e=>{e.O(0,[436,121,358],()=>e(e.s=5140)),_N_E=e.O()}]);