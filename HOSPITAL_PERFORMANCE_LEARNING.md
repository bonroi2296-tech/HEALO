# ë³‘ì› ì„±ê³¼ ê¸°ë°˜ ìë™ í•™ìŠµ ì‹œìŠ¤í…œ

> ì‘ì„±ì¼: 2026-01-29  
> ëª©ì : ë°ì´í„° ê¸°ë°˜ ë³‘ì› ì¶”ì²œ (LLM íŒŒì¸íŠœë‹ ì•„ë‹˜)  
> ë°©ì‹: ë² ì´ì§€ì•ˆ ìŠ¤ë¬´ë”© ê¸°ë°˜ í†µê³„ ë­í‚¹

---

## ğŸ¯ ì „ì²´ ê°œìš”

### ëª©í‘œ
- ë³‘ì› ì „ë‹¬ ê²°ê³¼ë¥¼ í•™ìŠµí•˜ì—¬ ì¶”ì²œ í’ˆì§ˆ í–¥ìƒ
- Cold Start ë¬¸ì œ í•´ê²° (ì‹ ê·œ ë³‘ì›ë„ ê³µì •í•˜ê²Œ í‰ê°€)
- ë°ì´í„°ê°€ ìŒ“ì¼ìˆ˜ë¡ ì •í™•ë„ í–¥ìƒ

### ë¹„ëª©í‘œ
- âŒ LLM íŒŒì¸íŠœë‹ (ë¹„ìš©/ë³µì¡ë„ ë†’ìŒ)
- âŒ ìë™ ì „ì†¡ (ìš´ì˜ì í™•ì¸ í•„ìˆ˜)
- âŒ ì‹¤ì‹œê°„ ì¶”ì²œ (ë°°ì¹˜ ì§‘ê³„)

---

## ğŸ“Š ë°ì´í„° íë¦„

```
1. ë¦¬ë“œ ì „ë‹¬
   inquiries â†’ hospital_lead_assignments (ì–´ë””ë¡œ ë³´ëƒˆëŠ”ì§€ ê¸°ë¡)
   
2. ë³‘ì› ì‘ë‹µ
   hospital_responses (ì‘ë‹µ ìƒíƒœ ì—…ë°ì´íŠ¸)
   
3. ì„±ê³¼ ì§‘ê³„ (ë°°ì¹˜)
   refresh_hospital_performance_stats() ì‹¤í–‰
   â†’ hospital_performance_stats ì—…ë°ì´íŠ¸
   
4. ì¶”ì²œ ì¡°íšŒ
   v_hospital_recommendations VIEW ì‚¬ìš©
   â†’ ë² ì´ì§€ì•ˆ ì ìˆ˜ ê¸°ë°˜ ì •ë ¬
   
5. ìš´ì˜ì ì„ íƒ
   ì¶”ì²œ ê²°ê³¼ ì°¸ê³ í•˜ì—¬ ìµœì¢… ê²°ì •
```

---

## ğŸ§® ë² ì´ì§€ì•ˆ ìŠ¤ë¬´ë”© ìƒì„¸ ì„¤ëª…

### ë¬¸ì œ: ì™œ ë‹¨ìˆœ ì „í™˜ìœ¨ë¡œëŠ” ì•ˆ ë˜ëŠ”ê°€?

#### ì˜ˆì‹œ
```
ë³‘ì› A: 100ê±´ ì¤‘ 40ê±´ ì „í™˜ (40%)
ë³‘ì› B: 2ê±´ ì¤‘ 2ê±´ ì „í™˜ (100%)

ë‹¨ìˆœ ì „í™˜ìœ¨ ìˆœìœ„: B(100%) > A(40%)
ì‹¤ì œ ì¶”ì²œí•´ì•¼ í•  ë³‘ì›: A (ë°ì´í„°ê°€ ë§ì•„ì„œ ì‹ ë¢°ë„ ë†’ìŒ)
```

**ë¬¸ì œì **:
- ì‹ ê·œ ë³‘ì›ì´ ìš°ì—°íˆ 1-2ê±´ ì„±ê³µí•˜ë©´ 100% ì „í™˜ìœ¨
- ê²€ì¦ëœ ë³‘ì›ë³´ë‹¤ ë†’ì€ ìˆœìœ„
- ìš´ì˜ ë¦¬ìŠ¤í¬ ì¦ê°€

---

### í•´ê²°: ë² ì´ì§€ì•ˆ ìŠ¤ë¬´ë”©

#### í•µì‹¬ ì•„ì´ë””ì–´
> "ì ì€ ë°ì´í„°ëŠ” ì „ì²´ í‰ê· ì— ê°€ê¹ê²Œ, ë§ì€ ë°ì´í„°ëŠ” ì‹¤ì œ ì„±ê³¼ì— ê°€ê¹ê²Œ"

#### ê³µì‹
```
Bayesian Score = (m * P + n * p) / (m + n)

m = Prior Strength (ê°€ì¤‘ì¹˜, ê¸°ë³¸ê°’: 10)
P = Global Average (ì „ì²´ ë³‘ì› í‰ê· , ì˜ˆ: 0.3)
n = Sample Size (ë³‘ì›ì˜ ì‹¤ì œ ë°ì´í„° ìˆ˜)
p = Hospital Rate (ë³‘ì›ì˜ ì‹¤ì œ ì „í™˜ìœ¨)
```

#### ì˜ˆì‹œ ê³„ì‚°

**ì „ì œ**:
- Global Average (P) = 30%
- Prior Strength (m) = 10

**ë³‘ì› A (ê²€ì¦ë¨)**:
- ì‹¤ì œ: 100ê±´ ì¤‘ 40ê±´ = 40%
- ê³„ì‚°: (10 * 0.3 + 100 * 0.4) / (10 + 100)
- ê³„ì‚°: (3 + 40) / 110 = 43 / 110 = 0.39
- **ì ìˆ˜: 39%** (ì‹¤ì œì— ê°€ê¹Œì›€)

**ë³‘ì› B (ì‹ ê·œ)**:
- ì‹¤ì œ: 2ê±´ ì¤‘ 2ê±´ = 100%
- ê³„ì‚°: (10 * 0.3 + 2 * 1.0) / (10 + 2)
- ê³„ì‚°: (3 + 2) / 12 = 5 / 12 = 0.42
- **ì ìˆ˜: 42%** (ì „ì²´ í‰ê· ì— ê°€ê¹Œì›€)

**ê²°ê³¼**:
```
ë‹¨ìˆœ ì „í™˜ìœ¨:  B(100%) > A(40%)   â† ì˜ëª»ëœ ìˆœìœ„
ë² ì´ì§€ì•ˆ ì ìˆ˜: A(39%) < B(42%)   â† ê±°ì˜ ë¹„ìŠ· (ë” ì•ˆì „)
```

í•˜ì§€ë§Œ ì‹ ë¢°ë„ë¥¼ ê³ ë ¤í•˜ë©´:
```
A: ì‹ ë¢°ë„ = 100 / (10 + 100) = 91%
B: ì‹ ë¢°ë„ = 2 / (10 + 2) = 17%

ìµœì¢… ì¶”ì²œ: A (ì ìˆ˜ ë¹„ìŠ· + ì‹ ë¢°ë„ ë†’ìŒ)
```

---

### Prior Strength (m) ê°’ ì„ íƒ

| m ê°’ | ì˜ë¯¸ | íš¨ê³¼ |
|------|------|------|
| 5 | ì•½í•œ ë³´ì • | ì‹¤ì œ ë°ì´í„°ì— ë¹ ë¥´ê²Œ ë°˜ì‘ |
| 10 | ì¤‘ê°„ ë³´ì • (ê¸°ë³¸ê°’) | ê· í˜• ì¡íŒ ì ‘ê·¼ |
| 20 | ê°•í•œ ë³´ì • | ë§ì€ ë°ì´í„° í•„ìš” (ë³´ìˆ˜ì ) |

**ê¸°ë³¸ê°’ 10 ì„ íƒ ì´ìœ **:
- ì•½ 10ê±´ì˜ ë°ì´í„°ë¶€í„° ì˜ë¯¸ ìˆëŠ” ì°¨ì´ ë°œìƒ
- ë„ˆë¬´ ë³´ìˆ˜ì ì´ì§€ ì•Šìœ¼ë©´ì„œ ì‹ ê·œ ë³‘ì› ë³´í˜¸
- ëŒ€ë¶€ë¶„ì˜ ì¶”ì²œ ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•˜ëŠ” ê°’

---

## ğŸ“ˆ ì‹ ë¢°ë„ (Confidence Level)

### ê³µì‹
```
Confidence = n / (m + n)

n = ì‹¤ì œ ë°ì´í„° ìˆ˜
m = Prior Strength
```

### í•´ì„
```
0-20%:   âš ï¸ ë°ì´í„° ë§¤ìš° ë¶€ì¡± (ì‹ ì¤‘íˆ)
20-50%:  ğŸ“Š ë°ì´í„° ë¶€ì¡± (ì°¸ê³ ë§Œ)
50-80%:  â­ ë°ì´í„° ì¶©ë¶„ (ì‹ ë¢° ê°€ëŠ¥)
80-100%: ğŸ”¥ ë°ì´í„° í’ë¶€ (ê°•ë ¥ ì¶”ì²œ)
```

### ì˜ˆì‹œ
```
ë³‘ì› A: 5ê±´ â†’ 5/(10+5) = 33% (ë‚®ìŒ)
ë³‘ì› B: 20ê±´ â†’ 20/(10+20) = 67% (ì¤‘ê°„)
ë³‘ì› C: 100ê±´ â†’ 100/(10+100) = 91% (ë†’ìŒ)
```

---

## ğŸ—„ï¸ DB êµ¬ì¡°

### 1. hospital_lead_assignments
**ìš©ë„**: ì–´ë–¤ ë¦¬ë“œë¥¼ ì–´ë–¤ ë³‘ì›ì— ì „ë‹¬í–ˆëŠ”ì§€ ê¸°ë¡

```sql
CREATE TABLE hospital_lead_assignments (
  inquiry_id INTEGER,      -- ë¬¸ì˜ ID
  hospital_id INTEGER,     -- ë³‘ì› ID
  treatment_id INTEGER,    -- ì‹œìˆ  ID
  country TEXT,            -- êµ­ê°€
  language TEXT,           -- ì–¸ì–´
  decision JSONB,          -- ê²°ì • ê·¼ê±°
  assigned_at TIMESTAMPTZ, -- ì „ë‹¬ ì‹œê°
  assigned_by TEXT         -- manual/auto/recommendation_engine
);
```

**ì˜ˆì‹œ ë°ì´í„°**:
```json
{
  "inquiry_id": 123,
  "hospital_id": 1,
  "treatment_id": 5,
  "country": "KR",
  "language": "ko",
  "decision": {
    "reason": "high_bayesian_score",
    "score": 0.85,
    "rank": 1,
    "alternatives": [
      {"hospital_id": 2, "score": 0.78, "rank": 2},
      {"hospital_id": 3, "score": 0.72, "rank": 3}
    ]
  }
}
```

---

### 2. hospital_performance_stats
**ìš©ë„**: ì§‘ê³„ëœ ì„±ê³¼ í†µê³„ (ë² ì´ì§€ì•ˆ ì ìˆ˜ í¬í•¨)

```sql
CREATE TABLE hospital_performance_stats (
  hospital_id INTEGER,
  treatment_id INTEGER,    -- NULL = ì „ì²´ ì‹œìˆ 
  country TEXT,            -- NULL = ì „ì²´ êµ­ê°€
  language TEXT,           -- NULL = ì „ì²´ ì–¸ì–´
  period TEXT,             -- all_time, last_30d, last_7d
  
  -- í¼ë„ ì¹´ìš´íŠ¸
  leads_sent INTEGER,
  leads_interested INTEGER,
  leads_booked INTEGER,
  leads_completed INTEGER,
  
  -- ì „í™˜ìœ¨
  booking_rate NUMERIC,
  completion_rate NUMERIC,
  
  -- ë² ì´ì§€ì•ˆ ì ìˆ˜
  bayesian_score NUMERIC,  -- 0.0 ~ 1.0
  confidence_level NUMERIC, -- 0.0 ~ 1.0
  sample_size INTEGER
);
```

**ì°¨ì› ì¡°í•© ì˜ˆì‹œ**:
```
(hospital_id=1, treatment=NULL, country=NULL, language=NULL, period=last_30d)
â†’ ë³‘ì› 1ì˜ ì „ì²´ ì„±ê³¼ (ìµœê·¼ 30ì¼)

(hospital_id=1, treatment=5, country='KR', language='ko', period=last_30d)
â†’ ë³‘ì› 1ì˜ ì½”ì„±í˜•(5) í•œêµ­ì¸ í•œêµ­ì–´ ì„±ê³¼ (ìµœê·¼ 30ì¼)
```

---

### 3. hospital_performance_global_avg
**ìš©ë„**: ê¸€ë¡œë²Œ í‰ê·  ì €ì¥ (ë² ì´ì§€ì•ˆ ê³„ì‚°ìš©)

```sql
CREATE TABLE hospital_performance_global_avg (
  global_interest_rate NUMERIC DEFAULT 0.5,
  global_booking_rate NUMERIC DEFAULT 0.3,
  global_completion_rate NUMERIC DEFAULT 0.25,
  bayesian_m INTEGER DEFAULT 10
);
```

---

## ğŸ”„ ì§‘ê³„ í”„ë¡œì„¸ìŠ¤

### 1. ìˆ˜ë™ ì‹¤í–‰
```bash
# ì „ì²´ ì¬ê³„ì‚°
npx tsx scripts/hospital-performance-aggregator.ts refresh

# ê²°ê³¼:
# âœ… Successfully refreshed 45 rows in hospital_performance_stats
```

### 2. Cron ìë™ ì‹¤í–‰ (ê¶Œì¥)
```bash
# crontab -e
0 2 * * * cd /path/to/healo && npx tsx scripts/hospital-performance-aggregator.ts refresh
```
â†’ ë§¤ì¼ ìƒˆë²½ 2ì‹œ ìë™ ì§‘ê³„

### 3. SQL í•¨ìˆ˜ ì§ì ‘ í˜¸ì¶œ
```sql
SELECT refresh_hospital_performance_stats();
```

---

## ğŸ¯ ì¶”ì²œ ì‚¬ìš©ë²•

### 1. VIEWë¥¼ í†µí•œ ì¶”ì²œ ì¡°íšŒ

```sql
-- ì½”ì„±í˜•(1) í•œêµ­(KR) í•œêµ­ì–´(ko) ì¶”ì²œ ë³‘ì› Top 5
SELECT 
  hospital_name,
  bayesian_score,
  confidence_level,
  breakdown
FROM v_hospital_recommendations
WHERE treatment_id = 1
  AND country = 'KR'
  AND language = 'ko'
ORDER BY bayesian_score DESC
LIMIT 5;
```

**ê²°ê³¼ ì˜ˆì‹œ**:
```
hospital_name        | bayesian_score | confidence_level | breakdown
---------------------|----------------|------------------|----------
Seoul Plastic A      | 0.85           | 0.91             | {...}
Gangnam Beauty       | 0.78           | 0.87             | {...}
Korea Medical Center | 0.72           | 0.75             | {...}
New Clinic           | 0.45           | 0.20             | {...}
```

---

### 2. CLI ë„êµ¬ ì‚¬ìš©

```bash
# ì¶”ì²œ ì¡°íšŒ
npx tsx scripts/hospital-performance-aggregator.ts recommend \
  --treatment 1 \
  --country KR \
  --language ko \
  --limit 5

# ê²°ê³¼:
# ğŸ¯ ë³‘ì› ì¶”ì²œ ì¡°íšŒ
# 
# 1. Seoul Plastic Surgery A
#    ì ìˆ˜: 85.0/100 (ì‹ ë¢°ë„: 91%)
#    ë°ì´í„°: 100ê±´
#    ì˜ˆì•½ìœ¨: 42.0%
#    ì™„ë£Œìœ¨: 38.0%
#    ì‘ë‹µ ì†ë„: 12.5ì‹œê°„
#    ì¶”ì²œ ë“±ê¸‰: ğŸ”¥ ê°•ë ¥ ì¶”ì²œ
```

---

### 3. ì¶”ì²œ ë“±ê¸‰ í•´ì„

| ë“±ê¸‰ | ì¡°ê±´ | ì˜ë¯¸ |
|------|------|------|
| ğŸ”¥ ê°•ë ¥ ì¶”ì²œ | ì ìˆ˜ 70%+ & ë°ì´í„° 10ê±´+ | ê²€ì¦ë¨, ë†’ì€ ì„±ê³¼ |
| â­ ì¶”ì²œ | ì ìˆ˜ 50%+ & ë°ì´í„° 5ê±´+ | ì‹ ë¢° ê°€ëŠ¥ |
| ğŸ“Š ê³ ë ¤ ê°€ëŠ¥ | ì ìˆ˜ 30%+ ë˜ëŠ” ë°ì´í„° 3ê±´+ | ì°¸ê³ ë§Œ |
| ğŸ“‰ ë°ì´í„° ë¶€ì¡± | ê·¸ ì™¸ | ì‹ ì¤‘íˆ íŒë‹¨ |

---

## ğŸ’¡ ìš´ì˜ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ìƒˆ ë¦¬ë“œ ì „ë‹¬ ì‹œ

**ì…ë ¥**:
- ë¦¬ë“œ #456 (ì½”ì„±í˜•, í•œêµ­, í•œêµ­ì–´)

**í”„ë¡œì„¸ìŠ¤**:
```sql
-- 1. ì¶”ì²œ ì¡°íšŒ
SELECT * FROM v_hospital_recommendations
WHERE treatment_id = 1 AND country = 'KR' AND language = 'ko'
ORDER BY bayesian_score DESC LIMIT 3;

-- ê²°ê³¼:
-- 1. Seoul Plastic A (85ì , ì‹ ë¢°ë„ 91%)
-- 2. Gangnam Beauty (78ì , ì‹ ë¢°ë„ 87%)
-- 3. Korea Medical (72ì , ì‹ ë¢°ë„ 75%)
```

**ìš´ì˜ì íŒë‹¨**:
- âœ… Seoul Plastic A ì„ íƒ (ìµœê³  ì ìˆ˜ + ë†’ì€ ì‹ ë¢°ë„)
- ğŸ“ decision JSON ê¸°ë¡:
```json
{
  "reason": "highest_bayesian_score",
  "score": 0.85,
  "rank": 1,
  "alternatives": [
    {"hospital_id": 2, "score": 0.78},
    {"hospital_id": 3, "score": 0.72}
  ]
}
```

**ê¸°ë¡**:
```sql
INSERT INTO hospital_lead_assignments (
  inquiry_id, hospital_id, treatment_id, 
  country, language, decision, assigned_by
) VALUES (
  456, 1, 1, 
  'KR', 'ko', '{"reason": "highest_bayesian_score", ...}', 'manual'
);
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì‹ ê·œ ë³‘ì› ì¶”ê°€

**ìƒí™©**:
- New Hospital ì¶”ê°€ë¨
- ë°ì´í„° 0ê±´

**ì´ˆê¸° ì ìˆ˜**:
```
ë² ì´ì§€ì•ˆ ì ìˆ˜ = (10 * 0.3 + 0 * 0) / (10 + 0) = 0.3 (30%)
ì‹ ë¢°ë„ = 0 / (10 + 0) = 0%
```

**ì¶”ì²œ ë“±ê¸‰**: ğŸ“‰ ë°ì´í„° ë¶€ì¡±

**ì „ëµ**:
1. ì¼ë¶€ ë¦¬ë“œ ì‹œë²” ì „ë‹¬ (2-3ê±´)
2. ê²°ê³¼ í™•ì¸
3. ì„±ê³¼ ì¢‹ìœ¼ë©´ ì ì§„ì  ì¦ê°€

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ì„±ê³¼ í•˜ë½ ë³‘ì›

**ìƒí™©**:
- ê¸°ì¡´ Aê¸‰ ë³‘ì› (ì ìˆ˜ 85%)
- ìµœê·¼ 30ì¼ ì„±ê³¼ í•˜ë½ (ì ìˆ˜ 55%)

**ë°ì´í„°**:
```sql
-- all_time: 85ì  (100ê±´ ê¸°ë°˜)
-- last_30d: 55ì  (10ê±´ ê¸°ë°˜)
```

**ìš´ì˜ ì¡°ì¹˜**:
1. last_30d ê¸°ì¤€ìœ¼ë¡œ ì¶”ì²œ ìˆœìœ„ í•˜ë½ (ìë™)
2. ë³‘ì›ì— í”¼ë“œë°± (ìˆ˜ë™)
3. ì›ì¸ íŒŒì•… (ë‹´ë‹¹ì ë³€ê²½? ì •ì±… ë³€ê²½?)
4. ê°œì„  ì•ˆ ë˜ë©´ ë¦¬ë“œ ì „ë‹¬ ì¶•ì†Œ

---

## ğŸ“Š ì„±ê³¼ ëª¨ë‹ˆí„°ë§

### 1. ì „ì²´ ë³‘ì› ëŒ€ì‹œë³´ë“œ

```bash
npx tsx scripts/hospital-performance-aggregator.ts dashboard
```

**ê²°ê³¼**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ë³‘ì›                    â”‚ ì ìˆ˜ â”‚ ì‹ ë¢°ë„(%) â”‚ ë¦¬ë“œ ìˆ˜  â”‚ ì˜ˆì•½ â”‚ ì˜ˆì•½ìœ¨(%)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seoul Plastic A         â”‚ 85.0 â”‚ 91        â”‚ 100      â”‚ 42   â”‚ 42.0        â”‚
â”‚ Gangnam Beauty          â”‚ 78.0 â”‚ 87        â”‚ 80       â”‚ 32   â”‚ 40.0        â”‚
â”‚ Korea Medical Center    â”‚ 72.0 â”‚ 75        â”‚ 50       â”‚ 18   â”‚ 36.0        â”‚
â”‚ New Clinic              â”‚ 45.0 â”‚ 20        â”‚ 3        â”‚ 1    â”‚ 33.3        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. íŠ¹ì • ë³‘ì› ìƒì„¸

```bash
npx tsx scripts/hospital-performance-aggregator.ts show-hospital 1
```

**ê²°ê³¼**:
```
ğŸ“Š ë³‘ì› #1 ì„±ê³¼ ì¡°íšŒ

ë³‘ì›ëª…: Seoul Plastic Surgery A

=== ìµœê·¼ 30ì¼ ì„±ê³¼ ===
ì „ë‹¬ëœ ë¦¬ë“œ: 100ê±´
ê´€ì‹¬ í‘œëª…: 70ê±´
ì˜ˆì•½ í™•ì •: 42ê±´
ì‹œìˆ  ì™„ë£Œ: 38ê±´

=== ì „í™˜ìœ¨ ===
ê´€ì‹¬ë¥ : 70.0%
ì˜ˆì•½ìœ¨: 42.0%
ì™„ë£Œìœ¨: 38.0%

=== ì†ë„ ===
í‰ê·  ì‘ë‹µ ì‹œê°„: 12.5ì‹œê°„

=== ë² ì´ì§€ì•ˆ ì ìˆ˜ ===
ì ìˆ˜: 85.0/100
ì‹ ë¢°ë„: 91.0%
ìƒ˜í”Œ í¬ê¸°: 100ê±´

ì„±ê³¼ ë“±ê¸‰: ğŸ”¥ Excellent
```

---

## ğŸ”¬ ë² ì´ì§€ì•ˆ ì‹œë®¬ë ˆì´ì…˜

```bash
npx tsx scripts/hospital-performance-aggregator.ts simulate
```

**ê²°ê³¼**:
```
ğŸ§ª ë² ì´ì§€ì•ˆ ìŠ¤ë¬´ë”© ì‹œë®¬ë ˆì´ì…˜

ê¸€ë¡œë²Œ í‰ê· : 30.0%
Prior Strength (m): 10

ì‹ ìƒ ë³‘ì› (2/2 = 100%)
  ì‹¤ì œ ì „í™˜ìœ¨: 100.0%
  ë² ì´ì§€ì•ˆ ì ìˆ˜: 41.7%
  ì‹ ë¢°ë„: 16.7%

ì¤‘ê²¬ ë³‘ì› (8/10 = 80%)
  ì‹¤ì œ ì „í™˜ìœ¨: 80.0%
  ë² ì´ì§€ì•ˆ ì ìˆ˜: 55.0%
  ì‹ ë¢°ë„: 50.0%

ëŒ€í˜• ë³‘ì› (40/100 = 40%)
  ì‹¤ì œ ì „í™˜ìœ¨: 40.0%
  ë² ì´ì§€ì•ˆ ì ìˆ˜: 39.1%
  ì‹ ë¢°ë„: 90.9%

ë¶€ì§„ ë³‘ì› (1/20 = 5%)
  ì‹¤ì œ ì „í™˜ìœ¨: 5.0%
  ë² ì´ì§€ì•ˆ ì ìˆ˜: 13.3%
  ì‹ ë¢°ë„: 66.7%

ğŸ’¡ í•´ì„:
- ì‹ ìƒ ë³‘ì›: 100%ì§€ë§Œ ë°ì´í„° ë¶€ì¡± â†’ ì ìˆ˜ ë‚®ìŒ (ì „ì²´ í‰ê· ì— ê°€ê¹Œì›€)
- ëŒ€í˜• ë³‘ì›: ì‹¤ì œ 40%ì— ê°€ê¹Œìš´ ì ìˆ˜ (ë°ì´í„° ë§ì•„ì„œ ì‹ ë¢°ë„ ë†’ìŒ)
```

---

## ğŸ“ ê³ ê¸‰ ê¸°ëŠ¥

### 1. ì°¨ì›ë³„ ì„±ê³¼

ë³‘ì›ì€ ë‹¤ì–‘í•œ ì°¨ì›ì—ì„œ ì„±ê³¼ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ:

```sql
-- ë³‘ì› 1ì˜ ì½”ì„±í˜• ì„±ê³¼
SELECT * FROM hospital_performance_stats
WHERE hospital_id = 1 AND treatment_id = 1;

-- ë³‘ì› 1ì˜ í•œêµ­ì¸ ëŒ€ìƒ ì„±ê³¼
SELECT * FROM hospital_performance_stats
WHERE hospital_id = 1 AND country = 'KR';

-- ë³‘ì› 1ì˜ ì „ì²´ ì„±ê³¼
SELECT * FROM hospital_performance_stats
WHERE hospital_id = 1 
  AND treatment_id IS NULL 
  AND country IS NULL 
  AND language IS NULL;
```

**í™œìš©**:
- ë³‘ì›ë§ˆë‹¤ ê°•ì  ì‹œìˆ /êµ­ê°€ê°€ ë‹¤ë¦„
- ì„¸ë¶„í™”ëœ ì¶”ì²œ ê°€ëŠ¥

---

### 2. ê¸°ê°„ë³„ íŠ¸ë Œë“œ

```sql
-- ì „ì²´ vs ìµœê·¼ 30ì¼ ë¹„êµ
SELECT 
  period,
  bayesian_score,
  sample_size
FROM hospital_performance_stats
WHERE hospital_id = 1
  AND treatment_id IS NULL
  AND period IN ('all_time', 'last_30d');
```

**í•´ì„**:
- last_30d > all_time: ğŸ”¥ ì„±ê³¼ ìƒìŠ¹
- last_30d < all_time: âš ï¸ ì„±ê³¼ í•˜ë½
- ì°¨ì´ í¬ë©´ ì¡°ì‚¬ í•„ìš”

---

### 3. ì†ë„ ì§€í‘œ

```sql
SELECT 
  hospital_name,
  avg_first_response_minutes / 60 as avg_response_hours,
  bayesian_score
FROM v_hospital_recommendations
WHERE treatment_id = 1
ORDER BY avg_first_response_minutes ASC;
```

**í™œìš©**:
- ì ìˆ˜ ë¹„ìŠ·í•˜ë©´ ë¹ ë¥¸ ë³‘ì› ìš°ì„ 
- ê¸´ê¸‰ ë¦¬ë“œëŠ” ì†ë„ ì¤‘ì‹œ

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ë°ì´í„° í’ˆì§ˆ
- âŒ hospital_responses ìƒíƒœê°€ ì •í™•í•˜ì§€ ì•Šìœ¼ë©´ â†’ ì˜ëª»ëœ í•™ìŠµ
- âœ… ì •ê¸°ì ìœ¼ë¡œ ë°ì´í„° ê²€ì¦ í•„ìš”

### 2. Cold Start ê·¹ë³µ
- ì‹ ê·œ ë³‘ì›ì€ ì´ˆê¸°ì— ë‚®ì€ ì ìˆ˜ (ì˜ë„ëœ ë™ì‘)
- ì†ŒëŸ‰ ì‹œë²” ì „ë‹¬ í›„ í‰ê°€
- ê¸‰ê²©í•œ ì¦ê°€ë³´ë‹¤ ì ì§„ì  ì¦ê°€

### 3. ì§‘ê³„ ì£¼ê¸°
- ì‹¤ì‹œê°„ ì•„ë‹˜ (ë°°ì¹˜ ì§‘ê³„)
- ë§¤ì¼ ìƒˆë²½ ìë™ ê°±ì‹  ê¶Œì¥
- ê¸´ê¸‰ ì‹œ ìˆ˜ë™ ì‹¤í–‰: `refresh`

### 4. ë‹¤ì°¨ì› ë°ì´í„°
- ì°¨ì›ì´ ë§ì„ìˆ˜ë¡ ë°ì´í„° í¬ì†Œ
- ë„ˆë¬´ ì„¸ë¶„í™”í•˜ì§€ ë§ ê²ƒ
- ì „ì²´ â†’ ì‹œìˆ ë³„ â†’ êµ­ê°€ë³„ ìˆœìœ¼ë¡œ í™•ì¥

---

## ğŸ“ˆ ê¸°ëŒ€ íš¨ê³¼

### Before (ìˆ˜ë™ íŒë‹¨)
```
ìš´ì˜ì ê°ìœ¼ë¡œ ë³‘ì› ì„ íƒ
â†“
ì¼ë¶€ ë³‘ì› í¸ì¤‘
â†“
ì‹ ê·œ ë³‘ì› ì‹œë„ ì–´ë ¤ì›€
â†“
ìµœì í™” ë¶ˆê°€ëŠ¥
```

### After (ë°ì´í„° ê¸°ë°˜)
```
ë² ì´ì§€ì•ˆ ì ìˆ˜ ê¸°ë°˜ ì¶”ì²œ
â†“
ì„±ê³¼ ì¢‹ì€ ë³‘ì›ì— ìì—°ìŠ¤ëŸ½ê²Œ ì§‘ì¤‘
â†“
ì‹ ê·œ ë³‘ì›ë„ ê³µì •í•˜ê²Œ í‰ê°€
â†“
ì§€ì†ì  ìµœì í™”
```

### ì˜ˆìƒ ê°œì„ 
- ğŸ“Š í‰ê·  ì „í™˜ìœ¨: 30% â†’ 35-40% (10-30% í–¥ìƒ)
- â±ï¸ ë³‘ì› ì„ ì • ì‹œê°„: 10ë¶„ â†’ 1ë¶„ (90% ì ˆê°)
- ğŸ¯ ì‹ ê·œ ë³‘ì› ë°œêµ´: ì–´ë ¤ì›€ â†’ ìë™ (ê³µì •í•œ ê¸°íšŒ)

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### Q1. ì ìˆ˜ê°€ ëª¨ë‘ ë¹„ìŠ·í•´ìš”
**A**: 
- ì •ìƒì…ë‹ˆë‹¤ (ë°ì´í„° ë¶€ì¡± ì´ˆê¸°)
- ë°ì´í„° ìŒ“ì´ë©´ ì°¨ì´ ë°œìƒ
- ê°•ì œë¡œ ì°¨ì´ ë§Œë“¤ì§€ ë§ ê²ƒ

### Q2. ì‹ ê·œ ë³‘ì› ì ìˆ˜ê°€ ë„ˆë¬´ ë‚®ì•„ìš”
**A**:
- ì˜ë„ëœ ë™ì‘ (Cold Start ë³´í˜¸)
- m ê°’ì„ ë‚®ì¶”ë©´ ë¹ ë¥´ê²Œ ë°˜ì˜ (ìœ„í—˜ ì¦ê°€)
- ì†ŒëŸ‰ ì‹œë²” ì „ë‹¬ ê¶Œì¥

### Q3. ì ìˆ˜ê°€ ê°‘ìê¸° ë–¨ì–´ì¡Œì–´ìš”
**A**:
```sql
-- ìµœê·¼ ë°ì´í„° í™•ì¸
SELECT * FROM hospital_responses
WHERE hospital_name = '...'
  AND sent_at > NOW() - INTERVAL '7 days';
```
- ì‹¤ì œ ì„±ê³¼ í•˜ë½ ê°€ëŠ¥ì„±
- ë°ì´í„° ì˜¤ë¥˜ ê°€ëŠ¥ì„±
- ì›ì¸ íŒŒì•… í›„ ì¡°ì¹˜

### Q4. ì§‘ê³„ê°€ ì•ˆ ë¼ìš”
**A**:
```sql
-- í•¨ìˆ˜ ì¡´ì¬ í™•ì¸
SELECT * FROM pg_proc WHERE proname = 'refresh_hospital_performance_stats';

-- ìˆ˜ë™ ì‹¤í–‰ í…ŒìŠ¤íŠ¸
SELECT refresh_hospital_performance_stats();
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ë² ì´ì§€ì•ˆ ì¶”ì • (Bayesian Estimation)
- [Wikipedia: Bayesian Average](https://en.wikipedia.org/wiki/Bayesian_average)
- IMDB, Yelp ë“±ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë°©ì‹

### ì¶”ì²œ ì‹œìŠ¤í…œ
- Cold Start Problem
- Prior Belief
- Posterior Estimation

### ê´€ë ¨ ë¬¸ì„œ
- `P3_HOSPITAL_LEAD_SUMMARY.md` - ë¦¬ë“œ ì „ë‹¬ ê¸°ë³¸
- `OPERATIONAL_DASHBOARD_GUIDE.md` - ëŒ€ì‹œë³´ë“œ ê°€ì´ë“œ

---

## ğŸš€ ì‹œì‘í•˜ê¸°

### 1. DB ë§ˆì´ê·¸ë ˆì´ì…˜
```bash
# Supabase SQL Editorì—ì„œ ì‹¤í–‰
migrations/20260129_add_hospital_performance.sql
```

### 2. ì´ˆê¸° ì§‘ê³„
```bash
npx tsx scripts/hospital-performance-aggregator.ts refresh
```

### 3. ì¶”ì²œ ì¡°íšŒ í…ŒìŠ¤íŠ¸
```bash
npx tsx scripts/hospital-performance-aggregator.ts recommend --treatment 1 --country KR
```

### 4. Cron ì„¤ì • (ì„ íƒ)
```bash
crontab -e
# ì¶”ê°€:
0 2 * * * cd /path/to/healo && npx tsx scripts/hospital-performance-aggregator.ts refresh
```

---

**ì´ì œ ë°ì´í„°ê°€ ìŒ“ì´ë©´ì„œ ìë™ìœ¼ë¡œ í•™ìŠµí•©ë‹ˆë‹¤!** ğŸ“
