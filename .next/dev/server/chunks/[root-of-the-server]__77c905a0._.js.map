{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/HEALO_Demo/src/lib/rag/supabaseAdmin.ts"],"sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nconst supabaseUrl =\n  process.env.NEXT_PUBLIC_SUPABASE_URL || process.env.VITE_SUPABASE_URL;\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nif (!supabaseUrl || !serviceKey) {\n  const missing = [];\n  if (!supabaseUrl) missing.push(\"NEXT_PUBLIC_SUPABASE_URL/VITE_SUPABASE_URL\");\n  if (!serviceKey) missing.push(\"SUPABASE_SERVICE_ROLE_KEY\");\n  throw new Error(`Supabase admin env missing: ${missing.join(\", \")}`);\n}\n\nexport const supabaseAdmin = createClient(supabaseUrl, serviceKey, {\n  auth: { persistSession: false },\n});\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cACJ,gFAAwC,QAAQ,GAAG,CAAC,iBAAiB;AACvE,MAAM,aAAa,QAAQ,GAAG,CAAC,yBAAyB;AAExD,IAAI,CAAC,eAAe,CAAC,YAAY;IAC/B,MAAM,UAAU,EAAE;IAClB;;IACA,IAAI,CAAC,YAAY,QAAQ,IAAI,CAAC;IAC9B,MAAM,IAAI,MAAM,CAAC,4BAA4B,EAAE,QAAQ,IAAI,CAAC,OAAO;AACrE;AAEO,MAAM,gBAAgB,IAAA,gMAAY,EAAC,aAAa,YAAY;IACjE,MAAM;QAAE,gBAAgB;IAAM;AAChC"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/HEALO_Demo/app/api/inquiries/event/route.ts"],"sourcesContent":["/**\n * HEALO: Inquiry Funnel 이벤트 수집 API (서버 전용)\n * step1_viewed, step1_submitted, step2_viewed, step2_submitted\n */\n\nimport { supabaseAdmin } from \"../../../../src/lib/rag/supabaseAdmin\";\nimport { NextRequest } from \"next/server\";\n\nconst ALLOWED_EVENT_TYPES = [\n  \"step1_viewed\",\n  \"step1_submitted\",\n  \"step2_viewed\",\n  \"step2_submitted\",\n] as const;\n\ntype EventType = (typeof ALLOWED_EVENT_TYPES)[number];\n\nconst REQUIRES_INQUIRY_ID: EventType[] = [\"step1_submitted\", \"step2_viewed\", \"step2_submitted\"];\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json().catch(() => ({}));\n    const eventType = body?.eventType ? String(body.eventType) : null;\n    const inquiryId = body?.inquiryId != null\n      ? (typeof body.inquiryId === \"number\" ? body.inquiryId : Number(body.inquiryId))\n      : null;\n    const meta = body?.meta && typeof body.meta === \"object\" && !Array.isArray(body.meta)\n      ? body.meta\n      : {};\n\n    if (!eventType || !ALLOWED_EVENT_TYPES.includes(eventType as EventType)) {\n      return Response.json(\n        { ok: false, error: \"invalid_event_type\", allowed: ALLOWED_EVENT_TYPES },\n        { status: 400 }\n      );\n    }\n\n    if (REQUIRES_INQUIRY_ID.includes(eventType as EventType)) {\n      if (inquiryId == null || isNaN(inquiryId)) {\n        return Response.json(\n          { ok: false, error: \"inquiry_id_required\" },\n          { status: 400 }\n        );\n      }\n    }\n\n    const { error: insertError } = await supabaseAdmin\n      .from(\"inquiry_events\")\n      .insert({\n        inquiry_id: inquiryId || null,\n        event_type: eventType,\n        meta,\n      });\n\n    if (insertError) {\n      console.error(\"[api/inquiries/event] insert error:\", insertError);\n      return Response.json(\n        { ok: false, error: \"event_insert_failed\" },\n        { status: 500 }\n      );\n    }\n\n    console.log(\"[api/inquiries/event] success:\", { eventType, inquiryId });\n    return Response.json({ ok: true });\n  } catch (error: any) {\n    console.error(\"[api/inquiries/event] error:\", error);\n    return Response.json(\n      { ok: false, error: error?.message || \"event_failed\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GAED;;AAGA,MAAM,sBAAsB;IAC1B;IACA;IACA;IACA;CACD;AAID,MAAM,sBAAmC;IAAC;IAAmB;IAAgB;CAAkB;AAExF,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QACjD,MAAM,YAAY,MAAM,YAAY,OAAO,KAAK,SAAS,IAAI;QAC7D,MAAM,YAAY,MAAM,aAAa,OAChC,OAAO,KAAK,SAAS,KAAK,WAAW,KAAK,SAAS,GAAG,OAAO,KAAK,SAAS,IAC5E;QACJ,MAAM,OAAO,MAAM,QAAQ,OAAO,KAAK,IAAI,KAAK,YAAY,CAAC,MAAM,OAAO,CAAC,KAAK,IAAI,IAChF,KAAK,IAAI,GACT,CAAC;QAEL,IAAI,CAAC,aAAa,CAAC,oBAAoB,QAAQ,CAAC,YAAyB;YACvE,OAAO,SAAS,IAAI,CAClB;gBAAE,IAAI;gBAAO,OAAO;gBAAsB,SAAS;YAAoB,GACvE;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,oBAAoB,QAAQ,CAAC,YAAyB;YACxD,IAAI,aAAa,QAAQ,MAAM,YAAY;gBACzC,OAAO,SAAS,IAAI,CAClB;oBAAE,IAAI;oBAAO,OAAO;gBAAsB,GAC1C;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,MAAM,EAAE,OAAO,WAAW,EAAE,GAAG,MAAM,qJAAa,CAC/C,IAAI,CAAC,kBACL,MAAM,CAAC;YACN,YAAY,aAAa;YACzB,YAAY;YACZ;QACF;QAEF,IAAI,aAAa;YACf,QAAQ,KAAK,CAAC,uCAAuC;YACrD,OAAO,SAAS,IAAI,CAClB;gBAAE,IAAI;gBAAO,OAAO;YAAsB,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,kCAAkC;YAAE;YAAW;QAAU;QACrE,OAAO,SAAS,IAAI,CAAC;YAAE,IAAI;QAAK;IAClC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,SAAS,IAAI,CAClB;YAAE,IAAI;YAAO,OAAO,OAAO,WAAW;QAAe,GACrD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}