(()=>{var a={};a.id=276,a.ids=[276],a.modules={261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2280:(a,b,c)=>{"use strict";Object.defineProperty(b,"I",{enumerable:!0,get:function(){return g}});let d=c(8208),e=c(7617),f=c(2018);async function g(a,b,c,g){if((0,d.isNodeNextResponse)(b)){var h;b.statusCode=c.status,b.statusMessage=c.statusText;let d=["set-cookie","www-authenticate","proxy-authenticate","vary"];null==(h=c.headers)||h.forEach((a,c)=>{if("x-middleware-set-cookie"!==c.toLowerCase())if("set-cookie"===c.toLowerCase())for(let d of(0,f.splitCookiesString)(a))b.appendHeader(c,d);else{let e=void 0!==b.getHeader(c);(d.includes(c.toLowerCase())||!e)&&b.appendHeader(c,a)}});let{originalResponse:i}=b;c.body&&"HEAD"!==a.method?await (0,e.pipeToNodeResponse)(c.body,i,g):i.end()}}},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3042:(a,b,c)=>{"use strict";c.d(b,{BZ:()=>g,LY:()=>f,s6:()=>e});let d=["goal","chief_complaint","body_part","timeline","budget","attachments_present"];function e(a="ai_agent"){return{intake:{goal:null,chief_complaint:null,body_part:null,duration:null,severity:null,budget:null,timeline:null,contraindications:null,medical_history_flag:null,medications_flag:null,allergy_flag:null,previous_procedure_flag:null,attachments_present:null},meta:{pipeline_version:"v1",source_type:a,model:null,prompt_version:null}}}function f(a){let b=[];for(let c of d){let d=a[c];if("attachments_present"===c){null==d&&b.push(c);continue}null!=d&&("string"!=typeof d||String(d).trim())||b.push(c)}return b}function g(a,b){let c=d.length-b.length;return c<=0?0:Math.min(1,Math.round(c/d.length*100)/100)}},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},6612:(a,b,c)=>{"use strict";c.d(b,{FJ:()=>f,SH:()=>g,b2:()=>k,h7:()=>h,ir:()=>j,jR:()=>i});let d=[[/nose|rhinoplasty|nasal/i,"nose"],[/skin|acne|facial|laser|botox|filler/i,"skin"],[/breast|augmentation|implants/i,"breast"],[/hair|transplant|follicle/i,"hair"],[/eye|lasik|eyelid|double eyelid/i,"eye"],[/abdomen|tummy|liposuction|belly/i,"abdomen"],[/chin|jaw/i,"chin"],[/dental|implant|tooth|teeth/i,"dental"]],e=[[/allergy|allergic/i,"allergy"],[/medication|medicine|meds|drug/i,"medication"],[/diabetes|diabetic/i,"diabetes"],[/pregnant|pregnancy/i,"pregnant"]];function f(a){let b=String(a||"").toLowerCase();if(!b)return null;for(let[a,c]of d)if("string"==typeof a?b.includes(a):a.test(b))return c;return null}function g(a){let b=String(a||"").toLowerCase(),c=[],d=!1,f=!1;for(let[a,g]of e)("string"==typeof a?b.includes(a):a.test(b))&&(c.push(g),"allergy"===g&&(d=!0),"medication"===g&&(f=!0));return{contraindications:c,allergy:d,medications:f}}function h(a){let b=String(a||"").toLowerCase();if(/\basap\b|as soon|urgent/i.test(b))return"asap";if(/1-3\s*month|1\s*to\s*3\s*m|within 3\s*m/i.test(b))return"1-3m";if(/3-6\s*month|3\s*to\s*6\s*m/i.test(b))return"3-6m";if(/6\s*month|6m\+|6m\s*plus/i.test(b))return"6m+";let c=b.match(/\b(20\d{2})-(\d{2})-(\d{2})\b/);if(c)return`preferred_date:${c[0]}`;let d=b.match(/\b(\d{1,2})\/(\d{1,2})\/(\d{4})\b/);return d?`preferred_date:${d[3]}-${d[1].padStart(2,"0")}-${d[2].padStart(2,"0")}`:null}function i(a){let b=String(a||"").toLowerCase();if(/\bbudget\b|price|cost|usd|won|\$|₩|krw/i.test(b)){let a=b.match(/(\d[\d,.]*)\s*(k|m|million|thousand)?\s*(usd|won|krw|\$|₩)?/i);return a?a[0].trim().slice(0,50):"mentioned"}return null}function j(a){let b=String(a||"").toLowerCase();return/\b1w\b|1\s*week/i.test(b)?"1w":/\b1m\b|1\s*month/i.test(b)?"1m":/\b3m\b|3\s*month/i.test(b)?"3m":/\b6m\b|6\s*month/i.test(b)?"6m":/\b1y\b|1\s*year|1y\+/i.test(b)?"1y+":null}function k(a){let b=String(a||"").toLowerCase();if(/\bmild\b|minor|slight/i.test(b))return"mild";if(/\bmedium\b|moderate/i.test(b))return"medium";if(/\bsevere\b|serious|bad/i.test(b))return"severe";let c=b.match(/\b([0-9]|10)\s*\/\s*10\b|\b([0-9]|10)-10\b/);return c?c[0].slice(0,20):null}},6874:a=>{"use strict";let b="u">typeof Buffer,c=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,d=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function e(a,e,g){null==g&&null!==e&&"object"==typeof e&&(g=e,e=void 0),b&&Buffer.isBuffer(a)&&(a=a.toString()),a&&65279===a.charCodeAt(0)&&(a=a.slice(1));let h=JSON.parse(a,e);if(null===h||"object"!=typeof h)return h;let i=g&&g.protoAction||"error",j=g&&g.constructorAction||"error";if("ignore"===i&&"ignore"===j)return h;if("ignore"!==i&&"ignore"!==j){if(!1===c.test(a)&&!1===d.test(a))return h}else if("ignore"!==i&&"ignore"===j){if(!1===c.test(a))return h}else if(!1===d.test(a))return h;return f(h,{protoAction:i,constructorAction:j,safe:g&&g.safe})}function f(a,{protoAction:b="error",constructorAction:c="error",safe:d}={}){let e=[a];for(;e.length;){let a=e;for(let f of(e=[],a)){if("ignore"!==b&&Object.prototype.hasOwnProperty.call(f,"__proto__")){if(!0===d)return null;if("error"===b)throw SyntaxError("Object contains forbidden prototype property");delete f.__proto__}if("ignore"!==c&&Object.prototype.hasOwnProperty.call(f,"constructor")&&Object.prototype.hasOwnProperty.call(f.constructor,"prototype")){if(!0===d)return null;if("error"===c)throw SyntaxError("Object contains forbidden prototype property");delete f.constructor}for(let a in f){let b=f[a];b&&"object"==typeof b&&e.push(b)}}}return a}function g(a,b,c){let d=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return e(a,b,c)}finally{Error.stackTraceLimit=d}}a.exports=g,a.exports.default=g,a.exports.parse=g,a.exports.safeParse=function(a,b){let c=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return e(a,b,{safe:!0})}catch(a){return null}finally{Error.stackTraceLimit=c}},a.exports.scan=f},7178:(a,b,c)=>{"use strict";let d,e;c.r(b),c.d(b,{handler:()=>gs,patchFetch:()=>gr,routeModule:()=>gn,serverHooks:()=>gq,workAsyncStorage:()=>go,workUnitAsyncStorage:()=>gp});var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K={};c.r(K),c.d(K,{POST:()=>gm});var L=c(9225),M=c(4006),N=c(8317),O=c(9373),P=c(4775),Q=c(4235),R=c(261),S=c(4365),T=c(771),U=c(3461),V=c(7798),W=c(2280),X=c(2018),Y=c(5696),Z=c(7929),$=c(6439),_=c(7527),aa="vercel.ai.error",ab=Symbol.for(aa),ac=class a extends Error{constructor({name:a,message:b,cause:c}){super(b),this[i]=!0,this.name=a,this.cause=c}static isInstance(b){return a.hasMarker(b,aa)}static hasMarker(a,b){let c=Symbol.for(b);return null!=a&&"object"==typeof a&&c in a&&"boolean"==typeof a[c]&&!0===a[c]}};i=ab;var ad=ac,ae="AI_APICallError",af=`vercel.ai.error.${ae}`,ag=Symbol.for(af),ah=class extends ad{constructor({message:a,url:b,requestBodyValues:c,statusCode:d,responseHeaders:e,responseBody:f,cause:g,isRetryable:h=null!=d&&(408===d||409===d||429===d||d>=500),data:i}){super({name:ae,message:a,cause:g}),this[j]=!0,this.url=b,this.requestBodyValues=c,this.statusCode=d,this.responseHeaders=e,this.responseBody=f,this.isRetryable=h,this.data=i}static isInstance(a){return ad.hasMarker(a,af)}};j=ag;var ai="AI_EmptyResponseBodyError",aj=`vercel.ai.error.${ai}`,ak=Symbol.for(aj),al=class extends ad{constructor({message:a="Empty response body"}={}){super({name:ai,message:a}),this[k]=!0}static isInstance(a){return ad.hasMarker(a,aj)}};function am(a){return null==a?"unknown error":"string"==typeof a?a:a instanceof Error?a.message:JSON.stringify(a)}k=ak;var an="AI_InvalidArgumentError",ao=`vercel.ai.error.${an}`,ap=Symbol.for(ao),aq=class extends ad{constructor({message:a,cause:b,argument:c}){super({name:an,message:a,cause:b}),this[l]=!0,this.argument=c}static isInstance(a){return ad.hasMarker(a,ao)}};l=ap;var ar="AI_InvalidPromptError",as=`vercel.ai.error.${ar}`,at=Symbol.for(as),au=class extends ad{constructor({prompt:a,message:b,cause:c}){super({name:ar,message:`Invalid prompt: ${b}`,cause:c}),this[m]=!0,this.prompt=a}static isInstance(a){return ad.hasMarker(a,as)}};m=at;var av="AI_InvalidResponseDataError",aw=`vercel.ai.error.${av}`,ax=Symbol.for(aw),ay=class extends ad{constructor({data:a,message:b=`Invalid response data: ${JSON.stringify(a)}.`}){super({name:av,message:b}),this[n]=!0,this.data=a}static isInstance(a){return ad.hasMarker(a,aw)}};n=ax;var az="AI_JSONParseError",aA=`vercel.ai.error.${az}`,aB=Symbol.for(aA),aC=class extends ad{constructor({text:a,cause:b}){super({name:az,message:`JSON parsing failed: Text: ${a}.
Error message: ${am(b)}`,cause:b}),this[o]=!0,this.text=a}static isInstance(a){return ad.hasMarker(a,aA)}};o=aB;var aD="AI_LoadAPIKeyError",aE=`vercel.ai.error.${aD}`,aF=Symbol.for(aE),aG=class extends ad{constructor({message:a}){super({name:aD,message:a}),this[p]=!0}static isInstance(a){return ad.hasMarker(a,aE)}};p=aF,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError");var aH="AI_TooManyEmbeddingValuesForCallError",aI=`vercel.ai.error.${aH}`,aJ=Symbol.for(aI),aK=class extends ad{constructor(a){super({name:aH,message:`Too many values for a single embedding call. The ${a.provider} model "${a.modelId}" can only embed up to ${a.maxEmbeddingsPerCall} values per call, but ${a.values.length} values were provided.`}),this[q]=!0,this.provider=a.provider,this.modelId=a.modelId,this.maxEmbeddingsPerCall=a.maxEmbeddingsPerCall,this.values=a.values}static isInstance(a){return ad.hasMarker(a,aI)}};q=aJ;var aL="AI_TypeValidationError",aM=`vercel.ai.error.${aL}`,aN=Symbol.for(aM),aO=class a extends ad{constructor({value:a,cause:b}){super({name:aL,message:`Type validation failed: Value: ${JSON.stringify(a)}.
Error message: ${am(b)}`,cause:b}),this[r]=!0,this.value=a}static isInstance(a){return ad.hasMarker(a,aM)}static wrap({value:b,cause:c}){return a.isInstance(c)&&c.value===b?c:new a({value:b,cause:c})}};r=aN;var aP="AI_UnsupportedFunctionalityError",aQ=`vercel.ai.error.${aP}`,aR=Symbol.for(aQ),aS=class extends ad{constructor({functionality:a,message:b=`'${a}' functionality not supported.`}){super({name:aP,message:b}),this[s]=!0,this.functionality=a}static isInstance(a){return ad.hasMarker(a,aQ)}};s=aR;var aT=c(6874);function aU(...a){return a.reduce((a,b)=>({...a,...null!=b?b:{}}),{})}async function aV(a){return null==a?Promise.resolve():new Promise(b=>setTimeout(b,a))}function aW(a){let b={};return a.headers.forEach((a,c)=>{b[c]=a}),b}var aX=({prefix:a,size:b=16,alphabet:c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:d="-"}={})=>{let e=((a,b=21)=>(c=b)=>{let d="",e=0|c;for(;e--;)d+=a[Math.random()*a.length|0];return d})(c,b);if(null==a)return e;if(c.includes(d))throw new aq({argument:"separator",message:`The separator "${d}" must not be part of the alphabet "${c}".`});return b=>`${a}${d}${e(b)}`},aY=aX();function aZ(a){return a instanceof Error&&("AbortError"===a.name||"TimeoutError"===a.name)}function a$({apiKey:a,environmentVariableName:b,apiKeyParameterName:c="apiKey",description:d}){if("string"==typeof a)return a;if(null!=a)throw new aG({message:`${d} API key must be a string.`});if("u"<typeof process)throw new aG({message:`${d} API key is missing. Pass it using the '${c}' parameter. Environment variables is not supported in this environment.`});if(null==(a=process.env[b]))throw new aG({message:`${d} API key is missing. Pass it using the '${c}' parameter or the ${b} environment variable.`});if("string"!=typeof a)throw new aG({message:`${d} API key must be a string. The value of the ${b} environment variable is not a string.`});return a}var a_=Symbol.for("vercel.ai.validator");function a0({value:a,schema:b}){var c;let d="object"==typeof b&&null!==b&&a_ in b&&!0===b[a_]&&"validate"in b?b:(c=b,{[a_]:!0,validate:a=>{let b=c.safeParse(a);return b.success?{success:!0,value:b.data}:{success:!1,error:b.error}}});try{if(null==d.validate)return{success:!0,value:a};let b=d.validate(a);if(b.success)return b;return{success:!1,error:aO.wrap({value:a,cause:b.error})}}catch(b){return{success:!1,error:aO.wrap({value:a,cause:b})}}}function a1({text:a,schema:b}){try{let c=aT.parse(a);if(null==b)return{success:!0,value:c,rawValue:c};let d=a0({value:c,schema:b});return d.success?{...d,rawValue:c}:d}catch(b){return{success:!1,error:aC.isInstance(b)?b:new aC({text:a,cause:b})}}}function a2(a){try{return aT.parse(a),!0}catch(a){return!1}}function a3({provider:a,providerOptions:b,schema:c}){if((null==b?void 0:b[a])==null)return;let d=a0({value:b[a],schema:c});if(!d.success)throw new aq({argument:"providerOptions",message:`invalid ${a} provider options`,cause:d.error});return d.value}var a4=()=>globalThis.fetch,a5=async({url:a,headers:b,body:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>a7({url:a,headers:{"Content-Type":"application/json",...b},body:{content:JSON.stringify(c),values:c},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),a6=async({url:a,headers:b,formData:c,failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g})=>a7({url:a,headers:b,body:{content:c,values:Object.fromEntries(c.entries())},failedResponseHandler:d,successfulResponseHandler:e,abortSignal:f,fetch:g}),a7=async({url:a,headers:b={},body:c,successfulResponseHandler:d,failedResponseHandler:e,abortSignal:f,fetch:g=a4()})=>{try{let h=await g(a,{method:"POST",headers:Object.fromEntries(Object.entries(b).filter(([a,b])=>null!=b)),body:c.content,signal:f}),i=aW(h);if(!h.ok){let b;try{b=await e({response:h,url:a,requestBodyValues:c.values})}catch(b){if(aZ(b)||ah.isInstance(b))throw b;throw new ah({message:"Failed to process error response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}throw b.value}try{return await d({response:h,url:a,requestBodyValues:c.values})}catch(b){if(b instanceof Error&&(aZ(b)||ah.isInstance(b)))throw b;throw new ah({message:"Failed to process successful response",cause:b,statusCode:h.status,url:a,responseHeaders:i,requestBodyValues:c.values})}}catch(b){if(aZ(b))throw b;if(b instanceof TypeError&&"fetch failed"===b.message){let d=b.cause;if(null!=d)throw new ah({message:`Cannot connect to API: ${d.message}`,cause:d,url:a,requestBodyValues:c.values,isRetryable:!0})}throw b}};async function a8(a){return"function"==typeof a&&(a=a()),Promise.resolve(a)}var a9=({errorSchema:a,errorToMessage:b,isRetryable:c})=>async({response:d,url:e,requestBodyValues:f})=>{let g=await d.text(),h=aW(d);if(""===g.trim())return{responseHeaders:h,value:new ah({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})};try{let i=function({text:a,schema:b}){try{let c=aT.parse(a);if(null==b)return c;return function({value:a,schema:b}){let c=a0({value:a,schema:b});if(!c.success)throw aO.wrap({value:a,cause:c.error});return c.value}({value:c,schema:b})}catch(b){if(aC.isInstance(b)||aO.isInstance(b))throw b;throw new aC({text:a,cause:b})}}({text:g,schema:a});return{responseHeaders:h,value:new ah({message:b(i),url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,data:i,isRetryable:null==c?void 0:c(d,i)})}}catch(a){return{responseHeaders:h,value:new ah({message:d.statusText,url:e,requestBodyValues:f,statusCode:d.status,responseHeaders:h,responseBody:g,isRetryable:null==c?void 0:c(d)})}}},ba=a=>async({response:b})=>{let c=aW(b);if(null==b.body)throw new al({});return{responseHeaders:c,value:b.body.pipeThrough(new TextDecoderStream).pipeThrough(function(){let a,b,c,d="",e=[];function f(a,b){if(""===a)return void g(b);if(a.startsWith(":"))return;let c=a.indexOf(":");if(-1===c)return void h(a,"");let d=a.slice(0,c),e=c+1;h(d,e<a.length&&" "===a[e]?a.slice(e+1):a.slice(e))}function g(d){e.length>0&&(d.enqueue({event:a,data:e.join("\n"),id:b,retry:c}),e=[],a=void 0,c=void 0)}function h(d,f){switch(d){case"event":a=f;break;case"data":e.push(f);break;case"id":b=f;break;case"retry":let g=parseInt(f,10);isNaN(g)||(c=g)}}return new TransformStream({transform(a,b){let{lines:c,incompleteLine:e}=function(a,b){let c=[],d=a;for(let a=0;a<b.length;){let e=b[a++];"\n"===e?(c.push(d),d=""):"\r"===e?(c.push(d),d="","\n"===b[a]&&a++):d+=e}return{lines:c,incompleteLine:d}}(d,a);d=e;for(let a=0;a<c.length;a++)f(c[a],b)},flush(a){f(d,a),g(a)}})}()).pipeThrough(new TransformStream({transform({data:b},c){"[DONE]"!==b&&c.enqueue(a1({text:b,schema:a}))}}))}},bb=a=>async({response:b,url:c,requestBodyValues:d})=>{let e=await b.text(),f=a1({text:e,schema:a}),g=aW(b);if(!f.success)throw new ah({message:"Invalid JSON response",cause:f.error,statusCode:b.status,responseHeaders:g,responseBody:e,url:c,requestBodyValues:d});return{responseHeaders:g,value:f.value,rawValue:f.rawValue}},{btoa:bc,atob:bd}=globalThis;function be(a){let b=bd(a.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(b,a=>a.codePointAt(0))}function bf(a){let b="";for(let c=0;c<a.length;c++)b+=String.fromCodePoint(a[c]);return bc(b)}function bg(a){return null==a?void 0:a.replace(/\/$/,"")}var bh=c(9774),bi=c(3045);(f=t||(t={})).assertEqual=a=>{},f.assertIs=function(a){},f.assertNever=function(a){throw Error()},f.arrayToEnum=a=>{let b={};for(let c of a)b[c]=c;return b},f.getValidEnumValues=a=>{let b=f.objectKeys(a).filter(b=>"number"!=typeof a[a[b]]),c={};for(let d of b)c[d]=a[d];return f.objectValues(c)},f.objectValues=a=>f.objectKeys(a).map(function(b){return a[b]}),f.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let b=[];for(let c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.push(c);return b},f.find=(a,b)=>{for(let c of a)if(b(c))return c},f.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&Number.isFinite(a)&&Math.floor(a)===a,f.joinValues=function(a,b=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(b)},f.jsonStringifyReplacer=(a,b)=>"bigint"==typeof b?b.toString():b,(u||(u={})).mergeShapes=(a,b)=>({...a,...b});let bj=t.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),bk=a=>{switch(typeof a){case"undefined":return bj.undefined;case"string":return bj.string;case"number":return Number.isNaN(a)?bj.nan:bj.number;case"boolean":return bj.boolean;case"function":return bj.function;case"bigint":return bj.bigint;case"symbol":return bj.symbol;case"object":if(Array.isArray(a))return bj.array;if(null===a)return bj.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return bj.promise;if("u">typeof Map&&a instanceof Map)return bj.map;if("u">typeof Set&&a instanceof Set)return bj.set;if("u">typeof Date&&a instanceof Date)return bj.date;return bj.object;default:return bj.unknown}},bl=t.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class bm extends Error{get errors(){return this.issues}constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};const b=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,b):this.__proto__=b,this.name="ZodError",this.issues=a}format(a){let b=a||function(a){return a.message},c={_errors:[]},d=a=>{for(let e of a.issues)if("invalid_union"===e.code)e.unionErrors.map(d);else if("invalid_return_type"===e.code)d(e.returnTypeError);else if("invalid_arguments"===e.code)d(e.argumentsError);else if(0===e.path.length)c._errors.push(b(e));else{let a=c,d=0;for(;d<e.path.length;){let c=e.path[d];d===e.path.length-1?(a[c]=a[c]||{_errors:[]},a[c]._errors.push(b(e))):a[c]=a[c]||{_errors:[]},a=a[c],d++}}};return d(this),c}static assert(a){if(!(a instanceof bm))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,t.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let b={},c=[];for(let d of this.issues)if(d.path.length>0){let c=d.path[0];b[c]=b[c]||[],b[c].push(a(d))}else c.push(a(d));return{formErrors:c,fieldErrors:b}}get formErrors(){return this.flatten()}}bm.create=a=>new bm(a);let bn=(a,b)=>{let c;switch(a.code){case bl.invalid_type:c=a.received===bj.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case bl.invalid_literal:c=`Invalid literal value, expected ${JSON.stringify(a.expected,t.jsonStringifyReplacer)}`;break;case bl.unrecognized_keys:c=`Unrecognized key(s) in object: ${t.joinValues(a.keys,", ")}`;break;case bl.invalid_union:c="Invalid input";break;case bl.invalid_union_discriminator:c=`Invalid discriminator value. Expected ${t.joinValues(a.options)}`;break;case bl.invalid_enum_value:c=`Invalid enum value. Expected ${t.joinValues(a.options)}, received '${a.received}'`;break;case bl.invalid_arguments:c="Invalid function arguments";break;case bl.invalid_return_type:c="Invalid function return type";break;case bl.invalid_date:c="Invalid date";break;case bl.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(c=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(c=`${c} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?c=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?c=`Invalid input: must end with "${a.validation.endsWith}"`:t.assertNever(a.validation):c="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case bl.too_small:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type||"bigint"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case bl.too_big:c="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case bl.custom:c="Invalid input";break;case bl.invalid_intersection_types:c="Intersection results could not be merged";break;case bl.not_multiple_of:c=`Number must be a multiple of ${a.multipleOf}`;break;case bl.not_finite:c="Number must be finite";break;default:c=b.defaultError,t.assertNever(a)}return{message:c}};(g=v||(v={})).errToObj=a=>"string"==typeof a?{message:a}:a||{},g.toString=a=>"string"==typeof a?a:a?.message;let bo=a=>{let{data:b,path:c,errorMaps:d,issueData:e}=a,f=[...c,...e.path||[]],g={...e,path:f};if(void 0!==e.message)return{...e,path:f,message:e.message};let h="";for(let a of d.filter(a=>!!a).slice().reverse())h=a(g,{data:b,defaultError:h}).message;return{...e,path:f,message:h}};function bp(a,b){let c=bo({issueData:b,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,bn,void 0].filter(a=>!!a)});a.common.issues.push(c)}class bq{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,b){let c=[];for(let d of b){if("aborted"===d.status)return br;"dirty"===d.status&&a.dirty(),c.push(d.value)}return{status:a.value,value:c}}static async mergeObjectAsync(a,b){let c=[];for(let a of b){let b=await a.key,d=await a.value;c.push({key:b,value:d})}return bq.mergeObjectSync(a,c)}static mergeObjectSync(a,b){let c={};for(let d of b){let{key:b,value:e}=d;if("aborted"===b.status||"aborted"===e.status)return br;"dirty"===b.status&&a.dirty(),"dirty"===e.status&&a.dirty(),"__proto__"!==b.value&&(void 0!==e.value||d.alwaysSet)&&(c[b.value]=e.value)}return{status:a.value,value:c}}}let br=Object.freeze({status:"aborted"}),bs=a=>({status:"dirty",value:a}),bt=a=>({status:"valid",value:a}),bu=a=>"u">typeof Promise&&a instanceof Promise;class bv{constructor(a,b,c,d){this._cachedPath=[],this.parent=a,this.data=b,this._path=c,this._key=d}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let bw=(a,b)=>{if("valid"===b.status)return{success:!0,data:b.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let b=new bm(a.common.issues);return this._error=b,this._error}}};function bx(a){if(!a)return{};let{errorMap:b,invalid_type_error:c,required_error:d,description:e}=a;if(b&&(c||d))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return b?{errorMap:b,description:e}:{errorMap:(b,e)=>{let{message:f}=a;return"invalid_enum_value"===b.code?{message:f??e.defaultError}:void 0===e.data?{message:f??d??e.defaultError}:"invalid_type"!==b.code?{message:e.defaultError}:{message:f??c??e.defaultError}},description:e}}class by{get description(){return this._def.description}_getType(a){return bk(a.data)}_getOrReturnCtx(a,b){return b||{common:a.parent.common,data:a.data,parsedType:bk(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new bq,ctx:{common:a.parent.common,data:a.data,parsedType:bk(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let b=this._parse(a);if(bu(b))throw Error("Synchronous parse encountered promise.");return b}_parseAsync(a){return Promise.resolve(this._parse(a))}parse(a,b){let c=this.safeParse(a,b);if(c.success)return c.data;throw c.error}safeParse(a,b){let c={common:{issues:[],async:b?.async??!1,contextualErrorMap:b?.errorMap},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:bk(a)},d=this._parseSync({data:a,path:c.path,parent:c});return bw(c,d)}"~validate"(a){let b={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:bk(a)};if(!this["~standard"].async)try{let c=this._parseSync({data:a,path:[],parent:b});return"valid"===c.status?{value:c.value}:{issues:b.common.issues}}catch(a){a?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),b.common={issues:[],async:!0}}return this._parseAsync({data:a,path:[],parent:b}).then(a=>"valid"===a.status?{value:a.value}:{issues:b.common.issues})}async parseAsync(a,b){let c=await this.safeParseAsync(a,b);if(c.success)return c.data;throw c.error}async safeParseAsync(a,b){let c={common:{issues:[],contextualErrorMap:b?.errorMap,async:!0},path:b?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:bk(a)},d=this._parse({data:a,path:c.path,parent:c});return bw(c,await (bu(d)?d:Promise.resolve(d)))}refine(a,b){return this._refinement((c,d)=>{let e=a(c),f=()=>d.addIssue({code:bl.custom,..."string"==typeof b||void 0===b?{message:b}:"function"==typeof b?b(c):b});return"u">typeof Promise&&e instanceof Promise?e.then(a=>!!a||(f(),!1)):!!e||(f(),!1)})}refinement(a,b){return this._refinement((c,d)=>!!a(c)||(d.addIssue("function"==typeof b?b(c,d):b),!1))}_refinement(a){return new ch({schema:this,typeName:w.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:a=>this["~validate"](a)}}optional(){return ci.create(this,this._def)}nullable(){return cj.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return b0.create(this)}promise(){return cg.create(this,this._def)}or(a){return b2.create([this,a],this._def)}and(a){return b5.create(this,a,this._def)}transform(a){return new ch({...bx(this._def),schema:this,typeName:w.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new ck({...bx(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:w.ZodDefault})}brand(){return new cn({typeName:w.ZodBranded,type:this,...bx(this._def)})}catch(a){return new cl({...bx(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:w.ZodCatch})}describe(a){return new this.constructor({...this._def,description:a})}pipe(a){return co.create(this,a)}readonly(){return cp.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let bz=/^c[^\s-]{8,}$/i,bA=/^[0-9a-z]+$/,bB=/^[0-9A-HJKMNP-TV-Z]{26}$/i,bC=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,bD=/^[a-z0-9_-]{21}$/i,bE=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bG=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,bH=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,bI=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,bJ=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,bK=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,bL=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,bM=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,bN="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",bO=RegExp(`^${bN}$`);function bP(a){let b="[0-5]\\d";a.precision?b=`${b}\\.\\d{${a.precision}}`:null==a.precision&&(b=`${b}(\\.\\d+)?`);let c=a.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${b})${c}`}class bQ extends by{_parse(a){var b,c,e,f;let g;if(this._def.coerce&&(a.data=String(a.data)),this._getType(a)!==bj.string){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.string,received:b.parsedType}),br}let h=new bq;for(let i of this._def.checks)if("min"===i.kind)a.data.length<i.value&&(bp(g=this._getOrReturnCtx(a,g),{code:bl.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("max"===i.kind)a.data.length>i.value&&(bp(g=this._getOrReturnCtx(a,g),{code:bl.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),h.dirty());else if("length"===i.kind){let b=a.data.length>i.value,c=a.data.length<i.value;(b||c)&&(g=this._getOrReturnCtx(a,g),b?bp(g,{code:bl.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):c&&bp(g,{code:bl.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),h.dirty())}else if("email"===i.kind)bG.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"email",code:bl.invalid_string,message:i.message}),h.dirty());else if("emoji"===i.kind)d||(d=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),d.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"emoji",code:bl.invalid_string,message:i.message}),h.dirty());else if("uuid"===i.kind)bC.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"uuid",code:bl.invalid_string,message:i.message}),h.dirty());else if("nanoid"===i.kind)bD.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"nanoid",code:bl.invalid_string,message:i.message}),h.dirty());else if("cuid"===i.kind)bz.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"cuid",code:bl.invalid_string,message:i.message}),h.dirty());else if("cuid2"===i.kind)bA.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"cuid2",code:bl.invalid_string,message:i.message}),h.dirty());else if("ulid"===i.kind)bB.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"ulid",code:bl.invalid_string,message:i.message}),h.dirty());else if("url"===i.kind)try{new URL(a.data)}catch{bp(g=this._getOrReturnCtx(a,g),{validation:"url",code:bl.invalid_string,message:i.message}),h.dirty()}else"regex"===i.kind?(i.regex.lastIndex=0,i.regex.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"regex",code:bl.invalid_string,message:i.message}),h.dirty())):"trim"===i.kind?a.data=a.data.trim():"includes"===i.kind?a.data.includes(i.value,i.position)||(bp(g=this._getOrReturnCtx(a,g),{code:bl.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),h.dirty()):"toLowerCase"===i.kind?a.data=a.data.toLowerCase():"toUpperCase"===i.kind?a.data=a.data.toUpperCase():"startsWith"===i.kind?a.data.startsWith(i.value)||(bp(g=this._getOrReturnCtx(a,g),{code:bl.invalid_string,validation:{startsWith:i.value},message:i.message}),h.dirty()):"endsWith"===i.kind?a.data.endsWith(i.value)||(bp(g=this._getOrReturnCtx(a,g),{code:bl.invalid_string,validation:{endsWith:i.value},message:i.message}),h.dirty()):"datetime"===i.kind?(function(a){let b=`${bN}T${bP(a)}`,c=[];return c.push(a.local?"Z?":"Z"),a.offset&&c.push("([+-]\\d{2}:?\\d{2})"),b=`${b}(${c.join("|")})`,RegExp(`^${b}$`)})(i).test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{code:bl.invalid_string,validation:"datetime",message:i.message}),h.dirty()):"date"===i.kind?bO.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{code:bl.invalid_string,validation:"date",message:i.message}),h.dirty()):"time"===i.kind?RegExp(`^${bP(i)}$`).test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{code:bl.invalid_string,validation:"time",message:i.message}),h.dirty()):"duration"===i.kind?bF.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"duration",code:bl.invalid_string,message:i.message}),h.dirty()):"ip"===i.kind?(b=a.data,!(("v4"===(c=i.version)||!c)&&bH.test(b)||("v6"===c||!c)&&bJ.test(b))&&1&&(bp(g=this._getOrReturnCtx(a,g),{validation:"ip",code:bl.invalid_string,message:i.message}),h.dirty())):"jwt"===i.kind?!function(a,b){if(!bE.test(a))return!1;try{let[c]=a.split(".");if(!c)return!1;let d=c.replace(/-/g,"+").replace(/_/g,"/").padEnd(c.length+(4-c.length%4)%4,"="),e=JSON.parse(atob(d));if("object"!=typeof e||null===e||"typ"in e&&e?.typ!=="JWT"||!e.alg||b&&e.alg!==b)return!1;return!0}catch{return!1}}(a.data,i.alg)&&(bp(g=this._getOrReturnCtx(a,g),{validation:"jwt",code:bl.invalid_string,message:i.message}),h.dirty()):"cidr"===i.kind?(e=a.data,!(("v4"===(f=i.version)||!f)&&bI.test(e)||("v6"===f||!f)&&bK.test(e))&&1&&(bp(g=this._getOrReturnCtx(a,g),{validation:"cidr",code:bl.invalid_string,message:i.message}),h.dirty())):"base64"===i.kind?bL.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"base64",code:bl.invalid_string,message:i.message}),h.dirty()):"base64url"===i.kind?bM.test(a.data)||(bp(g=this._getOrReturnCtx(a,g),{validation:"base64url",code:bl.invalid_string,message:i.message}),h.dirty()):t.assertNever(i);return{status:h.value,value:a.data}}_regex(a,b,c){return this.refinement(b=>a.test(b),{validation:b,code:bl.invalid_string,...v.errToObj(c)})}_addCheck(a){return new bQ({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...v.errToObj(a)})}url(a){return this._addCheck({kind:"url",...v.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...v.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...v.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...v.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...v.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...v.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...v.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...v.errToObj(a)})}base64url(a){return this._addCheck({kind:"base64url",...v.errToObj(a)})}jwt(a){return this._addCheck({kind:"jwt",...v.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...v.errToObj(a)})}cidr(a){return this._addCheck({kind:"cidr",...v.errToObj(a)})}datetime(a){return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===a?.precision?null:a?.precision,offset:a?.offset??!1,local:a?.local??!1,...v.errToObj(a?.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===a?.precision?null:a?.precision,...v.errToObj(a?.message)})}duration(a){return this._addCheck({kind:"duration",...v.errToObj(a)})}regex(a,b){return this._addCheck({kind:"regex",regex:a,...v.errToObj(b)})}includes(a,b){return this._addCheck({kind:"includes",value:a,position:b?.position,...v.errToObj(b?.message)})}startsWith(a,b){return this._addCheck({kind:"startsWith",value:a,...v.errToObj(b)})}endsWith(a,b){return this._addCheck({kind:"endsWith",value:a,...v.errToObj(b)})}min(a,b){return this._addCheck({kind:"min",value:a,...v.errToObj(b)})}max(a,b){return this._addCheck({kind:"max",value:a,...v.errToObj(b)})}length(a,b){return this._addCheck({kind:"length",value:a,...v.errToObj(b)})}nonempty(a){return this.min(1,v.errToObj(a))}trim(){return new bQ({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new bQ({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new bQ({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isCIDR(){return!!this._def.checks.find(a=>"cidr"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get isBase64url(){return!!this._def.checks.find(a=>"base64url"===a.kind)}get minLength(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxLength(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}bQ.create=a=>new bQ({checks:[],typeName:w.ZodString,coerce:a?.coerce??!1,...bx(a)});class bR extends by{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let b;if(this._def.coerce&&(a.data=Number(a.data)),this._getType(a)!==bj.number){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.number,received:b.parsedType}),br}let c=new bq;for(let d of this._def.checks)"int"===d.kind?t.isInteger(a.data)||(bp(b=this._getOrReturnCtx(a,b),{code:bl.invalid_type,expected:"integer",received:"float",message:d.message}),c.dirty()):"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.too_small,minimum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.too_big,maximum:d.value,type:"number",inclusive:d.inclusive,exact:!1,message:d.message}),c.dirty()):"multipleOf"===d.kind?0!==function(a,b){let c=(a.toString().split(".")[1]||"").length,d=(b.toString().split(".")[1]||"").length,e=c>d?c:d;return Number.parseInt(a.toFixed(e).replace(".",""))%Number.parseInt(b.toFixed(e).replace(".",""))/10**e}(a.data,d.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):"finite"===d.kind?Number.isFinite(a.data)||(bp(b=this._getOrReturnCtx(a,b),{code:bl.not_finite,message:d.message}),c.dirty()):t.assertNever(d);return{status:c.value,value:a.data}}gte(a,b){return this.setLimit("min",a,!0,v.toString(b))}gt(a,b){return this.setLimit("min",a,!1,v.toString(b))}lte(a,b){return this.setLimit("max",a,!0,v.toString(b))}lt(a,b){return this.setLimit("max",a,!1,v.toString(b))}setLimit(a,b,c,d){return new bR({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:v.toString(d)}]})}_addCheck(a){return new bR({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:v.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:v.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:v.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:v.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:v.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:v.toString(b)})}finite(a){return this._addCheck({kind:"finite",message:v.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:v.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:v.toString(a)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&t.isInteger(a.value))}get isFinite(){let a=null,b=null;for(let c of this._def.checks)if("finite"===c.kind||"int"===c.kind||"multipleOf"===c.kind)return!0;else"min"===c.kind?(null===b||c.value>b)&&(b=c.value):"max"===c.kind&&(null===a||c.value<a)&&(a=c.value);return Number.isFinite(b)&&Number.isFinite(a)}}bR.create=a=>new bR({checks:[],typeName:w.ZodNumber,coerce:a?.coerce||!1,...bx(a)});class bS extends by{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let b;if(this._def.coerce)try{a.data=BigInt(a.data)}catch{return this._getInvalidInput(a)}if(this._getType(a)!==bj.bigint)return this._getInvalidInput(a);let c=new bq;for(let d of this._def.checks)"min"===d.kind?(d.inclusive?a.data<d.value:a.data<=d.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.too_small,type:"bigint",minimum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"max"===d.kind?(d.inclusive?a.data>d.value:a.data>=d.value)&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.too_big,type:"bigint",maximum:d.value,inclusive:d.inclusive,message:d.message}),c.dirty()):"multipleOf"===d.kind?a.data%d.value!==BigInt(0)&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.not_multiple_of,multipleOf:d.value,message:d.message}),c.dirty()):t.assertNever(d);return{status:c.value,value:a.data}}_getInvalidInput(a){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.bigint,received:b.parsedType}),br}gte(a,b){return this.setLimit("min",a,!0,v.toString(b))}gt(a,b){return this.setLimit("min",a,!1,v.toString(b))}lte(a,b){return this.setLimit("max",a,!0,v.toString(b))}lt(a,b){return this.setLimit("max",a,!1,v.toString(b))}setLimit(a,b,c,d){return new bS({...this._def,checks:[...this._def.checks,{kind:a,value:b,inclusive:c,message:v.toString(d)}]})}_addCheck(a){return new bS({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:v.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:v.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:v.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:v.toString(a)})}multipleOf(a,b){return this._addCheck({kind:"multipleOf",value:a,message:v.toString(b)})}get minValue(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return a}get maxValue(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return a}}bS.create=a=>new bS({checks:[],typeName:w.ZodBigInt,coerce:a?.coerce??!1,...bx(a)});class bT extends by{_parse(a){if(this._def.coerce&&(a.data=!!a.data),this._getType(a)!==bj.boolean){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.boolean,received:b.parsedType}),br}return bt(a.data)}}bT.create=a=>new bT({typeName:w.ZodBoolean,coerce:a?.coerce||!1,...bx(a)});class bU extends by{_parse(a){let b;if(this._def.coerce&&(a.data=new Date(a.data)),this._getType(a)!==bj.date){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.date,received:b.parsedType}),br}if(Number.isNaN(a.data.getTime()))return bp(this._getOrReturnCtx(a),{code:bl.invalid_date}),br;let c=new bq;for(let d of this._def.checks)"min"===d.kind?a.data.getTime()<d.value&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.too_small,message:d.message,inclusive:!0,exact:!1,minimum:d.value,type:"date"}),c.dirty()):"max"===d.kind?a.data.getTime()>d.value&&(bp(b=this._getOrReturnCtx(a,b),{code:bl.too_big,message:d.message,inclusive:!0,exact:!1,maximum:d.value,type:"date"}),c.dirty()):t.assertNever(d);return{status:c.value,value:new Date(a.data.getTime())}}_addCheck(a){return new bU({...this._def,checks:[...this._def.checks,a]})}min(a,b){return this._addCheck({kind:"min",value:a.getTime(),message:v.toString(b)})}max(a,b){return this._addCheck({kind:"max",value:a.getTime(),message:v.toString(b)})}get minDate(){let a=null;for(let b of this._def.checks)"min"===b.kind&&(null===a||b.value>a)&&(a=b.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let b of this._def.checks)"max"===b.kind&&(null===a||b.value<a)&&(a=b.value);return null!=a?new Date(a):null}}bU.create=a=>new bU({checks:[],coerce:a?.coerce||!1,typeName:w.ZodDate,...bx(a)});class bV extends by{_parse(a){if(this._getType(a)!==bj.symbol){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.symbol,received:b.parsedType}),br}return bt(a.data)}}bV.create=a=>new bV({typeName:w.ZodSymbol,...bx(a)});class bW extends by{_parse(a){if(this._getType(a)!==bj.undefined){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.undefined,received:b.parsedType}),br}return bt(a.data)}}bW.create=a=>new bW({typeName:w.ZodUndefined,...bx(a)});class bX extends by{_parse(a){if(this._getType(a)!==bj.null){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.null,received:b.parsedType}),br}return bt(a.data)}}bX.create=a=>new bX({typeName:w.ZodNull,...bx(a)});class bY extends by{constructor(){super(...arguments),this._any=!0}_parse(a){return bt(a.data)}}bY.create=a=>new bY({typeName:w.ZodAny,...bx(a)});class bZ extends by{constructor(){super(...arguments),this._unknown=!0}_parse(a){return bt(a.data)}}bZ.create=a=>new bZ({typeName:w.ZodUnknown,...bx(a)});class b$ extends by{_parse(a){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.never,received:b.parsedType}),br}}b$.create=a=>new b$({typeName:w.ZodNever,...bx(a)});class b_ extends by{_parse(a){if(this._getType(a)!==bj.undefined){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.void,received:b.parsedType}),br}return bt(a.data)}}b_.create=a=>new b_({typeName:w.ZodVoid,...bx(a)});class b0 extends by{_parse(a){let{ctx:b,status:c}=this._processInputParams(a),d=this._def;if(b.parsedType!==bj.array)return bp(b,{code:bl.invalid_type,expected:bj.array,received:b.parsedType}),br;if(null!==d.exactLength){let a=b.data.length>d.exactLength.value,e=b.data.length<d.exactLength.value;(a||e)&&(bp(b,{code:a?bl.too_big:bl.too_small,minimum:e?d.exactLength.value:void 0,maximum:a?d.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:d.exactLength.message}),c.dirty())}if(null!==d.minLength&&b.data.length<d.minLength.value&&(bp(b,{code:bl.too_small,minimum:d.minLength.value,type:"array",inclusive:!0,exact:!1,message:d.minLength.message}),c.dirty()),null!==d.maxLength&&b.data.length>d.maxLength.value&&(bp(b,{code:bl.too_big,maximum:d.maxLength.value,type:"array",inclusive:!0,exact:!1,message:d.maxLength.message}),c.dirty()),b.common.async)return Promise.all([...b.data].map((a,c)=>d.type._parseAsync(new bv(b,a,b.path,c)))).then(a=>bq.mergeArray(c,a));let e=[...b.data].map((a,c)=>d.type._parseSync(new bv(b,a,b.path,c)));return bq.mergeArray(c,e)}get element(){return this._def.type}min(a,b){return new b0({...this._def,minLength:{value:a,message:v.toString(b)}})}max(a,b){return new b0({...this._def,maxLength:{value:a,message:v.toString(b)}})}length(a,b){return new b0({...this._def,exactLength:{value:a,message:v.toString(b)}})}nonempty(a){return this.min(1,a)}}b0.create=(a,b)=>new b0({type:a,minLength:null,maxLength:null,exactLength:null,typeName:w.ZodArray,...bx(b)});class b1 extends by{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),b=t.objectKeys(a);return this._cached={shape:a,keys:b},this._cached}_parse(a){if(this._getType(a)!==bj.object){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.object,received:b.parsedType}),br}let{status:b,ctx:c}=this._processInputParams(a),{shape:d,keys:e}=this._getCached(),f=[];if(!(this._def.catchall instanceof b$&&"strip"===this._def.unknownKeys))for(let a in c.data)e.includes(a)||f.push(a);let g=[];for(let a of e){let b=d[a],e=c.data[a];g.push({key:{status:"valid",value:a},value:b._parse(new bv(c,e,c.path,a)),alwaysSet:a in c.data})}if(this._def.catchall instanceof b$){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of f)g.push({key:{status:"valid",value:a},value:{status:"valid",value:c.data[a]}});else if("strict"===a)f.length>0&&(bp(c,{code:bl.unrecognized_keys,keys:f}),b.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let b of f){let d=c.data[b];g.push({key:{status:"valid",value:b},value:a._parse(new bv(c,d,c.path,b)),alwaysSet:b in c.data})}}return c.common.async?Promise.resolve().then(async()=>{let a=[];for(let b of g){let c=await b.key,d=await b.value;a.push({key:c,value:d,alwaysSet:b.alwaysSet})}return a}).then(a=>bq.mergeObjectSync(b,a)):bq.mergeObjectSync(b,g)}get shape(){return this._def.shape()}strict(a){return v.errToObj,new b1({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(b,c)=>{let d=this._def.errorMap?.(b,c).message??c.defaultError;return"unrecognized_keys"===b.code?{message:v.errToObj(a).message??d}:{message:d}}}:{}})}strip(){return new b1({...this._def,unknownKeys:"strip"})}passthrough(){return new b1({...this._def,unknownKeys:"passthrough"})}extend(a){return new b1({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){return new b1({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:w.ZodObject})}setKey(a,b){return this.augment({[a]:b})}catchall(a){return new b1({...this._def,catchall:a})}pick(a){let b={};for(let c of t.objectKeys(a))a[c]&&this.shape[c]&&(b[c]=this.shape[c]);return new b1({...this._def,shape:()=>b})}omit(a){let b={};for(let c of t.objectKeys(this.shape))a[c]||(b[c]=this.shape[c]);return new b1({...this._def,shape:()=>b})}deepPartial(){return function a(b){if(b instanceof b1){let c={};for(let d in b.shape){let e=b.shape[d];c[d]=ci.create(a(e))}return new b1({...b._def,shape:()=>c})}if(b instanceof b0)return new b0({...b._def,type:a(b.element)});if(b instanceof ci)return ci.create(a(b.unwrap()));if(b instanceof cj)return cj.create(a(b.unwrap()));if(b instanceof b6)return b6.create(b.items.map(b=>a(b)));else return b}(this)}partial(a){let b={};for(let c of t.objectKeys(this.shape)){let d=this.shape[c];a&&!a[c]?b[c]=d:b[c]=d.optional()}return new b1({...this._def,shape:()=>b})}required(a){let b={};for(let c of t.objectKeys(this.shape))if(a&&!a[c])b[c]=this.shape[c];else{let a=this.shape[c];for(;a instanceof ci;)a=a._def.innerType;b[c]=a}return new b1({...this._def,shape:()=>b})}keyof(){return cd(t.objectKeys(this.shape))}}b1.create=(a,b)=>new b1({shape:()=>a,unknownKeys:"strip",catchall:b$.create(),typeName:w.ZodObject,...bx(b)}),b1.strictCreate=(a,b)=>new b1({shape:()=>a,unknownKeys:"strict",catchall:b$.create(),typeName:w.ZodObject,...bx(b)}),b1.lazycreate=(a,b)=>new b1({shape:a,unknownKeys:"strip",catchall:b$.create(),typeName:w.ZodObject,...bx(b)});class b2 extends by{_parse(a){let{ctx:b}=this._processInputParams(a),c=this._def.options;if(b.common.async)return Promise.all(c.map(async a=>{let c={...b,common:{...b.common,issues:[]},parent:null};return{result:await a._parseAsync({data:b.data,path:b.path,parent:c}),ctx:c}})).then(function(a){for(let b of a)if("valid"===b.result.status)return b.result;for(let c of a)if("dirty"===c.result.status)return b.common.issues.push(...c.ctx.common.issues),c.result;let c=a.map(a=>new bm(a.ctx.common.issues));return bp(b,{code:bl.invalid_union,unionErrors:c}),br});{let a,d=[];for(let e of c){let c={...b,common:{...b.common,issues:[]},parent:null},f=e._parseSync({data:b.data,path:b.path,parent:c});if("valid"===f.status)return f;"dirty"!==f.status||a||(a={result:f,ctx:c}),c.common.issues.length&&d.push(c.common.issues)}if(a)return b.common.issues.push(...a.ctx.common.issues),a.result;let e=d.map(a=>new bm(a));return bp(b,{code:bl.invalid_union,unionErrors:e}),br}}get options(){return this._def.options}}b2.create=(a,b)=>new b2({options:a,typeName:w.ZodUnion,...bx(b)});let b3=a=>{if(a instanceof cb)return b3(a.schema);if(a instanceof ch)return b3(a.innerType());if(a instanceof cc)return[a.value];if(a instanceof ce)return a.options;if(a instanceof cf)return t.objectValues(a.enum);else if(a instanceof ck)return b3(a._def.innerType);else if(a instanceof bW)return[void 0];else if(a instanceof bX)return[null];else if(a instanceof ci)return[void 0,...b3(a.unwrap())];else if(a instanceof cj)return[null,...b3(a.unwrap())];else if(a instanceof cn)return b3(a.unwrap());else if(a instanceof cp)return b3(a.unwrap());else if(a instanceof cl)return b3(a._def.innerType);else return[]};class b4 extends by{_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==bj.object)return bp(b,{code:bl.invalid_type,expected:bj.object,received:b.parsedType}),br;let c=this.discriminator,d=b.data[c],e=this.optionsMap.get(d);return e?b.common.async?e._parseAsync({data:b.data,path:b.path,parent:b}):e._parseSync({data:b.data,path:b.path,parent:b}):(bp(b,{code:bl.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[c]}),br)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,b,c){let d=new Map;for(let c of b){let b=b3(c.shape[a]);if(!b.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let e of b){if(d.has(e))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(e)}`);d.set(e,c)}}return new b4({typeName:w.ZodDiscriminatedUnion,discriminator:a,options:b,optionsMap:d,...bx(c)})}}class b5 extends by{_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=(a,d)=>{if("aborted"===a.status||"aborted"===d.status)return br;let e=function a(b,c){let d=bk(b),e=bk(c);if(b===c)return{valid:!0,data:b};if(d===bj.object&&e===bj.object){let d=t.objectKeys(c),e=t.objectKeys(b).filter(a=>-1!==d.indexOf(a)),f={...b,...c};for(let d of e){let e=a(b[d],c[d]);if(!e.valid)return{valid:!1};f[d]=e.data}return{valid:!0,data:f}}if(d===bj.array&&e===bj.array){if(b.length!==c.length)return{valid:!1};let d=[];for(let e=0;e<b.length;e++){let f=a(b[e],c[e]);if(!f.valid)return{valid:!1};d.push(f.data)}return{valid:!0,data:d}}if(d===bj.date&&e===bj.date&&+b==+c)return{valid:!0,data:b};return{valid:!1}}(a.value,d.value);return e.valid?(("dirty"===a.status||"dirty"===d.status)&&b.dirty(),{status:b.value,value:e.data}):(bp(c,{code:bl.invalid_intersection_types}),br)};return c.common.async?Promise.all([this._def.left._parseAsync({data:c.data,path:c.path,parent:c}),this._def.right._parseAsync({data:c.data,path:c.path,parent:c})]).then(([a,b])=>d(a,b)):d(this._def.left._parseSync({data:c.data,path:c.path,parent:c}),this._def.right._parseSync({data:c.data,path:c.path,parent:c}))}}b5.create=(a,b,c)=>new b5({left:a,right:b,typeName:w.ZodIntersection,...bx(c)});class b6 extends by{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==bj.array)return bp(c,{code:bl.invalid_type,expected:bj.array,received:c.parsedType}),br;if(c.data.length<this._def.items.length)return bp(c,{code:bl.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),br;!this._def.rest&&c.data.length>this._def.items.length&&(bp(c,{code:bl.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),b.dirty());let d=[...c.data].map((a,b)=>{let d=this._def.items[b]||this._def.rest;return d?d._parse(new bv(c,a,c.path,b)):null}).filter(a=>!!a);return c.common.async?Promise.all(d).then(a=>bq.mergeArray(b,a)):bq.mergeArray(b,d)}get items(){return this._def.items}rest(a){return new b6({...this._def,rest:a})}}b6.create=(a,b)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new b6({items:a,typeName:w.ZodTuple,rest:null,...bx(b)})};class b7 extends by{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==bj.object)return bp(c,{code:bl.invalid_type,expected:bj.object,received:c.parsedType}),br;let d=[],e=this._def.keyType,f=this._def.valueType;for(let a in c.data)d.push({key:e._parse(new bv(c,a,c.path,a)),value:f._parse(new bv(c,c.data[a],c.path,a)),alwaysSet:a in c.data});return c.common.async?bq.mergeObjectAsync(b,d):bq.mergeObjectSync(b,d)}get element(){return this._def.valueType}static create(a,b,c){return new b7(b instanceof by?{keyType:a,valueType:b,typeName:w.ZodRecord,...bx(c)}:{keyType:bQ.create(),valueType:a,typeName:w.ZodRecord,...bx(b)})}}class b8 extends by{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==bj.map)return bp(c,{code:bl.invalid_type,expected:bj.map,received:c.parsedType}),br;let d=this._def.keyType,e=this._def.valueType,f=[...c.data.entries()].map(([a,b],f)=>({key:d._parse(new bv(c,a,c.path,[f,"key"])),value:e._parse(new bv(c,b,c.path,[f,"value"]))}));if(c.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let c of f){let d=await c.key,e=await c.value;if("aborted"===d.status||"aborted"===e.status)return br;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}})}{let a=new Map;for(let c of f){let d=c.key,e=c.value;if("aborted"===d.status||"aborted"===e.status)return br;("dirty"===d.status||"dirty"===e.status)&&b.dirty(),a.set(d.value,e.value)}return{status:b.value,value:a}}}}b8.create=(a,b,c)=>new b8({valueType:b,keyType:a,typeName:w.ZodMap,...bx(c)});class b9 extends by{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.parsedType!==bj.set)return bp(c,{code:bl.invalid_type,expected:bj.set,received:c.parsedType}),br;let d=this._def;null!==d.minSize&&c.data.size<d.minSize.value&&(bp(c,{code:bl.too_small,minimum:d.minSize.value,type:"set",inclusive:!0,exact:!1,message:d.minSize.message}),b.dirty()),null!==d.maxSize&&c.data.size>d.maxSize.value&&(bp(c,{code:bl.too_big,maximum:d.maxSize.value,type:"set",inclusive:!0,exact:!1,message:d.maxSize.message}),b.dirty());let e=this._def.valueType;function f(a){let c=new Set;for(let d of a){if("aborted"===d.status)return br;"dirty"===d.status&&b.dirty(),c.add(d.value)}return{status:b.value,value:c}}let g=[...c.data.values()].map((a,b)=>e._parse(new bv(c,a,c.path,b)));return c.common.async?Promise.all(g).then(a=>f(a)):f(g)}min(a,b){return new b9({...this._def,minSize:{value:a,message:v.toString(b)}})}max(a,b){return new b9({...this._def,maxSize:{value:a,message:v.toString(b)}})}size(a,b){return this.min(a,b).max(a,b)}nonempty(a){return this.min(1,a)}}b9.create=(a,b)=>new b9({valueType:a,minSize:null,maxSize:null,typeName:w.ZodSet,...bx(b)});class ca extends by{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:b}=this._processInputParams(a);if(b.parsedType!==bj.function)return bp(b,{code:bl.invalid_type,expected:bj.function,received:b.parsedType}),br;function c(a,c){return bo({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,bn,bn].filter(a=>!!a),issueData:{code:bl.invalid_arguments,argumentsError:c}})}function d(a,c){return bo({data:a,path:b.path,errorMaps:[b.common.contextualErrorMap,b.schemaErrorMap,bn,bn].filter(a=>!!a),issueData:{code:bl.invalid_return_type,returnTypeError:c}})}let e={errorMap:b.common.contextualErrorMap},f=b.data;if(this._def.returns instanceof cg){let a=this;return bt(async function(...b){let g=new bm([]),h=await a._def.args.parseAsync(b,e).catch(a=>{throw g.addIssue(c(b,a)),g}),i=await Reflect.apply(f,this,h);return await a._def.returns._def.type.parseAsync(i,e).catch(a=>{throw g.addIssue(d(i,a)),g})})}{let a=this;return bt(function(...b){let g=a._def.args.safeParse(b,e);if(!g.success)throw new bm([c(b,g.error)]);let h=Reflect.apply(f,this,g.data),i=a._def.returns.safeParse(h,e);if(!i.success)throw new bm([d(h,i.error)]);return i.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new ca({...this._def,args:b6.create(a).rest(bZ.create())})}returns(a){return new ca({...this._def,returns:a})}implement(a){return this.parse(a)}strictImplement(a){return this.parse(a)}static create(a,b,c){return new ca({args:a||b6.create([]).rest(bZ.create()),returns:b||bZ.create(),typeName:w.ZodFunction,...bx(c)})}}class cb extends by{get schema(){return this._def.getter()}_parse(a){let{ctx:b}=this._processInputParams(a);return this._def.getter()._parse({data:b.data,path:b.path,parent:b})}}cb.create=(a,b)=>new cb({getter:a,typeName:w.ZodLazy,...bx(b)});class cc extends by{_parse(a){if(a.data!==this._def.value){let b=this._getOrReturnCtx(a);return bp(b,{received:b.data,code:bl.invalid_literal,expected:this._def.value}),br}return{status:"valid",value:a.data}}get value(){return this._def.value}}function cd(a,b){return new ce({values:a,typeName:w.ZodEnum,...bx(b)})}cc.create=(a,b)=>new cc({value:a,typeName:w.ZodLiteral,...bx(b)});class ce extends by{_parse(a){if("string"!=typeof a.data){let b=this._getOrReturnCtx(a),c=this._def.values;return bp(b,{expected:t.joinValues(c),received:b.parsedType,code:bl.invalid_type}),br}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(a.data)){let b=this._getOrReturnCtx(a),c=this._def.values;return bp(b,{received:b.data,code:bl.invalid_enum_value,options:c}),br}return bt(a.data)}get options(){return this._def.values}get enum(){let a={};for(let b of this._def.values)a[b]=b;return a}get Values(){let a={};for(let b of this._def.values)a[b]=b;return a}get Enum(){let a={};for(let b of this._def.values)a[b]=b;return a}extract(a,b=this._def){return ce.create(a,{...this._def,...b})}exclude(a,b=this._def){return ce.create(this.options.filter(b=>!a.includes(b)),{...this._def,...b})}}ce.create=cd;class cf extends by{_parse(a){let b=t.getValidEnumValues(this._def.values),c=this._getOrReturnCtx(a);if(c.parsedType!==bj.string&&c.parsedType!==bj.number){let a=t.objectValues(b);return bp(c,{expected:t.joinValues(a),received:c.parsedType,code:bl.invalid_type}),br}if(this._cache||(this._cache=new Set(t.getValidEnumValues(this._def.values))),!this._cache.has(a.data)){let a=t.objectValues(b);return bp(c,{received:c.data,code:bl.invalid_enum_value,options:a}),br}return bt(a.data)}get enum(){return this._def.values}}cf.create=(a,b)=>new cf({values:a,typeName:w.ZodNativeEnum,...bx(b)});class cg extends by{unwrap(){return this._def.type}_parse(a){let{ctx:b}=this._processInputParams(a);return b.parsedType!==bj.promise&&!1===b.common.async?(bp(b,{code:bl.invalid_type,expected:bj.promise,received:b.parsedType}),br):bt((b.parsedType===bj.promise?b.data:Promise.resolve(b.data)).then(a=>this._def.type.parseAsync(a,{path:b.path,errorMap:b.common.contextualErrorMap})))}}cg.create=(a,b)=>new cg({type:a,typeName:w.ZodPromise,...bx(b)});class ch extends by{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===w.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:b,ctx:c}=this._processInputParams(a),d=this._def.effect||null,e={addIssue:a=>{bp(c,a),a.fatal?b.abort():b.dirty()},get path(){return c.path}};if(e.addIssue=e.addIssue.bind(e),"preprocess"===d.type){let a=d.transform(c.data,e);if(c.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===b.value)return br;let d=await this._def.schema._parseAsync({data:a,path:c.path,parent:c});return"aborted"===d.status?br:"dirty"===d.status||"dirty"===b.value?bs(d.value):d});{if("aborted"===b.value)return br;let d=this._def.schema._parseSync({data:a,path:c.path,parent:c});return"aborted"===d.status?br:"dirty"===d.status||"dirty"===b.value?bs(d.value):d}}if("refinement"===d.type){let a=a=>{let b=d.refinement(a,e);if(c.common.async)return Promise.resolve(b);if(b instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(c=>"aborted"===c.status?br:("dirty"===c.status&&b.dirty(),a(c.value).then(()=>({status:b.value,value:c.value}))));{let d=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===d.status?br:("dirty"===d.status&&b.dirty(),a(d.value),{status:b.value,value:d.value})}}if("transform"===d.type)if(!1!==c.common.async)return this._def.schema._parseAsync({data:c.data,path:c.path,parent:c}).then(a=>"valid"!==a.status?br:Promise.resolve(d.transform(a.value,e)).then(a=>({status:b.value,value:a})));else{let a=this._def.schema._parseSync({data:c.data,path:c.path,parent:c});if("valid"!==a.status)return br;let f=d.transform(a.value,e);if(f instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:b.value,value:f}}t.assertNever(d)}}ch.create=(a,b,c)=>new ch({schema:a,typeName:w.ZodEffects,effect:b,...bx(c)}),ch.createWithPreprocess=(a,b,c)=>new ch({schema:b,effect:{type:"preprocess",transform:a},typeName:w.ZodEffects,...bx(c)});class ci extends by{_parse(a){return this._getType(a)===bj.undefined?bt(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}ci.create=(a,b)=>new ci({innerType:a,typeName:w.ZodOptional,...bx(b)});class cj extends by{_parse(a){return this._getType(a)===bj.null?bt(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}}cj.create=(a,b)=>new cj({innerType:a,typeName:w.ZodNullable,...bx(b)});class ck extends by{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return b.parsedType===bj.undefined&&(c=this._def.defaultValue()),this._def.innerType._parse({data:c,path:b.path,parent:b})}removeDefault(){return this._def.innerType}}ck.create=(a,b)=>new ck({innerType:a,typeName:w.ZodDefault,defaultValue:"function"==typeof b.default?b.default:()=>b.default,...bx(b)});class cl extends by{_parse(a){let{ctx:b}=this._processInputParams(a),c={...b,common:{...b.common,issues:[]}},d=this._def.innerType._parse({data:c.data,path:c.path,parent:{...c}});return bu(d)?d.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new bm(c.common.issues)},input:c.data})})):{status:"valid",value:"valid"===d.status?d.value:this._def.catchValue({get error(){return new bm(c.common.issues)},input:c.data})}}removeCatch(){return this._def.innerType}}cl.create=(a,b)=>new cl({innerType:a,typeName:w.ZodCatch,catchValue:"function"==typeof b.catch?b.catch:()=>b.catch,...bx(b)});class cm extends by{_parse(a){if(this._getType(a)!==bj.nan){let b=this._getOrReturnCtx(a);return bp(b,{code:bl.invalid_type,expected:bj.nan,received:b.parsedType}),br}return{status:"valid",value:a.data}}}cm.create=a=>new cm({typeName:w.ZodNaN,...bx(a)}),Symbol("zod_brand");class cn extends by{_parse(a){let{ctx:b}=this._processInputParams(a),c=b.data;return this._def.type._parse({data:c,path:b.path,parent:b})}unwrap(){return this._def.type}}class co extends by{_parse(a){let{status:b,ctx:c}=this._processInputParams(a);if(c.common.async)return(async()=>{let a=await this._def.in._parseAsync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?br:"dirty"===a.status?(b.dirty(),bs(a.value)):this._def.out._parseAsync({data:a.value,path:c.path,parent:c})})();{let a=this._def.in._parseSync({data:c.data,path:c.path,parent:c});return"aborted"===a.status?br:"dirty"===a.status?(b.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:c.path,parent:c})}}static create(a,b){return new co({in:a,out:b,typeName:w.ZodPipeline})}}class cp extends by{_parse(a){let b=this._def.innerType._parse(a),c=a=>("valid"===a.status&&(a.value=Object.freeze(a.value)),a);return bu(b)?b.then(a=>c(a)):c(b)}unwrap(){return this._def.innerType}}function cq(a,b){let c="function"==typeof a?a(b):"string"==typeof a?{message:a}:a;return"string"==typeof c?{message:c}:c}function cr(a,b={},c){return a?bY.create().superRefine((d,e)=>{let f=a(d);if(f instanceof Promise)return f.then(a=>{if(!a){let a=cq(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}});if(!f){let a=cq(b,d),f=a.fatal??c??!0;e.addIssue({code:"custom",...a,fatal:f})}}):bY.create()}cp.create=(a,b)=>new cp({innerType:a,typeName:w.ZodReadonly,...bx(b)}),b1.lazycreate,(h=w||(w={})).ZodString="ZodString",h.ZodNumber="ZodNumber",h.ZodNaN="ZodNaN",h.ZodBigInt="ZodBigInt",h.ZodBoolean="ZodBoolean",h.ZodDate="ZodDate",h.ZodSymbol="ZodSymbol",h.ZodUndefined="ZodUndefined",h.ZodNull="ZodNull",h.ZodAny="ZodAny",h.ZodUnknown="ZodUnknown",h.ZodNever="ZodNever",h.ZodVoid="ZodVoid",h.ZodArray="ZodArray",h.ZodObject="ZodObject",h.ZodUnion="ZodUnion",h.ZodDiscriminatedUnion="ZodDiscriminatedUnion",h.ZodIntersection="ZodIntersection",h.ZodTuple="ZodTuple",h.ZodRecord="ZodRecord",h.ZodMap="ZodMap",h.ZodSet="ZodSet",h.ZodFunction="ZodFunction",h.ZodLazy="ZodLazy",h.ZodLiteral="ZodLiteral",h.ZodEnum="ZodEnum",h.ZodEffects="ZodEffects",h.ZodNativeEnum="ZodNativeEnum",h.ZodOptional="ZodOptional",h.ZodNullable="ZodNullable",h.ZodDefault="ZodDefault",h.ZodCatch="ZodCatch",h.ZodPromise="ZodPromise",h.ZodBranded="ZodBranded",h.ZodPipeline="ZodPipeline",h.ZodReadonly="ZodReadonly";let cs=(a,b={message:`Input not instance of ${a.name}`})=>cr(b=>b instanceof a,b),ct=bQ.create,cu=bR.create;cm.create,bS.create;let cv=bT.create;bU.create,bV.create,bW.create;let cw=bX.create,cx=bY.create,cy=bZ.create;b$.create,b_.create;let cz=b0.create,cA=b1.create;b1.strictCreate;let cB=b2.create,cC=b4.create;b5.create,b6.create;let cD=b7.create;b8.create,b9.create,ca.create;let cE=cb.create,cF=cc.create,cG=ce.create;cf.create,cg.create,ch.create;let cH=ci.create;cj.create,ch.createWithPreprocess,co.create;let cI=Symbol("Let zodToJsonSchema decide on which parser to use"),cJ={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},cK=(a,b)=>{let c=0;for(;c<a.length&&c<b.length&&a[c]===b[c];c++);return[(a.length-c).toString(),...b.slice(c)].join("/")};function cL(a){if("openAi"!==a.target)return{};let b=[...a.basePath,a.definitionPath,a.openAiAnyTypeName];return a.flags.hasReferencedOpenAiAnyType=!0,{$ref:"relative"===a.$refStrategy?cK(b,a.currentPath):b.join("/")}}function cM(a,b,c,d){d?.errorMessages&&c&&(a.errorMessage={...a.errorMessage,[b]:c})}function cN(a,b,c,d,e){a[b]=c,cM(a,b,d,e)}function cO(a,b){return c7(a.type._def,b)}let cP=/^[cC][^\s-]{8,}$/,cQ=/^[0-9a-z]+$/,cR=/^[0-9A-HJKMNP-TV-Z]{26}$/,cS=/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,cT=()=>(void 0===e&&(e=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),e),cU=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,cV=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,cW=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,cX=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,cY=/^[a-zA-Z0-9_-]{21}$/,cZ=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/;function c$(a,b){let c={type:"string"};if(a.checks)for(let d of a.checks)switch(d.kind){case"min":cN(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b);break;case"max":cN(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"email":switch(b.emailStrategy){case"format:email":c1(c,"email",d.message,b);break;case"format:idn-email":c1(c,"idn-email",d.message,b);break;case"pattern:zod":c2(c,cS,d.message,b)}break;case"url":c1(c,"uri",d.message,b);break;case"uuid":c1(c,"uuid",d.message,b);break;case"regex":c2(c,d.regex,d.message,b);break;case"cuid":c2(c,cP,d.message,b);break;case"cuid2":c2(c,cQ,d.message,b);break;case"startsWith":c2(c,RegExp(`^${c_(d.value,b)}`),d.message,b);break;case"endsWith":c2(c,RegExp(`${c_(d.value,b)}$`),d.message,b);break;case"datetime":c1(c,"date-time",d.message,b);break;case"date":c1(c,"date",d.message,b);break;case"time":c1(c,"time",d.message,b);break;case"duration":c1(c,"duration",d.message,b);break;case"length":cN(c,"minLength","number"==typeof c.minLength?Math.max(c.minLength,d.value):d.value,d.message,b),cN(c,"maxLength","number"==typeof c.maxLength?Math.min(c.maxLength,d.value):d.value,d.message,b);break;case"includes":c2(c,RegExp(c_(d.value,b)),d.message,b);break;case"ip":"v6"!==d.version&&c1(c,"ipv4",d.message,b),"v4"!==d.version&&c1(c,"ipv6",d.message,b);break;case"base64url":c2(c,cX,d.message,b);break;case"jwt":c2(c,cZ,d.message,b);break;case"cidr":"v6"!==d.version&&c2(c,cU,d.message,b),"v4"!==d.version&&c2(c,cV,d.message,b);break;case"emoji":c2(c,cT(),d.message,b);break;case"ulid":c2(c,cR,d.message,b);break;case"base64":switch(b.base64Strategy){case"format:binary":c1(c,"binary",d.message,b);break;case"contentEncoding:base64":cN(c,"contentEncoding","base64",d.message,b);break;case"pattern:zod":c2(c,cW,d.message,b)}break;case"nanoid":c2(c,cY,d.message,b)}return c}function c_(a,b){return"escape"===b.patternStrategy?function(a){let b="";for(let c=0;c<a.length;c++)c0.has(a[c])||(b+="\\"),b+=a[c];return b}(a):a}let c0=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function c1(a,b,c,d){a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&d.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:b,...c&&d.errorMessages&&{errorMessage:{format:c}}})):cN(a,"format",b,c,d)}function c2(a,b,c,d){a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&d.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:c3(b,d),...c&&d.errorMessages&&{errorMessage:{pattern:c}}})):cN(a,"pattern",c3(b,d),c,d)}function c3(a,b){if(!b.applyRegexFlags||!a.flags)return a.source;let c={i:a.flags.includes("i"),m:a.flags.includes("m"),s:a.flags.includes("s")},d=c.i?a.source.toLowerCase():a.source,e="",f=!1,g=!1,h=!1;for(let a=0;a<d.length;a++){if(f){e+=d[a],f=!1;continue}if(c.i){if(g){if(d[a].match(/[a-z]/)){h?(e+=d[a],e+=`${d[a-2]}-${d[a]}`.toUpperCase(),h=!1):"-"===d[a+1]&&d[a+2]?.match(/[a-z]/)?(e+=d[a],h=!0):e+=`${d[a]}${d[a].toUpperCase()}`;continue}}else if(d[a].match(/[a-z]/)){e+=`[${d[a]}${d[a].toUpperCase()}]`;continue}}if(c.m){if("^"===d[a]){e+=`(^|(?<=[\r
]))`;continue}else if("$"===d[a]){e+=`($|(?=[\r
]))`;continue}}if(c.s&&"."===d[a]){e+=g?`${d[a]}\r
`:`[${d[a]}\r
]`;continue}e+=d[a],"\\"===d[a]?f=!0:g&&"]"===d[a]?g=!1:g||"["!==d[a]||(g=!0)}try{new RegExp(e)}catch{return console.warn(`Could not convert regex pattern at ${b.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),a.source}return e}function c4(a,b){if("openAi"===b.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===b.target&&a.keyType?._def.typeName===w.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((c,d)=>({...c,[d]:c7(a.valueType._def,{...b,currentPath:[...b.currentPath,"properties",d]})??cL(b)}),{}),additionalProperties:b.rejectedAdditionalProperties};let c={type:"object",additionalProperties:c7(a.valueType._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]})??b.allowedAdditionalProperties};if("openApi3"===b.target)return c;if(a.keyType?._def.typeName===w.ZodString&&a.keyType._def.checks?.length){let{type:d,...e}=c$(a.keyType._def,b);return{...c,propertyNames:e}}if(a.keyType?._def.typeName===w.ZodEnum)return{...c,propertyNames:{enum:a.keyType._def.values}};if(a.keyType?._def.typeName===w.ZodBranded&&a.keyType._def.type._def.typeName===w.ZodString&&a.keyType._def.type._def.checks?.length){let{type:d,...e}=cO(a.keyType._def,b);return{...c,propertyNames:e}}return c}let c5={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},c6=(a,b)=>{let c=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,c)=>c7(a._def,{...b,currentPath:[...b.currentPath,"anyOf",`${c}`]})).filter(a=>!!a&&(!b.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return c.length?{anyOf:c}:void 0};function c7(a,b,c=!1){let d=b.seen.get(a);if(b.override){let e=b.override?.(a,b,d,c);if(e!==cI)return e}if(d&&!c){let a=c8(d,b);if(void 0!==a)return a}let e={def:a,path:b.currentPath,jsonSchema:void 0};b.seen.set(a,e);let f=((a,b,c)=>{switch(b){case w.ZodString:return c$(a,c);case w.ZodNumber:let d={type:"number"};if(!a.checks)return d;for(let b of a.checks)switch(b.kind){case"int":d.type="integer",cM(d,"type",b.message,c);break;case"min":"jsonSchema7"===c.target?b.inclusive?cN(d,"minimum",b.value,b.message,c):cN(d,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(d.exclusiveMinimum=!0),cN(d,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?cN(d,"maximum",b.value,b.message,c):cN(d,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(d.exclusiveMaximum=!0),cN(d,"maximum",b.value,b.message,c));break;case"multipleOf":cN(d,"multipleOf",b.value,b.message,c)}return d;case w.ZodObject:return function(a,b){let c="openAi"===b.target,d={type:"object",properties:{}},e=[],f=a.shape();for(let a in f){let g=f[a];if(void 0===g||void 0===g._def)continue;let h=function(a){try{return a.isOptional()}catch{return!0}}(g);h&&c&&("ZodOptional"===g._def.typeName&&(g=g._def.innerType),g.isNullable()||(g=g.nullable()),h=!1);let i=c7(g._def,{...b,currentPath:[...b.currentPath,"properties",a],propertyPath:[...b.currentPath,"properties",a]});void 0!==i&&(d.properties[a]=i,h||e.push(a))}e.length&&(d.required=e);let g=function(a,b){if("ZodNever"!==a.catchall._def.typeName)return c7(a.catchall._def,{...b,currentPath:[...b.currentPath,"additionalProperties"]});switch(a.unknownKeys){case"passthrough":return b.allowedAdditionalProperties;case"strict":return b.rejectedAdditionalProperties;case"strip":return"strict"===b.removeAdditionalStrategy?b.allowedAdditionalProperties:b.rejectedAdditionalProperties}}(a,b);return void 0!==g&&(d.additionalProperties=g),d}(a,c);case w.ZodBigInt:let e={type:"integer",format:"int64"};if(!a.checks)return e;for(let b of a.checks)switch(b.kind){case"min":"jsonSchema7"===c.target?b.inclusive?cN(e,"minimum",b.value,b.message,c):cN(e,"exclusiveMinimum",b.value,b.message,c):(b.inclusive||(e.exclusiveMinimum=!0),cN(e,"minimum",b.value,b.message,c));break;case"max":"jsonSchema7"===c.target?b.inclusive?cN(e,"maximum",b.value,b.message,c):cN(e,"exclusiveMaximum",b.value,b.message,c):(b.inclusive||(e.exclusiveMaximum=!0),cN(e,"maximum",b.value,b.message,c));break;case"multipleOf":cN(e,"multipleOf",b.value,b.message,c)}return e;case w.ZodBoolean:return{type:"boolean"};case w.ZodDate:return function a(b,c,d){let e=d??c.dateStrategy;if(Array.isArray(e))return{anyOf:e.map((d,e)=>a(b,c,d))};switch(e){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":var f=b,g=c;let h={type:"integer",format:"unix-time"};if("openApi3"===g.target)return h;for(let a of f.checks)switch(a.kind){case"min":cN(h,"minimum",a.value,a.message,g);break;case"max":cN(h,"maximum",a.value,a.message,g)}return h}}(a,c);case w.ZodUndefined:return{not:cL(c)};case w.ZodNull:return"openApi3"===c.target?{enum:["null"],nullable:!0}:{type:"null"};case w.ZodArray:let f;return f={type:"array"},a.type?._def&&a.type?._def?.typeName!==w.ZodAny&&(f.items=c7(a.type._def,{...c,currentPath:[...c.currentPath,"items"]})),a.minLength&&cN(f,"minItems",a.minLength.value,a.minLength.message,c),a.maxLength&&cN(f,"maxItems",a.maxLength.value,a.maxLength.message,c),a.exactLength&&(cN(f,"minItems",a.exactLength.value,a.exactLength.message,c),cN(f,"maxItems",a.exactLength.value,a.exactLength.message,c)),f;case w.ZodUnion:case w.ZodDiscriminatedUnion:if("openApi3"===c.target)return c6(a,c);let g=a.options instanceof Map?Array.from(a.options.values()):a.options;if(g.every(a=>a._def.typeName in c5&&(!a._def.checks||!a._def.checks.length))){let a=g.reduce((a,b)=>{let c=c5[b._def.typeName];return c&&!a.includes(c)?[...a,c]:a},[]);return{type:a.length>1?a:a[0]}}if(g.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=g.reduce((a,b)=>{let c=typeof b._def.value;switch(c){case"string":case"number":case"boolean":return[...a,c];case"bigint":return[...a,"integer"];case"object":if(null===b._def.value)return[...a,"null"];default:return a}},[]);if(a.length===g.length){let b=a.filter((a,b,c)=>c.indexOf(a)===b);return{type:b.length>1?b:b[0],enum:g.reduce((a,b)=>a.includes(b._def.value)?a:[...a,b._def.value],[])}}}else if(g.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:g.reduce((a,b)=>[...a,...b._def.values.filter(b=>!a.includes(b))],[])};return c6(a,c);case w.ZodIntersection:let h,i,j;return h=[c7(a.left._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),c7(a.right._def,{...c,currentPath:[...c.currentPath,"allOf","1"]})].filter(a=>!!a),i="jsonSchema2019-09"===c.target?{unevaluatedProperties:!1}:void 0,j=[],h.forEach(a=>{if((!("type"in a)||"string"!==a.type)&&"allOf"in a)j.push(...a.allOf),void 0===a.unevaluatedProperties&&(i=void 0);else{let b=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:c,...d}=a;b=d}else i=void 0;j.push(b)}}),j.length?{allOf:j,...i}:void 0;case w.ZodTuple:return a.rest?{type:"array",minItems:a.items.length,items:a.items.map((a,b)=>c7(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[]),additionalItems:c7(a.rest._def,{...c,currentPath:[...c.currentPath,"additionalItems"]})}:{type:"array",minItems:a.items.length,maxItems:a.items.length,items:a.items.map((a,b)=>c7(a._def,{...c,currentPath:[...c.currentPath,"items",`${b}`]})).reduce((a,b)=>void 0===b?a:[...a,b],[])};case w.ZodRecord:return c4(a,c);case w.ZodLiteral:let k;return"bigint"!=(k=typeof a.value)&&"number"!==k&&"boolean"!==k&&"string"!==k?{type:Array.isArray(a.value)?"array":"object"}:"openApi3"===c.target?{type:"bigint"===k?"integer":k,enum:[a.value]}:{type:"bigint"===k?"integer":k,const:a.value};case w.ZodEnum:return{type:"string",enum:Array.from(a.values)};case w.ZodNativeEnum:let l,m,n;return l=a.values,{type:1===(n=Array.from(new Set((m=Object.keys(a.values).filter(a=>"number"!=typeof l[l[a]]).map(a=>l[a])).map(a=>typeof a)))).length?"string"===n[0]?"string":"number":["string","number"],enum:m};case w.ZodNullable:if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(a.innerType._def.typeName)&&(!a.innerType._def.checks||!a.innerType._def.checks.length))return"openApi3"===c.target?{type:c5[a.innerType._def.typeName],nullable:!0}:{type:[c5[a.innerType._def.typeName],"null"]};if("openApi3"===c.target){let b=c7(a.innerType._def,{...c,currentPath:[...c.currentPath]});return b&&"$ref"in b?{allOf:[b],nullable:!0}:b&&{...b,nullable:!0}}let o=c7(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","0"]});return o&&{anyOf:[o,{type:"null"}]};case w.ZodOptional:if(c.currentPath.toString()===c.propertyPath?.toString())return c7(a.innerType._def,c);let p=c7(a.innerType._def,{...c,currentPath:[...c.currentPath,"anyOf","1"]});return p?{anyOf:[{not:cL(c)},p]}:cL(c);case w.ZodMap:if("record"===c.mapStrategy)return c4(a,c);return{type:"array",maxItems:125,items:{type:"array",items:[c7(a.keyType._def,{...c,currentPath:[...c.currentPath,"items","items","0"]})||cL(c),c7(a.valueType._def,{...c,currentPath:[...c.currentPath,"items","items","1"]})||cL(c)],minItems:2,maxItems:2}};case w.ZodSet:let q;return q={type:"array",uniqueItems:!0,items:c7(a.valueType._def,{...c,currentPath:[...c.currentPath,"items"]})},a.minSize&&cN(q,"minItems",a.minSize.value,a.minSize.message,c),a.maxSize&&cN(q,"maxItems",a.maxSize.value,a.maxSize.message,c),q;case w.ZodLazy:return()=>a.getter()._def;case w.ZodPromise:return c7(a.type._def,c);case w.ZodNaN:case w.ZodNever:return"openAi"===c.target?void 0:{not:cL({...c,currentPath:[...c.currentPath,"not"]})};case w.ZodEffects:return"input"===c.effectStrategy?c7(a.schema._def,c):cL(c);case w.ZodAny:case w.ZodUnknown:return cL(c);case w.ZodDefault:return{...c7(a.innerType._def,c),default:a.defaultValue()};case w.ZodBranded:return cO(a,c);case w.ZodReadonly:case w.ZodCatch:return c7(a.innerType._def,c);case w.ZodPipeline:if("input"===c.pipeStrategy)return c7(a.in._def,c);if("output"===c.pipeStrategy)return c7(a.out._def,c);let r=c7(a.in._def,{...c,currentPath:[...c.currentPath,"allOf","0"]}),s=c7(a.out._def,{...c,currentPath:[...c.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(a=>void 0!==a)};case w.ZodFunction:case w.ZodVoid:case w.ZodSymbol:default:return}})(a,a.typeName,b),g="function"==typeof f?c7(f(),b):f;if(g&&c9(a,b,g),b.postProcess){let c=b.postProcess(g,a,b);return e.jsonSchema=g,c}return e.jsonSchema=g,g}let c8=(a,b)=>{switch(b.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:cK(b.currentPath,a.path)};case"none":case"seen":if(a.path.length<b.currentPath.length&&a.path.every((a,c)=>b.currentPath[c]===a))return console.warn(`Recursive reference detected at ${b.currentPath.join("/")}! Defaulting to any`),cL(b);return"seen"===b.$refStrategy?cL(b):void 0}},c9=(a,b,c)=>(a.description&&(c.description=a.description,b.markdownDescription&&(c.markdownDescription=a.description)),c);var da={code:"0",name:"text",parse:a=>{if("string"!=typeof a)throw Error('"text" parts expect a string value.');return{type:"text",value:a}}},db={code:"3",name:"error",parse:a=>{if("string"!=typeof a)throw Error('"error" parts expect a string value.');return{type:"error",value:a}}},dc={code:"4",name:"assistant_message",parse:a=>{if(null==a||"object"!=typeof a||!("id"in a)||!("role"in a)||!("content"in a)||"string"!=typeof a.id||"string"!=typeof a.role||"assistant"!==a.role||!Array.isArray(a.content)||!a.content.every(a=>null!=a&&"object"==typeof a&&"type"in a&&"text"===a.type&&"text"in a&&null!=a.text&&"object"==typeof a.text&&"value"in a.text&&"string"==typeof a.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:a}}},dd={code:"5",name:"assistant_control_data",parse:a=>{if(null==a||"object"!=typeof a||!("threadId"in a)||!("messageId"in a)||"string"!=typeof a.threadId||"string"!=typeof a.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:a.threadId,messageId:a.messageId}}}},de={code:"6",name:"data_message",parse:a=>{if(null==a||"object"!=typeof a||!("role"in a)||!("data"in a)||"string"!=typeof a.role||"data"!==a.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:a}}},df=[da,db,dc,dd,de];da.code,db.code,dc.code,dd.code,de.code,da.name,da.code,db.name,db.code,dc.name,dc.code,dd.name,dd.code,de.name,de.code,df.map(a=>a.code);var dg=[{code:"0",name:"text",parse:a=>{if("string"!=typeof a)throw Error('"text" parts expect a string value.');return{type:"text",value:a}}},{code:"2",name:"data",parse:a=>{if(!Array.isArray(a))throw Error('"data" parts expect an array value.');return{type:"data",value:a}}},{code:"3",name:"error",parse:a=>{if("string"!=typeof a)throw Error('"error" parts expect a string value.');return{type:"error",value:a}}},{code:"8",name:"message_annotations",parse:a=>{if(!Array.isArray(a))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:a}}},{code:"9",name:"tool_call",parse:a=>{if(null==a||"object"!=typeof a||!("toolCallId"in a)||"string"!=typeof a.toolCallId||!("toolName"in a)||"string"!=typeof a.toolName||!("args"in a)||"object"!=typeof a.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:a}}},{code:"a",name:"tool_result",parse:a=>{if(null==a||"object"!=typeof a||!("toolCallId"in a)||"string"!=typeof a.toolCallId||!("result"in a))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:a}}},{code:"b",name:"tool_call_streaming_start",parse:a=>{if(null==a||"object"!=typeof a||!("toolCallId"in a)||"string"!=typeof a.toolCallId||!("toolName"in a)||"string"!=typeof a.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:a}}},{code:"c",name:"tool_call_delta",parse:a=>{if(null==a||"object"!=typeof a||!("toolCallId"in a)||"string"!=typeof a.toolCallId||!("argsTextDelta"in a)||"string"!=typeof a.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:a}}},{code:"d",name:"finish_message",parse:a=>{if(null==a||"object"!=typeof a||!("finishReason"in a)||"string"!=typeof a.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let b={finishReason:a.finishReason};return"usage"in a&&null!=a.usage&&"object"==typeof a.usage&&"promptTokens"in a.usage&&"completionTokens"in a.usage&&(b.usage={promptTokens:"number"==typeof a.usage.promptTokens?a.usage.promptTokens:NaN,completionTokens:"number"==typeof a.usage.completionTokens?a.usage.completionTokens:NaN}),{type:"finish_message",value:b}}},{code:"e",name:"finish_step",parse:a=>{if(null==a||"object"!=typeof a||!("finishReason"in a)||"string"!=typeof a.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let b={finishReason:a.finishReason,isContinued:!1};return"usage"in a&&null!=a.usage&&"object"==typeof a.usage&&"promptTokens"in a.usage&&"completionTokens"in a.usage&&(b.usage={promptTokens:"number"==typeof a.usage.promptTokens?a.usage.promptTokens:NaN,completionTokens:"number"==typeof a.usage.completionTokens?a.usage.completionTokens:NaN}),"isContinued"in a&&"boolean"==typeof a.isContinued&&(b.isContinued=a.isContinued),{type:"finish_step",value:b}}},{code:"f",name:"start_step",parse:a=>{if(null==a||"object"!=typeof a||!("messageId"in a)||"string"!=typeof a.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:a.messageId}}}},{code:"g",name:"reasoning",parse:a=>{if("string"!=typeof a)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:a}}},{code:"h",name:"source",parse:a=>{if(null==a||"object"!=typeof a)throw Error('"source" parts expect a Source object.');return{type:"source",value:a}}},{code:"i",name:"redacted_reasoning",parse:a=>{if(null==a||"object"!=typeof a||!("data"in a)||"string"!=typeof a.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:a.data}}}},{code:"j",name:"reasoning_signature",parse:a=>{if(null==a||"object"!=typeof a||!("signature"in a)||"string"!=typeof a.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:a.signature}}}},{code:"k",name:"file",parse:a=>{if(null==a||"object"!=typeof a||!("data"in a)||"string"!=typeof a.data||!("mimeType"in a)||"string"!=typeof a.mimeType)throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:a}}}];function dh(a,b){let c=dg.find(b=>b.name===a);if(!c)throw Error(`Invalid stream part type: ${a}`);return`${c.code}:${JSON.stringify(b)}
`}Object.fromEntries(dg.map(a=>[a.code,a])),Object.fromEntries(dg.map(a=>[a.name,a.code])),dg.map(a=>a.code);var di=Symbol.for("vercel.ai.schema");function dj(a){return"object"==typeof a&&null!==a&&di in a&&!0===a[di]&&"jsonSchema"in a&&"validate"in a?a:function(a,{validate:b}={}){return{[di]:!0,_type:void 0,[a_]:!0,jsonSchema:a,validate:b}}(((a,b)=>{let c,d,e=(d=void 0!==(c="string"==typeof b?{...cJ,name:b}:{...cJ,...b}).name?[...c.basePath,c.definitionPath,c.name]:c.basePath,{...c,flags:{hasReferencedOpenAiAnyType:!1},currentPath:d,propertyPath:void 0,seen:new Map(Object.entries(c.definitions).map(([a,b])=>[b._def,{def:b._def,path:[...c.basePath,c.definitionPath,a],jsonSchema:void 0}]))}),f="object"==typeof b&&b.definitions?Object.entries(b.definitions).reduce((a,[b,c])=>({...a,[b]:c7(c._def,{...e,currentPath:[...e.basePath,e.definitionPath,b]},!0)??cL(e)}),{}):void 0,g="string"==typeof b?b:b?.nameStrategy==="title"?void 0:b?.name,h=c7(a._def,void 0===g?e:{...e,currentPath:[...e.basePath,e.definitionPath,g]},!1)??cL(e),i="object"==typeof b&&void 0!==b.name&&"title"===b.nameStrategy?b.name:void 0;void 0!==i&&(h.title=i),e.flags.hasReferencedOpenAiAnyType&&(f||(f={}),f[e.openAiAnyTypeName]||(f[e.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:"relative"===e.$refStrategy?"1":[...e.basePath,e.definitionPath,e.openAiAnyTypeName].join("/")}}));let j=void 0===g?f?{...h,[e.definitionPath]:f}:h:{$ref:[..."relative"===e.$refStrategy?[]:e.basePath,e.definitionPath,g].join("/"),[e.definitionPath]:{...f,[g]:h}};return"jsonSchema7"===e.target?j.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===e.target||"openAi"===e.target)&&(j.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===e.target&&("anyOf"in j||"oneOf"in j||"allOf"in j||"type"in j&&Array.isArray(j.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),j})(a,{$refStrategy:"none",target:"jsonSchema7"}),{validate:b=>{let c=a.safeParse(b);return c.success?{success:!0,value:c.data}:{success:!1,error:c.error}}})}var dk=Object.defineProperty,dl=(a,b)=>{for(var c in b)dk(a,c,{get:b[c],enumerable:!0})};function dm(a,{contentType:b,dataStreamVersion:c}){let d=new Headers(null!=a?a:{});return d.has("Content-Type")||d.set("Content-Type",b),void 0!==c&&d.set("X-Vercel-AI-Data-Stream",c),d}function dn(a,{contentType:b,dataStreamVersion:c}){let d={};if(null!=a)for(let[b,c]of Object.entries(a))d[b]=c;return null==d["Content-Type"]&&(d["Content-Type"]=b),void 0!==c&&(d["X-Vercel-AI-Data-Stream"]=c),d}function dp({response:a,status:b,statusText:c,headers:d,stream:e}){a.writeHead(null!=b?b:200,c,d);let f=e.getReader();(async()=>{try{for(;;){let{done:b,value:c}=await f.read();if(b)break;a.write(c)}}catch(a){throw a}finally{a.end()}})()}var dq=class extends ad{constructor(){super({name:"AI_UnsupportedModelVersionError",message:'Unsupported model version. AI SDK 4 only supports models that implement specification version "v1". Please upgrade to AI SDK 5 to use this model.'})}},dr="AI_InvalidArgumentError",ds=`vercel.ai.error.${dr}`,dt=Symbol.for(ds),du=class extends ad{constructor({parameter:a,value:b,message:c}){super({name:dr,message:`Invalid argument for parameter ${a}: ${c}`}),this[x]=!0,this.parameter=a,this.value=b}static isInstance(a){return ad.hasMarker(a,ds)}};x=dt;var dv="AI_RetryError",dw=`vercel.ai.error.${dv}`,dx=Symbol.for(dw),dy=class extends ad{constructor({message:a,reason:b,errors:c}){super({name:dv,message:a}),this[y]=!0,this.reason=b,this.errors=c,this.lastError=c[c.length-1]}static isInstance(a){return ad.hasMarker(a,dw)}};async function dz(a,{maxRetries:b,delayInMs:c,backoffFactor:d},e=[]){try{return await a()}catch(i){if(aZ(i)||0===b)throw i;let f=null==i?"unknown error":"string"==typeof i?i:i instanceof Error?i.message:JSON.stringify(i),g=[...e,i],h=g.length;if(h>b)throw new dy({message:`Failed after ${h} attempts. Last error: ${f}`,reason:"maxRetriesExceeded",errors:g});if(i instanceof Error&&ah.isInstance(i)&&!0===i.isRetryable&&h<=b)return await aV(c),dz(a,{maxRetries:b,delayInMs:d*c,backoffFactor:d},g);if(1===h)throw i;throw new dy({message:`Failed after ${h} attempts with non-retryable error: '${f}'`,reason:"errorNotRetryable",errors:g})}}function dA({operationId:a,telemetry:b}){return{"operation.name":`${a}${(null==b?void 0:b.functionId)!=null?` ${b.functionId}`:""}`,"resource.name":null==b?void 0:b.functionId,"ai.operationId":a,"ai.telemetry.functionId":null==b?void 0:b.functionId}}y=dx;var dB={startSpan:()=>dC,startActiveSpan:(a,b,c,d)=>"function"==typeof b?b(dC):"function"==typeof c?c(dC):"function"==typeof d?d(dC):void 0},dC={spanContext:()=>dD,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},dD={traceId:"",spanId:"",traceFlags:0};function dE({name:a,tracer:b,attributes:c,fn:d,endWhenDone:e=!0}){return b.startActiveSpan(a,{attributes:c},async a=>{try{let b=await d(a);return e&&a.end(),b}catch(b){try{dF(a,b)}finally{a.end()}throw b}})}function dF(a,b){b instanceof Error?(a.recordException({name:b.name,message:b.message,stack:b.stack}),a.setStatus({code:bi.s.ERROR,message:b.message})):a.setStatus({code:bi.s.ERROR})}function dG({telemetry:a,attributes:b}){return(null==a?void 0:a.isEnabled)!==!0?{}:Object.entries(b).reduce((b,[c,d])=>{if(void 0===d)return b;if("object"==typeof d&&"input"in d&&"function"==typeof d.input){if((null==a?void 0:a.recordInputs)===!1)return b;let e=d.input();return void 0===e?b:{...b,[c]:e}}if("object"==typeof d&&"output"in d&&"function"==typeof d.output){if((null==a?void 0:a.recordOutputs)===!1)return b;let e=d.output();return void 0===e?b:{...b,[c]:e}}return{...b,[c]:d}},{})}Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var dH=class{constructor({data:a,mimeType:b}){const c=a instanceof Uint8Array;this.base64Data=c?void 0:a,this.uint8ArrayData=c?a:void 0,this.mimeType=b}get base64(){return null==this.base64Data&&(this.base64Data=bf(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=be(this.base64Data)),this.uint8ArrayData}},dI=class extends dH{constructor(a){super(a),this.type="file"}},dJ=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],dK="AI_NoObjectGeneratedError",dL=`vercel.ai.error.${dK}`,dM=Symbol.for(dL),dN=class extends ad{constructor({message:a="No object generated.",cause:b,text:c,response:d,usage:e,finishReason:f}){super({name:dK,message:a,cause:b}),this[z]=!0,this.text=c,this.response=d,this.usage=e,this.finishReason=f}static isInstance(a){return ad.hasMarker(a,dL)}};z=dM;var dO="AI_DownloadError",dP=`vercel.ai.error.${dO}`,dQ=Symbol.for(dP),dR=class extends ad{constructor({url:a,statusCode:b,statusText:c,cause:d,message:e=null==d?`Failed to download ${a}: ${b} ${c}`:`Failed to download ${a}: ${d}`}){super({name:dO,message:e,cause:d}),this[A]=!0,this.url=a,this.statusCode=b,this.statusText=c}static isInstance(a){return ad.hasMarker(a,dP)}};async function dS({url:a}){var b;let c=a.toString();try{let a=await fetch(c);if(!a.ok)throw new dR({url:c,statusCode:a.status,statusText:a.statusText});return{data:new Uint8Array(await a.arrayBuffer()),mimeType:null!=(b=a.headers.get("content-type"))?b:void 0}}catch(a){if(dR.isInstance(a))throw a;throw new dR({url:c,cause:a})}}A=dQ;var dT="AI_InvalidDataContentError",dU=`vercel.ai.error.${dT}`,dV=Symbol.for(dU),dW=class extends ad{constructor({content:a,cause:b,message:c=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof a}.`}){super({name:dT,message:c,cause:b}),this[B]=!0,this.content=a}static isInstance(a){return ad.hasMarker(a,dU)}};B=dV;var dX=cB([ct(),cs(Uint8Array),cs(ArrayBuffer),cr(a=>{var b,c;return null!=(c=null==(b=globalThis.Buffer)?void 0:b.isBuffer(a))&&c},{message:"Must be a Buffer"})]);function dY(a){return"string"==typeof a?a:a instanceof ArrayBuffer?bf(new Uint8Array(a)):bf(a)}function dZ(a){if(a instanceof Uint8Array)return a;if("string"==typeof a)try{return be(a)}catch(b){throw new dW({message:"Invalid data content. Content string is not a base64-encoded media.",content:a,cause:b})}if(a instanceof ArrayBuffer)return new Uint8Array(a);throw new dW({content:a})}var d$="AI_InvalidMessageRoleError",d_=`vercel.ai.error.${d$}`,d0=Symbol.for(d_),d1=class extends ad{constructor({role:a,message:b=`Invalid message role: '${a}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:d$,message:b}),this[C]=!0,this.role=a}static isInstance(a){return ad.hasMarker(a,d_)}};async function d2({prompt:a,modelSupportsImageUrls:b=!0,modelSupportsUrl:c=()=>!1,downloadImplementation:d=dS}){let e=await d3(a.messages,d,b,c);return[...null!=a.system?[{role:"system",content:a.system}]:[],...a.messages.map(a=>(function(a,b){var c,d,e,f,g,h;let i=a.role;switch(i){case"system":return{role:"system",content:a.content,providerMetadata:null!=(c=a.providerOptions)?c:a.experimental_providerMetadata};case"user":if("string"==typeof a.content)return{role:"user",content:[{type:"text",text:a.content}],providerMetadata:null!=(d=a.providerOptions)?d:a.experimental_providerMetadata};return{role:"user",content:a.content.map(a=>(function(a,b){var c,d,e,f;let g,h,i;if("text"===a.type)return{type:"text",text:a.text,providerMetadata:null!=(c=a.providerOptions)?c:a.experimental_providerMetadata};let j=a.mimeType,k=a.type;switch(k){case"image":g=a.image;break;case"file":g=a.data;break;default:throw Error(`Unsupported part type: ${k}`)}try{h="string"==typeof g?new URL(g):g}catch(a){h=g}if(h instanceof URL)if("data:"===h.protocol){let{mimeType:a,base64Content:b}=function(a){try{let[b,c]=a.split(",");return{mimeType:b.split(";")[0].split(":")[1],base64Content:c}}catch(a){return{mimeType:void 0,base64Content:void 0}}}(h.toString());if(null==a||null==b)throw Error(`Invalid data URL format in part ${k}`);j=a,i=dZ(b)}else{let a=b[h.toString()];a?(i=a.data,null!=j||(j=a.mimeType)):i=h}else i=dZ(h);switch(k){case"image":return i instanceof Uint8Array&&(j=null!=(d=function({data:a,signatures:b}){let c,d,e="string"==typeof a&&a.startsWith("SUQz")||"string"!=typeof a&&a.length>10&&73===a[0]&&68===a[1]&&51===a[2]?(d=(127&(c="string"==typeof a?be(a):a)[6])<<21|(127&c[7])<<14|(127&c[8])<<7|127&c[9],c.slice(d+10)):a;for(let a of b)if("string"==typeof e?e.startsWith(a.base64Prefix):e.length>=a.bytesPrefix.length&&a.bytesPrefix.every((a,b)=>e[b]===a))return a.mimeType}({data:i,signatures:dJ}))?d:j),{type:"image",image:i,mimeType:j,providerMetadata:null!=(e=a.providerOptions)?e:a.experimental_providerMetadata};case"file":if(null==j)throw Error("Mime type is missing for file part");return{type:"file",data:i instanceof Uint8Array?dY(i):i,filename:a.filename,mimeType:j,providerMetadata:null!=(f=a.providerOptions)?f:a.experimental_providerMetadata}}})(a,b)).filter(a=>"text"!==a.type||""!==a.text),providerMetadata:null!=(e=a.providerOptions)?e:a.experimental_providerMetadata};case"assistant":if("string"==typeof a.content)return{role:"assistant",content:[{type:"text",text:a.content}],providerMetadata:null!=(f=a.providerOptions)?f:a.experimental_providerMetadata};return{role:"assistant",content:a.content.filter(a=>"text"!==a.type||""!==a.text).map(a=>{var b;let c=null!=(b=a.providerOptions)?b:a.experimental_providerMetadata;switch(a.type){case"file":return{type:"file",data:a.data instanceof URL?a.data:dY(a.data),filename:a.filename,mimeType:a.mimeType,providerMetadata:c};case"reasoning":return{type:"reasoning",text:a.text,signature:a.signature,providerMetadata:c};case"redacted-reasoning":return{type:"redacted-reasoning",data:a.data,providerMetadata:c};case"text":return{type:"text",text:a.text,providerMetadata:c};case"tool-call":return{type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,args:a.args,providerMetadata:c}}}),providerMetadata:null!=(g=a.providerOptions)?g:a.experimental_providerMetadata};case"tool":return{role:"tool",content:a.content.map(a=>{var b;return{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,result:a.result,content:a.experimental_content,isError:a.isError,providerMetadata:null!=(b=a.providerOptions)?b:a.experimental_providerMetadata}}),providerMetadata:null!=(h=a.providerOptions)?h:a.experimental_providerMetadata};default:throw new d1({role:i})}})(a,e))]}async function d3(a,b,c,d){let e=a.filter(a=>"user"===a.role).map(a=>a.content).filter(a=>Array.isArray(a)).flat().filter(a=>"image"===a.type||"file"===a.type).filter(a=>"image"!==a.type||!0!==c).map(a=>"image"===a.type?a.image:a.data).map(a=>"string"==typeof a&&(a.startsWith("http:")||a.startsWith("https:"))?new URL(a):a).filter(a=>a instanceof URL).filter(a=>!d(a));return Object.fromEntries((await Promise.all(e.map(async a=>({url:a,data:await b({url:a})})))).map(({url:a,data:b})=>[a.toString(),b]))}function d4(a){var b,c,d;let e=[];for(let f of a){let a;try{a=new URL(f.url)}catch(a){throw Error(`Invalid URL: ${f.url}`)}switch(a.protocol){case"http:":case"https:":if(null==(b=f.contentType)?void 0:b.startsWith("image/"))e.push({type:"image",image:a});else{if(!f.contentType)throw Error("If the attachment is not an image, it must specify a content type");e.push({type:"file",data:a,mimeType:f.contentType})}break;case"data:":{let a,b,g;try{[a,b]=f.url.split(","),g=a.split(";")[0].split(":")[1]}catch(a){throw Error(`Error processing data URL: ${f.url}`)}if(null==g||null==b)throw Error(`Invalid data URL format: ${f.url}`);if(null==(c=f.contentType)?void 0:c.startsWith("image/"))e.push({type:"image",image:dZ(b)});else if(null==(d=f.contentType)?void 0:d.startsWith("text/"))e.push({type:"text",text:function(a){try{return new TextDecoder().decode(a)}catch(a){throw Error("Error decoding Uint8Array to text")}}(dZ(b))});else{if(!f.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");e.push({type:"file",data:b,mimeType:f.contentType})}break}default:throw Error(`Unsupported URL protocol: ${a.protocol}`)}}return e}C=d0;var d5="AI_MessageConversionError",d6=`vercel.ai.error.${d5}`,d7=Symbol.for(d6),d8=class extends ad{constructor({originalMessage:a,message:b}){super({name:d5,message:b}),this[D]=!0,this.originalMessage=a}static isInstance(a){return ad.hasMarker(a,d6)}};D=d7;var d9=cE(()=>cB([cw(),ct(),cu(),cv(),cD(ct(),d9),cz(d9)])),ea=cD(ct(),cD(ct(),d9)),eb=cz(cB([cA({type:cF("text"),text:ct()}),cA({type:cF("image"),data:ct(),mimeType:ct().optional()})])),ec=cA({type:cF("text"),text:ct(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),ed=cA({type:cF("image"),image:cB([dX,cs(URL)]),mimeType:ct().optional(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),ee=cA({type:cF("file"),data:cB([dX,cs(URL)]),filename:ct().optional(),mimeType:ct(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),ef=cA({type:cF("reasoning"),text:ct(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),eg=cA({type:cF("redacted-reasoning"),data:ct(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),eh=cA({type:cF("tool-call"),toolCallId:ct(),toolName:ct(),args:cy(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),ei=cA({type:cF("tool-result"),toolCallId:ct(),toolName:ct(),result:cy(),content:eb.optional(),isError:cv().optional(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),ej=cA({role:cF("system"),content:ct(),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),ek=cA({role:cF("user"),content:cB([ct(),cz(cB([ec,ed,ee]))]),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),el=cA({role:cF("assistant"),content:cB([ct(),cz(cB([ec,ee,ef,eg,eh]))]),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()}),em=cB([ej,ek,el,cA({role:cF("tool"),content:cz(ei),providerOptions:ea.optional(),experimental_providerMetadata:ea.optional()})]);function en(a){return"object"==typeof a&&null!==a&&("function"===a.role||"data"===a.role||"toolInvocations"in a||"parts"in a||"experimental_attachments"in a)?"has-ui-specific-parts":"object"==typeof a&&null!==a&&"content"in a&&(Array.isArray(a.content)||"experimental_providerMetadata"in a||"providerOptions"in a)?"has-core-specific-parts":"object"==typeof a&&null!==a&&"role"in a&&"content"in a&&"string"==typeof a.content&&["system","user","assistant","tool"].includes(a.role)?"message":"other"}function eo(a){let b=a.pipeThrough(new TransformStream);return b[Symbol.asyncIterator]=()=>{let a=b.getReader();return{async next(){let{done:b,value:c}=await a.read();return b?{done:!0,value:void 0}:{done:!1,value:c}}}},b}function ep(a){return"image"===a.type?{...a,image:a.image instanceof Uint8Array?dY(a.image):a.image}:a}aX({prefix:"aiobj",size:24});var eq=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((a,b)=>{"resolved"===this.status.type?a(this.status.value):"rejected"===this.status.type&&b(this.status.error),this._resolve=a,this._reject=b})),this.promise}resolve(a){var b;this.status={type:"resolved",value:a},this.promise&&(null==(b=this._resolve)||b.call(this,a))}reject(a){var b;this.status={type:"rejected",error:a},this.promise&&(null==(b=this._reject)||b.call(this,a))}};function er(){let a,b;return{promise:new Promise((c,d)=>{a=c,b=d}),resolve:a,reject:b}}aX({prefix:"aiobj",size:24});var es="AI_NoOutputSpecifiedError",et=`vercel.ai.error.${es}`,eu=Symbol.for(et),ev=class extends ad{constructor({message:a="No output specified."}={}){super({name:es,message:a}),this[E]=!0}static isInstance(a){return ad.hasMarker(a,et)}};E=eu;var ew="AI_ToolExecutionError",ex=`vercel.ai.error.${ew}`,ey=Symbol.for(ex),ez=class extends ad{constructor({toolArgs:a,toolName:b,toolCallId:c,cause:d,message:e=`Error executing tool ${b}: ${am(d)}`}){super({name:ew,message:e,cause:d}),this[F]=!0,this.toolArgs=a,this.toolName=b,this.toolCallId=c}static isInstance(a){return ad.hasMarker(a,ex)}};F=ey;var eA=/^([\s\S]*?)(\s+)(\S*)$/,eB="AI_InvalidToolArgumentsError",eC=`vercel.ai.error.${eB}`,eD=Symbol.for(eC),eE=class extends ad{constructor({toolArgs:a,toolName:b,cause:c,message:d=`Invalid arguments for tool ${b}: ${am(c)}`}){super({name:eB,message:d,cause:c}),this[G]=!0,this.toolArgs=a,this.toolName=b}static isInstance(a){return ad.hasMarker(a,eC)}};G=eD;var eF="AI_NoSuchToolError",eG=`vercel.ai.error.${eF}`,eH=Symbol.for(eG),eI=class extends ad{constructor({toolName:a,availableTools:b,message:c=`Model tried to call unavailable tool '${a}'. ${void 0===b?"No tools are available.":`Available tools: ${b.join(", ")}.`}`}){super({name:eF,message:c}),this[H]=!0,this.toolName=a,this.availableTools=b}static isInstance(a){return ad.hasMarker(a,eG)}};H=eH;var eJ="AI_ToolCallRepairError",eK=`vercel.ai.error.${eJ}`,eL=Symbol.for(eK),eM=class extends ad{constructor({cause:a,originalError:b,message:c=`Error repairing tool call: ${am(a)}`}){super({name:eJ,message:c,cause:a}),this[I]=!0,this.originalError=b}static isInstance(a){return ad.hasMarker(a,eK)}};async function eN({toolCall:a,tools:b,repairToolCall:c,system:d,messages:e}){if(null==b)throw new eI({toolName:a.toolName});try{return await eO({toolCall:a,tools:b})}catch(g){if(null==c||!(eI.isInstance(g)||eE.isInstance(g)))throw g;let f=null;try{f=await c({toolCall:a,tools:b,parameterSchema:({toolName:a})=>dj(b[a].parameters).jsonSchema,system:d,messages:e,error:g})}catch(a){throw new eM({cause:a,originalError:g})}if(null==f)throw g;return await eO({toolCall:f,tools:b})}}async function eO({toolCall:a,tools:b}){let c=a.toolName,d=b[c];if(null==d)throw new eI({toolName:a.toolName,availableTools:Object.keys(b)});let e=dj(d.parameters),f=""===a.args.trim()?a0({value:{},schema:e}):a1({text:a.args,schema:e});if(!1===f.success)throw new eE({toolName:c,toolArgs:a.args,cause:f.error});return{type:"tool-call",toolCallId:a.toolCallId,toolName:c,args:f.value}}function eP({text:a="",files:b,reasoning:c,tools:d,toolCalls:e,toolResults:f,messageId:g,generateMessageId:h}){let i=[],j=[];return c.length>0&&j.push(...c.map(a=>"text"===a.type?{...a,type:"reasoning"}:{...a,type:"redacted-reasoning"})),b.length>0&&j.push(...b.map(a=>({type:"file",data:a.base64,mimeType:a.mimeType}))),a.length>0&&j.push({type:"text",text:a}),e.length>0&&j.push(...e),j.length>0&&i.push({role:"assistant",content:j,id:g}),f.length>0&&i.push({role:"tool",id:h(),content:f.map(a=>{let b=d[a.toolName];return(null==b?void 0:b.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,result:b.experimental_toToolResultContent(a.result),experimental_content:b.experimental_toToolResultContent(a.result)}:{type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,result:a.result}})}),i}I=eL,aX({prefix:"aitxt",size:24}),aX({prefix:"msg",size:24}),dl({},{object:()=>eV,text:()=>eU});var eQ="AI_InvalidStreamPartError",eR=`vercel.ai.error.${eQ}`,eS=Symbol.for(eR),eT=class extends ad{constructor({chunk:a,message:b}){super({name:eQ,message:b}),this[J]=!0,this.chunk=a}static isInstance(a){return ad.hasMarker(a,eR)}};J=eS,Symbol.for("vercel.ai.error.AI_MCPClientError");var eU=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:a})=>a,parsePartial:({text:a})=>({partial:a}),parseOutput:({text:a})=>a}),eV=({schema:a})=>{let b=dj(a);return{type:"object",responseFormat:({model:a})=>({type:"json",schema:a.supportsStructuredOutputs?b.jsonSchema:void 0}),injectIntoSystemPrompt:({system:a,model:c})=>c.supportsStructuredOutputs?a:function({prompt:a,schema:b,schemaPrefix:c=null!=b?"JSON schema:":void 0,schemaSuffix:d=null!=b?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=a&&a.length>0?a:void 0,null!=a&&a.length>0?"":void 0,c,null!=b?JSON.stringify(b):void 0,d].filter(a=>null!=a).join("\n")}({prompt:a,schema:b.jsonSchema}),parsePartial({text:a}){let b=function(a){if(void 0===a)return{value:void 0,state:"undefined-input"};let b=a1({text:a});return b.success?{value:b.value,state:"successful-parse"}:(b=a1({text:function(a){let b=["ROOT"],c=-1,d=null;function e(a,e,f){switch(a){case'"':c=e,b.pop(),b.push(f),b.push("INSIDE_STRING");break;case"f":case"t":case"n":c=e,d=e,b.pop(),b.push(f),b.push("INSIDE_LITERAL");break;case"-":b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=e,b.pop(),b.push(f),b.push("INSIDE_NUMBER");break;case"{":c=e,b.pop(),b.push(f),b.push("INSIDE_OBJECT_START");break;case"[":c=e,b.pop(),b.push(f),b.push("INSIDE_ARRAY_START")}}function f(a,d){switch(a){case",":b.pop(),b.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":c=d,b.pop()}}function g(a,d){switch(a){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=d,b.pop()}}for(let h=0;h<a.length;h++){let i=a[h];switch(b[b.length-1]){case"ROOT":e(i,h,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':b.pop(),b.push("INSIDE_OBJECT_KEY");break;case"}":c=h,b.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(b.pop(),b.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(b.pop(),b.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":e(i,h,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":f(i,h);break;case"INSIDE_STRING":switch(i){case'"':b.pop(),c=h;break;case"\\":b.push("INSIDE_STRING_ESCAPE");break;default:c=h}break;case"INSIDE_ARRAY_START":"]"===i?(c=h,b.pop()):(c=h,e(i,h,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":b.pop(),b.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":c=h,b.pop();break;default:c=h}break;case"INSIDE_ARRAY_AFTER_COMMA":e(i,h,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":b.pop(),c=h;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":c=h;break;case"e":case"E":case"-":case".":break;case",":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"}":b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]&&f(i,h);break;case"]":b.pop(),"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h);break;default:b.pop()}break;case"INSIDE_LITERAL":{let e=a.substring(d,h+1);"false".startsWith(e)||"true".startsWith(e)||"null".startsWith(e)?c=h:(b.pop(),"INSIDE_OBJECT_AFTER_VALUE"===b[b.length-1]?f(i,h):"INSIDE_ARRAY_AFTER_VALUE"===b[b.length-1]&&g(i,h))}}}let h=a.slice(0,c+1);for(let c=b.length-1;c>=0;c--)switch(b[c]){case"INSIDE_STRING":h+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":h+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":h+="]";break;case"INSIDE_LITERAL":{let b=a.substring(d,a.length);"true".startsWith(b)?h+="true".slice(b.length):"false".startsWith(b)?h+="false".slice(b.length):"null".startsWith(b)&&(h+="null".slice(b.length))}}return h}(a)})).success?{value:b.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}(a);switch(b.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:b.value};default:{let a=b.state;throw Error(`Unsupported parse state: ${a}`)}}},parseOutput({text:a},c){let d=a1({text:a});if(!d.success)throw new dN({message:"No object generated: could not parse the response.",cause:d.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});let e=a0({value:d.value,schema:b});if(!e.success)throw new dN({message:"No object generated: response did not match schema.",cause:e.error,text:a,response:c.response,usage:c.usage,finishReason:c.finishReason});return e.value}}};async function eW({stream:a,onError:b}){let c=a.getReader();try{for(;;){let{done:a}=await c.read();if(a)break}}catch(a){null==b||b(a)}finally{c.releaseLock()}}function eX(a,b){let c,d,e=a.getReader(),f=b.getReader(),g=!1,h=!1;async function i(a){try{null==c&&(c=e.read());let b=await c;c=void 0,b.done?a.close():a.enqueue(b.value)}catch(b){a.error(b)}}async function j(a){try{null==d&&(d=f.read());let b=await d;d=void 0,b.done?a.close():a.enqueue(b.value)}catch(b){a.error(b)}}return new ReadableStream({async pull(a){try{if(g)return void await j(a);if(h)return void await i(a);null==c&&(c=e.read()),null==d&&(d=f.read());let{result:b,reader:k}=await Promise.race([c.then(a=>({result:a,reader:e})),d.then(a=>({result:a,reader:f}))]);b.done||a.enqueue(b.value),k===e?(c=void 0,b.done&&(await j(a),g=!0)):(d=void 0,b.done&&(h=!0,await i(a)))}catch(b){a.error(b)}},cancel(){e.cancel(),f.cancel()}})}var eY=aX({prefix:"aitxt",size:24}),eZ=aX({prefix:"msg",size:24}),e$=class{constructor({model:a,telemetry:b,headers:c,settings:d,maxRetries:e,abortSignal:f,system:g,prompt:h,messages:i,tools:j,toolChoice:k,toolCallStreaming:l,transforms:m,activeTools:n,repairToolCall:o,maxSteps:p,output:q,continueSteps:r,providerOptions:s,now:t,currentDate:u,generateId:v,generateMessageId:w,onChunk:x,onError:y,onFinish:z,onStepFinish:A}){var B;let C,D,E,F;if(this.warningsPromise=new eq,this.usagePromise=new eq,this.finishReasonPromise=new eq,this.providerMetadataPromise=new eq,this.textPromise=new eq,this.reasoningPromise=new eq,this.reasoningDetailsPromise=new eq,this.sourcesPromise=new eq,this.filesPromise=new eq,this.toolCallsPromise=new eq,this.toolResultsPromise=new eq,this.requestPromise=new eq,this.responsePromise=new eq,this.stepsPromise=new eq,p<1)throw new du({parameter:"maxSteps",value:p,message:"maxSteps must be at least 1"});this.output=q;let G="",H="",I="",J=[],K=[],L=[];const M=[],N={id:v(),timestamp:u(),modelId:a.modelId,messages:[]};let O=[],P=[],Q="initial";const R=[],S=new TransformStream({async transform(a,b){b.enqueue(a);let{part:c}=a;if(("text-delta"===c.type||"reasoning"===c.type||"source"===c.type||"tool-call"===c.type||"tool-result"===c.type||"tool-call-streaming-start"===c.type||"tool-call-delta"===c.type)&&await (null==x?void 0:x({chunk:c})),"error"===c.type&&await (null==y?void 0:y({error:c.error})),"text-delta"===c.type&&(G+=c.textDelta,H+=c.textDelta,I+=c.textDelta),"reasoning"===c.type&&(null==D?(D={type:"text",text:c.textDelta},J.push(D)):D.text+=c.textDelta),"reasoning-signature"===c.type){if(null==D)throw new ad({name:"InvalidStreamPart",message:"reasoning-signature without reasoning"});D.signature=c.signature,D=void 0}if("redacted-reasoning"===c.type&&J.push({type:"redacted",data:c.data}),"file"===c.type&&K.push(c),"source"===c.type&&(M.push(c.source),L.push(c.source)),"tool-call"===c.type&&O.push(c),"tool-result"===c.type&&P.push(c),"step-finish"===c.type){let a,b=eP({text:H,files:K,reasoning:J,tools:null!=j?j:{},toolCalls:O,toolResults:P,messageId:c.messageId,generateMessageId:w}),d=R.length,e="done";d+1<p&&(r&&"length"===c.finishReason&&0===O.length?e="continue":O.length>0&&P.length===O.length&&(e="tool-result"));let f={stepType:Q,text:G,reasoning:(a=J.filter(a=>"text"===a.type).map(a=>a.text).join("")).length>0?a:void 0,reasoningDetails:J,files:K,sources:L,toolCalls:O,toolResults:P,finishReason:c.finishReason,usage:c.usage,warnings:c.warnings,logprobs:c.logprobs,request:c.request,response:{...c.response,messages:[...N.messages,...b]},providerMetadata:c.experimental_providerMetadata,experimental_providerMetadata:c.experimental_providerMetadata,isContinued:c.isContinued};await (null==A?void 0:A(f)),R.push(f),O=[],P=[],G="",L=[],J=[],K=[],D=void 0,"done"!==e&&(Q=e),"continue"!==e&&(N.messages.push(...b),H="")}"finish"===c.type&&(N.id=c.response.id,N.timestamp=c.response.timestamp,N.modelId=c.response.modelId,N.headers=c.response.headers,F=c.usage,E=c.finishReason)},async flush(a){var c;try{if(0===R.length)return;let a=R[R.length-1];$.warningsPromise.resolve(a.warnings),$.requestPromise.resolve(a.request),$.responsePromise.resolve(a.response),$.toolCallsPromise.resolve(a.toolCalls),$.toolResultsPromise.resolve(a.toolResults),$.providerMetadataPromise.resolve(a.experimental_providerMetadata),$.reasoningPromise.resolve(a.reasoning),$.reasoningDetailsPromise.resolve(a.reasoningDetails);let d=null!=E?E:"unknown",e=null!=F?F:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};$.finishReasonPromise.resolve(d),$.usagePromise.resolve(e),$.textPromise.resolve(I),$.sourcesPromise.resolve(M),$.filesPromise.resolve(a.files),$.stepsPromise.resolve(R),await (null==z?void 0:z({finishReason:d,logprobs:void 0,usage:e,text:I,reasoning:a.reasoning,reasoningDetails:a.reasoningDetails,files:a.files,sources:a.sources,toolCalls:a.toolCalls,toolResults:a.toolResults,request:null!=(c=a.request)?c:{},response:a.response,warnings:a.warnings,providerMetadata:a.providerMetadata,experimental_providerMetadata:a.experimental_providerMetadata,steps:R})),C.setAttributes(dG({telemetry:b,attributes:{"ai.response.finishReason":d,"ai.response.text":{output:()=>I},"ai.response.toolCalls":{output:()=>{var b;return(null==(b=a.toolCalls)?void 0:b.length)?JSON.stringify(a.toolCalls):void 0}},"ai.usage.promptTokens":e.promptTokens,"ai.usage.completionTokens":e.completionTokens,"ai.response.providerMetadata":JSON.stringify(a.providerMetadata)}}))}catch(b){a.error(b)}finally{C.end()}}}),T=function(){let a=[],b=null,c=!1,d=er(),e=async()=>{if(c&&0===a.length){null==b||b.close();return}if(0===a.length)return d=er(),await d.promise,e();try{let{value:d,done:f}=await a[0].read();f?(a.shift(),a.length>0?await e():c&&(null==b||b.close())):null==b||b.enqueue(d)}catch(d){null==b||b.error(d),a.shift(),c&&0===a.length&&(null==b||b.close())}};return{stream:new ReadableStream({start(a){b=a},pull:e,async cancel(){for(let b of a)await b.cancel();a=[],c=!0}}),addStream:b=>{if(c)throw Error("Cannot add inner stream: outer stream is closed");a.push(b.getReader()),d.resolve()},close:()=>{c=!0,d.resolve(),0===a.length&&(null==b||b.close())},terminate:()=>{c=!0,d.resolve(),a.forEach(a=>a.cancel()),a=[],null==b||b.close()}}}();this.addStream=T.addStream,this.closeStream=T.close;let U=T.stream;for(const a of m)U=U.pipeThrough(a({tools:j,stopStream(){T.terminate()}}));this.baseStream=U.pipeThrough(function(a){if(!a)return new TransformStream({transform(a,b){b.enqueue({part:a,partialOutput:void 0})}});let b="",c="",d="";function e({controller:a,partialOutput:b}){a.enqueue({part:{type:"text-delta",textDelta:c},partialOutput:b}),c=""}return new TransformStream({transform(f,g){if("step-finish"===f.type&&e({controller:g}),"text-delta"!==f.type)return void g.enqueue({part:f,partialOutput:void 0});b+=f.textDelta,c+=f.textDelta;let h=a.parsePartial({text:b});if(null!=h){let a=JSON.stringify(h.partial);a!==d&&(e({controller:g,partialOutput:h.partial}),d=a)}},flush(a){c.length>0&&e({controller:a})}})}(q)).pipeThrough(S);const{maxRetries:V,retry:W}=function({maxRetries:a}){if(null!=a){if(!Number.isInteger(a))throw new du({parameter:"maxRetries",value:a,message:"maxRetries must be an integer"});if(a<0)throw new du({parameter:"maxRetries",value:a,message:"maxRetries must be >= 0"})}let b=null!=a?a:2;return{maxRetries:b,retry:(({maxRetries:a=2,initialDelayInMs:b=2e3,backoffFactor:c=2}={})=>async d=>dz(d,{maxRetries:a,delayInMs:b,backoffFactor:c}))({maxRetries:b})}}({maxRetries:e}),X=function({isEnabled:a=!1,tracer:b}={}){return a?b||bh.u.getTracer("ai"):dB}(b),Y=function({model:a,settings:b,telemetry:c,headers:d}){var e;return{"ai.model.provider":a.provider,"ai.model.id":a.modelId,...Object.entries(b).reduce((a,[b,c])=>(a[`ai.settings.${b}`]=c,a),{}),...Object.entries(null!=(e=null==c?void 0:c.metadata)?e:{}).reduce((a,[b,c])=>(a[`ai.telemetry.metadata.${b}`]=c,a),{}),...Object.entries(null!=d?d:{}).reduce((a,[b,c])=>(void 0!==c&&(a[`ai.request.headers.${b}`]=c),a),{})}}({model:a,telemetry:b,headers:c,settings:{...d,maxRetries:V}}),Z=function({prompt:a,tools:b}){if(null==a.prompt&&null==a.messages)throw new au({prompt:a,message:"prompt or messages must be defined"});if(null!=a.prompt&&null!=a.messages)throw new au({prompt:a,message:"prompt and messages cannot be defined at the same time"});if(null!=a.system&&"string"!=typeof a.system)throw new au({prompt:a,message:"system must be a string"});if(null!=a.prompt){if("string"!=typeof a.prompt)throw new au({prompt:a,message:"prompt must be a string"});return{type:"prompt",system:a.system,messages:[{role:"user",content:a.prompt}]}}if(null!=a.messages){let c="ui-messages"===function(a){if(!Array.isArray(a))throw new au({prompt:a,message:`messages must be an array of CoreMessage or UIMessage
Received non-array value: ${JSON.stringify(a)}`,cause:a});if(0===a.length)return"messages";let b=a.map(en);if(b.some(a=>"has-ui-specific-parts"===a))return"ui-messages";let c=b.findIndex(a=>"has-core-specific-parts"!==a&&"message"!==a);if(-1===c)return"messages";throw new au({prompt:a,message:`messages must be an array of CoreMessage or UIMessage
Received message of type: "${b[c]}" at index ${c}
messages[${c}]: ${JSON.stringify(a[c])}`,cause:a})}(a.messages)?function(a,b){var c,d;let e=null!=(c=null==b?void 0:b.tools)?c:{},f=[];for(let b=0;b<a.length;b++){let c=a[b],g=b===a.length-1,{role:h,content:i,experimental_attachments:j}=c;switch(h){case"system":f.push({role:"system",content:i});break;case"user":if(null==c.parts)f.push({role:"user",content:j?[{type:"text",text:i},...d4(j)]:i});else{let a=c.parts.filter(a=>"text"===a.type).map(a=>({type:"text",text:a.text}));f.push({role:"user",content:j?[...a,...d4(j)]:a})}break;case"assistant":{if(null!=c.parts){let a=function(){let a=[];for(let b of h)switch(b.type){case"file":case"text":a.push(b);break;case"reasoning":for(let c of b.details)switch(c.type){case"text":a.push({type:"reasoning",text:c.text,signature:c.signature});break;case"redacted":a.push({type:"redacted-reasoning",data:c.data})}break;case"tool-invocation":a.push({type:"tool-call",toolCallId:b.toolInvocation.toolCallId,toolName:b.toolInvocation.toolName,args:b.toolInvocation.args});break;default:throw Error(`Unsupported part: ${b}`)}f.push({role:"assistant",content:a});let d=h.filter(a=>"tool-invocation"===a.type).map(a=>a.toolInvocation);d.length>0&&f.push({role:"tool",content:d.map(a=>{if(!("result"in a))throw new d8({originalMessage:c,message:"ToolInvocation must have a result: "+JSON.stringify(a)});let{toolCallId:b,toolName:d,result:f}=a,g=e[d];return(null==g?void 0:g.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:b,toolName:d,result:g.experimental_toToolResultContent(f),experimental_content:g.experimental_toToolResultContent(f)}:{type:"tool-result",toolCallId:b,toolName:d,result:f}})}),h=[],g=!1,b++},b=0,g=!1,h=[];for(let e of c.parts)switch(e.type){case"text":g&&a(),h.push(e);break;case"file":case"reasoning":h.push(e);break;case"tool-invocation":(null!=(d=e.toolInvocation.step)?d:0)!==b&&a(),h.push(e),g=!0}a();break}let a=c.toolInvocations;if(null==a||0===a.length){f.push({role:"assistant",content:i});break}let b=a.reduce((a,b)=>{var c;return Math.max(a,null!=(c=b.step)?c:0)},0);for(let d=0;d<=b;d++){let b=a.filter(a=>{var b;return(null!=(b=a.step)?b:0)===d});0!==b.length&&(f.push({role:"assistant",content:[...g&&i&&0===d?[{type:"text",text:i}]:[],...b.map(({toolCallId:a,toolName:b,args:c})=>({type:"tool-call",toolCallId:a,toolName:b,args:c}))]}),f.push({role:"tool",content:b.map(a=>{if(!("result"in a))throw new d8({originalMessage:c,message:"ToolInvocation must have a result: "+JSON.stringify(a)});let{toolCallId:b,toolName:d,result:f}=a,g=e[d];return(null==g?void 0:g.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:b,toolName:d,result:g.experimental_toToolResultContent(f),experimental_content:g.experimental_toToolResultContent(f)}:{type:"tool-result",toolCallId:b,toolName:d,result:f}})}))}i&&!g&&f.push({role:"assistant",content:i});break}case"data":break;default:throw new d8({originalMessage:c,message:`Unsupported role: ${h}`})}}return f}(a.messages,{tools:b}):a.messages;if(0===c.length)throw new au({prompt:a,message:"messages must not be empty"});let d=a0({value:c,schema:cz(em)});if(!d.success)throw new au({prompt:a,message:`message must be a CoreMessage or a UI message
Validation error: ${d.error.message}`,cause:d.error});return{type:"messages",messages:c,system:a.system}}throw Error("unreachable")}({prompt:{system:null!=(B=null==q?void 0:q.injectIntoSystemPrompt({system:g,model:a}))?B:g,prompt:h,messages:i},tools:j}),$=this;dE({name:"ai.streamText",attributes:dG({telemetry:b,attributes:{...dA({operationId:"ai.streamText",telemetry:b}),...Y,"ai.prompt":{input:()=>JSON.stringify({system:g,prompt:h,messages:i})},"ai.settings.maxSteps":p}}),tracer:X,endWhenDone:!1,fn:async e=>{async function h({currentStep:e,responseMessages:i,usage:m,stepType:x,previousStepText:y,hasLeadingWhitespace:z,messageId:A}){var B;let C,D,E,F=0===i.length?Z.type:"messages",G=[...Z.messages,...i],H=await d2({prompt:{type:F,system:Z.system,messages:G},modelSupportsImageUrls:a.supportsImageUrls,modelSupportsUrl:null==(B=a.supportsUrl)?void 0:B.bind(a)}),I={type:"regular",...function({tools:a,toolChoice:b,activeTools:c}){return null!=a&&Object.keys(a).length>0?{tools:(null!=c?Object.entries(a).filter(([a])=>c.includes(a)):Object.entries(a)).map(([a,b])=>{let c=b.type;switch(c){case void 0:case"function":return{type:"function",name:a,description:b.description,parameters:dj(b.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:a,id:b.id,args:b.args};default:throw Error(`Unsupported tool type: ${c}`)}}),toolChoice:null==b?{type:"auto"}:"string"==typeof b?{type:b}:{type:"tool",toolName:b.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:j,toolChoice:k,activeTools:n})},{result:{stream:J,warnings:K,rawResponse:L,request:M},doStreamSpan:N,startTimestampMs:O}=await W(()=>dE({name:"ai.streamText.doStream",attributes:dG({telemetry:b,attributes:{...dA({operationId:"ai.streamText.doStream",telemetry:b}),...Y,"ai.prompt.format":{input:()=>F},"ai.prompt.messages":{input:()=>JSON.stringify(H.map(a=>({...a,content:"string"==typeof a.content?a.content:a.content.map(ep)})))},"ai.prompt.tools":{input:()=>{var a;return null==(a=I.tools)?void 0:a.map(a=>JSON.stringify(a))}},"ai.prompt.toolChoice":{input:()=>null!=I.toolChoice?JSON.stringify(I.toolChoice):void 0},"gen_ai.system":a.provider,"gen_ai.request.model":a.modelId,"gen_ai.request.frequency_penalty":d.frequencyPenalty,"gen_ai.request.max_tokens":d.maxTokens,"gen_ai.request.presence_penalty":d.presencePenalty,"gen_ai.request.stop_sequences":d.stopSequences,"gen_ai.request.temperature":d.temperature,"gen_ai.request.top_k":d.topK,"gen_ai.request.top_p":d.topP}}),tracer:X,endWhenDone:!1,fn:async b=>({startTimestampMs:t(),doStreamSpan:b,result:await a.doStream({mode:I,...function({maxTokens:a,temperature:b,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,stopSequences:g,seed:h}){if(null!=a){if(!Number.isInteger(a))throw new du({parameter:"maxTokens",value:a,message:"maxTokens must be an integer"});if(a<1)throw new du({parameter:"maxTokens",value:a,message:"maxTokens must be >= 1"})}if(null!=b&&"number"!=typeof b)throw new du({parameter:"temperature",value:b,message:"temperature must be a number"});if(null!=c&&"number"!=typeof c)throw new du({parameter:"topP",value:c,message:"topP must be a number"});if(null!=d&&"number"!=typeof d)throw new du({parameter:"topK",value:d,message:"topK must be a number"});if(null!=e&&"number"!=typeof e)throw new du({parameter:"presencePenalty",value:e,message:"presencePenalty must be a number"});if(null!=f&&"number"!=typeof f)throw new du({parameter:"frequencyPenalty",value:f,message:"frequencyPenalty must be a number"});if(null!=h&&!Number.isInteger(h))throw new du({parameter:"seed",value:h,message:"seed must be an integer"});return{maxTokens:a,temperature:null!=b?b:0,topP:c,topK:d,presencePenalty:e,frequencyPenalty:f,stopSequences:null!=g&&g.length>0?g:void 0,seed:h}}(d),inputFormat:F,responseFormat:null==q?void 0:q.responseFormat({model:a}),prompt:H,providerMetadata:s,abortSignal:f,headers:c})})})),P=function({tools:a,generatorStream:b,toolCallStreaming:c,tracer:d,telemetry:e,system:f,messages:g,abortSignal:h,repairToolCall:i}){let j,k=null,l=new ReadableStream({start(a){k=a}}),m={},n=new Set,o=!1;function p(){o&&0===n.size&&(null!=j&&k.enqueue(j),k.close())}let q=new TransformStream({async transform(b,l){let o=b.type;switch(o){case"text-delta":case"reasoning":case"reasoning-signature":case"redacted-reasoning":case"source":case"response-metadata":case"error":l.enqueue(b);break;case"file":l.enqueue(new dI({data:b.data,mimeType:b.mimeType}));break;case"tool-call-delta":c&&(m[b.toolCallId]||(l.enqueue({type:"tool-call-streaming-start",toolCallId:b.toolCallId,toolName:b.toolName}),m[b.toolCallId]=!0),l.enqueue({type:"tool-call-delta",toolCallId:b.toolCallId,toolName:b.toolName,argsTextDelta:b.argsTextDelta}));break;case"tool-call":try{let c=await eN({toolCall:b,tools:a,repairToolCall:i,system:f,messages:g});l.enqueue(c);let j=a[c.toolName];if(null!=j.execute){let a=aY();n.add(a),dE({name:"ai.toolCall",attributes:dG({telemetry:e,attributes:{...dA({operationId:"ai.toolCall",telemetry:e}),"ai.toolCall.name":c.toolName,"ai.toolCall.id":c.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(c.args)}}}),tracer:d,fn:async b=>j.execute(c.args,{toolCallId:c.toolCallId,messages:g,abortSignal:h}).then(d=>{k.enqueue({...c,type:"tool-result",result:d}),n.delete(a),p();try{b.setAttributes(dG({telemetry:e,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(d)}}}))}catch(a){}},d=>{dF(b,d),k.enqueue({type:"error",error:new ez({toolCallId:c.toolCallId,toolName:c.toolName,toolArgs:c.args,cause:d})}),n.delete(a),p()})})}}catch(a){k.enqueue({type:"error",error:a})}break;case"finish":j={type:"finish",finishReason:b.finishReason,logprobs:b.logprobs,usage:function({promptTokens:a,completionTokens:b}){return{promptTokens:a,completionTokens:b,totalTokens:a+b}}(b.usage),experimental_providerMetadata:b.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${o}`)}},flush(){o=!0,p()}});return new ReadableStream({start:async a=>Promise.all([b.pipeThrough(q).pipeTo(new WritableStream({write(b){a.enqueue(b)},close(){}})),l.pipeTo(new WritableStream({write(b){a.enqueue(b)},close(){a.close()}}))])})}({tools:j,generatorStream:J,toolCallStreaming:l,tracer:X,telemetry:b,system:g,messages:G,repairToolCall:o,abortSignal:f}),Q=null!=M?M:{},R=[],S=[],T=[],U=[],V="unknown",_={promptTokens:0,completionTokens:0,totalTokens:0},aa=!0,ab="",ac="continue"===x?y:"",ad={id:v(),timestamp:u(),modelId:a.modelId},ae="",af=!1,ag=!0,ah=!1;async function ai({controller:a,chunk:b}){a.enqueue(b),ab+=b.textDelta,ac+=b.textDelta,af=!0,ah=b.textDelta.trimEnd()!==b.textDelta}$.addStream(P.pipeThrough(new TransformStream({async transform(a,b){var c,d,e;if(aa){let a=t()-O;aa=!1,N.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":a}),N.setAttributes({"ai.response.msToFirstChunk":a}),b.enqueue({type:"step-start",messageId:A,request:Q,warnings:null!=K?K:[]})}if("text-delta"===a.type&&0===a.textDelta.length)return;let f=a.type;switch(f){case"text-delta":if(r){let c,d=ag&&z?a.textDelta.trimStart():a.textDelta;if(0===d.length)break;ag=!1,ae+=d;let e=(c=ae.match(eA))?{prefix:c[1],whitespace:c[2],suffix:c[3]}:void 0;null!=e&&(ae=e.suffix,await ai({controller:b,chunk:{type:"text-delta",textDelta:e.prefix+e.whitespace}}))}else await ai({controller:b,chunk:a});break;case"reasoning":b.enqueue(a),null==E?(E={type:"text",text:a.textDelta},T.push(E)):E.text+=a.textDelta;break;case"reasoning-signature":if(b.enqueue(a),null==E)throw new eT({chunk:a,message:"reasoning-signature without reasoning"});E.signature=a.signature,E=void 0;break;case"redacted-reasoning":b.enqueue(a),T.push({type:"redacted",data:a.data});break;case"tool-call":b.enqueue(a),R.push(a);break;case"tool-result":b.enqueue(a),S.push(a);break;case"response-metadata":ad={id:null!=(c=a.id)?c:ad.id,timestamp:null!=(d=a.timestamp)?d:ad.timestamp,modelId:null!=(e=a.modelId)?e:ad.modelId};break;case"finish":{_=a.usage,V=a.finishReason,C=a.experimental_providerMetadata,D=a.logprobs;let b=t()-O;N.addEvent("ai.stream.finish"),N.setAttributes({"ai.response.msToFinish":b,"ai.response.avgCompletionTokensPerSecond":1e3*_.completionTokens/b});break}case"file":U.push(a),b.enqueue(a);break;case"source":case"tool-call-streaming-start":case"tool-call-delta":b.enqueue(a);break;case"error":b.enqueue(a),V="error";break;default:throw Error(`Unknown chunk type: ${f}`)}},async flush(a){var c;let d=R.length>0?JSON.stringify(R):void 0,f="done";e+1<p&&(r&&"length"===V&&0===R.length?f="continue":R.length>0&&S.length===R.length&&(f="tool-result")),r&&ae.length>0&&("continue"!==f||"continue"===x&&!af)&&(await ai({controller:a,chunk:{type:"text-delta",textDelta:ae}}),ae="");try{N.setAttributes(dG({telemetry:b,attributes:{"ai.response.finishReason":V,"ai.response.text":{output:()=>ab},"ai.response.toolCalls":{output:()=>d},"ai.response.id":ad.id,"ai.response.model":ad.modelId,"ai.response.timestamp":ad.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(C),"ai.usage.promptTokens":_.promptTokens,"ai.usage.completionTokens":_.completionTokens,"gen_ai.response.finish_reasons":[V],"gen_ai.response.id":ad.id,"gen_ai.response.model":ad.modelId,"gen_ai.usage.input_tokens":_.promptTokens,"gen_ai.usage.output_tokens":_.completionTokens}}))}catch(a){}finally{N.end()}a.enqueue({type:"step-finish",finishReason:V,usage:_,providerMetadata:C,experimental_providerMetadata:C,logprobs:D,request:Q,response:{...ad,headers:null==L?void 0:L.headers},warnings:K,isContinued:"continue"===f,messageId:A});let g=(c=_,{promptTokens:m.promptTokens+c.promptTokens,completionTokens:m.completionTokens+c.completionTokens,totalTokens:m.totalTokens+c.totalTokens});if("done"===f)a.enqueue({type:"finish",finishReason:V,usage:g,providerMetadata:C,experimental_providerMetadata:C,logprobs:D,response:{...ad,headers:null==L?void 0:L.headers}}),$.closeStream();else{if("continue"===x){let a=i[i.length-1];"string"==typeof a.content?a.content+=ab:a.content.push({text:ab,type:"text"})}else i.push(...eP({text:ab,files:U,reasoning:T,tools:null!=j?j:{},toolCalls:R,toolResults:S,messageId:A,generateMessageId:w}));await h({currentStep:e+1,responseMessages:i,usage:g,stepType:f,previousStepText:ac,hasLeadingWhitespace:ah,messageId:"continue"===f?A:w()})}}})))}C=e,await h({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:w()})}}).catch(a=>{$.addStream(new ReadableStream({start(b){b.enqueue({type:"error",error:a}),b.close()}})),$.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get reasoningDetails(){return this.reasoningDetailsPromise.value}get sources(){return this.sourcesPromise.value}get files(){return this.filesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[a,b]=this.baseStream.tee();return this.baseStream=b,a}get textStream(){return eo(this.teeStream().pipeThrough(new TransformStream({transform({part:a},b){"text-delta"===a.type&&b.enqueue(a.textDelta)}})))}get fullStream(){return eo(this.teeStream().pipeThrough(new TransformStream({transform({part:a},b){b.enqueue(a)}})))}async consumeStream(a){var b;try{await eW({stream:this.fullStream,onError:null==a?void 0:a.onError})}catch(c){null==(b=null==a?void 0:a.onError)||b.call(a,c)}}get experimental_partialOutputStream(){if(null==this.output)throw new ev;return eo(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:a},b){null!=a&&b.enqueue(a)}})))}toDataStreamInternal({getErrorMessage:a=()=>"An error occurred.",sendUsage:b=!0,sendReasoning:c=!1,sendSources:d=!1,experimental_sendFinish:e=!0}){return this.fullStream.pipeThrough(new TransformStream({transform:async(f,g)=>{let h=f.type;switch(h){case"text-delta":g.enqueue(dh("text",f.textDelta));break;case"reasoning":c&&g.enqueue(dh("reasoning",f.textDelta));break;case"redacted-reasoning":c&&g.enqueue(dh("redacted_reasoning",{data:f.data}));break;case"reasoning-signature":c&&g.enqueue(dh("reasoning_signature",{signature:f.signature}));break;case"file":g.enqueue(dh("file",{mimeType:f.mimeType,data:f.base64}));break;case"source":d&&g.enqueue(dh("source",f.source));break;case"tool-call-streaming-start":g.enqueue(dh("tool_call_streaming_start",{toolCallId:f.toolCallId,toolName:f.toolName}));break;case"tool-call-delta":g.enqueue(dh("tool_call_delta",{toolCallId:f.toolCallId,argsTextDelta:f.argsTextDelta}));break;case"tool-call":g.enqueue(dh("tool_call",{toolCallId:f.toolCallId,toolName:f.toolName,args:f.args}));break;case"tool-result":g.enqueue(dh("tool_result",{toolCallId:f.toolCallId,result:f.result}));break;case"error":g.enqueue(dh("error",a(f.error)));break;case"step-start":g.enqueue(dh("start_step",{messageId:f.messageId}));break;case"step-finish":g.enqueue(dh("finish_step",{finishReason:f.finishReason,usage:b?{promptTokens:f.usage.promptTokens,completionTokens:f.usage.completionTokens}:void 0,isContinued:f.isContinued}));break;case"finish":e&&g.enqueue(dh("finish_message",{finishReason:f.finishReason,usage:b?{promptTokens:f.usage.promptTokens,completionTokens:f.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${h}`)}}}))}pipeDataStreamToResponse(a,{status:b,statusText:c,headers:d,data:e,getErrorMessage:f,sendUsage:g,sendReasoning:h,sendSources:i,experimental_sendFinish:j}={}){dp({response:a,status:b,statusText:c,headers:dn(d,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:e,getErrorMessage:f,sendUsage:g,sendReasoning:h,sendSources:i,experimental_sendFinish:j})})}pipeTextStreamToResponse(a,b){dp({response:a,status:null==b?void 0:b.status,statusText:null==b?void 0:b.statusText,headers:dn(null==b?void 0:b.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(a){let b=this.toDataStreamInternal({getErrorMessage:null==a?void 0:a.getErrorMessage,sendUsage:null==a?void 0:a.sendUsage,sendReasoning:null==a?void 0:a.sendReasoning,sendSources:null==a?void 0:a.sendSources,experimental_sendFinish:null==a?void 0:a.experimental_sendFinish}).pipeThrough(new TextEncoderStream);return(null==a?void 0:a.data)?eX(null==a?void 0:a.data.stream,b):b}mergeIntoDataStream(a,b){a.merge(this.toDataStreamInternal({getErrorMessage:a.onError,sendUsage:null==b?void 0:b.sendUsage,sendReasoning:null==b?void 0:b.sendReasoning,sendSources:null==b?void 0:b.sendSources,experimental_sendFinish:null==b?void 0:b.experimental_sendFinish}))}toDataStreamResponse({headers:a,status:b,statusText:c,data:d,getErrorMessage:e,sendUsage:f,sendReasoning:g,sendSources:h,experimental_sendFinish:i}={}){return new Response(this.toDataStream({data:d,getErrorMessage:e,sendUsage:f,sendReasoning:g,sendSources:h,experimental_sendFinish:i}),{status:b,statusText:c,headers:dm(a,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(a){var b;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(b=null==a?void 0:a.status)?b:200,headers:dm(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8"})})}},e_=(Symbol.for("vercel.ai.error.AI_NoSuchProviderError"),cA({name:ct(),version:ct()}).passthrough()),e0=cA({_meta:cH(cA({}).passthrough())}).passthrough(),e1=cA({method:ct(),params:cH(e0)}),e2=cA({experimental:cH(cA({}).passthrough()),logging:cH(cA({}).passthrough()),prompts:cH(cA({listChanged:cH(cv())}).passthrough()),resources:cH(cA({subscribe:cH(cv()),listChanged:cH(cv())}).passthrough()),tools:cH(cA({listChanged:cH(cv())}).passthrough())}).passthrough();e0.extend({protocolVersion:ct(),capabilities:e2,serverInfo:e_,instructions:cH(ct())});var e3=e0.extend({nextCursor:cH(ct())}),e4=cA({name:ct(),description:cH(ct()),inputSchema:cA({type:cF("object"),properties:cH(cA({}).passthrough())}).passthrough()}).passthrough();e3.extend({tools:cz(e4)});var e5=cA({type:cF("text"),text:ct()}).passthrough(),e6=cA({type:cF("image"),data:ct().base64(),mimeType:ct()}).passthrough(),e7=cA({uri:ct(),mimeType:cH(ct())}).passthrough(),e8=e7.extend({text:ct()}),e9=e7.extend({blob:ct().base64()}),fa=cA({type:cF("resource"),resource:cB([e8,e9])}).passthrough();e0.extend({content:cz(cB([e5,e6,fa])),isError:cv().default(!1).optional()}).or(e0.extend({toolResult:cy()}));var fb=cA({jsonrpc:cF("2.0"),id:cB([ct(),cu().int()])}).merge(e1).strict(),fc=cA({jsonrpc:cF("2.0"),id:cB([ct(),cu().int()]),result:e0}).strict(),fd=cA({jsonrpc:cF("2.0"),id:cB([ct(),cu().int()]),error:cA({code:cu().int(),message:ct(),data:cH(cy())})}).strict();function fe(a={}){let b=new TextEncoder,c="";return new TransformStream({async start(){a.onStart&&await a.onStart()},async transform(d,e){e.enqueue(b.encode(d)),c+=d,a.onToken&&await a.onToken(d),a.onText&&"string"==typeof d&&await a.onText(d)},async flush(){a.onCompletion&&await a.onCompletion(c),a.onFinal&&await a.onFinal(c)}})}function ff(a,b){return a.pipeThrough(new TransformStream({transform:async(a,b)=>{var c;if("string"==typeof a)return void b.enqueue(a);if("event"in a){"on_chat_model_stream"===a.event&&fj(null==(c=a.data)?void 0:c.chunk,b);return}fj(a,b)}})).pipeThrough(fe(b)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(a,b)=>{b.enqueue(dh("text",a))}}))}function fg(a,b){return ff(a,b).pipeThrough(new TextEncoderStream)}function fh(a,b){var c;let d=ff(a,null==b?void 0:b.callbacks).pipeThrough(new TextEncoderStream),e=null==b?void 0:b.data,f=null==b?void 0:b.init;return new Response(e?eX(e.stream,d):d,{status:null!=(c=null==f?void 0:f.status)?c:200,statusText:null==f?void 0:f.statusText,headers:dm(null==f?void 0:f.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function fi(a,b){b.dataStream.merge(ff(a,b.callbacks))}function fj(a,b){if("string"==typeof a.content)b.enqueue(a.content);else for(let c of a.content)"text"===c.type&&b.enqueue(c.text)}function fk(a,b){var c;let d,e=(d=!0,a=>(d&&(a=a.trimStart())&&(d=!1),a));return(c=a[Symbol.asyncIterator](),new ReadableStream({async pull(a){try{let{value:b,done:d}=await c.next();d?a.close():a.enqueue(b)}catch(b){a.error(b)}},cancel(){}})).pipeThrough(new TransformStream({async transform(a,b){b.enqueue(e(a.delta))}})).pipeThrough(fe(b)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(a,b)=>{b.enqueue(dh("text",a))}}))}function fl(a,b){return fk(a,b).pipeThrough(new TextEncoderStream)}function fm(a,b={}){var c;let{init:d,data:e,callbacks:f}=b,g=fk(a,f).pipeThrough(new TextEncoderStream);return new Response(e?eX(e.stream,g):g,{status:null!=(c=null==d?void 0:d.status)?c:200,statusText:null==d?void 0:d.statusText,headers:dm(null==d?void 0:d.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function fn(a,b){b.dataStream.merge(fk(a,b.callbacks))}function fo(a){var b,c;return null!=(c=null==(b=null==a?void 0:a.content)?void 0:b.map(({token:a,logprob:b,top_logprobs:c})=>({token:a,logprob:b,topLogprobs:c?c.map(({token:a,logprob:b})=>({token:a,logprob:b})):[]})))?c:void 0}function fp(a){switch(a){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}cB([fb,cA({jsonrpc:cF("2.0")}).merge(cA({method:ct(),params:cH(e0)})).strict(),fc,fd]),dl({},{mergeIntoDataStream:()=>fi,toDataStream:()=>fg,toDataStreamResponse:()=>fh}),dl({},{mergeIntoDataStream:()=>fn,toDataStream:()=>fl,toDataStreamResponse:()=>fm});var fq=cA({error:cA({message:ct(),type:ct().nullish(),param:cx().nullish(),code:cB([ct(),cu()]).nullish()})}),fr=a9({errorSchema:fq,errorToMessage:a=>a.error.message});function fs({id:a,model:b,created:c}){return{id:null!=a?a:void 0,modelId:null!=b?b:void 0,timestamp:null!=c?new Date(1e3*c):void 0}}var ft=class{constructor(a,b,c){this.specificationVersion="v1",this.modelId=a,this.settings=b,this.config=c}get supportsStructuredOutputs(){var a;return null!=(a=this.settings.structuredOutputs)?a:fx(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:a,prompt:b,maxTokens:c,temperature:d,topP:e,topK:f,frequencyPenalty:g,presencePenalty:h,stopSequences:i,responseFormat:j,seed:k,providerMetadata:l}){var m,n,o,p,q,r,s,t,u,v,w;let x=a.type,y=[];null!=f&&y.push({type:"unsupported-setting",setting:"topK"}),(null==j?void 0:j.type)!=="json"||null==j.schema||this.supportsStructuredOutputs||y.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let z=this.settings.useLegacyFunctionCalling;if(z&&!0===this.settings.parallelToolCalls)throw new aS({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(z&&this.supportsStructuredOutputs)throw new aS({functionality:"structuredOutputs with useLegacyFunctionCalling"});let{messages:A,warnings:B}=function({prompt:a,useLegacyFunctionCalling:b=!1,systemMessageMode:c="system"}){let d=[],e=[];for(let{role:f,content:g}of a)switch(f){case"system":switch(c){case"system":d.push({role:"system",content:g});break;case"developer":d.push({role:"developer",content:g});break;case"remove":e.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${c}`)}break;case"user":if(1===g.length&&"text"===g[0].type){d.push({role:"user",content:g[0].text});break}d.push({role:"user",content:g.map((a,b)=>{var c,d,e,f;switch(a.type){case"text":return{type:"text",text:a.text};case"image":return{type:"image_url",image_url:{url:a.image instanceof URL?a.image.toString():`data:${null!=(c=a.mimeType)?c:"image/jpeg"};base64,${bf(a.image)}`,detail:null==(e=null==(d=a.providerMetadata)?void 0:d.openai)?void 0:e.imageDetail}};case"file":if(a.data instanceof URL)throw new aS({functionality:"'File content parts with URL data' functionality not supported."});switch(a.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:a.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:a.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:null!=(f=a.filename)?f:`part-${b}.pdf`,file_data:`data:application/pdf;base64,${a.data}`}};default:throw new aS({functionality:`File content part type ${a.mimeType} in user messages`})}}})});break;case"assistant":{let a="",c=[];for(let b of g)switch(b.type){case"text":a+=b.text;break;case"tool-call":c.push({id:b.toolCallId,type:"function",function:{name:b.toolName,arguments:JSON.stringify(b.args)}})}if(b){if(c.length>1)throw new aS({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});d.push({role:"assistant",content:a,function_call:c.length>0?c[0].function:void 0})}else d.push({role:"assistant",content:a,tool_calls:c.length>0?c:void 0});break}case"tool":for(let a of g)b?d.push({role:"function",name:a.toolName,content:JSON.stringify(a.result)}):d.push({role:"tool",tool_call_id:a.toolCallId,content:JSON.stringify(a.result)});break;default:throw Error(`Unsupported role: ${f}`)}return{messages:d,warnings:e}}({prompt:b,useLegacyFunctionCalling:z,systemMessageMode:fx(u=this.modelId)?null!=(w=null==(v=fy[u])?void 0:v.systemMessageMode)?w:"developer":"system"});y.push(...B);let C={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:c,temperature:d,top_p:e,frequency_penalty:g,presence_penalty:h,response_format:(null==j?void 0:j.type)==="json"?this.supportsStructuredOutputs&&null!=j.schema?{type:"json_schema",json_schema:{schema:j.schema,strict:!0,name:null!=(m=j.name)?m:"response",description:j.description}}:{type:"json_object"}:void 0,stop:i,seed:k,max_completion_tokens:null==(n=null==l?void 0:l.openai)?void 0:n.maxCompletionTokens,store:null==(o=null==l?void 0:l.openai)?void 0:o.store,metadata:null==(p=null==l?void 0:l.openai)?void 0:p.metadata,prediction:null==(q=null==l?void 0:l.openai)?void 0:q.prediction,reasoning_effort:null!=(s=null==(r=null==l?void 0:l.openai)?void 0:r.reasoningEffort)?s:this.settings.reasoningEffort,messages:A};switch(fx(this.modelId)?(null!=C.temperature&&(C.temperature=void 0,y.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=C.top_p&&(C.top_p=void 0,y.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=C.frequency_penalty&&(C.frequency_penalty=void 0,y.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=C.presence_penalty&&(C.presence_penalty=void 0,y.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=C.logit_bias&&(C.logit_bias=void 0,y.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=C.logprobs&&(C.logprobs=void 0,y.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=C.top_logprobs&&(C.top_logprobs=void 0,y.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=C.max_tokens&&(null==C.max_completion_tokens&&(C.max_completion_tokens=C.max_tokens),C.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=C.temperature&&(C.temperature=void 0,y.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),x){case"regular":{let{tools:b,tool_choice:c,functions:d,function_call:e,toolWarnings:f}=function({mode:a,useLegacyFunctionCalling:b=!1,structuredOutputs:c}){var d;let e=(null==(d=a.tools)?void 0:d.length)?a.tools:void 0,f=[];if(null==e)return{tools:void 0,tool_choice:void 0,toolWarnings:f};let g=a.toolChoice;if(b){let a=[];for(let b of e)"provider-defined"===b.type?f.push({type:"unsupported-tool",tool:b}):a.push({name:b.name,description:b.description,parameters:b.parameters});if(null==g)return{functions:a,function_call:void 0,toolWarnings:f};switch(g.type){case"auto":case"none":case void 0:return{functions:a,function_call:void 0,toolWarnings:f};case"required":throw new aS({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:a,function_call:{name:g.toolName},toolWarnings:f}}}let h=[];for(let a of e)"provider-defined"===a.type?f.push({type:"unsupported-tool",tool:a}):h.push({type:"function",function:{name:a.name,description:a.description,parameters:a.parameters,strict:!!c||void 0}});if(null==g)return{tools:h,tool_choice:void 0,toolWarnings:f};let i=g.type;switch(i){case"auto":case"none":case"required":return{tools:h,tool_choice:i,toolWarnings:f};case"tool":return{tools:h,tool_choice:{type:"function",function:{name:g.toolName}},toolWarnings:f};default:throw new aS({functionality:`Unsupported tool choice type: ${i}`})}}({mode:a,useLegacyFunctionCalling:z,structuredOutputs:this.supportsStructuredOutputs});return{args:{...C,tools:b,tool_choice:c,functions:d,function_call:e},warnings:[...y,...f]}}case"object-json":return{args:{...C,response_format:this.supportsStructuredOutputs&&null!=a.schema?{type:"json_schema",json_schema:{schema:a.schema,strict:!0,name:null!=(t=a.name)?t:"response",description:a.description}}:{type:"json_object"}},warnings:y};case"object-tool":return{args:z?{...C,function_call:{name:a.tool.name},functions:[{name:a.tool.name,description:a.tool.description,parameters:a.tool.parameters}]}:{...C,tool_choice:{type:"function",function:{name:a.tool.name}},tools:[{type:"function",function:{name:a.tool.name,description:a.tool.description,parameters:a.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:y};default:throw Error(`Unsupported type: ${x}`)}}async doGenerate(a){var b,c,d,e,f,g,h,i;let{args:j,warnings:k}=this.getArgs(a),{responseHeaders:l,value:m,rawValue:n}=await a5({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),body:j,failedResponseHandler:fr,successfulResponseHandler:bb(fv),abortSignal:a.abortSignal,fetch:this.config.fetch}),{messages:o,...p}=j,q=m.choices[0],r=null==(b=m.usage)?void 0:b.completion_tokens_details,s=null==(c=m.usage)?void 0:c.prompt_tokens_details,t={openai:{}};return(null==r?void 0:r.reasoning_tokens)!=null&&(t.openai.reasoningTokens=null==r?void 0:r.reasoning_tokens),(null==r?void 0:r.accepted_prediction_tokens)!=null&&(t.openai.acceptedPredictionTokens=null==r?void 0:r.accepted_prediction_tokens),(null==r?void 0:r.rejected_prediction_tokens)!=null&&(t.openai.rejectedPredictionTokens=null==r?void 0:r.rejected_prediction_tokens),(null==s?void 0:s.cached_tokens)!=null&&(t.openai.cachedPromptTokens=null==s?void 0:s.cached_tokens),{text:null!=(d=q.message.content)?d:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&q.message.function_call?[{toolCallType:"function",toolCallId:aY(),toolName:q.message.function_call.name,args:q.message.function_call.arguments}]:null==(e=q.message.tool_calls)?void 0:e.map(a=>{var b;return{toolCallType:"function",toolCallId:null!=(b=a.id)?b:aY(),toolName:a.function.name,args:a.function.arguments}}),finishReason:fp(q.finish_reason),usage:{promptTokens:null!=(g=null==(f=m.usage)?void 0:f.prompt_tokens)?g:NaN,completionTokens:null!=(i=null==(h=m.usage)?void 0:h.completion_tokens)?i:NaN},rawCall:{rawPrompt:o,rawSettings:p},rawResponse:{headers:l,body:n},request:{body:JSON.stringify(j)},response:fs(m),warnings:k,logprobs:fo(q.logprobs),providerMetadata:t}}async doStream(a){let b;if(this.settings.simulateStreaming){let b=await this.doGenerate(a);return{stream:new ReadableStream({start(a){if(a.enqueue({type:"response-metadata",...b.response}),b.text&&a.enqueue({type:"text-delta",textDelta:b.text}),b.toolCalls)for(let c of b.toolCalls)a.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:c.toolCallId,toolName:c.toolName,argsTextDelta:c.args}),a.enqueue({type:"tool-call",...c});a.enqueue({type:"finish",finishReason:b.finishReason,usage:b.usage,logprobs:b.logprobs,providerMetadata:b.providerMetadata}),a.close()}}),rawCall:b.rawCall,rawResponse:b.rawResponse,warnings:b.warnings}}let{args:c,warnings:d}=this.getArgs(a),e={...c,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:f,value:g}=await a5({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),body:e,failedResponseHandler:fr,successfulResponseHandler:ba(fw),abortSignal:a.abortSignal,fetch:this.config.fetch}),{messages:h,...i}=c,j=[],k="unknown",l={promptTokens:void 0,completionTokens:void 0},m=!0,{useLegacyFunctionCalling:n}=this.settings,o={openai:{}};return{stream:g.pipeThrough(new TransformStream({transform(a,c){var d,e,f,g,h,i,p,q,r,s,t,u;if(!a.success){k="error",c.enqueue({type:"error",error:a.error});return}let v=a.value;if("error"in v){k="error",c.enqueue({type:"error",error:v.error});return}if(m&&(m=!1,c.enqueue({type:"response-metadata",...fs(v)})),null!=v.usage){let{prompt_tokens:a,completion_tokens:b,prompt_tokens_details:c,completion_tokens_details:d}=v.usage;l={promptTokens:null!=a?a:void 0,completionTokens:null!=b?b:void 0},(null==d?void 0:d.reasoning_tokens)!=null&&(o.openai.reasoningTokens=null==d?void 0:d.reasoning_tokens),(null==d?void 0:d.accepted_prediction_tokens)!=null&&(o.openai.acceptedPredictionTokens=null==d?void 0:d.accepted_prediction_tokens),(null==d?void 0:d.rejected_prediction_tokens)!=null&&(o.openai.rejectedPredictionTokens=null==d?void 0:d.rejected_prediction_tokens),(null==c?void 0:c.cached_tokens)!=null&&(o.openai.cachedPromptTokens=null==c?void 0:c.cached_tokens)}let w=v.choices[0];if((null==w?void 0:w.finish_reason)!=null&&(k=fp(w.finish_reason)),(null==w?void 0:w.delta)==null)return;let x=w.delta;null!=x.content&&c.enqueue({type:"text-delta",textDelta:x.content});let y=fo(null==w?void 0:w.logprobs);(null==y?void 0:y.length)&&(void 0===b&&(b=[]),b.push(...y));let z=n&&null!=x.function_call?[{type:"function",id:aY(),function:x.function_call,index:0}]:x.tool_calls;if(null!=z)for(let a of z){let b=a.index;if(null==j[b]){if("function"!==a.type)throw new ay({data:a,message:"Expected 'function' type."});if(null==a.id)throw new ay({data:a,message:"Expected 'id' to be a string."});if((null==(d=a.function)?void 0:d.name)==null)throw new ay({data:a,message:"Expected 'function.name' to be a string."});j[b]={id:a.id,type:"function",function:{name:a.function.name,arguments:null!=(e=a.function.arguments)?e:""},hasFinished:!1};let i=j[b];(null==(f=i.function)?void 0:f.name)!=null&&(null==(g=i.function)?void 0:g.arguments)!=null&&(i.function.arguments.length>0&&c.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:i.id,toolName:i.function.name,argsTextDelta:i.function.arguments}),a2(i.function.arguments)&&(c.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(h=i.id)?h:aY(),toolName:i.function.name,args:i.function.arguments}),i.hasFinished=!0));continue}let k=j[b];!k.hasFinished&&((null==(i=a.function)?void 0:i.arguments)!=null&&(k.function.arguments+=null!=(q=null==(p=a.function)?void 0:p.arguments)?q:""),c.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:k.id,toolName:k.function.name,argsTextDelta:null!=(r=a.function.arguments)?r:""}),(null==(s=k.function)?void 0:s.name)!=null&&(null==(t=k.function)?void 0:t.arguments)!=null&&a2(k.function.arguments)&&(c.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(u=k.id)?u:aY(),toolName:k.function.name,args:k.function.arguments}),k.hasFinished=!0))}},flush(a){var c,d;a.enqueue({type:"finish",finishReason:k,logprobs:b,usage:{promptTokens:null!=(c=l.promptTokens)?c:NaN,completionTokens:null!=(d=l.completionTokens)?d:NaN},...null!=o?{providerMetadata:o}:{}})}})),rawCall:{rawPrompt:h,rawSettings:i},rawResponse:{headers:f},request:{body:JSON.stringify(e)},warnings:d}}},fu=cA({prompt_tokens:cu().nullish(),completion_tokens:cu().nullish(),prompt_tokens_details:cA({cached_tokens:cu().nullish()}).nullish(),completion_tokens_details:cA({reasoning_tokens:cu().nullish(),accepted_prediction_tokens:cu().nullish(),rejected_prediction_tokens:cu().nullish()}).nullish()}).nullish(),fv=cA({id:ct().nullish(),created:cu().nullish(),model:ct().nullish(),choices:cz(cA({message:cA({role:cF("assistant").nullish(),content:ct().nullish(),function_call:cA({arguments:ct(),name:ct()}).nullish(),tool_calls:cz(cA({id:ct().nullish(),type:cF("function"),function:cA({name:ct(),arguments:ct()})})).nullish()}),index:cu(),logprobs:cA({content:cz(cA({token:ct(),logprob:cu(),top_logprobs:cz(cA({token:ct(),logprob:cu()}))})).nullable()}).nullish(),finish_reason:ct().nullish()})),usage:fu}),fw=cB([cA({id:ct().nullish(),created:cu().nullish(),model:ct().nullish(),choices:cz(cA({delta:cA({role:cG(["assistant"]).nullish(),content:ct().nullish(),function_call:cA({name:ct().optional(),arguments:ct().optional()}).nullish(),tool_calls:cz(cA({index:cu(),id:ct().nullish(),type:cF("function").nullish(),function:cA({name:ct().nullish(),arguments:ct().nullish()})})).nullish()}).nullish(),logprobs:cA({content:cz(cA({token:ct(),logprob:cu(),top_logprobs:cz(cA({token:ct(),logprob:cu()}))})).nullable()}).nullish(),finish_reason:ct().nullish(),index:cu()})),usage:fu}),fq]);function fx(a){return a.startsWith("o")||a.startsWith("gpt-5")}var fy={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function fz(a){return null==a?void 0:a.tokens.map((b,c)=>({token:b,logprob:a.token_logprobs[c],topLogprobs:a.top_logprobs?Object.entries(a.top_logprobs[c]).map(([a,b])=>({token:a,logprob:b})):[]}))}var fA=class{constructor(a,b,c){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=a,this.settings=b,this.config=c}get provider(){return this.config.provider}getArgs({mode:a,inputFormat:b,prompt:c,maxTokens:d,temperature:e,topP:f,topK:g,frequencyPenalty:h,presencePenalty:i,stopSequences:j,responseFormat:k,seed:l}){var m;let n=a.type,o=[];null!=g&&o.push({type:"unsupported-setting",setting:"topK"}),null!=k&&"text"!==k.type&&o.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:p,stopSequences:q}=function({prompt:a,inputFormat:b,user:c="user",assistant:d="assistant"}){if("prompt"===b&&1===a.length&&"user"===a[0].role&&1===a[0].content.length&&"text"===a[0].content[0].type)return{prompt:a[0].content[0].text};let e="";for(let{role:b,content:f}of("system"===a[0].role&&(e+=`${a[0].content}

`,a=a.slice(1)),a))switch(b){case"system":throw new au({message:"Unexpected system message in prompt: ${content}",prompt:a});case"user":{let a=f.map(a=>{switch(a.type){case"text":return a.text;case"image":throw new aS({functionality:"images"})}}).join("");e+=`${c}:
${a}

`;break}case"assistant":{let a=f.map(a=>{switch(a.type){case"text":return a.text;case"tool-call":throw new aS({functionality:"tool-call messages"})}}).join("");e+=`${d}:
${a}

`;break}case"tool":throw new aS({functionality:"tool messages"});default:throw Error(`Unsupported role: ${b}`)}return{prompt:e+=`${d}:
`,stopSequences:[`
${c}:`]}}({prompt:c,inputFormat:b}),r=[...null!=q?q:[],...null!=j?j:[]],s={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:d,temperature:e,top_p:f,frequency_penalty:h,presence_penalty:i,seed:l,prompt:p,stop:r.length>0?r:void 0};switch(n){case"regular":if(null==(m=a.tools)?void 0:m.length)throw new aS({functionality:"tools"});if(a.toolChoice)throw new aS({functionality:"toolChoice"});return{args:s,warnings:o};case"object-json":throw new aS({functionality:"object-json mode"});case"object-tool":throw new aS({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${n}`)}}async doGenerate(a){let{args:b,warnings:c}=this.getArgs(a),{responseHeaders:d,value:e,rawValue:f}=await a5({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),body:b,failedResponseHandler:fr,successfulResponseHandler:bb(fB),abortSignal:a.abortSignal,fetch:this.config.fetch}),{prompt:g,...h}=b,i=e.choices[0];return{text:i.text,usage:{promptTokens:e.usage.prompt_tokens,completionTokens:e.usage.completion_tokens},finishReason:fp(i.finish_reason),logprobs:fz(i.logprobs),rawCall:{rawPrompt:g,rawSettings:h},rawResponse:{headers:d,body:f},response:fs(e),warnings:c,request:{body:JSON.stringify(b)}}}async doStream(a){let b,{args:c,warnings:d}=this.getArgs(a),e={...c,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:f,value:g}=await a5({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),body:e,failedResponseHandler:fr,successfulResponseHandler:ba(fC),abortSignal:a.abortSignal,fetch:this.config.fetch}),{prompt:h,...i}=c,j="unknown",k={promptTokens:NaN,completionTokens:NaN},l=!0;return{stream:g.pipeThrough(new TransformStream({transform(a,c){if(!a.success){j="error",c.enqueue({type:"error",error:a.error});return}let d=a.value;if("error"in d){j="error",c.enqueue({type:"error",error:d.error});return}l&&(l=!1,c.enqueue({type:"response-metadata",...fs(d)})),null!=d.usage&&(k={promptTokens:d.usage.prompt_tokens,completionTokens:d.usage.completion_tokens});let e=d.choices[0];(null==e?void 0:e.finish_reason)!=null&&(j=fp(e.finish_reason)),(null==e?void 0:e.text)!=null&&c.enqueue({type:"text-delta",textDelta:e.text});let f=fz(null==e?void 0:e.logprobs);(null==f?void 0:f.length)&&(void 0===b&&(b=[]),b.push(...f))},flush(a){a.enqueue({type:"finish",finishReason:j,logprobs:b,usage:k})}})),rawCall:{rawPrompt:h,rawSettings:i},rawResponse:{headers:f},warnings:d,request:{body:JSON.stringify(e)}}}},fB=cA({id:ct().nullish(),created:cu().nullish(),model:ct().nullish(),choices:cz(cA({text:ct(),finish_reason:ct(),logprobs:cA({tokens:cz(ct()),token_logprobs:cz(cu()),top_logprobs:cz(cD(ct(),cu())).nullable()}).nullish()})),usage:cA({prompt_tokens:cu(),completion_tokens:cu()})}),fC=cB([cA({id:ct().nullish(),created:cu().nullish(),model:ct().nullish(),choices:cz(cA({text:ct(),finish_reason:ct().nullish(),index:cu(),logprobs:cA({tokens:cz(ct()),token_logprobs:cz(cu()),top_logprobs:cz(cD(ct(),cu())).nullable()}).nullish()})),usage:cA({prompt_tokens:cu(),completion_tokens:cu()}).nullish()}),fq]),fD=class{constructor(a,b,c){this.specificationVersion="v1",this.modelId=a,this.settings=b,this.config=c}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var a;return null!=(a=this.settings.maxEmbeddingsPerCall)?a:2048}get supportsParallelCalls(){var a;return null==(a=this.settings.supportsParallelCalls)||a}async doEmbed({values:a,headers:b,abortSignal:c}){if(a.length>this.maxEmbeddingsPerCall)throw new aK({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:a});let{responseHeaders:d,value:e}=await a5({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:aU(this.config.headers(),b),body:{model:this.modelId,input:a,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:fr,successfulResponseHandler:bb(fE),abortSignal:c,fetch:this.config.fetch});return{embeddings:e.data.map(a=>a.embedding),usage:e.usage?{tokens:e.usage.prompt_tokens}:void 0,rawResponse:{headers:d}}}},fE=cA({data:cz(cA({embedding:cz(cu())})),usage:cA({prompt_tokens:cu()}).nullish()}),fF={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},fG=new Set(["gpt-image-1"]),fH=class{constructor(a,b,c){this.modelId=a,this.settings=b,this.config=c,this.specificationVersion="v1"}get maxImagesPerCall(){var a,b;return null!=(b=null!=(a=this.settings.maxImagesPerCall)?a:fF[this.modelId])?b:1}get provider(){return this.config.provider}async doGenerate({prompt:a,n:b,size:c,aspectRatio:d,seed:e,providerOptions:f,headers:g,abortSignal:h}){var i,j,k,l;let m=[];null!=d&&m.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=e&&m.push({type:"unsupported-setting",setting:"seed"});let n=null!=(k=null==(j=null==(i=this.config._internal)?void 0:i.currentDate)?void 0:j.call(i))?k:new Date,{value:o,responseHeaders:p}=await a5({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:aU(this.config.headers(),g),body:{model:this.modelId,prompt:a,n:b,size:c,...null!=(l=f.openai)?l:{},...!fG.has(this.modelId)?{response_format:"b64_json"}:{}},failedResponseHandler:fr,successfulResponseHandler:bb(fI),abortSignal:h,fetch:this.config.fetch});return{images:o.data.map(a=>a.b64_json),warnings:m,response:{timestamp:n,modelId:this.modelId,headers:p}}}},fI=cA({data:cz(cA({b64_json:ct()}))}),fJ=cA({include:cz(ct()).nullish(),language:ct().nullish(),prompt:ct().nullish(),temperature:cu().min(0).max(1).nullish().default(0),timestampGranularities:cz(cG(["word","segment"])).nullish().default(["segment"])}),fK={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},fL=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:a,mediaType:b,providerOptions:c}){var d,e,f,g,h;let i=a3({provider:"openai",providerOptions:c,schema:fJ}),j=new FormData,k=a instanceof Uint8Array?new Blob([a]):new Blob([be(a)]);if(j.append("model",this.modelId),j.append("file",new File([k],"audio",{type:b})),i){let a={include:null!=(d=i.include)?d:void 0,language:null!=(e=i.language)?e:void 0,prompt:null!=(f=i.prompt)?f:void 0,temperature:null!=(g=i.temperature)?g:void 0,timestamp_granularities:null!=(h=i.timestampGranularities)?h:void 0};for(let b in a){let c=a[b];void 0!==c&&j.append(b,String(c))}}return{formData:j,warnings:[]}}async doGenerate(a){var b,c,d,e,f,g;let h=null!=(d=null==(c=null==(b=this.config._internal)?void 0:b.currentDate)?void 0:c.call(b))?d:new Date,{formData:i,warnings:j}=this.getArgs(a),{value:k,responseHeaders:l,rawValue:m}=await a6({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),formData:i,failedResponseHandler:fr,successfulResponseHandler:bb(fM),abortSignal:a.abortSignal,fetch:this.config.fetch}),n=null!=k.language&&k.language in fK?fK[k.language]:void 0;return{text:k.text,segments:null!=(f=null==(e=k.words)?void 0:e.map(a=>({text:a.word,startSecond:a.start,endSecond:a.end})))?f:[],language:n,durationInSeconds:null!=(g=k.duration)?g:void 0,warnings:j,response:{timestamp:h,modelId:this.modelId,headers:l,body:m}}}},fM=cA({text:ct(),language:ct().nullish(),duration:cu().nullish(),words:cz(cA({word:ct(),start:cu(),end:cu()})).nullish()});function fN({finishReason:a,hasToolCalls:b}){switch(a){case void 0:case null:return b?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return b?"tool-calls":"unknown"}}var fO=class{constructor(a,b){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=a,this.config=b}get provider(){return this.config.provider}getArgs({mode:a,maxTokens:b,temperature:c,stopSequences:d,topP:e,topK:f,presencePenalty:g,frequencyPenalty:h,seed:i,prompt:j,providerMetadata:k,responseFormat:l}){var m,n,o,p;let q=[],r=(p=this.modelId).startsWith("o")||p.startsWith("gpt-5")?p.startsWith("o1-mini")||p.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1},s=a.type;null!=f&&q.push({type:"unsupported-setting",setting:"topK"}),null!=i&&q.push({type:"unsupported-setting",setting:"seed"}),null!=g&&q.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=h&&q.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=d&&q.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:t,warnings:u}=function({prompt:a,systemMessageMode:b}){let c=[],d=[];for(let{role:e,content:f}of a)switch(e){case"system":switch(b){case"system":c.push({role:"system",content:f});break;case"developer":c.push({role:"developer",content:f});break;case"remove":d.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${b}`)}break;case"user":c.push({role:"user",content:f.map((a,b)=>{var c,d,e,f;switch(a.type){case"text":return{type:"input_text",text:a.text};case"image":return{type:"input_image",image_url:a.image instanceof URL?a.image.toString():`data:${null!=(c=a.mimeType)?c:"image/jpeg"};base64,${bf(a.image)}`,detail:null==(e=null==(d=a.providerMetadata)?void 0:d.openai)?void 0:e.imageDetail};case"file":if(a.data instanceof URL)throw new aS({functionality:"File URLs in user messages"});if("application/pdf"===a.mimeType)return{type:"input_file",filename:null!=(f=a.filename)?f:`part-${b}.pdf`,file_data:`data:application/pdf;base64,${a.data}`};throw new aS({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":for(let a of f)switch(a.type){case"text":c.push({role:"assistant",content:[{type:"output_text",text:a.text}]});break;case"tool-call":c.push({type:"function_call",call_id:a.toolCallId,name:a.toolName,arguments:JSON.stringify(a.args)})}break;case"tool":for(let a of f)c.push({type:"function_call_output",call_id:a.toolCallId,output:JSON.stringify(a.result)});break;default:throw Error(`Unsupported role: ${e}`)}return{messages:c,warnings:d}}({prompt:j,systemMessageMode:r.systemMessageMode});q.push(...u);let v=a3({provider:"openai",providerOptions:k,schema:fR}),w=null==(m=null==v?void 0:v.strictSchemas)||m,x={model:this.modelId,input:t,temperature:c,top_p:e,max_output_tokens:b,...(null==l?void 0:l.type)==="json"&&{text:{format:null!=l.schema?{type:"json_schema",strict:w,name:null!=(n=l.name)?n:"response",description:l.description,schema:l.schema}:{type:"json_object"}}},metadata:null==v?void 0:v.metadata,parallel_tool_calls:null==v?void 0:v.parallelToolCalls,previous_response_id:null==v?void 0:v.previousResponseId,store:null==v?void 0:v.store,user:null==v?void 0:v.user,instructions:null==v?void 0:v.instructions,...r.isReasoningModel&&((null==v?void 0:v.reasoningEffort)!=null||(null==v?void 0:v.reasoningSummary)!=null)&&{reasoning:{...(null==v?void 0:v.reasoningEffort)!=null&&{effort:v.reasoningEffort},...(null==v?void 0:v.reasoningSummary)!=null&&{summary:v.reasoningSummary}}},...r.requiredAutoTruncation&&{truncation:"auto"}};switch(r.isReasoningModel&&(null!=x.temperature&&(x.temperature=void 0,q.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=x.top_p&&(x.top_p=void 0,q.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),s){case"regular":{let{tools:b,tool_choice:c,toolWarnings:d}=function({mode:a,strict:b}){var c;let d=(null==(c=a.tools)?void 0:c.length)?a.tools:void 0,e=[];if(null==d)return{tools:void 0,tool_choice:void 0,toolWarnings:e};let f=a.toolChoice,g=[];for(let a of d)switch(a.type){case"function":g.push({type:"function",name:a.name,description:a.description,parameters:a.parameters,strict:!!b||void 0});break;case"provider-defined":"openai.web_search_preview"===a.id?g.push({type:"web_search_preview",search_context_size:a.args.searchContextSize,user_location:a.args.userLocation}):e.push({type:"unsupported-tool",tool:a});break;default:e.push({type:"unsupported-tool",tool:a})}if(null==f)return{tools:g,tool_choice:void 0,toolWarnings:e};let h=f.type;switch(h){case"auto":case"none":case"required":return{tools:g,tool_choice:h,toolWarnings:e};case"tool":if("web_search_preview"===f.toolName)return{tools:g,tool_choice:{type:"web_search_preview"},toolWarnings:e};return{tools:g,tool_choice:{type:"function",name:f.toolName},toolWarnings:e};default:throw new aS({functionality:`Unsupported tool choice type: ${h}`})}}({mode:a,strict:w});return{args:{...x,tools:b,tool_choice:c},warnings:[...q,...d]}}case"object-json":return{args:{...x,text:{format:null!=a.schema?{type:"json_schema",strict:w,name:null!=(o=a.name)?o:"response",description:a.description,schema:a.schema}:{type:"json_object"}}},warnings:q};case"object-tool":return{args:{...x,tool_choice:{type:"function",name:a.tool.name},tools:[{type:"function",name:a.tool.name,description:a.tool.description,parameters:a.tool.parameters,strict:w}]},warnings:q};default:throw Error(`Unsupported type: ${s}`)}}async doGenerate(a){var b,c,d,e,f,g,h;let{args:i,warnings:j}=this.getArgs(a),k=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:l,value:m,rawValue:n}=await a5({url:k,headers:aU(this.config.headers(),a.headers),body:i,failedResponseHandler:fr,successfulResponseHandler:bb(cA({id:ct(),created_at:cu(),error:cA({message:ct(),code:ct()}).nullish(),model:ct(),output:cz(cC("type",[cA({type:cF("message"),role:cF("assistant"),content:cz(cA({type:cF("output_text"),text:ct(),annotations:cz(cA({type:cF("url_citation"),start_index:cu(),end_index:cu(),url:ct(),title:ct()}))}))}),cA({type:cF("function_call"),call_id:ct(),name:ct(),arguments:ct()}),cA({type:cF("web_search_call")}),cA({type:cF("computer_call")}),cA({type:cF("reasoning"),summary:cz(cA({type:cF("summary_text"),text:ct()}))})])),incomplete_details:cA({reason:ct()}).nullable(),usage:fP})),abortSignal:a.abortSignal,fetch:this.config.fetch});if(m.error)throw new ah({message:m.error.message,url:k,requestBodyValues:i,statusCode:400,responseHeaders:l,responseBody:n,isRetryable:!1});let o=m.output.filter(a=>"message"===a.type).flatMap(a=>a.content).filter(a=>"output_text"===a.type),p=m.output.filter(a=>"function_call"===a.type).map(a=>({toolCallType:"function",toolCallId:a.call_id,toolName:a.name,args:a.arguments})),q=null!=(c=null==(b=m.output.find(a=>"reasoning"===a.type))?void 0:b.summary)?c:null;return{text:o.map(a=>a.text).join("\n"),sources:o.flatMap(a=>a.annotations.map(a=>{var b,c,d;return{sourceType:"url",id:null!=(d=null==(c=(b=this.config).generateId)?void 0:c.call(b))?d:aY(),url:a.url,title:a.title}})),finishReason:fN({finishReason:null==(d=m.incomplete_details)?void 0:d.reason,hasToolCalls:p.length>0}),toolCalls:p.length>0?p:void 0,reasoning:q?q.map(a=>({type:"text",text:a.text})):void 0,usage:{promptTokens:m.usage.input_tokens,completionTokens:m.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:l,body:n},request:{body:JSON.stringify(i)},response:{id:m.id,timestamp:new Date(1e3*m.created_at),modelId:m.model},providerMetadata:{openai:{responseId:m.id,cachedPromptTokens:null!=(f=null==(e=m.usage.input_tokens_details)?void 0:e.cached_tokens)?f:null,reasoningTokens:null!=(h=null==(g=m.usage.output_tokens_details)?void 0:g.reasoning_tokens)?h:null}},warnings:j}}async doStream(a){let{args:b,warnings:c}=this.getArgs(a),{responseHeaders:d,value:e}=await a5({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),body:{...b,stream:!0},failedResponseHandler:fr,successfulResponseHandler:ba(fQ),abortSignal:a.abortSignal,fetch:this.config.fetch}),f=this,g="unknown",h=NaN,i=NaN,j=null,k=null,l=null,m={},n=!1;return{stream:e.pipeThrough(new TransformStream({transform(a,b){var c,d,e,o,p,q,r,s,t;if(!a.success){g="error",b.enqueue({type:"error",error:a.error});return}let u=a.value;if("response.output_item.added"===u.type)"function_call"===u.item.type&&(m[u.output_index]={toolName:u.item.name,toolCallId:u.item.call_id},b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:u.item.call_id,toolName:u.item.name,argsTextDelta:u.item.arguments}));else if("response.function_call_arguments.delta"===u.type){let a=m[u.output_index];null!=a&&b.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:a.toolCallId,toolName:a.toolName,argsTextDelta:u.delta})}else{"response.created"===u.type?(l=u.response.id,b.enqueue({type:"response-metadata",id:u.response.id,timestamp:new Date(1e3*u.response.created_at),modelId:u.response.model})):"response.output_text.delta"===u.type?b.enqueue({type:"text-delta",textDelta:u.delta}):"response.reasoning_summary_text.delta"===u.type?b.enqueue({type:"reasoning",textDelta:u.delta}):"response.output_item.done"===u.type&&"function_call"===u.item.type?(m[u.output_index]=void 0,n=!0,b.enqueue({type:"tool-call",toolCallType:"function",toolCallId:u.item.call_id,toolName:u.item.name,args:u.item.arguments})):"response.completed"===(t=u).type||"response.incomplete"===t.type?(g=fN({finishReason:null==(c=u.response.incomplete_details)?void 0:c.reason,hasToolCalls:n}),h=u.response.usage.input_tokens,i=u.response.usage.output_tokens,j=null!=(e=null==(d=u.response.usage.input_tokens_details)?void 0:d.cached_tokens)?e:j,k=null!=(p=null==(o=u.response.usage.output_tokens_details)?void 0:o.reasoning_tokens)?p:k):"response.output_text.annotation.added"===u.type?b.enqueue({type:"source",source:{sourceType:"url",id:null!=(s=null==(r=(q=f.config).generateId)?void 0:r.call(q))?s:aY(),url:u.annotation.url,title:u.annotation.title}}):"error"===u.type&&b.enqueue({type:"error",error:u})}},flush(a){a.enqueue({type:"finish",finishReason:g,usage:{promptTokens:h,completionTokens:i},...(null!=j||null!=k)&&{providerMetadata:{openai:{responseId:l,cachedPromptTokens:j,reasoningTokens:k}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:d},request:{body:JSON.stringify(b)},warnings:c}}},fP=cA({input_tokens:cu(),input_tokens_details:cA({cached_tokens:cu().nullish()}).nullish(),output_tokens:cu(),output_tokens_details:cA({reasoning_tokens:cu().nullish()}).nullish()}),fQ=cB([cA({type:cF("response.output_text.delta"),delta:ct()}),cA({type:cG(["response.completed","response.incomplete"]),response:cA({incomplete_details:cA({reason:ct()}).nullish(),usage:fP})}),cA({type:cF("response.created"),response:cA({id:ct(),created_at:cu(),model:ct()})}),cA({type:cF("response.output_item.done"),output_index:cu(),item:cC("type",[cA({type:cF("message")}),cA({type:cF("function_call"),id:ct(),call_id:ct(),name:ct(),arguments:ct(),status:cF("completed")})])}),cA({type:cF("response.function_call_arguments.delta"),item_id:ct(),output_index:cu(),delta:ct()}),cA({type:cF("response.output_item.added"),output_index:cu(),item:cC("type",[cA({type:cF("message")}),cA({type:cF("function_call"),id:ct(),call_id:ct(),name:ct(),arguments:ct()})])}),cA({type:cF("response.output_text.annotation.added"),annotation:cA({type:cF("url_citation"),url:ct(),title:ct()})}),cA({type:cF("response.reasoning_summary_text.delta"),item_id:ct(),output_index:cu(),summary_index:cu(),delta:ct()}),cA({type:cF("error"),code:ct(),message:ct(),param:ct().nullish(),sequence_number:cu()}),cA({type:ct()}).passthrough()]),fR=cA({metadata:cx().nullish(),parallelToolCalls:cv().nullish(),previousResponseId:ct().nullish(),store:cv().nullish(),user:ct().nullish(),reasoningEffort:ct().nullish(),strictSchemas:cv().nullish(),instructions:ct().nullish(),reasoningSummary:ct().nullish()}),fS=cA({}),fT={webSearchPreview:function({searchContextSize:a,userLocation:b}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:a,userLocation:b},parameters:fS}}},fU=cA({instructions:ct().nullish(),speed:cu().min(.25).max(4).default(1).nullish()}),fV=class{constructor(a,b){this.modelId=a,this.config=b,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:a,voice:b="alloy",outputFormat:c="mp3",speed:d,instructions:e,providerOptions:f}){let g=[],h=a3({provider:"openai",providerOptions:f,schema:fU}),i={model:this.modelId,input:a,voice:b,response_format:"mp3",speed:d,instructions:e};if(c&&(["mp3","opus","aac","flac","wav","pcm"].includes(c)?i.response_format=c:g.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${c}. Using mp3 instead.`})),h){let a={};for(let b in a){let c=a[b];void 0!==c&&(i[b]=c)}}return{requestBody:i,warnings:g}}async doGenerate(a){var b,c,d;let e=null!=(d=null==(c=null==(b=this.config._internal)?void 0:b.currentDate)?void 0:c.call(b))?d:new Date,{requestBody:f,warnings:g}=this.getArgs(a),{value:h,responseHeaders:i,rawValue:j}=await a5({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:aU(this.config.headers(),a.headers),body:f,failedResponseHandler:fr,successfulResponseHandler:async({response:a,url:b,requestBodyValues:c})=>{let d=aW(a);if(!a.body)throw new ah({message:"Response body is empty",url:b,requestBodyValues:c,statusCode:a.status,responseHeaders:d,responseBody:void 0});try{let b=await a.arrayBuffer();return{responseHeaders:d,value:new Uint8Array(b)}}catch(e){throw new ah({message:"Failed to read response as array buffer",url:b,requestBodyValues:c,statusCode:a.status,responseHeaders:d,responseBody:void 0,cause:e})}},abortSignal:a.abortSignal,fetch:this.config.fetch});return{audio:h,warnings:g,request:{body:JSON.stringify(f)},response:{timestamp:e,modelId:this.modelId,headers:i,body:j}}}},fW=function(a={}){var b,c,d;let e=null!=(b=bg(a.baseURL))?b:"https://api.openai.com/v1",f=null!=(c=a.compatibility)?c:"compatible",g=null!=(d=a.name)?d:"openai",h=()=>({Authorization:`Bearer ${a$({apiKey:a.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":a.organization,"OpenAI-Project":a.project,...a.headers}),i=(b,c={})=>new ft(b,c,{provider:`${g}.chat`,url:({path:a})=>`${e}${a}`,headers:h,compatibility:f,fetch:a.fetch}),j=(b,c={})=>new fA(b,c,{provider:`${g}.completion`,url:({path:a})=>`${e}${a}`,headers:h,compatibility:f,fetch:a.fetch}),k=(b,c={})=>new fD(b,c,{provider:`${g}.embedding`,url:({path:a})=>`${e}${a}`,headers:h,fetch:a.fetch}),l=(b,c={})=>new fH(b,c,{provider:`${g}.image`,url:({path:a})=>`${e}${a}`,headers:h,fetch:a.fetch}),m=b=>new fL(b,{provider:`${g}.transcription`,url:({path:a})=>`${e}${a}`,headers:h,fetch:a.fetch}),n=b=>new fV(b,{provider:`${g}.speech`,url:({path:a})=>`${e}${a}`,headers:h,fetch:a.fetch}),o=(a,b)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===a?j(a,b):i(a,b)},p=function(a,b){return o(a,b)};return p.languageModel=o,p.chat=i,p.completion=j,p.responses=b=>new fO(b,{provider:`${g}.responses`,url:({path:a})=>`${e}${a}`,headers:h,fetch:a.fetch}),p.embedding=k,p.textEmbedding=k,p.textEmbeddingModel=k,p.image=l,p.imageModel=l,p.transcription=m,p.transcriptionModel=m,p.speech=n,p.speechModel=n,p.tools=fT,p}({compatibility:"strict"});function fX(a){var b;if(null!=(b=a)&&"object"==typeof b&&"object"===b.type&&(null==b.properties||0===Object.keys(b.properties).length)&&!b.additionalProperties)return;if("boolean"==typeof a)return{type:"boolean",properties:{}};let{type:c,description:d,required:e,properties:f,items:g,allOf:h,anyOf:i,oneOf:j,format:k,const:l,minLength:m,enum:n}=a,o={};if(d&&(o.description=d),e&&(o.required=e),k&&(o.format=k),void 0!==l&&(o.enum=[l]),c&&(Array.isArray(c)?c.includes("null")?(o.type=c.filter(a=>"null"!==a)[0],o.nullable=!0):o.type=c:"null"===c?o.type="null":o.type=c),void 0!==n&&(o.enum=n),null!=f&&(o.properties=Object.entries(f).reduce((a,[b,c])=>(a[b]=fX(c),a),{})),g&&(o.items=Array.isArray(g)?g.map(fX):fX(g)),h&&(o.allOf=h.map(fX)),i)if(i.some(a=>"object"==typeof a&&(null==a?void 0:a.type)==="null")){let a=i.filter(a=>"object"!=typeof a||(null==a?void 0:a.type)!=="null");if(1===a.length){let b=fX(a[0]);"object"==typeof b&&(o.nullable=!0,Object.assign(o,b))}else o.anyOf=a.map(fX),o.nullable=!0}else o.anyOf=i.map(fX);return j&&(o.oneOf=j.map(fX)),void 0!==m&&(o.minLength=m),o}function fY(a){return a.includes("/")?a:`models/${a}`}var fZ=a9({errorSchema:cA({error:cA({code:cu().nullable(),message:ct(),status:ct()})}),errorToMessage:a=>a.error.message});function f$({finishReason:a,hasToolCalls:b}){switch(a){case"STOP":return b?"tool-calls":"stop";case"MAX_TOKENS":return"length";case"IMAGE_SAFETY":case"RECITATION":case"SAFETY":case"BLOCKLIST":case"PROHIBITED_CONTENT":case"SPII":return"content-filter";case"FINISH_REASON_UNSPECIFIED":case"OTHER":return"other";case"MALFORMED_FUNCTION_CALL":return"error";default:return"unknown"}}var f_=class{constructor(a,b,c){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsImageUrls=!1,this.modelId=a,this.settings=b,this.config=c}get supportsStructuredOutputs(){var a;return null==(a=this.settings.structuredOutputs)||a}get provider(){return this.config.provider}async getArgs({mode:a,prompt:b,maxTokens:c,temperature:d,topP:e,topK:f,frequencyPenalty:g,presencePenalty:h,stopSequences:i,responseFormat:j,seed:k,providerMetadata:l}){var m,n,o;let p=a.type,q=[],r=a3({provider:"google",providerOptions:l,schema:gb});(null==(m=null==r?void 0:r.thinkingConfig)?void 0:m.includeThoughts)!==!0||this.config.provider.startsWith("google.vertex.")||q.push({type:"other",message:`The 'includeThoughts' option is only supported with the Google Vertex provider and might not be supported or could behave unexpectedly with the current Google provider (${this.config.provider}).`});let s={maxOutputTokens:c,temperature:d,topK:f,topP:e,frequencyPenalty:g,presencePenalty:h,stopSequences:i,seed:k,responseMimeType:(null==j?void 0:j.type)==="json"?"application/json":void 0,responseSchema:(null==j?void 0:j.type)==="json"&&null!=j.schema&&this.supportsStructuredOutputs?fX(j.schema):void 0,...this.settings.audioTimestamp&&{audioTimestamp:this.settings.audioTimestamp},responseModalities:null==r?void 0:r.responseModalities,thinkingConfig:null==r?void 0:r.thinkingConfig},{contents:t,systemInstruction:u}=function(a){var b,c;let d=[],e=[],f=!0;for(let{role:g,content:h}of a)switch(g){case"system":if(!f)throw new aS({functionality:"system messages are only supported at the beginning of the conversation"});d.push({text:h});break;case"user":{f=!1;let a=[];for(let d of h)switch(d.type){case"text":a.push({text:d.text});break;case"image":a.push(d.image instanceof URL?{fileData:{mimeType:null!=(b=d.mimeType)?b:"image/jpeg",fileUri:d.image.toString()}}:{inlineData:{mimeType:null!=(c=d.mimeType)?c:"image/jpeg",data:bf(d.image)}});break;case"file":a.push(d.data instanceof URL?{fileData:{mimeType:d.mimeType,fileUri:d.data.toString()}}:{inlineData:{mimeType:d.mimeType,data:d.data}})}e.push({role:"user",parts:a});break}case"assistant":f=!1,e.push({role:"model",parts:h.map(a=>{switch(a.type){case"text":return 0===a.text.length?void 0:{text:a.text};case"file":if("image/png"!==a.mimeType)throw new aS({functionality:"Only PNG images are supported in assistant messages"});if(a.data instanceof URL)throw new aS({functionality:"File data URLs in assistant messages are not supported"});return{inlineData:{mimeType:a.mimeType,data:a.data}};case"tool-call":return{functionCall:{name:a.toolName,args:a.args}}}}).filter(a=>void 0!==a)});break;case"tool":f=!1,e.push({role:"user",parts:h.map(a=>({functionResponse:{name:a.toolName,response:{name:a.toolName,content:a.result}}}))})}return{systemInstruction:d.length>0?{parts:d}:void 0,contents:e}}(b);switch(p){case"regular":{let{tools:b,toolConfig:c,toolWarnings:d}=function(a,b,c,d){var e,f;let g=(null==(e=a.tools)?void 0:e.length)?a.tools:void 0,h=[],i=d.includes("gemini-2"),j=d.includes("gemini-1.5-flash")&&!d.includes("-8b");if(b)return{tools:i?{googleSearch:{}}:{googleSearchRetrieval:j&&c?{dynamicRetrievalConfig:c}:{}},toolConfig:void 0,toolWarnings:h};if(null==g)return{tools:void 0,toolConfig:void 0,toolWarnings:h};let k=[];for(let a of g)"provider-defined"===a.type?h.push({type:"unsupported-tool",tool:a}):k.push({name:a.name,description:null!=(f=a.description)?f:"",parameters:fX(a.parameters)});let l=a.toolChoice;if(null==l)return{tools:{functionDeclarations:k},toolConfig:void 0,toolWarnings:h};let m=l.type;switch(m){case"auto":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"AUTO"}},toolWarnings:h};case"none":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"NONE"}},toolWarnings:h};case"required":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"ANY"}},toolWarnings:h};case"tool":return{tools:{functionDeclarations:k},toolConfig:{functionCallingConfig:{mode:"ANY",allowedFunctionNames:[l.toolName]}},toolWarnings:h};default:throw new aS({functionality:`Unsupported tool choice type: ${m}`})}}(a,null!=(n=this.settings.useSearchGrounding)&&n,this.settings.dynamicRetrievalConfig,this.modelId);return{args:{generationConfig:s,contents:t,systemInstruction:u,safetySettings:this.settings.safetySettings,tools:b,toolConfig:c,cachedContent:this.settings.cachedContent},warnings:[...q,...d]}}case"object-json":return{args:{generationConfig:{...s,responseMimeType:"application/json",responseSchema:null!=a.schema&&this.supportsStructuredOutputs?fX(a.schema):void 0},contents:t,systemInstruction:u,safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:q};case"object-tool":return{args:{generationConfig:s,contents:t,systemInstruction:u,tools:{functionDeclarations:[{name:a.tool.name,description:null!=(o=a.tool.description)?o:"",parameters:fX(a.tool.parameters)}]},toolConfig:{functionCallingConfig:{mode:"ANY"}},safetySettings:this.settings.safetySettings,cachedContent:this.settings.cachedContent},warnings:q};default:throw Error(`Unsupported type: ${p}`)}}supportsUrl(a){return this.config.isSupportedUrl(a)}async doGenerate(a){var b,c,d,e,f;let{args:g,warnings:h}=await this.getArgs(a),i=JSON.stringify(g),j=aU(await a8(this.config.headers),a.headers),{responseHeaders:k,value:l,rawValue:m}=await a5({url:`${this.config.baseURL}/${fY(this.modelId)}:generateContent`,headers:j,body:g,failedResponseHandler:fZ,successfulResponseHandler:bb(f9),abortSignal:a.abortSignal,fetch:this.config.fetch}),{contents:n,...o}=g,p=l.candidates[0],q=null!=p.content&&"object"==typeof p.content&&"parts"in p.content?p.content.parts:[],r=f0({parts:q,generateId:this.config.generateId}),s=l.usageMetadata;return{text:f1(q),reasoning:f2(q),files:null==(b=f3(q))?void 0:b.map(a=>({data:a.inlineData.data,mimeType:a.inlineData.mimeType})),toolCalls:r,finishReason:f$({finishReason:p.finishReason,hasToolCalls:null!=r&&r.length>0}),usage:{promptTokens:null!=(c=null==s?void 0:s.promptTokenCount)?c:NaN,completionTokens:null!=(d=null==s?void 0:s.candidatesTokenCount)?d:NaN},rawCall:{rawPrompt:n,rawSettings:o},rawResponse:{headers:k,body:m},warnings:h,providerMetadata:{google:{groundingMetadata:null!=(e=p.groundingMetadata)?e:null,safetyRatings:null!=(f=p.safetyRatings)?f:null}},sources:f4({groundingMetadata:p.groundingMetadata,generateId:this.config.generateId}),request:{body:i}}}async doStream(a){let b,{args:c,warnings:d}=await this.getArgs(a),e=JSON.stringify(c),f=aU(await a8(this.config.headers),a.headers),{responseHeaders:g,value:h}=await a5({url:`${this.config.baseURL}/${fY(this.modelId)}:streamGenerateContent?alt=sse`,headers:f,body:c,failedResponseHandler:fZ,successfulResponseHandler:ba(ga),abortSignal:a.abortSignal,fetch:this.config.fetch}),{contents:i,...j}=c,k="unknown",l={promptTokens:NaN,completionTokens:NaN},m=this.config.generateId,n=!1;return{stream:h.pipeThrough(new TransformStream({transform(a,c){var d,e,f,g,h,i;if(!a.success)return void c.enqueue({type:"error",error:a.error});let j=a.value,o=j.usageMetadata;null!=o&&(l={promptTokens:null!=(d=o.promptTokenCount)?d:NaN,completionTokens:null!=(e=o.candidatesTokenCount)?e:NaN});let p=null==(f=j.candidates)?void 0:f[0];if(null==p)return;let q=p.content;if(null!=q){let a=f1(q.parts);null!=a&&c.enqueue({type:"text-delta",textDelta:a});let b=f2(q.parts);if(null!=b)for(let a of b)c.enqueue({type:"reasoning",textDelta:a.text});let d=f3(q.parts);if(null!=d)for(let a of d)c.enqueue({type:"file",mimeType:a.inlineData.mimeType,data:a.inlineData.data});let e=f0({parts:q.parts,generateId:m});if(null!=e)for(let a of e)c.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:a.toolCallId,toolName:a.toolName,argsTextDelta:a.args}),c.enqueue({type:"tool-call",toolCallType:"function",toolCallId:a.toolCallId,toolName:a.toolName,args:a.args}),n=!0}if(null!=p.finishReason){for(let a of(k=f$({finishReason:p.finishReason,hasToolCalls:n}),null!=(g=f4({groundingMetadata:p.groundingMetadata,generateId:m}))?g:[]))c.enqueue({type:"source",source:a});b={google:{groundingMetadata:null!=(h=p.groundingMetadata)?h:null,safetyRatings:null!=(i=p.safetyRatings)?i:null}}}},flush(a){a.enqueue({type:"finish",finishReason:k,usage:l,providerMetadata:b})}})),rawCall:{rawPrompt:i,rawSettings:j},rawResponse:{headers:g},warnings:d,request:{body:e}}}};function f0({parts:a,generateId:b}){let c=null==a?void 0:a.filter(a=>"functionCall"in a);return null==c||0===c.length?void 0:c.map(a=>({toolCallType:"function",toolCallId:b(),toolName:a.functionCall.name,args:JSON.stringify(a.functionCall.args)}))}function f1(a){let b=null==a?void 0:a.filter(a=>"text"in a&&!0!==a.thought);return null==b||0===b.length?void 0:b.map(a=>a.text).join("")}function f2(a){let b=null==a?void 0:a.filter(a=>"text"in a&&!0===a.thought&&null!=a.text);return null==b||0===b.length?void 0:b.map(a=>({type:"text",text:a.text}))}function f3(a){return null==a?void 0:a.filter(a=>"inlineData"in a)}function f4({groundingMetadata:a,generateId:b}){var c;return null==(c=null==a?void 0:a.groundingChunks)?void 0:c.filter(a=>null!=a.web).map(a=>({sourceType:"url",id:b(),url:a.web.uri,title:a.web.title}))}var f5=cA({parts:cz(cB([cA({functionCall:cA({name:ct(),args:cy()})}),cA({inlineData:cA({mimeType:ct(),data:ct()})}),cA({text:ct().nullish(),thought:cv().nullish()})])).nullish()}),f6=cA({web:cA({uri:ct(),title:ct()}).nullish(),retrievedContext:cA({uri:ct(),title:ct()}).nullish()}),f7=cA({webSearchQueries:cz(ct()).nullish(),retrievalQueries:cz(ct()).nullish(),searchEntryPoint:cA({renderedContent:ct()}).nullish(),groundingChunks:cz(f6).nullish(),groundingSupports:cz(cA({segment:cA({startIndex:cu().nullish(),endIndex:cu().nullish(),text:ct().nullish()}),segment_text:ct().nullish(),groundingChunkIndices:cz(cu()).nullish(),supportChunkIndices:cz(cu()).nullish(),confidenceScores:cz(cu()).nullish(),confidenceScore:cz(cu()).nullish()})).nullish(),retrievalMetadata:cB([cA({webDynamicRetrievalScore:cu()}),cA({})]).nullish()}),f8=cA({category:ct().nullish(),probability:ct().nullish(),probabilityScore:cu().nullish(),severity:ct().nullish(),severityScore:cu().nullish(),blocked:cv().nullish()}),f9=cA({candidates:cz(cA({content:f5.nullish().or(cA({}).strict()),finishReason:ct().nullish(),safetyRatings:cz(f8).nullish(),groundingMetadata:f7.nullish()})),usageMetadata:cA({promptTokenCount:cu().nullish(),candidatesTokenCount:cu().nullish(),totalTokenCount:cu().nullish()}).nullish()}),ga=cA({candidates:cz(cA({content:f5.nullish(),finishReason:ct().nullish(),safetyRatings:cz(f8).nullish(),groundingMetadata:f7.nullish()})).nullish(),usageMetadata:cA({promptTokenCount:cu().nullish(),candidatesTokenCount:cu().nullish(),totalTokenCount:cu().nullish()}).nullish()}),gb=cA({responseModalities:cz(cG(["TEXT","IMAGE"])).nullish(),thinkingConfig:cA({thinkingBudget:cu().nullish(),includeThoughts:cv().nullish()}).nullish()}),gc=class{constructor(a,b,c){this.specificationVersion="v1",this.modelId=a,this.settings=b,this.config=c}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){return 2048}get supportsParallelCalls(){return!0}async doEmbed({values:a,headers:b,abortSignal:c}){if(a.length>this.maxEmbeddingsPerCall)throw new aK({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:a});let d=aU(await a8(this.config.headers),b),{responseHeaders:e,value:f}=await a5({url:`${this.config.baseURL}/models/${this.modelId}:batchEmbedContents`,headers:d,body:{requests:a.map(a=>({model:`models/${this.modelId}`,content:{role:"user",parts:[{text:a}]},outputDimensionality:this.settings.outputDimensionality,taskType:this.settings.taskType}))},failedResponseHandler:fZ,successfulResponseHandler:bb(gd),abortSignal:c,fetch:this.config.fetch});return{embeddings:f.embeddings.map(a=>a.values),usage:void 0,rawResponse:{headers:e}}}},gd=cA({embeddings:cz(cA({values:cz(cu())}))});function ge(a){return a.toString().startsWith("https://generativelanguage.googleapis.com/v1beta/files/")}var gf=function(a={}){var b;let c=null!=(b=bg(a.baseURL))?b:"https://generativelanguage.googleapis.com/v1beta",d=()=>({"x-goog-api-key":a$({apiKey:a.apiKey,environmentVariableName:"GOOGLE_GENERATIVE_AI_API_KEY",description:"Google Generative AI"}),...a.headers}),e=(b,e={})=>{var f;return new f_(b,e,{provider:"google.generative-ai",baseURL:c,headers:d,generateId:null!=(f=a.generateId)?f:aY,isSupportedUrl:ge,fetch:a.fetch})},f=(b,e={})=>new gc(b,e,{provider:"google.generative-ai",baseURL:c,headers:d,fetch:a.fetch}),g=function(a,b){if(new.target)throw Error("The Google Generative AI model function cannot be called with the new keyword.");return e(a,b)};return g.languageModel=e,g.chat=e,g.generativeAI=e,g.embedding=f,g.textEmbedding=f,g.textEmbeddingModel=f,g}(),gg=c(8473),gh=c(3042),gi=c(6612),gj=c(7387);let gk=(process.env.LLM_PROVIDER||"openai").toLowerCase(),gl=(a,b,c,d)=>Response.json({ok:!1,error:b},{status:a});async function gm(a){var b;try{(0,gj.NW)()}catch(a){return console.error("[api/chat] encryption key validation failed:",a),gl(500,"encryption_key_missing",a?.message||"encryption_key_missing")}let c={};try{c=await a.json()}catch(a){return console.error("[api/chat] invalid json:",a),gl(400,"invalid_json",a?.message||"invalid_json")}let d=Array.isArray(c?.messages)?c.messages:[],e=c?.lang?String(c.lang):"en",f=c?.session_id?String(c.session_id):null,g=c?.page?String(c.page):null,h=c?.utm&&"object"==typeof c.utm?c.utm:null,i=((a=[])=>{for(let b=a.length-1;b>=0;b-=1)if(a[b]?.role==="user")return a[b];return null})(d),j=String(i?.content||"").trim();if(!j)return gl(400,"user_message_required","last user message is empty");(async()=>{try{let a=function(a){let{intake:b}=(0,gh.s6)("ai_agent");try{let c=String(a||"").trim();b.chief_complaint=c?c.slice(0,300):null,b.goal=null,b.body_part=(0,gi.FJ)(c)??null,b.timeline=(0,gi.h7)(c)??null,b.budget=(0,gi.jR)(c)??null,b.duration=(0,gi.ir)(c)??null,b.severity=(0,gi.b2)(c)??null;let{contraindications:d,allergy:e,medications:f}=(0,gi.SH)(c);b.contraindications=d.length?d:null,b.allergy_flag=e||null,b.medications_flag=f||null,b.medical_history_flag=null,b.previous_procedure_flag=null,b.attachments_present=!1}catch{}return b}(j),b=(0,gh.LY)(a),c=(0,gh.BZ)(a,b),d={intake:a,meta:{pipeline_version:"v1",source_type:"ai_agent",model:"google"===gk?"gemini-2.0-flash":"gpt-4o-mini",prompt_version:null}};null!=f&&(d.session_id=f),null!=g&&(d.page=g),null!=h&&(d.utm=h);let i=await (0,gj.FA)(j);await gg.E.from("normalized_inquiries").insert({source_type:"ai_agent",language:e,raw_message:i,constraints:d,treatment_slug:null,objective:null,extraction_confidence:c,missing_fields:b.length?b:null})}catch(a){console.error("[api/chat] normalized_inquiries insert failed:",a)}})();let k=[];try{let a=gg.E.from("rag_chunks").select("id, document_id, chunk_index, content, rag_documents!inner(id, source_type, source_id, lang, title)").ilike("content",`%${j}%`).limit(6);e&&(a=a.eq("rag_documents.lang",e));let{data:b,error:c}=await a;c||(k=b||[]),c&&console.error("[api/chat] rag query error:",c)}catch(a){console.error("[api/chat] rag query failed:",a)}let l=Array.isArray(b=k)&&0!==b.length?b.map(a=>{let b=a?.rag_documents?.title?` | ${a.rag_documents.title}`:"",c=a?.rag_documents?.source_type?`[${a.rag_documents.source_type}${b}]`:"[source]";return`${c} ${String(a.content||"").trim()}`}).join("\n\n"):"",m=["You are a medical concierge assistant for HEALO.","Do not provide diagnosis, medical advice, or guarantees.","Ask clarifying questions when constraints are missing.","Primary objective: guide the user to submit an inquiry.","If relevant, reference the provided context briefly.","",l?"Context:\n"+l:""].filter(Boolean).join("\n"),n="google"===gk?process.env.GOOGLE_GENERATIVE_AI_API_KEY?{model:gf("gemini-2.0-flash")}:(console.error("[api/chat] GOOGLE_GENERATIVE_AI_API_KEY is missing"),{error:gl(500,"google_key_missing","GOOGLE_GENERATIVE_AI_API_KEY is missing")}):process.env.OPENAI_API_KEY?{model:fW("gpt-4o-mini")}:(console.error("[api/chat] OPENAI_API_KEY is missing"),{error:gl(500,"openai_key_missing","OPENAI_API_KEY is missing")});if(n.error)return n.error;try{return(await function({model:a,tools:b,toolChoice:c,system:d,prompt:e,messages:f,maxRetries:g,abortSignal:h,headers:i,maxSteps:j=1,experimental_generateMessageId:k=eZ,experimental_output:l,experimental_continueSteps:m=!1,experimental_telemetry:n,experimental_providerMetadata:o,providerOptions:p=o,experimental_toolCallStreaming:q=!1,toolCallStreaming:r=q,experimental_activeTools:s,experimental_repairToolCall:t,experimental_transform:u,onChunk:v,onError:w,onFinish:x,onStepFinish:y,_internal:{now:z=function(){var a,b;return null!=(b=null==(a=null==globalThis?void 0:globalThis.performance)?void 0:a.now())?b:Date.now()},generateId:A=eY,currentDate:B=()=>new Date}={},...C}){if("string"==typeof a||"v1"!==a.specificationVersion)throw new dq;return new e$({model:a,telemetry:n,headers:i,settings:C,maxRetries:g,abortSignal:h,system:d,prompt:e,messages:f,tools:b,toolChoice:c,toolCallStreaming:r,transforms:void 0===u?[]:Array.isArray(u)?u:[u],activeTools:s,repairToolCall:t,maxSteps:j,output:l,continueSteps:m,providerOptions:p,onChunk:v,onError:w,onFinish:x,onStepFinish:y,now:z,currentDate:B,generateId:A,generateMessageId:k})}({model:n.model,system:m,messages:d,onError:({error:a})=>{console.error("[api/chat] stream error:",a)}})).toDataStreamResponse()}catch(f){let a,b,c,d;console.error("[api/chat] LLM error:",f);let e="google"===gk?(b=(a=String(f?.message||"")).toLowerCase()).includes("api key")?{status:401,code:"google_invalid_key",message:a}:b.includes("quota")||b.includes("insufficient")?{status:402,code:"google_quota_exceeded",message:a}:b.includes("permission")||b.includes("access")?{status:403,code:"google_access_denied",message:a}:b.includes("rate limit")?{status:429,code:"google_rate_limited",message:a}:{status:502,code:"google_error",message:a}:(d=(c=String(f?.message||"")).toLowerCase()).includes("insufficient_quota")||d.includes("quota")?{status:402,code:"openai_quota_exceeded",message:c}:d.includes("invalid_api_key")||d.includes("api key")?{status:401,code:"openai_invalid_key",message:c}:d.includes("model")&&(d.includes("not found")||d.includes("does not exist")||d.includes("access"))?{status:403,code:"openai_model_access",message:c}:d.includes("rate limit")?{status:429,code:"openai_rate_limited",message:c}:{status:502,code:"openai_error",message:c};return gl(e.status,e.code,e.message)}}let gn=new L.AppRouteRouteModule({definition:{kind:M.RouteKind.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},distDir:".next",relativeProjectDir:"",resolvedPagePath:"C:\\Users\\user\\Desktop\\HEALO_Demo\\app\\api\\chat\\route.ts",nextConfigOutput:"",userland:K}),{workAsyncStorage:go,workUnitAsyncStorage:gp,serverHooks:gq}=gn;function gr(){return(0,N.patchFetch)({workAsyncStorage:go,workUnitAsyncStorage:gp})}async function gs(a,b,c){gn.isDev&&(0,O.addRequestMeta)(a,"devRequestTimingInternalsEnd",process.hrtime.bigint());let d="/api/chat/route";"/index"===d&&(d="/");let e=await gn.prepare(a,b,{srcPage:d,multiZoneDraftMode:!1});if(!e)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:f,params:g,nextConfig:h,parsedUrl:i,isDraftMode:j,prerenderManifest:k,routerServerContext:l,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,resolvedPathname:o,clientReferenceManifest:p,serverActionsManifest:q}=e,r=(0,R.normalizeAppPath)(d),s=!!(k.dynamicRoutes[r]||k.routes[o]),t=async()=>((null==l?void 0:l.render404)?await l.render404(a,b,i,!1):b.end("This page could not be found"),null);if(s&&!j){let a=!!k.routes[o],b=k.dynamicRoutes[r];if(b&&!1===b.fallback&&!a){if(h.experimental.adapterPath)return await t();throw new $.NoFallbackError}}let u=null;!s||gn.isDev||j||(u="/index"===(u=o)?"/":u);let v=!0===gn.isDev||!s,w=s&&!v;q&&p&&(0,Q.setManifestsSingleton)({page:d,clientReferenceManifest:p,serverActionsManifest:q});let x=a.method||"GET",y=(0,P.getTracer)(),z=y.getActiveScopeSpan(),A={params:g,prerenderManifest:k,renderOpts:{experimental:{authInterrupts:!!h.experimental.authInterrupts},cacheComponents:!!h.cacheComponents,supportsDynamicResponse:v,incrementalCache:(0,O.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:h.cacheLife,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d,e)=>gn.onRequestError(a,b,d,e,l)},sharedContext:{buildId:f}},B=new S.NodeNextRequest(a),C=new S.NodeNextResponse(b),D=T.NextRequestAdapter.fromNodeNextRequest(B,(0,T.signalFromNodeResponse)(b));try{let e=async a=>gn.handle(D,A).finally(()=>{if(!a)return;a.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let c=y.getRootSpanAttributes();if(!c)return;if(c.get("next.span_type")!==U.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${c.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=c.get("next.route");if(e){let b=`${x} ${e}`;a.setAttributes({"next.route":e,"http.route":e,"next.span_name":b}),a.updateName(b)}else a.updateName(`${x} ${d}`)}),f=!!(0,O.getRequestMeta)(a,"minimalMode"),g=async g=>{var i,o;let p=async({previousCacheEntry:h})=>{try{if(!f&&m&&n&&!h)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let d=await e(g);a.fetchMetrics=A.renderOpts.fetchMetrics;let i=A.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=A.renderOpts.collectedTags;if(!s)return await (0,W.I)(B,C,d,A.renderOpts.pendingWaitUntil),null;{let a=await d.blob(),b=(0,X.toNodeOutgoingHttpHeaders)(d.headers);j&&(b[Z.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==A.renderOpts.collectedRevalidate&&!(A.renderOpts.collectedRevalidate>=Z.INFINITE_CACHE)&&A.renderOpts.collectedRevalidate,e=void 0===A.renderOpts.collectedExpire||A.renderOpts.collectedExpire>=Z.INFINITE_CACHE?void 0:A.renderOpts.collectedExpire;return{value:{kind:_.CachedRouteKind.APP_ROUTE,status:d.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:e}}}}catch(b){throw(null==h?void 0:h.isStale)&&await gn.onRequestError(a,b,{routerKind:"App Router",routePath:d,routeType:"route",revalidateReason:(0,V.c)({isStaticGeneration:w,isOnDemandRevalidate:m})},!1,l),b}},q=await gn.handleResponse({req:a,nextConfig:h,cacheKey:u,routeKind:M.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:k,isRoutePPREnabled:!1,isOnDemandRevalidate:m,revalidateOnlyGenerated:n,responseGenerator:p,waitUntil:c.waitUntil,isMinimalMode:f});if(!s)return null;if((null==q||null==(i=q.value)?void 0:i.kind)!==_.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==q||null==(o=q.value)?void 0:o.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});f||b.setHeader("x-nextjs-cache",m?"REVALIDATED":q.isMiss?"MISS":q.isStale?"STALE":"HIT"),j&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let r=(0,X.fromNodeOutgoingHttpHeaders)(q.value.headers);return f&&s||r.delete(Z.NEXT_CACHE_TAGS_HEADER),!q.cacheControl||b.getHeader("Cache-Control")||r.get("Cache-Control")||r.set("Cache-Control",(0,Y.getCacheControlHeader)(q.cacheControl)),await (0,W.I)(B,C,new Response(q.value.body,{headers:r,status:q.value.status||200})),null};z?await g(z):await y.withPropagatedContext(a.headers,()=>y.trace(U.BaseServerSpan.handleRequest,{spanName:`${x} ${d}`,kind:P.SpanKind.SERVER,attributes:{"http.method":x,"http.target":a.url}},g))}catch(b){if(b instanceof $.NoFallbackError||await gn.onRequestError(a,b,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,V.c)({isStaticGeneration:w,isOnDemandRevalidate:m})},!1,l),s)throw b;return await (0,W.I)(B,C,new Response(null,{status:500})),null}}},7387:(a,b,c)=>{"use strict";c.d(b,{FA:()=>g,NW:()=>f,V3:()=>h});var d=c(8473);let e=process.env.SUPABASE_ENCRYPTION_KEY;function f(){if(!e){let a=Error("[security/encryption] SUPABASE_ENCRYPTION_KEY is missing. 암호화 키가 설정되지 않았습니다. 환경변수를 확인하세요. 키 분실/변경 시 기존 데이터 복호화 불가.");throw console.error(a.message),a}if(e.length<32){let a=Error(`[security/encryption] SUPABASE_ENCRYPTION_KEY is too short (${e.length} < 32). 암호화 키는 최소 32자 이상이어야 합니다. 키 분실/변경 시 기존 데이터 복호화 불가.`);throw console.error(a.message),a}}async function g(a){if(f(),!a)return null;try{let{data:b,error:c}=await d.E.rpc("encrypt_text",{plaintext:String(a),encryption_key:e});if(c)return console.error("[security/encryption] encrypt error:",c),null;return b}catch(a){return console.error("[security/encryption] encrypt exception:",a),null}}async function h(a){if(!a)return null;try{let{data:b,error:c}=await d.E.rpc("email_hash",{email:String(a)});if(c)return console.error("[security/encryption] hash error:",c),null;return b}catch(a){return console.error("[security/encryption] hash exception:",a),null}}},8335:()=>{},8473:(a,b,c)=>{"use strict";c.d(b,{E:()=>g});var d=c(1837);let e="https://xppnvkuahlrdyfvabzur.supabase.co",f=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!e||!f){let a=[];throw e||a.push("NEXT_PUBLIC_SUPABASE_URL/VITE_SUPABASE_URL"),f||a.push("SUPABASE_SERVICE_ROLE_KEY"),Error(`Supabase admin env missing: ${a.join(", ")}`)}let g=(0,d.UU)(e,f,{auth:{persistSession:!1}})},9225:(a,b,c)=>{"use strict";a.exports=c(4870)},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[741,218],()=>b(b.s=7178));module.exports=c})();