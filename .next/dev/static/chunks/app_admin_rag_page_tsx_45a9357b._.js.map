{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/user/Desktop/HEALO_Demo/app/admin/rag/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ntype InquiryRow = {\n  id: number;\n  email?: string | null;\n  treatment_type?: string | null;\n  message?: string | null;\n};\n\nexport default function RagAdminPage() {\n  const [normalizeText, setNormalizeText] = useState(\"\");\n  const [selectedInquiryId, setSelectedInquiryId] = useState<string>(\"\");\n  const [inquiries, setInquiries] = useState<InquiryRow[]>([]);\n  const [normalizeResult, setNormalizeResult] = useState<any>(null);\n\n  const [ingestSourceType, setIngestSourceType] = useState(\"treatment\");\n  const [ingestSourceId, setIngestSourceId] = useState(\"\");\n  const [ingestResult, setIngestResult] = useState<any>(null);\n\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchLang, setSearchLang] = useState(\"en\");\n  const [searchResult, setSearchResult] = useState<any>(null);\n\n  useEffect(() => {\n    fetch(\"/api/rag/inquiries\")\n      .then((r) => r.json())\n      .then((data) => setInquiries(data?.rows || []))\n      .catch(() => setInquiries([]));\n  }, []);\n\n  const handleNormalize = async () => {\n    setNormalizeResult(null);\n    const payload: any = {};\n    if (normalizeText.trim()) payload.text = normalizeText.trim();\n    if (selectedInquiryId) payload.inquiry_id = Number(selectedInquiryId);\n    const res = await fetch(\"/api/inquiry/normalize\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    const data = await res.json();\n    setNormalizeResult(data);\n  };\n\n  const handleIngest = async () => {\n    setIngestResult(null);\n    const payload: any = { sourceTypes: [ingestSourceType] };\n    if (ingestSourceId.trim()) payload.source_id = ingestSourceId.trim();\n    const res = await fetch(\"/api/rag/ingest\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify(payload),\n    });\n    const data = await res.json();\n    setIngestResult(data);\n  };\n\n  const handleSearch = async () => {\n    setSearchResult(null);\n    const res = await fetch(\"/api/rag/search\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        query: searchQuery.trim(),\n        lang: searchLang,\n      }),\n    });\n    const data = await res.json();\n    setSearchResult(data);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 flex\">\n      <aside className=\"w-64 bg-white border-r border-gray-200 fixed h-full p-6 flex flex-col z-20\">\n        <div className=\"text-2xl font-black text-teal-600 mb-10 flex items-center gap-2\">\n          관리자 모드\n        </div>\n        <nav className=\"space-y-2 flex-1\">\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            시장 분석 (통계)\n          </a>\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            고객 문의\n          </a>\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            병원 관리\n          </a>\n          <a\n            href=\"/admin\"\n            className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n          >\n            시술 관리\n          </a>\n          <div className=\"pt-4 mt-4 border-t border-gray-100 space-y-2\">\n            <a\n              href=\"/admin\"\n              className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition text-gray-500 hover:bg-gray-50\"\n            >\n              사이트 설정\n            </a>\n            <div className=\"w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 bg-teal-50 text-teal-700\">\n              RAG 테스트\n            </div>\n          </div>\n        </nav>\n        <a\n          href=\"/\"\n          className=\"flex items-center gap-2 text-gray-400 hover:text-red-500 font-bold px-2 py-2\"\n        >\n          관리자 나가기\n        </a>\n      </aside>\n\n      <div className=\"ml-64 flex-1 p-8 md:p-12 max-w-5xl space-y-10 text-sm text-gray-800\">\n        <section>\n          <h1 className=\"text-xl font-bold\">RAG 테스트</h1>\n          <p className=\"text-gray-500\">정규화/수집/검색용 최소 도구</p>\n        </section>\n\n        <section className=\"space-y-3\">\n        <h2 className=\"text-lg font-semibold\">A) 문의 정규화 테스트</h2>\n        <textarea\n          className=\"w-full border rounded p-2\"\n          rows={4}\n          placeholder=\"문의 내용을 붙여넣기...\"\n          value={normalizeText}\n          onChange={(e) => setNormalizeText(e.target.value)}\n        />\n        <div className=\"flex items-center gap-3\">\n          <select\n            className=\"border rounded p-2\"\n            value={selectedInquiryId}\n            onChange={(e) => setSelectedInquiryId(e.target.value)}\n          >\n            <option value=\"\">문의 폼 레코드 선택</option>\n            {inquiries.map((row) => (\n              <option key={row.id} value={row.id}>\n                {row.id} {row.email ? `- ${row.email}` : \"\"}\n              </option>\n            ))}\n          </select>\n          <button className=\"border px-3 py-2\" onClick={handleNormalize}>\n            정규화 실행\n          </button>\n        </div>\n        <pre className=\"bg-gray-50 border rounded p-3 overflow-auto\">\n          {normalizeResult ? JSON.stringify(normalizeResult, null, 2) : \"—\"}\n        </pre>\n      </section>\n\n        <section className=\"space-y-3\">\n        <h2 className=\"text-lg font-semibold\">B) 수집(ingest) 테스트</h2>\n        <div className=\"flex items-center gap-3\">\n          <select\n            className=\"border rounded p-2\"\n            value={ingestSourceType}\n            onChange={(e) => setIngestSourceType(e.target.value)}\n          >\n            <option value=\"treatment\">시술 (treatment)</option>\n            <option value=\"hospital\">병원 (hospital)</option>\n            <option value=\"review\">리뷰 (review)</option>\n            <option value=\"normalized_inquiry\">정규화 문의 (normalized_inquiry)</option>\n          </select>\n          <input\n            className=\"border rounded p-2 flex-1\"\n            placeholder=\"source_id (선택)\"\n            value={ingestSourceId}\n            onChange={(e) => setIngestSourceId(e.target.value)}\n          />\n          <button className=\"border px-3 py-2\" onClick={handleIngest}>\n            수집 실행\n          </button>\n        </div>\n        <pre className=\"bg-gray-50 border rounded p-3 overflow-auto\">\n          {ingestResult ? JSON.stringify(ingestResult, null, 2) : \"—\"}\n        </pre>\n      </section>\n\n        <section className=\"space-y-3\">\n        <h2 className=\"text-lg font-semibold\">C) 검색 테스트</h2>\n        <div className=\"flex items-center gap-3\">\n          <input\n            className=\"border rounded p-2 flex-1\"\n            placeholder=\"검색어...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n          />\n          <select\n            className=\"border rounded p-2\"\n            value={searchLang}\n            onChange={(e) => setSearchLang(e.target.value)}\n          >\n            <option value=\"en\">en</option>\n            <option value=\"ko\">ko</option>\n            <option value=\"ja\">ja</option>\n          </select>\n          <button className=\"border px-3 py-2\" onClick={handleSearch}>\n            검색\n          </button>\n        </div>\n        <pre className=\"bg-gray-50 border rounded p-3 overflow-auto\">\n          {searchResult ? JSON.stringify(searchResult, null, 2) : \"—\"}\n        </pre>\n      </section>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAWe,SAAS;;IACtB,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,mBAAmB,qBAAqB,GAAG,IAAA,yKAAQ,EAAS;IACnE,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAe,EAAE;IAC3D,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAM;IAE5D,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,yKAAQ,EAAC;IACzD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAC;IACrD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAM;IAEtD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAC;IAC/C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,yKAAQ,EAAC;IAC7C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,yKAAQ,EAAM;IAEtD,IAAA,0KAAS;kCAAC;YACR,MAAM,sBACH,IAAI;0CAAC,CAAC,IAAM,EAAE,IAAI;yCAClB,IAAI;0CAAC,CAAC,OAAS,aAAa,MAAM,QAAQ,EAAE;yCAC5C,KAAK;0CAAC,IAAM,aAAa,EAAE;;QAChC;iCAAG,EAAE;IAEL,MAAM,kBAAkB;QACtB,mBAAmB;QACnB,MAAM,UAAe,CAAC;QACtB,IAAI,cAAc,IAAI,IAAI,QAAQ,IAAI,GAAG,cAAc,IAAI;QAC3D,IAAI,mBAAmB,QAAQ,UAAU,GAAG,OAAO;QACnD,MAAM,MAAM,MAAM,MAAM,0BAA0B;YAChD,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACvB;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,mBAAmB;IACrB;IAEA,MAAM,eAAe;QACnB,gBAAgB;QAChB,MAAM,UAAe;YAAE,aAAa;gBAAC;aAAiB;QAAC;QACvD,IAAI,eAAe,IAAI,IAAI,QAAQ,SAAS,GAAG,eAAe,IAAI;QAClE,MAAM,MAAM,MAAM,MAAM,mBAAmB;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;QACvB;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,gBAAgB;IAClB;IAEA,MAAM,eAAe;QACnB,gBAAgB;QAChB,MAAM,MAAM,MAAM,MAAM,mBAAmB;YACzC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,OAAO,YAAY,IAAI;gBACvB,MAAM;YACR;QACF;QACA,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,gBAAgB;IAClB;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAM,WAAU;;kCACf,6LAAC;wBAAI,WAAU;kCAAkE;;;;;;kCAGjF,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;0CAGD,6LAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;0CAGD,6LAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;0CAGD,6LAAC;gCACC,MAAK;gCACL,WAAU;0CACX;;;;;;0CAGD,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,MAAK;wCACL,WAAU;kDACX;;;;;;kDAGD,6LAAC;wCAAI,WAAU;kDAAmG;;;;;;;;;;;;;;;;;;kCAKtH,6LAAC;wBACC,MAAK;wBACL,WAAU;kCACX;;;;;;;;;;;;0BAKH,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;;0CACC,6LAAC;gCAAG,WAAU;0CAAoB;;;;;;0CAClC,6LAAC;gCAAE,WAAU;0CAAgB;;;;;;;;;;;;kCAG/B,6LAAC;wBAAQ,WAAU;;0CACnB,6LAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,6LAAC;gCACC,WAAU;gCACV,MAAM;gCACN,aAAY;gCACZ,OAAO;gCACP,UAAU,CAAC,IAAM,iBAAiB,EAAE,MAAM,CAAC,KAAK;;;;;;0CAElD,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,WAAU;wCACV,OAAO;wCACP,UAAU,CAAC,IAAM,qBAAqB,EAAE,MAAM,CAAC,KAAK;;0DAEpD,6LAAC;gDAAO,OAAM;0DAAG;;;;;;4CAChB,UAAU,GAAG,CAAC,CAAC,oBACd,6LAAC;oDAAoB,OAAO,IAAI,EAAE;;wDAC/B,IAAI,EAAE;wDAAC;wDAAE,IAAI,KAAK,GAAG,CAAC,EAAE,EAAE,IAAI,KAAK,EAAE,GAAG;;mDAD9B,IAAI,EAAE;;;;;;;;;;;kDAKvB,6LAAC;wCAAO,WAAU;wCAAmB,SAAS;kDAAiB;;;;;;;;;;;;0CAIjE,6LAAC;gCAAI,WAAU;0CACZ,kBAAkB,KAAK,SAAS,CAAC,iBAAiB,MAAM,KAAK;;;;;;;;;;;;kCAIhE,6LAAC;wBAAQ,WAAU;;0CACnB,6LAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,WAAU;wCACV,OAAO;wCACP,UAAU,CAAC,IAAM,oBAAoB,EAAE,MAAM,CAAC,KAAK;;0DAEnD,6LAAC;gDAAO,OAAM;0DAAY;;;;;;0DAC1B,6LAAC;gDAAO,OAAM;0DAAW;;;;;;0DACzB,6LAAC;gDAAO,OAAM;0DAAS;;;;;;0DACvB,6LAAC;gDAAO,OAAM;0DAAqB;;;;;;;;;;;;kDAErC,6LAAC;wCACC,WAAU;wCACV,aAAY;wCACZ,OAAO;wCACP,UAAU,CAAC,IAAM,kBAAkB,EAAE,MAAM,CAAC,KAAK;;;;;;kDAEnD,6LAAC;wCAAO,WAAU;wCAAmB,SAAS;kDAAc;;;;;;;;;;;;0CAI9D,6LAAC;gCAAI,WAAU;0CACZ,eAAe,KAAK,SAAS,CAAC,cAAc,MAAM,KAAK;;;;;;;;;;;;kCAI1D,6LAAC;wBAAQ,WAAU;;0CACnB,6LAAC;gCAAG,WAAU;0CAAwB;;;;;;0CACtC,6LAAC;gCAAI,WAAU;;kDACb,6LAAC;wCACC,WAAU;wCACV,aAAY;wCACZ,OAAO;wCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;;;;;;kDAEhD,6LAAC;wCACC,WAAU;wCACV,OAAO;wCACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;;0DAE7C,6LAAC;gDAAO,OAAM;0DAAK;;;;;;0DACnB,6LAAC;gDAAO,OAAM;0DAAK;;;;;;0DACnB,6LAAC;gDAAO,OAAM;0DAAK;;;;;;;;;;;;kDAErB,6LAAC;wCAAO,WAAU;wCAAmB,SAAS;kDAAc;;;;;;;;;;;;0CAI9D,6LAAC;gCAAI,WAAU;0CACZ,eAAe,KAAK,SAAS,CAAC,cAAc,MAAM,KAAK;;;;;;;;;;;;;;;;;;;;;;;;AAMlE;GA/MwB;KAAA"}}]
}