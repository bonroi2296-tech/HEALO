# 관리자 환경 테스트 가이드

## 🎯 문제: 세션 유지로 인한 테스트 어려움

### 증상:
- 로그아웃 후에도 "Log In" 클릭하면 바로 관리자 페이지로 이동
- 사용자 환경 테스트 불가능
- 다른 환경(카페, 도서관 등)에서 로그인 후 세션이 남아있음

---

## ✅ 해결: 완전한 로그아웃 구현

### 로그아웃 시 정리되는 항목:

```javascript
1. Supabase 세션 (auth.signOut())
2. localStorage (모든 데이터)
3. sessionStorage (모든 데이터)
4. 브라우저 쿠키 (모든 쿠키)
5. 캐시 무효화 (타임스탬프 쿼리)
```

---

## 🧪 사용자 환경 테스트 방법

### **방법 1: 시크릿 모드 (가장 추천!)**

**Chrome**:
```
Ctrl+Shift+N (Windows/Linux)
Cmd+Shift+N (Mac)
```

**Edge**:
```
Ctrl+Shift+P (Windows/Linux)
Cmd+Shift+P (Mac)
```

**Firefox**:
```
Ctrl+Shift+P (Windows/Linux)
Cmd+Shift+P (Mac)
```

**장점**:
- ✅ 완전히 깨끗한 환경
- ✅ 쿠키/스토리지 없음
- ✅ 실제 신규 사용자 환경과 동일
- ✅ 창 닫으면 모든 데이터 자동 삭제

**사용법**:
1. 시크릿 모드 창 열기
2. `localhost:3000` 접속
3. 사용자 환경으로 테스트
4. 관리자 테스트 필요하면 로그인
5. 창 닫으면 세션 완전 삭제

---

### **방법 2: 개발자 도구로 쿠키 삭제**

**단계**:
1. **F12** 키 (개발자 도구)
2. **Application** 탭 (Chrome/Edge) 또는 **Storage** 탭 (Firefox)
3. **Storage** 섹션:
   - **Cookies** → `http://localhost:3000` 선택
   - 모든 쿠키 우클릭 → **Clear**
   - **Local Storage** → `http://localhost:3000` → **Clear**
   - **Session Storage** → `http://localhost:3000` → **Clear**
4. **F5** (새로고침)

**장점**:
- ✅ 현재 창 유지
- ✅ 개발자 도구 열어둔 채로 테스트
- ✅ 네트워크 탭으로 API 호출 확인 가능

**단점**:
- ❌ 수동으로 삭제해야 함
- ❌ 실수로 일부만 삭제할 수 있음

---

### **방법 3: 브라우저 프로필 분리**

**Chrome/Edge**:
1. 브라우저 우측 상단 프로필 아이콘 클릭
2. **"Add"** 또는 **"프로필 추가"**
3. 프로필 이름:
   - **"HEALO Admin"** (관리자용)
   - **"HEALO User"** (사용자 테스트용)

**장점**:
- ✅ 완전히 분리된 환경
- ✅ 쿠키/스토리지/북마크 독립적
- ✅ 동시에 여러 창 열어서 테스트 가능
- ✅ 프로필별로 확장 프로그램도 분리

**사용법**:
- **관리자 작업**: "HEALO Admin" 프로필
- **사용자 테스트**: "HEALO User" 프로필
- 동시에 2개 창 열어서 비교 가능!

---

### **방법 4: 다른 브라우저 사용**

**예시**:
- **Chrome**: 관리자용
- **Firefox**: 사용자 테스트용
- **Edge**: 추가 테스트용

**장점**:
- ✅ 완전히 분리된 환경
- ✅ 브라우저별 호환성 테스트 가능

---

## 🔒 보안 Best Practice

### **공용 PC에서 작업 후**:

```bash
✅ 필수 체크리스트:

1. [ ] 로그아웃 버튼 클릭
2. [ ] 브라우저 창 모두 닫기
3. [ ] 시크릿 모드 사용했다면 → 자동 삭제됨
4. [ ] 일반 모드 사용했다면:
   - 브라우저 설정 → "종료 시 쿠키 삭제" 확인
   - 또는 Ctrl+Shift+Delete → 쿠키/캐시 삭제
```

---

### **비밀번호 관리**:

```bash
❌ 하지 말아야 할 것:
- 브라우저 "비밀번호 저장" (공용 PC)
- 자동 로그인 설정
- 로그아웃 없이 창만 닫기

✅ 해야 할 것:
- 비밀번호 관리자 사용 (1Password, Bitwarden)
- 작업 완료 후 항상 로그아웃
- 시크릿 모드 사용
```

---

## 🧪 테스트 시나리오

### **사용자 환경 테스트**:

```bash
1. 시크릿 모드 열기 (Ctrl+Shift+N)
2. localhost:3000 접속
3. 일반 사용자처럼 탐색:
   - 시술 목록 확인
   - 병원 상세 페이지
   - 문의 폼 제출
4. 창 닫기 → 세션 자동 삭제
```

---

### **관리자 환경 테스트**:

```bash
1. 일반 모드 (또는 관리자 프로필)
2. localhost:3000/admin 접속
3. 로그인
4. 관리자 작업 수행
5. 로그아웃 버튼 클릭
6. "Log In" 클릭 → 로그인 화면 나타나는지 확인 ✅
```

---

### **세션 유지 테스트**:

```bash
✅ 정상 동작:
1. 로그인
2. 브라우저 새로고침 (F5)
3. 세션 유지됨 → 정상 ✅
4. 로그아웃 버튼 클릭
5. "Log In" 클릭
6. 로그인 화면 나타남 → 정상 ✅

❌ 비정상 동작:
1. 로그인
2. 로그아웃 버튼 클릭
3. "Log In" 클릭
4. 바로 관리자 페이지 이동 → 버그! ❌
```

---

## 🎯 로그아웃 동작 확인

### **로그아웃 시 콘솔 메시지**:

```javascript
[AdminPage] ✅ Logged out - all sessions cleared
```

### **삭제되는 항목**:

```bash
✅ Supabase 세션
✅ localStorage 전체
✅ sessionStorage 전체
✅ 모든 브라우저 쿠키
✅ 캐시 (타임스탬프로 무효화)
```

---

## 🚨 문제 해결

### **로그아웃 후에도 자동 로그인되는 경우**:

```bash
1. F12 → Console 탭
2. 다음 명령어 실행:
   localStorage.clear();
   sessionStorage.clear();
   location.reload();

3. 또는 브라우저 데이터 완전 삭제:
   Ctrl+Shift+Delete
   → "모든 기간"
   → "쿠키", "캐시" 체크
   → "데이터 삭제"
```

---

### **Vercel 프로덕션 환경**:

```bash
https://healo-nu.vercel.app

1. 시크릿 모드에서 접속
2. 테스트 완료
3. 창 닫기 → 자동으로 모든 세션 삭제
```

---

## 📋 체크리스트

### **개발 환경 설정**:

- [ ] Chrome: "HEALO Admin" 프로필 생성
- [ ] Chrome: "HEALO User" 프로필 생성
- [ ] 시크릿 모드 단축키 숙지 (Ctrl+Shift+N)
- [ ] 개발자 도구 단축키 숙지 (F12)

### **매일 작업 전**:

- [ ] 관리자 작업: 관리자 프로필 사용
- [ ] 사용자 테스트: 시크릿 모드 사용
- [ ] 작업 완료 후: 로그아웃 확인

### **배포 전**:

- [ ] 로그아웃 → "Log In" → 로그인 화면 나타나는지 확인
- [ ] 시크릿 모드에서 사용자 플로우 테스트
- [ ] 다른 브라우저에서 테스트

---

**작성일**: 2026-01-29  
**최종 업데이트**: 2026-01-29
