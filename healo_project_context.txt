=== PROJECT FILE STRUCTURE ===
.\.cursorrules
.\.env
.\.env.local
.\.gitignore
.\DEV_LOG.md
.\eslint.config.js
.\GOOGLE_MAPS_SETUP.md
.\healo_project_context.txt
.\index.html
.\merge_code.py
.\OPTIMAL_SETTINGS.md
.\package.json
.\postcss.config.js
.\PROJECT_ANALYSIS.md
.\public.zip
.\QUICK_START.md
.\README.md
.\tailwind.config.js
.\TOAST_TEST_GUIDE.md
.\TOAST_USAGE.md
.\vite.config.js
.\public\vite.svg
.\src\AdminPage.jsx
.\src\App.css
.\src\App.jsx
.\src\components.jsx
.\src\data.js
.\src\index.css
.\src\main.jsx
.\src\pages.jsx
.\src\supabase.js
.\src\assets\react.svg
.\src\components\AddressInput.jsx
.\src\components\ErrorBoundary.jsx
.\src\components\GoogleMap.jsx
.\src\components\Modals.jsx
.\src\components\SEO.jsx
.\src\components\Toast.jsx
.\src\hooks\useDetailFetch.js
.\src\lib\language.js
.\src\lib\mapper.js
.\src\lib\normalizeImages.js
.\src\pages\AuthPages.jsx
.\src\pages\HospitalDetailPage.jsx
.\src\pages\InquiryPage.jsx
.\src\pages\TreatmentDetailPage.jsx
.\src\pages\admin\AnalyticsTab.jsx
.\src\pages\admin\HospitalManager.jsx
.\src\pages\admin\InquiryManager.jsx
.\src\pages\admin\SiteSettings.jsx
.\src\pages\admin\TreatmentManager.jsx


=== FILE CONTENTS ===



--- START OF FILE: .\eslint.config.js ---
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])

--- END OF FILE: .\eslint.config.js ---


--- START OF FILE: .\package.json ---
{
  "name": "healo-mn",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "lint": "eslint .",
    "lint:fix": "eslint . --fix",
    "format": "prettier --write \"src/**/*.{js,jsx}\""
  },
  "dependencies": {
    "@react-google-maps/api": "^2.20.8",
    "@supabase/supabase-js": "^2.90.1",
    "lucide-react": "^0.562.0",
    "react": "^19.2.0",
    "react-daum-postcode": "^3.2.0",
    "react-dom": "^19.2.0",
    "react-helmet-async": "^2.0.5",
    "react-router-dom": "^7.12.0"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.23",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "vite": "^7.2.4"
  }
}

--- END OF FILE: .\package.json ---


--- START OF FILE: .\postcss.config.js ---
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
--- END OF FILE: .\postcss.config.js ---


--- START OF FILE: .\tailwind.config.js ---
/** @type {import('tailwindcss').Config} */
export default {
  content: [
    "./index.html",
    "./src/**/*.{js,ts,jsx,tsx}",
  ],
  theme: {
    extend: {},
  },
  plugins: [],
}
--- END OF FILE: .\tailwind.config.js ---


--- START OF FILE: .\vite.config.js ---
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  
  // ì„±ëŠ¥ ìµœì í™”: ì½”ë“œ ìŠ¤í”Œë¦¬íŒ…
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'supabase-vendor': ['@supabase/supabase-js'],
        },
      },
    },
    // ì²­í¬ í¬ê¸° ê²½ê³  ì œí•œ (1000KB)
    chunkSizeWarningLimit: 1000,
  },
  
  // ê°œë°œ ì„œë²„ ì„¤ì •
  server: {
    port: 5173,
    open: true, // ìë™ìœ¼ë¡œ ë¸Œë¼ìš°ì € ì—´ê¸°
  },
  
  // ê²½ë¡œ ë³„ì¹­ (ì„ íƒì‚¬í•­ - ì¶”í›„ ì‚¬ìš©)
  resolve: {
    alias: {
      '@': '/src',
    },
  },
})

--- END OF FILE: .\vite.config.js ---


--- START OF FILE: .\src\AdminPage.jsx ---
// src/AdminPage.jsx
import React, { useEffect, useState, useRef } from 'react';
import { supabase } from './supabase';
import {
  RefreshCw, Loader2, Paperclip, X,
  LayoutDashboard, Building2, 
  Stethoscope, MessageSquare, Plus, Save, Trash2,
  ImageIcon, User, LogOut, Globe, Coffee, Trophy, UploadCloud, Info, Settings,
  BarChart3, TrendingUp, DollarSign, Activity, AlertCircle, Target, ArrowRightCircle
} from 'lucide-react';
import { useToast } from './components/Toast';
import { AddressInput } from './components/AddressInput';
import { AnalyticsTab } from './pages/admin/AnalyticsTab';
import { InquiryManager } from './pages/admin/InquiryManager';
import { HospitalManager } from './pages/admin/HospitalManager';
import { TreatmentManager } from './pages/admin/TreatmentManager';
import { SiteSettings as SiteSettingsTab } from './pages/admin/SiteSettings';

// ==========================================
// 1. í…ìŠ¤íŠ¸ ì…ë ¥ìš© ë™ì  ë¦¬ìŠ¤íŠ¸
// ==========================================
const DynamicListInput = ({ items, onAdd, onRemove, placeholder, icon: Icon }) => {
    const [newItem, setNewItem] = useState('');
    const handleAdd = () => {
        if (newItem.trim()) {
            onAdd(newItem.trim());
            setNewItem('');
        }
    };
    return (
        <div className="space-y-2">
            <div className="flex gap-2">
                <div className="relative flex-1">
                    {Icon && <Icon size={16} className="absolute left-3 top-3 text-gray-400"/>}
                    <input type="text" value={newItem} onChange={(e) => setNewItem(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), handleAdd())} className={`w-full p-2.5 rounded-lg border border-gray-200 text-sm focus:ring-2 focus:ring-teal-500 outline-none transition ${Icon ? 'pl-10' : ''}`} placeholder={placeholder} />
                </div>
                <button type="button" onClick={handleAdd} className="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 rounded-lg font-bold text-sm transition">ì¶”ê°€</button>
            </div>
            <div className="flex flex-wrap gap-2">
                {items.map((item, idx) => (
                    <span key={idx} className="bg-teal-50 text-teal-700 text-xs font-bold px-3 py-1.5 rounded-full flex items-center gap-2 border border-teal-100">
                        {item} <button type="button" onClick={() => onRemove(idx)} className="hover:text-red-500"><X size={12}/></button>
                    </span>
                ))}
            </div>
        </div>
    );
};

// ==========================================
// 2. ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë”
// ==========================================
const ImageUploader = ({ images, onUpload, onRemove, uploading }) => {
    const fileInputRef = useRef(null);

    const handleFileChange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        await onUpload(file);
        if (fileInputRef.current) fileInputRef.current.value = '';
    };

    return (
        <div className="space-y-3">
            <div className="flex gap-2">
                <div className="relative flex-1">
                    <input 
                        type="file" 
                        accept="image/*"
                        ref={fileInputRef}
                        onChange={handleFileChange}
                        disabled={uploading}
                        className="hidden" 
                        id="file-upload-input"
                    />
                    <label 
                        onClick={() => fileInputRef.current.click()}
                        className={`w-full flex items-center justify-center gap-2 p-3 rounded-lg border border-dashed border-gray-300 text-sm text-gray-500 cursor-pointer hover:bg-gray-50 hover:border-teal-500 transition ${uploading ? 'opacity-50 cursor-not-allowed' : ''}`}
                    >
                        {uploading ? <Loader2 size={18} className="animate-spin"/> : <UploadCloud size={18}/>}
                        {uploading ? "ì—…ë¡œë“œ ì¤‘..." : "í´ë¦­í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ (JPG, PNG)"}
                    </label>
                </div>
            </div>
            
            {images.length > 0 && (
                <div className="grid grid-cols-4 gap-2">
                    {images.map((url, idx) => (
                        <div key={idx} className="relative group aspect-square rounded-lg overflow-hidden border border-gray-200 bg-gray-100">
                            <img src={url} alt="upload" className="w-full h-full object-cover" />
                            <button 
                                onClick={() => onRemove(idx)} 
                                className="absolute top-1 right-1 bg-red-500 text-white p-1 rounded-full opacity-80 hover:opacity-100 transition shadow-sm"
                            >
                                <X size={12} />
                            </button>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
};


export const AdminPage = ({ setView }) => {
  const toast = useToast(); // Toast ì‚¬ìš© ì¤€ë¹„
  const [activeTab, setActiveTab] = useState('analytics'); 
  const [loading, setLoading] = useState(false);
  const [uploading, setUploading] = useState(false);

  const [inquiries, setInquiries] = useState([]);
  const [hospitalsList, setHospitalsList] = useState([]);
  const [treatmentsList, setTreatmentsList] = useState([]);
  const [hospitalsError, setHospitalsError] = useState(null);
  const [treatmentsError, setTreatmentsError] = useState(null);
  const [selectedFile, setSelectedFile] = useState(null);
  const [siteSettings, setSiteSettings] = useState({ logo_url: '', hero_background_url: '' });

  // í†µê³„ ë°ì´í„° ìƒíƒœ
  const [analytics, setAnalytics] = useState({
      totalRevenue: 0,
      totalLeads: 0,
      topTreatment: '-',
      hospitalOpportunities: [],
      treatmentTrends: []
  });

  // ë³‘ì› í¼
  const [editingHospitalId, setEditingHospitalId] = useState(null);
  const [hospitalForm, setHospitalForm] = useState({ 
      name: '', location_kr: '', location_en: '', address_detail: '', description: '', 
      latitude: null, longitude: null,
      tags: [], images: [], 
      languages: [], amenities: [], 
      hoursMonFri: '09:00 - 18:00', hoursSat: '09:00 - 13:00', 
      doctorName: '', doctorTitle: '', doctorImage: '', 
      doctorSchool: '', doctorYears: '', doctorSpecialties: [], 
      doctorMetricValue: '99%', doctorMetricLabel: 'ë§Œì¡±ë„' 
  });

  // ì‹œìˆ  í¼
  const [selectedHospitalId, setSelectedHospitalId] = useState('');
  const [editingTreatmentId, setEditingTreatmentId] = useState(null);
  const [treatmentForm, setTreatmentForm] = useState({ 
      title: '', desc: '', fullDescription: '', 
      priceMin: '', recoveryTime: '', 
      benefits: [], tags: [], images: [] 
  });

  // ==========================================
  // API Calls & Logic
  // ==========================================
  
  const fetchInquiries = async () => { const { data } = await supabase.from('inquiries').select('*').order('created_at', { ascending: false }); setInquiries(data || []); };
  const fetchHospitals = async () => {
      const { data, error } = await supabase.from('hospitals').select('*').order('created_at', { ascending: false });
      if (error) {
          console.error('[AdminPage] Hospitals fetch error:', error);
          setHospitalsError(error);
          setHospitalsList([]);
          return;
      }
      setHospitalsError(null);
      setHospitalsList(data || []);
  };
  const fetchTreatments = async (hId) => {
      if(!hId) return;
      const { data, error } = await supabase.from('treatments').select('*').eq('hospital_id', hId).order('created_at', { ascending: false });
      if (error) {
          console.error('[AdminPage] Treatments fetch error:', error);
          setTreatmentsError(error);
          setTreatmentsList([]);
          return;
      }
      setTreatmentsError(null);
      setTreatmentsList(data || []);
  };
  
  const fetchSiteSettings = async () => {
      const { data } = await supabase.from('site_settings').select('*').single();
      if(data) setSiteSettings(data);
  };

  const fetchAllData = async () => {
    setLoading(true);
    await Promise.all([fetchInquiries(), fetchHospitals(), fetchSiteSettings()]);
    setLoading(false);
  };

  useEffect(() => {
    const checkSession = async () => {
        const { data: { session } } = await supabase.auth.getSession();
        if (!session || session.user.email !== 'admin@healo.com') {
            toast.error('ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤ ğŸ›¡ï¸'); setView('login');
        } else {
            fetchAllData();
        }
    };
    checkSession();
  }, []);

  // ğŸ”¥ [Analytics] Sales Intelligence Logic (í•œêµ­ì–´ ëŒ€ì‘)
  useEffect(() => {
      if (inquiries.length === 0) return;

      const AVG_PRICE = 3500; // í‰ê·  ì‹œìˆ  ë‹¨ê°€ ($3,500 ê°€ì •)

      // 1. Demand Trends (ì‹œìˆ  íŠ¸ë Œë“œ)
      const treatmentCounts = {};
      inquiries.forEach(q => {
          const type = q.treatment_type || 'General Inquiry';
          treatmentCounts[type] = (treatmentCounts[type] || 0) + 1;
      });
      const sortedTrends = Object.entries(treatmentCounts)
          .sort(([,a], [,b]) => b - a)
          .map(([name, count]) => ({ name, count, percent: Math.round((count / inquiries.length) * 100) }));

      // 2. Opportunity Analysis (ë³‘ì›ë³„ ê¸°íšŒ ë¹„ìš© ë¶„ì„)
      const hospitalCounts = {};
      inquiries.forEach(q => {
          const hId = q.hospital_id || 'unassigned';
          hospitalCounts[hId] = (hospitalCounts[hId] || 0) + 1;
      });

      const opportunities = Object.entries(hospitalCounts).map(([id, count]) => {
          const hospital = hospitalsList.find(h => h.id === id);
          const isUnassigned = id === 'unassigned';
          // íƒœê·¸ì— 'Partner'ê°€ ìˆìœ¼ë©´ ì œíœ´ ë³‘ì›
          const isPartner = hospital?.tags?.some(t => String(t).toLowerCase().includes('partner'));
          
          return {
              id,
              name: hospital ? hospital.name : (isUnassigned ? 'ë¯¸ì§€ì • ìˆ˜ìš” (Floating Demand)' : 'Unknown'),
              count,
              marketValue: count * AVG_PRICE, // ì‹œì¥ ê°€ì¹˜
              status: isPartner ? 'ë§¤ì¹­ ì™„ë£Œ' : (isUnassigned ? 'ê¸°íšŒ ë¹„ìš© (Missed)' : 'ì´íƒˆ ìš°ë ¤'),
              // ì˜ì—… í–‰ë™ ê°€ì´ë“œ
              action: isPartner ? 'ê´€ê³„ ìœ ì§€ ê´€ë¦¬' : (isUnassigned ? 'ì‹ ê·œ ì œíœ´ ì œì•ˆ ì‹œê¸‰' : 'ì˜ì—… íƒ€ê²ŸíŒ… ëŒ€ìƒ')
          };
      }).sort((a, b) => b.marketValue - a.marketValue);

      setAnalytics({
          totalLeads: inquiries.length,
          totalRevenue: inquiries.length * AVG_PRICE,
          topTreatment: sortedTrends[0]?.name || '-',
          hospitalOpportunities: opportunities,
          treatmentTrends: sortedTrends
      });

  }, [inquiries, hospitalsList]);


  const handleStatusChange = async (id, newStatus) => { await supabase.from('inquiries').update({ status: newStatus }).eq('id', id); fetchInquiries(); };
  const handleDelete = async (table, id, cb) => { if(confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) { await supabase.from(table).delete().eq('id', id); cb(); } };
  const handleFileClick = (url) => { setSelectedFile(url); };
  const getFileType = (url) => { const ext = url.split('.').pop().toLowerCase(); return ['png', 'jpg', 'jpeg', 'gif', 'webp'].includes(ext) ? 'image' : (ext === 'pdf' ? 'pdf' : 'other'); };

  const uploadToSupabase = async (file) => {
      if (!file) return null;
      setUploading(true);
      try {
          const fileExt = file.name.split('.').pop();
          const fileName = `${Date.now()}-${Math.random().toString(36).substring(2, 10)}.${fileExt}`;
          const filePath = `uploads/${fileName}`;

          const { error: uploadError } = await supabase.storage.from('images').upload(filePath, file);
          if (uploadError) throw uploadError;

          const { data } = supabase.storage.from('images').getPublicUrl(filePath);
          return data.publicUrl;
      } catch (error) {
          console.error('Upload failed:', error);
          toast.error('ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message);
          return null;
      } finally {
          setUploading(false);
      }
  };

  // ì €ì¥ ë¡œì§ë“¤...
  const handleSaveHospital = async () => {
      if(!hospitalForm.name) return toast.error("ë³‘ì›ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
      setLoading(true);
      const generatedSlug = hospitalForm.name.toLowerCase().trim().replace(/[^\w\s-]/g, '').replace(/[\s_-]+/g, '-').replace(/^-+|-+$/g, '') || `hospital-${Date.now()}`;
      
      const payload = {
          name: hospitalForm.name, slug: generatedSlug, 
          location_kr: hospitalForm.location_kr?.trim() || null,
          location_en: hospitalForm.location_en?.trim() || null,
          address_detail: hospitalForm.address_detail?.trim() || null,
          description: hospitalForm.description, 
          latitude: hospitalForm.latitude, longitude: hospitalForm.longitude,
          tags: hospitalForm.tags, images: hospitalForm.images, 
          supported_languages: hospitalForm.languages, amenities: hospitalForm.amenities,
          operating_hours: { mon_fri: hospitalForm.hoursMonFri, sat: hospitalForm.hoursSat },
          doctor_profile: { 
              name: hospitalForm.doctorName, title: hospitalForm.doctorTitle, image: hospitalForm.doctorImage, 
              school: hospitalForm.doctorSchool, years: hospitalForm.doctorYears, specialties: hospitalForm.doctorSpecialties, 
              heroMetric: { value: hospitalForm.doctorMetricValue, label: hospitalForm.doctorMetricLabel } 
          }
      };

      try {
          if(editingHospitalId) await supabase.from('hospitals').update(payload).eq('id', editingHospitalId);
          else await supabase.from('hospitals').insert([payload]);
          
          toast.success("ë³‘ì› ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¥");
          setEditingHospitalId(null); fetchHospitals();
          setHospitalForm({ name: '', location_kr: '', location_en: '', address_detail: '', description: '', latitude: null, longitude: null, tags: [], images: [], languages: [], amenities: [], hoursMonFri: '', hoursSat: '', doctorName: '', doctorTitle: '', doctorImage: '', doctorSchool: '', doctorYears: '', doctorSpecialties: [], doctorMetricValue: '99%', doctorMetricLabel: 'ë§Œì¡±ë„' });
      } catch (err) { toast.error("ì €ì¥ ì‹¤íŒ¨: " + err.message); } finally { setLoading(false); }
  };

  const handleSaveTreatment = async () => { 
      if(!selectedHospitalId || !treatmentForm.title) return toast.error("ë³‘ì› ì„ íƒê³¼ ì‹œìˆ ëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
      setLoading(true);
      const payload = { hospital_id: selectedHospitalId, name: treatmentForm.title, description: treatmentForm.desc, full_description: treatmentForm.fullDescription, price_min: Number(treatmentForm.priceMin)||0, recovery_time: treatmentForm.recoveryTime, benefits: treatmentForm.benefits, tags: treatmentForm.tags, images: treatmentForm.images };
      try { 
          if(editingTreatmentId) await supabase.from('treatments').update(payload).eq('id', editingTreatmentId); 
          else await supabase.from('treatments').insert([payload]); 
          
          toast.success("ì‹œìˆ  ì •ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ’‰");
          setEditingTreatmentId(null); fetchTreatments(selectedHospitalId);
          setTreatmentForm({ title: '', desc: '', fullDescription: '', priceMin: '', recoveryTime: '', benefits: [], tags: [], images: [] }); 
      } catch (err) { toast.error("ì €ì¥ ì‹¤íŒ¨: " + err.message); } finally { setLoading(false); }
  };

  const handleSaveSettings = async () => {
      setLoading(true);
      const { error } = await supabase.from('site_settings').update({
          logo_url: siteSettings.logo_url,
          hero_background_url: siteSettings.hero_background_url
      }).eq('id', siteSettings.id);

      if(error) toast.error("ì €ì¥ ì‹¤íŒ¨: " + error.message);
      else toast.success("ì‚¬ì´íŠ¸ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¨");
      setLoading(false);
  };

  const handleEditHospital = (h) => {
      setEditingHospitalId(h.id);
      const doc = h.doctor_profile || {};
      setHospitalForm({
          name: h.name, 
          location_kr: h.location_kr || h.location || '',
          location_en: h.location_en || h.location || '',
          address_detail: h.address_detail || '',
          description: h.description, 
          latitude: h.latitude || null, longitude: h.longitude || null,
          tags: h.tags||[], images: h.images||[], 
          languages: h.supported_languages || [], amenities: h.amenities || [],           
          hoursMonFri: h.operating_hours?.mon_fri||'', hoursSat: h.operating_hours?.sat||'',
          doctorName: doc.name||'', doctorTitle: doc.title||'', doctorImage: doc.image||'', 
          doctorSchool: doc.school||'', doctorYears: doc.years||'', doctorSpecialties: doc.specialties || [], 
          doctorMetricValue: doc.heroMetric?.value || '99%', doctorMetricLabel: doc.heroMetric?.label || 'ë§Œì¡±ë„'
      });
  };
  const handleEditTreatment = (t) => { setEditingTreatmentId(t.id); setTreatmentForm({ title: t.name, desc: t.description, fullDescription: t.full_description||'', priceMin: t.price_min, recoveryTime: t.recovery_time||'', benefits: t.benefits||[], tags: t.tags||[], images: t.images||[] }); };

  return (
    <div className="min-h-screen bg-gray-50 flex">
        <div className="w-64 bg-white border-r border-gray-200 fixed h-full p-6 flex flex-col z-20">
            <div className="text-2xl font-black text-teal-600 mb-10 flex items-center gap-2"><LayoutDashboard /> ê´€ë¦¬ì ëª¨ë“œ</div>
            <nav className="space-y-2 flex-1">
                {/* ğŸ”¥ ë©”ë‰´ í•œêµ­ì–´í™” */}
                <button onClick={() => setActiveTab('analytics')} className={`w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition ${activeTab === 'analytics' ? 'bg-teal-50 text-teal-700' : 'text-gray-500 hover:bg-gray-50'}`}><BarChart3 size={18}/> ì‹œì¥ ë¶„ì„ (í†µê³„)</button>
                <button onClick={() => setActiveTab('inquiries')} className={`w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition ${activeTab === 'inquiries' ? 'bg-teal-50 text-teal-700' : 'text-gray-500 hover:bg-gray-50'}`}><MessageSquare size={18}/> ê³ ê° ë¬¸ì˜</button>
                <button onClick={() => setActiveTab('hospitals')} className={`w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition ${activeTab === 'hospitals' ? 'bg-teal-50 text-teal-700' : 'text-gray-500 hover:bg-gray-50'}`}><Building2 size={18}/> ë³‘ì› ê´€ë¦¬</button>
                <button onClick={() => setActiveTab('treatments')} className={`w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition ${activeTab === 'treatments' ? 'bg-teal-50 text-teal-700' : 'text-gray-500 hover:bg-gray-50'}`}><Stethoscope size={18}/> ì‹œìˆ  ê´€ë¦¬</button>
                <div className="pt-4 mt-4 border-t border-gray-100">
                    <button onClick={() => setActiveTab('settings')} className={`w-full text-left px-4 py-3 rounded-xl font-bold flex items-center gap-3 transition ${activeTab === 'settings' ? 'bg-teal-50 text-teal-700' : 'text-gray-500 hover:bg-gray-50'}`}><Settings size={18}/> ì‚¬ì´íŠ¸ ì„¤ì •</button>
                </div>
            </nav>
            <button onClick={() => setView('home')} className="flex items-center gap-2 text-gray-400 hover:text-red-500 font-bold px-2 py-2"><LogOut size={16}/> ê´€ë¦¬ì ë‚˜ê°€ê¸°</button>
        </div>

        <div className="ml-64 flex-1 p-8 md:p-12 max-w-7xl">
            
            {/* ğŸ”¥ [Sales Intelligence Dashboard] - Internal Only */}
            {activeTab === 'analytics' && <AnalyticsTab analytics={analytics} />}

            {/* ë‚˜ë¨¸ì§€ íƒ­ë“¤ì€ ê¸°ì¡´ ì½”ë“œ ìœ ì§€ (ë²ˆì—­ë§Œ ì ìš©ë¨) */}
            {activeTab === 'inquiries' && (
                <InquiryManager
                    inquiries={inquiries}
                    fetchInquiries={fetchInquiries}
                    handleStatusChange={handleStatusChange}
                    handleFileClick={handleFileClick}
                />
            )}

            {activeTab === 'hospitals' && (
                <HospitalManager
                    hospitalsList={hospitalsList}
                    hospitalsError={hospitalsError}
                    handleEditHospital={handleEditHospital}
                    editingHospitalId={editingHospitalId}
                    setEditingHospitalId={setEditingHospitalId}
                    hospitalForm={hospitalForm}
                    setHospitalForm={setHospitalForm}
                    uploading={uploading}
                    loading={loading}
                    handleSaveHospital={handleSaveHospital}
                    handleDelete={handleDelete}
                    fetchHospitals={fetchHospitals}
                    uploadToSupabase={uploadToSupabase}
                    DynamicListInput={DynamicListInput}
                    ImageUploader={ImageUploader}
                    AddressInput={AddressInput}
                    toast={toast}
                />
            )}

            {activeTab === 'treatments' && (
                <TreatmentManager
                    hospitalsList={hospitalsList}
                    selectedHospitalId={selectedHospitalId}
                    setSelectedHospitalId={setSelectedHospitalId}
                    fetchTreatments={fetchTreatments}
                    treatmentsList={treatmentsList}
                    treatmentsError={treatmentsError}
                    editingTreatmentId={editingTreatmentId}
                    setEditingTreatmentId={setEditingTreatmentId}
                    treatmentForm={treatmentForm}
                    setTreatmentForm={setTreatmentForm}
                    handleEditTreatment={handleEditTreatment}
                    handleSaveTreatment={handleSaveTreatment}
                    handleDelete={handleDelete}
                    loading={loading}
                    uploadToSupabase={uploadToSupabase}
                    uploading={uploading}
                    DynamicListInput={DynamicListInput}
                    ImageUploader={ImageUploader}
                />
            )}

            {activeTab === 'settings' && (
                <SiteSettingsTab
                    siteSettings={siteSettings}
                    setSiteSettings={setSiteSettings}
                    uploadToSupabase={uploadToSupabase}
                    uploading={uploading}
                    handleSaveSettings={handleSaveSettings}
                    ImageUploader={ImageUploader}
                />
            )}
        </div>
        {selectedFile && (
            <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[100]" onClick={() => setSelectedFile(null)}>
                <div className="bg-white rounded-xl p-5 max-w-6xl w-full h-[85vh] flex flex-col relative" onClick={(e) => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-4">
                        <h3 className="text-lg font-bold text-gray-800">ë¯¸ë¦¬ë³´ê¸°</h3>
                        <button onClick={() => setSelectedFile(null)}>
                            <X size={20} />
                        </button>
                    </div>
                    <div className="flex-1 overflow-auto border rounded-lg bg-gray-50 p-4 flex justify-center items-start">
                        {getFileType(selectedFile) === 'image' && <img src={selectedFile} className="max-w-full max-h-full" alt="preview"/>}
                        {getFileType(selectedFile) === 'pdf' && <iframe src={selectedFile} className="w-full h-full border" title="pdf"/>}
                        {getFileType(selectedFile) === 'other' && <a href={selectedFile} target="_blank" rel="noopener noreferrer" className="text-teal-600 underline">ìƒˆ ì°½ì—ì„œ ì—´ê¸°</a>}
                    </div>
                </div>
            </div>
        )}
    </div>
  );
};
--- END OF FILE: .\src\AdminPage.jsx ---


--- START OF FILE: .\src\App.css ---
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

--- END OF FILE: .\src\App.css ---


--- START OF FILE: .\src\App.jsx ---
// src/App.jsx
import React, { useState, useEffect, useCallback } from 'react';
import { BrowserRouter, Routes, Route, useNavigate, useParams, Navigate, useLocation } from 'react-router-dom';
import { supabase } from './supabase';
import {
  Header, HeroSection, CardListSection, FloatingInquiryBtn, PersonalConciergeCTA, MobileBottomNav
} from './components.jsx';
import {
  TreatmentDetailPage, HospitalDetailPage, InquiryPage, LoginPage, SignUpPage, SuccessPage
} from './pages.jsx';
import { AdminPage } from './AdminPage';
import { Loader2 } from 'lucide-react';
// ğŸ”¥ Mapper & ErrorBoundary import
import { mapHospitalRow, mapTreatmentRow } from './lib/mapper';
import ErrorBoundary from './components/ErrorBoundary';
import { ToastProvider, useToast } from './components/Toast';
import { getLocationColumn } from './lib/language';

// ==========================================
// 1. í˜ì´ì§€ë„¤ì´ì…˜ ë¦¬ìŠ¤íŠ¸ (Mapper ì ìš©ë¨)
// ==========================================
const PaginatedList = ({ type, searchTerm, onCardClick, title }) => {
    const [items, setItems] = useState([]);
    const [page, setPage] = useState(0);
    const [hasMore, setHasMore] = useState(true);
    const [loading, setLoading] = useState(false);
  const [itemsError, setItemsError] = useState(null);
    const ITEMS_PER_PAGE = 6;

    const fetchItems = useCallback(async (isLoadMore = false) => {
        if (!isLoadMore) setLoading(true);
        
        const from = isLoadMore ? (page + 1) * ITEMS_PER_PAGE : 0;
        const to = from + ITEMS_PER_PAGE - 1;
        const table = type === 'treatment' ? 'treatments' : 'hospitals';
        const locCol = getLocationColumn();
        
        try {
            let query = supabase
                .from(table)
                // í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ - ì–¸ì–´ë³„ location ì»¬ëŸ¼ ì‚¬ìš©
                .select(type === 'treatment' 
                    ? `*, hospitals(name, location:${locCol})` 
                    : `*, location:${locCol}`
                )
                .range(from, to);

            if (searchTerm) {
                query = query.ilike('name', `%${searchTerm}%`);
            }

        const { data, error } = await query;
        if (error) {
            console.error(`[PaginatedList ${type}] Fetch Error:`, error);
            setItemsError(error);
            throw error;
        }
        setItemsError(null);

            // ğŸ”¥ [í•µì‹¬] Mapperë¥¼ í†µí•´ ë°ì´í„° í‘œì¤€í™”
            const mappedData = data.map(item => 
                type === 'treatment' ? mapTreatmentRow(item) : mapHospitalRow(item)
            ).filter(item => item !== null); // null ì œê±°

            if (isLoadMore) {
                setItems(prev => [...prev, ...mappedData]);
                setPage(prev => prev + 1);
            } else {
                setItems(mappedData);
                setPage(0);
            }

            setHasMore(data.length === ITEMS_PER_PAGE);

        } catch (err) {
            console.error(`[PaginatedList ${type}] Fetch Error:`, err);
            setItemsError(err);
        } finally {
            setLoading(false);
        }
    }, [type, searchTerm, page]);

    // íƒ­ì´ ë°”ë€Œë©´(type ë³€ê²½) ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
    useEffect(() => {
        setItems([]);
        setPage(0);
        setHasMore(true);
        fetchItems(false);
    }, [type, searchTerm, fetchItems]);

    return (
        <>
            <CardListSection 
                title={searchTerm ? `Search Results for "${searchTerm}"` : title} 
                items={items} 
                onCardClick={onCardClick} 
                type={type} 
            />
            {import.meta.env.DEV && itemsError && (
                <div className="max-w-6xl mx-auto px-4 mt-2">
                    <p className="text-xs text-red-500">Error: {itemsError.message}</p>
                </div>
            )}
            
            <div className="flex justify-center mt-8 mb-12">
                {loading && page === 0 ? (
                    <div className="flex items-center gap-2 text-teal-600 font-bold"><Loader2 className="animate-spin"/> Loading...</div>
                ) : hasMore ? (
                    <button 
                        onClick={() => fetchItems(true)} 
                        className="px-8 py-3 bg-white border border-gray-200 text-gray-600 rounded-full font-bold shadow-sm hover:bg-gray-50 hover:border-teal-500 hover:text-teal-600 transition"
                    >
                        {loading ? <Loader2 className="animate-spin"/> : "Load More +"}
                    </button>
                ) : items.length > 0 && (
                    <span className="text-gray-300 text-sm font-bold">End of list</span>
                )}
            </div>
        </>
    );
};

// ==========================================
// 2. í™ˆ í™”ë©´ (Mapper ì ìš©)
// ==========================================
const HomeView = ({ setView, searchTerm, setSearchTerm, siteConfig, navigate }) => {
    const [featuredTreatments, setFeaturedTreatments] = useState([]);
    const [featuredHospitals, setFeaturedHospitals] = useState([]);
    const [treatmentsError, setTreatmentsError] = useState(null);
    const [hospitalsError, setHospitalsError] = useState(null);

    useEffect(() => {
        const fetchFeatured = async () => {
            const locCol = getLocationColumn();
            
            // Fetch treatments with language-aware location
            const { data: tData, error: tError } = await supabase
                .from('treatments')
                .select(`*, hospitals(name, location:${locCol})`)
                .limit(4);
            
            if (tError) {
                console.error('[HomeView] Treatments fetch error:', tError);
                setTreatmentsError(tError);
            } else {
                setTreatmentsError(null);
                if(tData) setFeaturedTreatments(tData.map(mapTreatmentRow).filter(i => i));
            }

            // Fetch hospitals with language-aware location
            const { data: hData, error: hError } = await supabase
                .from('hospitals')
                .select(`*, location:${locCol}`)
                .limit(4);
            
            if (hError) {
                console.error('[HomeView] Hospitals fetch error:', hError);
                setHospitalsError(hError);
            } else {
                setHospitalsError(null);
                if(hData) setFeaturedHospitals(hData.map(mapHospitalRow).filter(i => i));
            }
        };
        fetchFeatured();
    }, []);

    return (
        <>
            {/* DEV: Component badge */}
            {import.meta.env.DEV && (
                <div className="fixed bottom-4 right-4 bg-yellow-400 text-black text-xs px-2 py-1 rounded z-50 font-mono">
                    HomeView.jsx | {Date.now()}
                </div>
            )}
            
            <HeroSection setView={setView} searchTerm={searchTerm} setSearchTerm={setSearchTerm} siteConfig={siteConfig} />
            
            <div>
                <CardListSection 
                    title="HEALO's Signature Collection" 
                    items={featuredTreatments} 
                    onCardClick={(id) => navigate(`/treatments/${id}`)} 
                    type="treatment" 
                />
                {/* DEV: Debug visibility */}
                {import.meta.env.DEV && (
                    <div className="max-w-6xl mx-auto px-4 mt-2">
                        {featuredTreatments.length === 0 && !treatmentsError && (
                            <p className="text-xs text-gray-500">No treatments loaded</p>
                        )}
                        {treatmentsError && (
                            <p className="text-xs text-red-500">Error: {treatmentsError.message}</p>
                        )}
                    </div>
                )}
            </div>
            
            <CardListSection 
                title="Official Medical Partners" 
                items={featuredHospitals} 
                onCardClick={(id) => navigate(`/hospitals/${id}`)} 
                type="hospital" 
            />
            {import.meta.env.DEV && (
                <div className="max-w-6xl mx-auto px-4 mt-2">
                    {featuredHospitals.length === 0 && !hospitalsError && (
                        <p className="text-xs text-gray-500">No hospitals loaded</p>
                    )}
                    {hospitalsError && (
                        <p className="text-xs text-red-500">Error: {hospitalsError.message}</p>
                    )}
                </div>
            )}
        </>
    );
};

// Wrapper Components (ê¸°ì¡´ ìœ ì§€)
const TreatmentDetailWrapper = ({ setView, setInquiryMode }) => {
  const { id } = useParams();
  const navigate = useNavigate();
  return <TreatmentDetailPage selectedId={id} setView={setView} setInquiryMode={setInquiryMode} onTreatmentClick={(tid) => navigate(`/treatments/${tid}`)} onHospitalClick={(hid) => navigate(`/hospitals/${hid}`)} />;
};

const HospitalDetailWrapper = ({ setView }) => {
  const { id } = useParams();
  const navigate = useNavigate();
  return <HospitalDetailPage selectedId={id} setView={setView} onTreatmentClick={(tid) => navigate(`/treatments/${tid}`)} />;
};

function AppContent() {
  const navigate = useNavigate();
  const location = useLocation();
  const toast = useToast(); // Toast ì‚¬ìš© ì¤€ë¹„
  const [session, setSession] = useState(null);
  const [inquiryMode, setInquiryMode] = useState('select');
  const [searchTerm, setSearchTerm] = useState('');
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
  const [siteConfig, setSiteConfig] = useState({ logo: '', hero: '' });
  const [simpleList, setSimpleList] = useState([]);

  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => setSession(session));
    const { data } = supabase.auth.onAuthStateChange((_event, session) => setSession(session));
    supabase.from("site_settings").select("*").single().then(({data}) => { if(data) setSiteConfig({ logo: data.logo_url, hero: data.hero_background_url }); });
    const locCol = getLocationColumn();
    supabase.from("treatments").select(`id, name, hospital_id, price_min, hospitals(name)`).then(({data, error}) => { 
        if (error) {
            console.error('[AppContent] Simple list fetch error:', error);
        } else if(data) {
            setSimpleList(data.map(t => ({ id: t.id, title: t.name, hospitalId: t.hospital_id, hospital: t.hospitals?.name, price: t.price_min ? `$${t.price_min}` : '' }))); 
        }
    });
    return () => { if(data?.subscription) data.subscription.unsubscribe(); };
  }, []);

  useEffect(() => { window.scrollTo(0, 0); }, [location.pathname]);

  const handleSetView = (viewName) => {
    setIsMobileMenuOpen(false);
    if(viewName === 'home') setSearchTerm('');
    switch(viewName) {
        case 'home': navigate('/'); break;
        case 'admin': navigate('/admin'); break;
        case 'list_treatment': navigate('/treatments'); break;
        case 'list_hospital': navigate('/hospitals'); break;
        case 'inquiry': navigate('/inquiry'); break;
        case 'login': navigate('/login'); break;
        case 'signup': navigate('/signup'); break;
        case 'success': navigate('/success'); break;
        default: navigate('/'); 
    }
  };

  const handleNavClick = (targetView) => { if(targetView !== 'list_treatment') setSearchTerm(''); handleSetView(targetView); };
  const handleLogout = async () => { await supabase.auth.signOut(); toast.success("Logged out successfully!"); navigate('/'); };
  const handleGlobalInquiry = () => { setInquiryMode('select'); navigate('/inquiry'); setIsMobileMenuOpen(false); };
  const handleInquiryClose = () => { navigate(-1); };
  const getCurrentView = () => { const path = location.pathname; if (path === '/') return 'home'; if (path.includes('treatments')) return 'list_treatment'; if (path.includes('hospitals')) return 'list_hospital'; return ''; };

  return (
    <div className="font-sans text-gray-800 bg-gray-50 min-h-screen relative">
      <Header setView={handleSetView} view={getCurrentView()} handleGlobalInquiry={handleGlobalInquiry} isMobileMenuOpen={isMobileMenuOpen} setIsMobileMenuOpen={setIsMobileMenuOpen} onNavClick={handleNavClick} session={session} onLogout={handleLogout} siteConfig={siteConfig} />
      
      {/* ğŸ”¥ ErrorBoundaryë¡œ ê°ì‹¸ì„œ ì•± ë³´í˜¸ */}
      <ErrorBoundary>
        <main className="pb-24">
            <Routes>
            <Route path="/" element={<><HomeView setView={handleSetView} searchTerm={searchTerm} setSearchTerm={setSearchTerm} siteConfig={siteConfig} navigate={navigate} /><div className="mt-10"><PersonalConciergeCTA onClick={handleGlobalInquiry} /></div></>} />
            <Route path="/admin" element={<AdminPage setView={handleSetView} />} />
            
            {/* ğŸ”¥ í•µì‹¬ ìˆ˜ì •: key={type} ì¶”ê°€ë¡œ íƒ­ ì „í™˜ ë²„ê·¸ í•´ê²° */}
            <Route path="/treatments" element={<><PaginatedList key="treatment" type="treatment" title="All Treatments" searchTerm={searchTerm} onCardClick={(id) => navigate(`/treatments/${id}`)} /><div className="mt-10"><PersonalConciergeCTA onClick={handleGlobalInquiry} /></div></>} />
            <Route path="/hospitals" element={<><PaginatedList key="hospital" type="hospital" title="Partner Hospitals" searchTerm={searchTerm} onCardClick={(id) => navigate(`/hospitals/${id}`)} /><div className="mt-10"><PersonalConciergeCTA onClick={handleGlobalInquiry} /></div></>} />
            
            <Route path="/treatments/:id" element={<TreatmentDetailWrapper setView={handleSetView} setInquiryMode={setInquiryMode} />} />
            <Route path="/hospitals/:id" element={<HospitalDetailWrapper setView={handleSetView} />} />
            <Route path="/inquiry" element={<InquiryPage setView={handleSetView} mode={inquiryMode} setMode={setInquiryMode} onClose={handleInquiryClose} treatments={simpleList} />} />
            <Route path="/login" element={<LoginPage setView={handleSetView} />} />
            <Route path="/signup" element={<SignUpPage setView={handleSetView} />} />
            <Route path="/success" element={<SuccessPage setView={handleSetView} />} />
            <Route path="*" element={<Navigate to="/" replace />} />
            </Routes>
        </main>
      </ErrorBoundary>

      {!location.pathname.includes('success') && (<><MobileBottomNav setView={handleSetView} view={getCurrentView()} onInquiry={handleGlobalInquiry} onNavClick={handleNavClick} /><div className="hidden md:block"><FloatingInquiryBtn onClick={handleGlobalInquiry} /></div></>)}
    </div>
  );
}

function App() { 
  return (
    <BrowserRouter>
      <ToastProvider>
        <AppContent />
      </ToastProvider>
    </BrowserRouter>
  ); 
}
export default App;
--- END OF FILE: .\src\App.jsx ---


--- START OF FILE: .\src\components.jsx ---
// src/components.jsx
import React, { useEffect, useRef, useState } from 'react';
import {
  Search, MapPin, Globe, Menu, Star, Zap, ChevronDown, CheckCircle,
  MessageCircle, X, ArrowRight, Stethoscope, Building2, Settings,
  FileText, UserCheck, Clock, ShieldCheck, Sparkles
} from 'lucide-react';

/**
 * ìœ í‹¸: ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
 */
const useOutsideClose = (isOpen, onClose) => {
  const ref = useRef(null);
  useEffect(() => {
    if (!isOpen) return;
    const handler = (e) => {
      if (!ref.current) return;
      if (!ref.current.contains(e.target)) onClose();
    };
    window.addEventListener('mousedown', handler);
    return () => window.removeEventListener('mousedown', handler);
  }, [isOpen, onClose]);
  return ref;
};

// --- 1. í—¤ë” ---
export const Header = ({ setView, view, handleGlobalInquiry, isMobileMenuOpen, setIsMobileMenuOpen, onNavClick, session, onLogout, siteConfig }) => {
  const [isLangOpen, setIsLangOpen] = useState(false);
  
  const getInitialLang = () => {
    if (typeof document === 'undefined') return 'ENG';
    const cookies = document.cookie.split(';');
    const langCookie = cookies.find(row => row.trim().startsWith('googtrans='));
    if (langCookie) {
        const langCode = langCookie.split('=')[1].split('/').pop();
        if (langCode === 'ko') return 'KOR';
        if (langCode === 'zh-CN') return 'CHN';
        if (langCode === 'ja') return 'JPN';
    }
    return 'ENG';
  };

  const [currentLang, setCurrentLang] = useState(getInitialLang());
  const isAdmin = session?.user?.email === 'admin@healo.com';

  const handleLanguageChange = (langLabel) => {
      let googleLangCode = 'en';
      switch (langLabel) {
          case 'KOR': googleLangCode = 'ko'; break;
          case 'CHN': googleLangCode = 'zh-CN'; break;
          case 'JPN': googleLangCode = 'ja'; break;
          default: googleLangCode = 'en';
      }
      document.cookie = `googtrans=/en/${googleLangCode}; path=/; domain=${window.location.hostname}`;
      document.cookie = `googtrans=/en/${googleLangCode}; path=/;`;
      setCurrentLang(langLabel);
      setIsLangOpen(false);
      window.location.reload();
  };

  // í™œì„± íƒ­ ìŠ¤íƒ€ì¼ë§
  const getNavLinkClass = (targetView) => {
      const isActive = String(view).includes(targetView);
      return `text-sm font-bold transition px-3 py-1.5 rounded-full ${isActive ? 'bg-white/10 text-white shadow-sm ring-1 ring-white/20' : 'text-white/80 hover:text-white'}`;
  };

  return (
    <>
      <header className="bg-teal-600 text-white sticky top-0 z-50 shadow-sm border-b border-teal-500">
        <div className="max-w-6xl mx-auto px-4 h-14 md:h-16 relative flex items-center justify-between">
          
          <div className="flex items-center cursor-pointer gap-3 z-20" onClick={() => onNavClick('home')}>
            {siteConfig?.logo ? (
                <img src={siteConfig.logo} alt="HEALO" className="h-8 md:h-10 object-contain" />
            ) : (
                <span className="text-xl md:text-2xl font-extrabold tracking-tight notranslate">HEALO</span>
            )}
            <span className="hidden lg:block text-xs text-teal-100 font-light uppercase tracking-widest border-l border-teal-400/60 pl-3">
              AI Medical Concierge
            </span>
          </div>

          {!isAdmin && (
            <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 hidden md:block z-30 pointer-events-auto">
              <button onClick={handleGlobalInquiry} className="flex items-center gap-2 text-sm font-extrabold bg-white text-teal-700 px-6 py-2 rounded-full hover:bg-teal-50 transition shadow-md ring-2 ring-teal-600/20">
                <Zap size={16} className="text-teal-600 fill-teal-600" /> Get Free Treatment Plan
              </button>
            </div>
          )}

          <div className="ml-auto hidden md:flex items-center z-20">
            <div className="flex items-center gap-4 pl-6">
              <nav className="flex items-center gap-2">
                <button onClick={() => onNavClick('list_treatment')} className={getNavLinkClass('treatment')}>Treatments</button>
                <button onClick={() => onNavClick('list_hospital')} className={getNavLinkClass('hospital')}>Hospitals</button>
              </nav>
              <div className="w-px h-5 bg-white/20" />
              <div className="flex items-center gap-4">
                {session ? (
                  <>
                    <span className="text-xs font-bold text-teal-100">Hi, {session.user.email.split('@')[0]}</span>
                    <button onClick={onLogout} className="text-sm font-bold text-white/80 hover:text-red-200 transition">Log Out</button>
                  </>
                ) : (
                  <>
                    <button onClick={() => setView('login')} className="text-sm font-bold text-white/80 hover:text-white transition">Log In</button>
                    <button onClick={() => setView('signup')} className="text-sm font-bold text-white/80 hover:text-white transition">Sign Up</button>
                  </>
                )}
              </div>
              <div className="w-px h-5 bg-white/20" />
              
              <div className="relative">
                <button onClick={() => setIsLangOpen(!isLangOpen)} className="flex items-center gap-1 text-white/80 hover:text-white text-sm font-bold transition notranslate">
                  <Globe size={16} className="opacity-90" />
                  <span>{currentLang}</span>
                  <ChevronDown size={14} className={`opacity-80 transition ${isLangOpen ? 'rotate-180' : ''}`} />
                </button>
                {isLangOpen && (
                  <>
                    <div className="absolute right-0 mt-2 w-32 bg-white rounded-xl shadow-xl border border-gray-100 overflow-hidden z-50 py-1 text-gray-800 notranslate">
                      <button onClick={() => handleLanguageChange('ENG')} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 flex justify-between">ENG {currentLang==='ENG' && <CheckCircle size={12}/>}</button>
                      <button onClick={() => handleLanguageChange('KOR')} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 flex justify-between">KOR {currentLang==='KOR' && <CheckCircle size={12}/>}</button>
                      <button onClick={() => handleLanguageChange('CHN')} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 flex justify-between">CHN {currentLang==='CHN' && <CheckCircle size={12}/>}</button>
                      <button onClick={() => handleLanguageChange('JPN')} className="w-full text-left px-4 py-2 text-sm hover:bg-gray-50 flex justify-between">JPN {currentLang==='JPN' && <CheckCircle size={12}/>}</button>
                    </div>
                    <div className="fixed inset-0 z-40 bg-transparent" onClick={() => setIsLangOpen(false)} />
                  </>
                )}
              </div>
              {isAdmin && (
                <>
                  <div className="w-px h-5 bg-white/20" />
                  <button onClick={() => setView('admin')} className="text-white/80 hover:text-white transition p-1 rounded-full hover:bg-white/10" title="Admin Settings"><Settings size={20} /></button>
                </>
              )}
            </div>
          </div>

          <div className="md:hidden flex items-center gap-3 z-20">
             <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)} className="text-white">
               {isMobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
             </button>
          </div>
        </div>
      </header>
      
      {isMobileMenuOpen && (
        <div className="fixed inset-0 z-[100] flex justify-end">
           <div className="absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in" onClick={() => setIsMobileMenuOpen(false)}></div>
           <div className="relative w-[80%] max-w-[300px] h-full bg-white shadow-2xl p-6 flex flex-col animate-in slide-in-from-right duration-300">
              <div className="flex justify-between items-center mb-8 border-b border-gray-100 pb-4">
                 <span className="text-xl font-extrabold text-teal-600 notranslate">HEALO</span>
                 <button onClick={() => setIsMobileMenuOpen(false)} className="p-2 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200"><X size={20}/></button>
              </div>
              <nav className="flex flex-col gap-4 text-lg font-bold text-gray-800">
                 <div className="flex gap-2 mb-4 notranslate">
                    <button onClick={() => handleLanguageChange('ENG')} className={`px-3 py-1 rounded-lg border text-xs ${currentLang==='ENG'?'bg-teal-600 text-white':'text-gray-500'}`}>ENG</button>
                    <button onClick={() => handleLanguageChange('KOR')} className={`px-3 py-1 rounded-lg border text-xs ${currentLang==='KOR'?'bg-teal-600 text-white':'text-gray-500'}`}>KOR</button>
                    <button onClick={() => handleLanguageChange('CHN')} className={`px-3 py-1 rounded-lg border text-xs ${currentLang==='CHN'?'bg-teal-600 text-white':'text-gray-500'}`}>CHN</button>
                    <button onClick={() => handleLanguageChange('JPN')} className={`px-3 py-1 rounded-lg border text-xs ${currentLang==='JPN'?'bg-teal-600 text-white':'text-gray-500'}`}>JPN</button>
                 </div>
                 {isAdmin && <button onClick={() => { setView('admin'); setIsMobileMenuOpen(false); }} className="text-left py-3 px-4 bg-gray-900 text-white rounded-lg flex items-center gap-2 mb-2"><Settings size={18}/> Admin Settings</button>}
                 <button onClick={() => onNavClick('list_treatment')} className="text-left py-2 flex items-center justify-between">Treatments <ArrowRight size={16} className="text-gray-300"/></button>
                 <button onClick={() => onNavClick('list_hospital')} className="text-left py-2 flex items-center justify-between">Hospitals <ArrowRight size={16} className="text-gray-300"/></button>
                 <hr className="border-gray-100 my-2"/>
                 {session ? (
                   <>
                     <div className="text-sm text-gray-500 py-1">Hi, {session.user.email.split('@')[0]}</div>
                     <button onClick={() => { onLogout(); setIsMobileMenuOpen(false); }} className="text-left py-2 text-red-500 hover:text-red-700">Log Out</button>
                   </>
                 ) : (
                   <>
                     <button onClick={() => { setView('login'); setIsMobileMenuOpen(false); }} className="text-left py-2 text-gray-500 hover:text-teal-600">Log In</button>
                     <button onClick={() => { setView('signup'); setIsMobileMenuOpen(false); }} className="text-left py-2 text-gray-500 hover:text-teal-600">Sign Up</button>
                   </>
                 )}
              </nav>
           </div>
        </div>
      )}
    </>
  );
};

// --- 2. íˆì–´ë¡œ ì„¹ì…˜ ---
export const HeroSection = ({ setView, searchTerm, setSearchTerm, siteConfig }) => {
  return (
    <section className="relative mb-12">
      <div className="relative pt-12 pb-16 md:pt-24 md:pb-20 text-center overflow-hidden bg-teal-900">
        <div className="absolute inset-0 z-0">
          <img 
            src={siteConfig?.hero || "https://images.unsplash.com/photo-1538108149393-fbbd81895907?auto=format&fit=crop&q=80&w=2000"} 
            alt="Hero Background" 
            className="w-full h-full object-cover opacity-60" 
          />
          <div className="absolute inset-0 bg-gradient-to-b from-teal-950/80 via-teal-900/60 to-teal-800/90 mix-blend-multiply"></div>
        </div>
        <div className="relative z-10 max-w-5xl mx-auto px-4 flex flex-col items-center">
            <h1 className="text-3xl md:text-5xl lg:text-6xl font-extrabold text-white mb-3 leading-tight drop-shadow-lg tracking-tight">
              Find the Best Hospital in Korea<br className="hidden md:block"/> 
              <span className="text-teal-200">in 30 Seconds.</span>
            </h1>
            <p className="text-teal-50 text-sm md:text-lg max-w-2xl mx-auto font-medium opacity-90 drop-shadow-md">
              AI compares treatments, doctors, and prices so you don't have to.<br className="hidden md:block"/>
              Your personal medical concierge service.
            </p>
        </div>
      </div>
      <div className="relative z-20 max-w-2xl mx-auto px-4 -mt-8 md:-mt-10">
        <div className="bg-white p-2 md:p-2.5 rounded-full shadow-2xl flex items-center border border-gray-100">
            <Search className="text-teal-600 ml-3 md:ml-4 shrink-0" size={20} />
            <input
            type="text"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            placeholder="Try searching for 'Stem Cell'..."
            className="flex-1 p-3 md:p-4 text-gray-800 placeholder-gray-400 outline-none bg-transparent text-sm md:text-lg min-w-0 font-medium"
            onKeyDown={(e) => e.key === 'Enter' && setView('list_treatment')}
            />
            <button
            onClick={() => setView('list_treatment')}
            className="bg-teal-600 text-white px-5 md:px-8 py-2.5 md:py-3.5 rounded-full font-bold text-sm md:text-base hover:bg-teal-700 transition shadow-lg shrink-0"
            >
            Search
            </button>
        </div>
      </div>
    </section>
  );
};

// --- 3. ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ ---
export const CardListSection = ({ title, items, onCardClick, type }) => (
  <section className="max-w-6xl mx-auto px-4 py-8">
    <h2 className="text-xl md:text-2xl font-extrabold text-gray-900 mb-6">{title}</h2>

    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
      {items.map((item) => (
        <div
          key={item.id}
          onClick={() => onCardClick(item.id)}
          className="bg-white border border-gray-100 rounded-2xl md:rounded-3xl overflow-hidden shadow-sm hover:shadow-xl hover:border-teal-500 transition-all duration-300 cursor-pointer group flex flex-row h-36 md:h-56"
        >
          <div className="w-40 md:w-auto md:h-full md:aspect-square relative bg-gray-200 overflow-hidden shrink-0">
            <img
              src={type === 'hospital' ? item.images?.[0] : item.images?.[0]} 
              onError={(e) => e.target.src = `https://placehold.co/600x600?text=${type}`}
              className="w-full h-full object-cover group-hover:scale-105 transition duration-500"
              alt="img"
            />
          </div>
          <div className="flex-1 p-3 md:p-5 flex flex-col justify-between min-w-0">
            <div>
              {type === 'hospital' ? (
                <div className="flex items-center gap-2 mb-1">
                  <h3 className="font-extrabold text-sm md:text-lg text-gray-900 line-clamp-1 group-hover:text-teal-600 transition">
                    {item.name}
                  </h3>
                </div>
              ) : (
                <>
                  <div className="flex justify-between items-start mb-0.5">
                    <p className="text-[10px] font-extrabold text-gray-400 uppercase tracking-wider truncate">
                      {item.hospital}
                    </p>
                  </div>
                  <h3 className="font-extrabold text-base md:text-lg text-gray-900 mb-1 line-clamp-2 md:line-clamp-1 leading-snug group-hover:text-teal-600 transition">
                    {item.title}
                  </h3>
                </>
              )}
              {item.tags && (
                <div className="flex flex-wrap gap-1 mb-1 md:mb-3">
                  {item.tags.slice(0, 2).map((tag, idx) => (
                    <span key={idx} className="text-[9px] md:text-[10px] bg-teal-50 text-teal-700 px-1.5 py-0.5 rounded font-extrabold">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
              <div className="hidden md:block text-xs text-gray-500 line-clamp-2 leading-relaxed">
                {type === 'hospital' ? item.description : item.desc}
              </div>
            </div>
            <div className="pt-2 mt-auto border-t border-gray-50 flex items-end justify-between">
              {type === 'treatment' ? (
                <div>
                  <p className="hidden md:block text-[10px] text-gray-400 uppercase font-extrabold">Est. Price</p>
                  <p className="text-teal-700 font-black text-sm md:text-sm">{item.price}</p>
                </div>
              ) : (
                <div className="flex items-start gap-1 text-[10px] md:text-xs text-gray-500 mr-2">
                  <MapPin size={10} className="md:w-3 md:h-3 mt-0.5" />
                  <span className="line-clamp-2 whitespace-normal">
                    {item.location}
                    {item.address_detail ? `, ${item.address_detail}` : ''}
                  </span>
                </div>
              )}
              <div className="flex items-center gap-1 text-xs font-extrabold text-gray-900 shrink-0">
                <Star size={10} className="md:w-3 md:h-3 text-yellow-400 fill-yellow-400" /> {item.rating}
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </section>
);

// --- 4. í”Œë¡œíŒ… ë²„íŠ¼ ë° ê¸°íƒ€ ---
export const FloatingInquiryBtn = ({ onClick }) => (
    <div className="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-2 group cursor-pointer" onClick={onClick}>
      <div className="bg-white text-gray-800 text-xs font-extrabold px-3 py-2 rounded-xl shadow-md border border-gray-100 mb-1 animate-bounce">
        Need Help? ğŸ’¬
      </div>
      <button className="w-14 h-14 bg-teal-600 hover:bg-teal-700 text-white rounded-full shadow-2xl flex items-center justify-center transition-transform transform hover:scale-110 active:scale-95 relative">
        <MessageCircle size={28} fill="currentColor" className="text-teal-100" />
        <span className="absolute top-0 right-0 w-4 h-4 bg-red-500 border-2 border-white rounded-full"></span>
      </button>
    </div>
);

export const PersonalConciergeCTA = ({
  title = "Find the right treatment for you.",
  subtitle = "Get a free, personalized treatment plan â€” tailored to your goals and budget.",
  badge = "PERSONAL CONCIERGE",
  buttonText = "Get My Free Plan",
  onClick,
  className = "",
}) => (
    <section className={`max-w-6xl mx-auto px-4 ${className}`}>
      <div className="rounded-3xl border border-teal-100 bg-teal-50/50 p-6 md:p-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4 text-center md:text-left">
        <div className="min-w-0">
          <div className="flex items-center justify-center md:justify-start gap-2 text-teal-700 text-xs font-extrabold tracking-widest">
            <span className="inline-flex items-center justify-center w-6 h-6 rounded-full bg-teal-100">âœ¨</span>
            <span>{badge}</span>
          </div>
          <h3 className="mt-3 text-2xl md:text-3xl font-extrabold text-gray-900">{title}</h3>
          <p className="mt-2 text-gray-700 text-sm md:text-base text-balance leading-relaxed">{subtitle}</p>
        </div>
        <div className="shrink-0 mt-2 md:mt-0">
          <button onClick={onClick} className="w-full md:w-auto px-8 py-4 rounded-full bg-teal-600 text-white font-extrabold shadow-lg hover:bg-teal-700 transition">
            {buttonText}
          </button>
        </div>
      </div>
    </section>
);

export const MobileBottomNav = ({ setView, view, onInquiry, onNavClick }) => (
    <div className="md:hidden fixed bottom-0 left-0 right-0 z-[80] bg-white border-t border-gray-200 pb-safe-area shadow-[0_-4px_10px_rgba(0,0,0,0.03)]">
      <div className="grid grid-cols-3 h-16 items-center relative">
        <button onClick={() => onNavClick('list_treatment')} className={`flex flex-col items-center justify-center gap-1 h-full w-full active:scale-95 transition ${String(view).includes('treatment') ? 'text-teal-600' : 'text-gray-400 hover:text-gray-600'}`}>
            <Stethoscope size={24} strokeWidth={String(view).includes('treatment') ? 2.5 : 2} />
            <span className="text-[10px] font-bold">Treatments</span>
        </button>
        <div className="relative flex justify-center h-full pointer-events-none"> 
           <button onClick={onInquiry} className="pointer-events-auto absolute -top-5 flex flex-col items-center group">
              <div className="w-14 h-14 rounded-full bg-teal-600 shadow-lg shadow-teal-100 flex items-center justify-center text-white mb-1 transform group-active:scale-95 transition border-[3px] border-white">
                  <MessageCircle size={24} fill="currentColor" className="text-white" />
              </div>
              <span className="text-[10px] font-bold text-teal-700">Inquiry</span>
           </button>
        </div>
        <button onClick={() => onNavClick('list_hospital')} className={`flex flex-col items-center justify-center gap-1 h-full w-full active:scale-95 transition ${String(view).includes('hospital') ? 'text-teal-600' : 'text-gray-400 hover:text-gray-600'}`}>
            <Building2 size={24} strokeWidth={String(view).includes('hospital') ? 2.5 : 2} />
            <span className="text-[10px] font-bold">Hospitals</span>
        </button>
      </div>
    </div>
);

// ğŸ”¥ [NEW] 5. ì˜¤í¼ ë°°ë„ˆ (Offer Banner) - ê°€ì§œ ë¦¬ë·° ëŒ€ì‹  ì‚¬ìš©í•  ì‹ ë¢° ì¥ì¹˜
export const OfferBanner = ({ onClick }) => (
  <div className="bg-teal-50 border border-teal-100 rounded-2xl p-5 mb-8">
    <h4 className="text-sm font-bold text-teal-900 mb-4 uppercase tracking-wider flex items-center gap-2">
      <Sparkles size={16} className="text-teal-600"/> Why book with HEALO?
    </h4>
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div className="flex items-start gap-3">
        <div className="p-2 bg-white rounded-lg shadow-sm text-teal-600"><FileText size={20}/></div>
        <div>
          <div className="font-bold text-sm text-gray-900">Free Comparison</div>
          <div className="text-xs text-gray-500 mt-0.5">Get 3 quotes from top clinics.</div>
        </div>
      </div>
      <div className="flex items-start gap-3">
        <div className="p-2 bg-white rounded-lg shadow-sm text-teal-600"><UserCheck size={20}/></div>
        <div>
          <div className="font-bold text-sm text-gray-900">Full Concierge</div>
          <div className="text-xs text-gray-500 mt-0.5">Translation & pickup included.</div>
        </div>
      </div>
      <div className="flex items-start gap-3">
        <div className="p-2 bg-white rounded-lg shadow-sm text-teal-600"><Clock size={20}/></div>
        <div>
          <div className="font-bold text-sm text-gray-900">Fast Response</div>
          <div className="text-xs text-gray-500 mt-0.5">Average reply within 1 hour.</div>
        </div>
      </div>
    </div>
    <button onClick={onClick} className="w-full mt-5 py-3 bg-teal-600 text-white rounded-xl font-bold text-sm shadow-md hover:bg-teal-700 transition flex items-center justify-center gap-2">
      Get My Free Quote Now <ArrowRight size={16}/>
    </button>
  </div>
);

// ğŸ”¥ [NEW] 6. í”„ë¡œì„¸ìŠ¤ ìŠ¤í… (Process Steps) - ë§‰ì—°í•œ ë¶ˆì•ˆê° í•´ì†Œ
export const ProcessSteps = () => (
  <div className="py-6 border-t border-gray-100">
    <h3 className="text-lg font-bold text-gray-900 mb-6">How it works</h3>
    <div className="grid grid-cols-4 gap-2 relative">
      {/* ì—°ê²°ì„  (PCì—ì„œë§Œ) */}
      <div className="hidden md:block absolute top-4 left-0 right-0 h-0.5 bg-gray-100 -z-10 translate-y-2"></div>
      
      {[
        { step: 1, title: "Inquiry", icon: FileText },
        { step: 2, title: "Matching", icon: Search },
        { step: 3, title: "Travel", icon: Globe },
        { step: 4, title: "Care", icon: ShieldCheck }
      ].map((s, i) => (
        <div key={i} className="flex flex-col items-center text-center">
          <div className="w-12 h-12 rounded-full bg-white border-2 border-teal-500 text-teal-600 flex items-center justify-center font-bold text-lg shadow-sm mb-2 z-10">
            <s.icon size={20} />
          </div>
          <div className="text-xs font-bold text-gray-900">{s.title}</div>
        </div>
      ))}
    </div>
  </div>
);

export { SEO } from './components/SEO';
--- END OF FILE: .\src\components.jsx ---


--- START OF FILE: .\src\data.js ---
// src/data.js
import { LayoutGrid, Sparkles, Sun, ScanLine } from 'lucide-react';

// --- ë³‘ì› ë°ì´í„° (IDê°€ ê¸°ì¤€ì´ ë©ë‹ˆë‹¤) ---
export const INITIAL_HOSPITALS = [
    {
      id: 'h1',
      name: 'Immune Hospital',
      dept: 'Cancer & Immunity',
      description: 'A specialized medical center focusing on post-op immunity recovery and integrative cancer treatments using Korean traditional medicine.',
      location: 'Gangnam, Seoul',
      rating: 4.9,
      reviews: 128,
      doctors: 29,
      established: '2005',
      languages: ['ENG', 'JPN', 'CHN'],
      doctorProfile: {
          name: 'Dr. Kim Seok-Min',
          title: 'Chief Medical Director',
          image: 'https://placehold.co/200x200/0d9488/ffffff?text=Dr.Kim',
          years: '20+',
          school: 'Kyung Hee Univ.',
          specialties: ['Immunity Care', 'Post-Op Rehab', 'Integrative Medicine'],
          heroMetric: { value: '3,000+', label: 'Rehab Cases' }
      },
      tags: ['Cancer Care', 'Immunity', 'Rehab'],
      images: ['https://placehold.co/1200x600/0d9488/ffffff?text=Immune+Hospital+Facility'],
      logo: 'https://placehold.co/100x100/0d9488/ffffff?text=IH'
    },
    {
      id: 'h2',
      name: 'Grand Plastic Surgery',
      dept: 'Plastic Surgery',
      description: 'Koreaâ€™s premier plastic surgery clinic renowned for natural-looking results and celebrity makeovers.',
      location: 'Sinsa, Seoul',
      rating: 4.8,
      reviews: 850,
      doctors: 15,
      established: '2012',
      languages: ['ENG', 'CHN', 'THA'],
      doctorProfile: {
          name: 'Dr. Park',
          title: 'Plastic Surgery Specialist',
          image: 'https://placehold.co/200x200/db2777/ffffff?text=Dr.Park',
          years: '15+',
          school: 'Seoul Natâ€™l Univ.',
          specialties: ['Rhinoplasty', 'Anti-Aging', 'Facial Contour'],
          heroMetric: { value: '10,000+', label: 'Successful Cases' }
      },
      tags: ['Anti-Aging', 'Facial Contour', 'Body'],
      images: ['https://placehold.co/1200x600/db2777/ffffff?text=Grand+PS+Facility'],
      logo: 'https://placehold.co/100x100/db2777/ffffff?text=GP'
    }
  ];
  
  export const TREATMENTS = [
    {
      id: 't1',
      hospitalId: 'h1',
      hospital: 'Immune Hospital',
      title: 'High-frequency Hyperthermia',
      desc: 'Selectively targets heat-sensitive cancer cells to boost immunity.',
      fullDescription: 'High-frequency hyperthermia treatment raises the body temperature to 42Â°C to selectively target heat-sensitive cancer cells without damaging normal tissue. It is highly effective when combined with immunotherapy.',
      price: '$300+',
      rating: 4.9,
      tags: ['CancerCare', 'Immunity'],
      images: ['https://placehold.co/600x400?text=Hyperthermia'],
      benefits: ['Non-invasive', 'Boosts Immunity', 'Synergy with Chemo'],
      logo: 'https://placehold.co/100x100/0d9488/ffffff?text=IH'
    },
    {
      id: 't2',
      hospitalId: 'h1',
      hospital: 'Immune Hospital',
      title: 'Facial Paralysis Care',
      desc: 'Integrative acupuncture and herbal therapy for nerve restoration.',
      fullDescription: 'A comprehensive program combining traditional acupuncture, herbal medicine, and modern physical therapy to restore facial nerve function and relieve muscle stiffness.',
      price: '$150 - $250',
      rating: 4.8,
      tags: ['Rehab', 'Acupuncture'],
      images: ['https://placehold.co/600x400?text=Facial+Rehab'],
      benefits: ['Natural Recovery', 'Nerve Stimulation', 'Pain Relief'],
      logo: 'https://placehold.co/100x100/0d9488/ffffff?text=IH'
    },
    {
      id: 't3',
      hospitalId: 'h1',
      hospital: 'Immune Hospital',
      title: 'Post-op Immunity Rehab',
      desc: 'Intensive recovery program after major surgery or chemotherapy.',
      fullDescription: 'Designed for patients recovering from surgery or chemotherapy. Focuses on rebuilding the immune system through diet, herbal medicine, and physical therapy.',
      price: '$500+',
      rating: 5.0,
      tags: ['PostOp', 'Recovery'],
      images: ['https://placehold.co/600x400?text=Immunity+Rehab'],
      benefits: ['Fast Recovery', 'Detox', 'Energy Boost'],
      logo: 'https://placehold.co/100x100/0d9488/ffffff?text=IH'
    },
    {
      id: 't4',
      hospitalId: 'h2',
      hospital: 'Grand Plastic Surgery',
      title: 'Premium Ulthera Lifting',
      desc: 'Non-surgical face lifting using FDA-approved ultrasound technology.',
      fullDescription: 'Ulthera is a non-invasive lifting procedure that uses ultrasound energy to stimulate collagen production deep within the skin, providing a natural lifting effect.',
      price: '$1,200',
      rating: 4.7,
      tags: ['AntiAging', 'Lifting'],
      images: ['https://placehold.co/600x400?text=Ulthera'],
      benefits: ['No Downtime', 'FDA Approved', 'Long-lasting'],
      logo: 'https://placehold.co/100x100/db2777/ffffff?text=GP'
    }
  ];
  
export const REVIEWS_DATA = [
  { id: 1, name: "Sarah J.", country: "US", rating: 5, content: "The coordinator was very helpful. My shoulder pain is gone after the treatment!", date: "Oct 2023", helpful: 12 },
  { id: 2, name: "Kenji T.", country: "JP", rating: 5, content: "Clean facility and kind staff. Felt very safe. The result is amazing.", date: "Sep 2023", helpful: 8 },
  { id: 3, name: "Elena K.", country: "RU", rating: 5, content: "Great service. The results exceeded my expectations.", date: "Nov 2023", helpful: 4 },
];

export const PRIVACY_CONTENT = `
[Privacy Policy for HEALO]

Effective Date: October 31, 2025

1. Introduction
Bonroy Inc. (hereinafter referred to as the â€œCompanyâ€, provider of "HEALO" service) values your privacy and protects your personal information in compliance with the Personal Information Protection Act of the Republic of Korea.

2. Information We Collect
To provide our AI Medical Concierge services, we collect the following:
- Required: Name, Email, Password, Nationality.
- Optional: Health data (symptoms, desired procedures), Past medical records (for consultation purposes).
* We do not collect sensitive data without your explicit consent.

3. Purpose of Collection
- To verify identity and manage membership.
- To provide AI-based medical recommendations and hospital matching services.
- To process bookings and payments for medical procedures.

4. Sharing of Information
We only share your data with:
- Partner Hospitals: For medical consultation and booking confirmation (only with your consent).
- Payment Gateways: To process service fees or deposits.
We never sell your data to third parties for advertising purposes.

5. Data Retention
We retain your personal data only as long as necessary to provide our services or as required by law. You may request deletion of your account at any time via contact@healo.com.

6. Security
We use industry-standard encryption (SSL) and secure servers to protect your data. However, no transmission over the internet is 100% secure.

7. Contact Us
If you have any questions, please contact our Data Protection Officer at:
Email: contact@healo.com
Address: Seoul, Republic of Korea
`;

export const TERMS_CONTENT = `
[Terms of Service for HEALO]

Effective Date: October 31, 2025

1. Introduction
Welcome to HEALO. These Terms of Service govern your use of the HEALO website and AI Medical Concierge services operated by Bonroy Inc.

2. Nature of Service (Intermediary Role)
HEALO is a platform that connects international patients with medical institutions in Korea using AI technology.
- IMPORTANT: HEALO is NOT a medical provider. We do not provide medical advice, diagnosis, or treatment.
- The ultimate decision and responsibility for any medical procedure lie solely between the User and the Medical Institution.

3. Booking & Payments
- A deposit (typically 10% of the estimated cost) may be required to secure your appointment.
- Cancellations made 72 hours prior to the appointment are eligible for a full refund of the deposit. Cancellations made within 72 hours may be subject to penalties.

4. User Responsibilities
- You must provide accurate and up-to-date information regarding your health condition.
- You agree to comply with the hospital's policies and Korean laws during your visit.

5. Limitation of Liability
Bonroy Inc. is not liable for:
- Medical outcomes, side effects, or malpractice by the partner hospitals.
- Disputes arising directly between the User and the Hospital.
- Issues caused by false information provided by the User.

6. Intellectual Property
All content on HEALO (logos, text, AI algorithms, designs) is the property of Bonroy Inc. and is protected by copyright laws.

7. Governing Law & Jurisdiction
These Terms shall be governed by the laws of the Republic of Korea. Any disputes shall be resolved exclusively by the Seoul Central District Court.

8. Contact
For support or inquiries: contact@healo.com
`;
--- END OF FILE: .\src\data.js ---


--- START OF FILE: .\src\index.css ---
/* index.css */
@tailwind base;
@tailwind components;
@tailwind utilities;

html {
  scrollbar-gutter: stable;
}

/* ğŸ”¥ [ì¶”ê°€] ë²ˆì—­ ì‹œ í°íŠ¸ ê¹¨ì§ ë°©ì§€ (í”„ë¦¬í…ë‹¤ë“œ/ì‹œìŠ¤í…œ í°íŠ¸ ìš°ì„ ) */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
}

/* ë²ˆì—­ëœ í…ìŠ¤íŠ¸ë„ ì´ í°íŠ¸ ë”°ë¼ê°€ê²Œ ê°•ì œ */
font {
  font-family: inherit !important;
}
--- END OF FILE: .\src\index.css ---


--- START OF FILE: .\src\main.jsx ---
// src/main.jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
--- END OF FILE: .\src\main.jsx ---


--- START OF FILE: .\src\pages.jsx ---
export { TreatmentDetailPage } from './pages/TreatmentDetailPage';
export { HospitalDetailPage } from './pages/HospitalDetailPage';
export { InquiryPage } from './pages/InquiryPage';
export { SuccessPage, LoginPage, SignUpPage } from './pages/AuthPages';

--- END OF FILE: .\src\pages.jsx ---


--- START OF FILE: .\src\supabase.js ---
// src/supabase.js
import { createClient } from '@supabase/supabase-js';

// 1. Project URL
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;

// 2. Publishable Key 
const supabaseKey = import.meta.env.VITE_SUPABASE_KEY;

// í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ (í”„ë¡œë•ì…˜ ë°°í¬ ì „ í•„ìˆ˜)
if (!supabaseUrl || !supabaseKey) {
  const missing = [];
  if (!supabaseUrl) missing.push('VITE_SUPABASE_URL');
  if (!supabaseKey) missing.push('VITE_SUPABASE_KEY');
  
  throw new Error(
    `âŒ Supabase í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!\n` +
    `ëˆ„ë½ëœ ë³€ìˆ˜: ${missing.join(', ')}\n` +
    `í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— .env íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒì„ ì¶”ê°€í•˜ì„¸ìš”:\n` +
    `VITE_SUPABASE_URL=your_url\n` +
    `VITE_SUPABASE_KEY=your_key`
  );
}

export const supabase = createClient(supabaseUrl, supabaseKey);
--- END OF FILE: .\src\supabase.js ---


--- START OF FILE: .\src\components\AddressInput.jsx ---
// src/components/AddressInput.jsx
// Daum Postcode ê¸°ë°˜ ì£¼ì†Œ ì…ë ¥ (ê´€ë¦¬ììš©)

import React, { useState } from 'react';
import DaumPostcode from 'react-daum-postcode';
import { MapPin, X } from 'lucide-react';

export const AddressInput = ({
  value,
  onChange,
  onLocationSelect, // { koAddress, enAddress, zonecode } ì „ë‹¬
  placeholder = "í•œêµ­ì–´ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123)",
}) => {
  const [isOpen, setIsOpen] = useState(false);

  const handleComplete = (data) => {
    const koAddress = data.address || '';
    const enAddress = data.addressEnglish || '';
    const zonecode = data.zonecode || '';

    onChange?.(koAddress);
    onLocationSelect?.({ koAddress, enAddress, zonecode });
    setIsOpen(false);
  };

  return (
    <div className="space-y-2">
      <div className="relative">
        <MapPin className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" size={18} />
        <input
          type="text"
          value={value}
          onChange={(e) => onChange(e.target.value)}
          placeholder={placeholder}
          className="w-full pl-10 pr-20 py-2.5 border border-gray-200 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none transition text-sm"
        />
        <div className="absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1">
          {value && (
            <button
              type="button"
              onClick={() => onChange('')}
              className="p-1 text-gray-400 hover:text-gray-600"
            >
              <X size={16} />
            </button>
          )}
          <button
            type="button"
            onClick={() => setIsOpen(true)}
            className="text-xs font-bold text-teal-600 px-2 py-1 rounded border border-teal-200 hover:bg-teal-50 transition"
          >
            ê²€ìƒ‰
          </button>
        </div>
      </div>

      {isOpen && (
        <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/40 p-4">
          <div className="bg-white rounded-2xl shadow-xl w-full max-w-lg overflow-hidden">
            <div className="flex items-center justify-between px-4 py-3 border-b border-gray-100">
              <h4 className="text-sm font-bold text-gray-700">ì£¼ì†Œ ê²€ìƒ‰</h4>
              <button
                type="button"
                onClick={() => setIsOpen(false)}
                className="p-1 text-gray-400 hover:text-gray-600"
              >
                <X size={18} />
              </button>
            </div>
            <div className="p-3">
              <DaumPostcode onComplete={handleComplete} style={{ width: '100%', height: '420px' }} />
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

--- END OF FILE: .\src\components\AddressInput.jsx ---


--- START OF FILE: .\src\components\ErrorBoundary.jsx ---
// src/components/ErrorBoundary.jsx
import React from 'react';

class ErrorBoundary extends React.Component {
  constructor(props) {
    super(props);
    this.state = { hasError: false };
  }

  static getDerivedStateFromError(error) {
    return { hasError: true };
  }

  componentDidCatch(error, errorInfo) {
    console.error("Uncaught error:", error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <div className="p-10 text-center">Something went wrong. Please refresh.</div>;
    }
    return this.props.children;
  }
}

export default ErrorBoundary; // ğŸ”¥ ì´ ì¤„ì´ í•„ìˆ˜ì…ë‹ˆë‹¤!
--- END OF FILE: .\src\components\ErrorBoundary.jsx ---


--- START OF FILE: .\src\components\GoogleMap.jsx ---
// src/components/GoogleMap.jsx
import React, { useMemo, useState } from 'react';
import { GoogleMap, LoadScript, Marker } from '@react-google-maps/api';
import { Loader2 } from 'lucide-react';

const containerStyle = {
  width: '100%',
  height: '100%',
  minHeight: '200px',
};

// ì„œìš¸ ê¸°ë³¸ ì¢Œí‘œ (ê°•ë‚¨êµ¬)
const defaultCenter = {
  lat: 37.4979,
  lng: 127.0276,
};

// ìœ„ì¹˜ ë¬¸ìì—´ì„ ê°„ë‹¨íˆ íŒŒì‹± (ì˜ˆ: "Gangnam, Seoul" -> ê°•ë‚¨êµ¬ ì¢Œí‘œ)
const parseLocation = (location) => {
  if (!location) return defaultCenter;
  
  const lower = location.toLowerCase();
  // ê°„ë‹¨í•œ ìœ„ì¹˜ ë§¤í•‘ (ì¶”í›„ Geocoding APIë¡œ ê°œì„  ê°€ëŠ¥)
  if (lower.includes('gangnam') || lower.includes('ê°•ë‚¨')) {
    return { lat: 37.4979, lng: 127.0276 };
  }
  if (lower.includes('sinsa') || lower.includes('ì‹ ì‚¬')) {
    return { lat: 37.5161, lng: 127.0193 };
  }
  if (lower.includes('seoul') || lower.includes('ì„œìš¸')) {
    return { lat: 37.5665, lng: 126.9780 }; // ì„œìš¸ì‹œì²­
  }
  
  return defaultCenter;
};

export const GoogleMapComponent = ({ location, hospitalName, latitude, longitude }) => {
  const apiKey = import.meta.env.VITE_GOOGLE_MAPS_API_KEY;

  // ì¢Œí‘œê°€ ìˆìœ¼ë©´ ìš°ì„  ì‚¬ìš©, ì—†ìœ¼ë©´ ì£¼ì†Œ íŒŒì‹±
  const center = useMemo(() => {
    if (latitude && longitude) {
      return { lat: Number(latitude), lng: Number(longitude) };
    }
    return parseLocation(location);
  }, [location, latitude, longitude]);

  // API í‚¤ê°€ ì—†ìœ¼ë©´ placeholder í‘œì‹œ
  if (!apiKey) {
    return (
      <div className="bg-gray-100 w-full h-full min-h-[200px] flex items-center justify-center text-gray-400 font-bold">
        <div className="flex flex-col items-center gap-2">
          <span className="text-xs">Google Maps API key required</span>
          <span className="text-[10px] text-gray-300">Add VITE_GOOGLE_MAPS_API_KEY to .env</span>
        </div>
      </div>
    );
  }

  const [mapLoaded, setMapLoaded] = useState(false);

  return (
    <LoadScript 
      googleMapsApiKey={apiKey}
      onLoad={() => setMapLoaded(true)}
    >
      {mapLoaded ? (
        <GoogleMap
          mapContainerStyle={containerStyle}
          center={center}
          zoom={15}
          options={{
            disableDefaultUI: false,
            zoomControl: true,
            streetViewControl: false,
            mapTypeControl: false,
            fullscreenControl: true,
            styles: [
              {
                featureType: 'poi',
                elementType: 'labels',
                stylers: [{ visibility: 'off' }],
              },
            ],
          }}
        >
          <Marker
            position={center}
            title={hospitalName || 'Hospital Location'}
            icon={{
              url: 'https://maps.google.com/mapfiles/ms/icons/red-dot.png',
            }}
          />
        </GoogleMap>
      ) : (
        <div className="w-full h-full min-h-[200px] flex items-center justify-center bg-gray-100">
          <div className="flex flex-col items-center gap-2">
            <Loader2 size={24} className="animate-spin text-teal-600" />
            <span className="text-xs text-gray-500">Loading map...</span>
          </div>
        </div>
      )}
    </LoadScript>
  );
};

--- END OF FILE: .\src\components\GoogleMap.jsx ---


--- START OF FILE: .\src\components\Modals.jsx ---
// src/components/Modals.jsx
import React from 'react';
import { X, Star, ThumbsUp } from 'lucide-react';

// --- [ê³µí†µ] ì•½ê´€ íŒì—… ---
export const PolicyModal = ({ isOpen, onClose, title, content }) => {
    if (!isOpen) return null;
    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-200 text-left">
            <div className="bg-white rounded-2xl w-full max-w-2xl max-h-[80vh] flex flex-col shadow-2xl">
                <div className="p-5 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white rounded-t-2xl z-10">
                    <h3 className="text-lg font-bold text-gray-900">{title}</h3>
                    <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition"><X size={20} className="text-gray-500"/></button>
                </div>
                <div className="p-6 overflow-y-auto whitespace-pre-wrap text-sm text-gray-600 leading-relaxed h-full text-left">
                    {content}
                </div>
                <div className="p-5 border-t border-gray-100 sticky bottom-0 bg-white rounded-b-2xl">
                    <button onClick={onClose} className="w-full bg-teal-600 text-white font-bold py-3 rounded-xl hover:bg-teal-700 transition">I Understand</button>
                </div>
            </div>
        </div>
    );
};

// --- ë¦¬ë·° ì „ì²´ë³´ê¸° íŒì—… ---
export const ReviewModal = ({ isOpen, onClose, reviews }) => {
    if (!isOpen) return null;
    return (
        <div className="fixed inset-0 z-[110] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200">
            <div className="bg-white rounded-3xl w-full max-w-2xl max-h-[85vh] flex flex-col shadow-2xl">
                <div className="p-6 border-b border-gray-100 flex justify-between items-center sticky top-0 bg-white rounded-t-3xl z-10">
                    <h3 className="text-xl font-bold text-gray-900">All Reviews ({reviews.length})</h3>
                    <button onClick={onClose} className="p-2 hover:bg-gray-100 rounded-full transition"><X size={24} className="text-gray-400"/></button>
                </div>
                <div className="p-6 overflow-y-auto space-y-6">
                    {reviews.map(review => (
                        <div key={review.id} className="border border-gray-100 rounded-2xl p-5 shadow-sm bg-white">
                            <div className="flex justify-between items-start mb-3">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-teal-50 text-teal-600 rounded-full flex items-center justify-center font-bold text-sm">
                                        {review.name[0]}
                                    </div>
                                    <div>
                                        <div className="flex items-center gap-2">
                                            <p className="font-bold text-gray-900">{review.name}</p>
                                            <span className="text-[10px] text-gray-400 font-bold uppercase">{review.country}</span>
                                        </div>
                                        <p className="text-xs text-gray-400">{review.date}</p>
                                    </div>
                                </div>
                                <div className="flex text-yellow-400 gap-0.5">
                                    {[...Array(5)].map((_, i) => <Star key={i} size={14} fill="currentColor"/>)}
                                </div>
                            </div>
                            <p className="text-sm text-gray-600 leading-relaxed mb-4">{review.content}</p>
                            <div className="flex gap-2 mb-3">
                                <div className="w-16 h-16 bg-gray-200 rounded-xl flex items-center justify-center text-[10px] text-gray-500 font-bold cursor-pointer hover:bg-gray-300 transition">Review 1</div>
                                {review.id === 1 && <div className="w-16 h-16 bg-gray-200 rounded-xl flex items-center justify-center text-[10px] text-gray-500 font-bold cursor-pointer hover:bg-gray-300 transition">Review 2</div>}
                            </div>
                            <div className="flex items-center gap-1 text-xs text-gray-400">
                                <ThumbsUp size={12}/> Helpful ({review.helpful})
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
};
--- END OF FILE: .\src\components\Modals.jsx ---


--- START OF FILE: .\src\components\SEO.jsx ---
// src/components/SEO.jsx
import React from 'react';
import { Helmet } from 'react-helmet-async';

export const SEO = ({ title, description, image, url }) => {
  const siteTitle = "HEALO | Korea's #1 Medical Concierge";
  const fullTitle = title ? `${title} | HEALO` : siteTitle;
  const metaDescription = description || "Find the best clinics in Korea. Free comparison quotes & concierge service.";
  const metaImage = image || "https://healo-landing.vercel.app/default-og.png"; // ê¸°ë³¸ ì´ë¯¸ì§€ URL (ì—†ìœ¼ë©´ ë¡œê³  ë“±)
  const metaUrl = url || window.location.href;

  return (
    <Helmet>
      {/* ê¸°ë³¸ íƒœê·¸ */}
      <title>{fullTitle}</title>
      <meta name="description" content={metaDescription} />

      {/* í˜ì´ìŠ¤ë¶/ì¹´ì¹´ì˜¤í†¡ (Open Graph) */}
      <meta property="og:type" content="website" />
      <meta property="og:title" content={fullTitle} />
      <meta property="og:description" content={metaDescription} />
      <meta property="og:image" content={metaImage} />
      <meta property="og:url" content={metaUrl} />

      {/* íŠ¸ìœ„í„° */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={fullTitle} />
      <meta name="twitter:description" content={metaDescription} />
      <meta name="twitter:image" content={metaImage} />
    </Helmet>
  );
};
--- END OF FILE: .\src\components\SEO.jsx ---


--- START OF FILE: .\src\components\Toast.jsx ---
// src/components/Toast.jsx
// Toast = í™”ë©´ì— ì ê¹ ë‚˜íƒ€ë‚¬ë‹¤ ì‚¬ë¼ì§€ëŠ” ì•Œë¦¼ ë©”ì‹œì§€
// alert() ëŒ€ì‹  ì‚¬ìš©í•˜ëŠ” ë” ì˜ˆì˜ê³  ì‚¬ìš©ì ì¹œí™”ì ì¸ ë°©ë²•

import React, { createContext, useContext, useState, useCallback } from 'react';
import { CheckCircle2, XCircle, Info, AlertCircle, X } from 'lucide-react';

// Toast íƒ€ì…: success(ì„±ê³µ), error(ì—ëŸ¬), info(ì •ë³´), warning(ê²½ê³ )
const ToastContext = createContext(null);

// Toast Provider - ì•± ì „ì²´ì—ì„œ Toastë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ì»´í¬ë„ŒíŠ¸
export const ToastProvider = ({ children }) => {
  const [toasts, setToasts] = useState([]);

  // Toast ë©”ì‹œì§€ ì¶”ê°€ í•¨ìˆ˜
  const addToast = useCallback((message, type = 'info', duration = 3000) => {
    const id = Date.now() + Math.random();
    const newToast = { id, message, type };
    
    setToasts(prev => [...prev, newToast]);

    // duration ì‹œê°„ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§€ê²Œ
    setTimeout(() => {
      setToasts(prev => prev.filter(toast => toast.id !== id));
    }, duration);
  }, []);

  // í¸ì˜ í•¨ìˆ˜ë“¤ - ì‚¬ìš©í•˜ê¸° ì‰½ê²Œ
  const toast = {
    success: (message) => addToast(message, 'success'),
    error: (message) => addToast(message, 'error'),
    info: (message) => addToast(message, 'info'),
    warning: (message) => addToast(message, 'warning'),
  };

  // Toast ì œê±° í•¨ìˆ˜
  const removeToast = useCallback((id) => {
    setToasts(prev => prev.filter(toast => toast.id !== id));
  }, []);

  return (
    <ToastContext.Provider value={{ toast, removeToast }}>
      {children}
      {/* Toast ë©”ì‹œì§€ë“¤ì„ í™”ë©´ì— í‘œì‹œí•˜ëŠ” ì˜ì—­ */}
      <div className="fixed top-20 right-4 z-[200] space-y-2 pointer-events-none">
        {toasts.map((toast) => (
          <ToastItem key={toast.id} toast={toast} onRemove={removeToast} />
        ))}
      </div>
    </ToastContext.Provider>
  );
};

// ê°œë³„ Toast ì•„ì´í…œ ì»´í¬ë„ŒíŠ¸
const ToastItem = ({ toast, onRemove }) => {
  const { message, type } = toast;

  // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
  const styles = {
    success: {
      bg: 'bg-green-50',
      border: 'border-green-200',
      text: 'text-green-800',
      icon: <CheckCircle2 size={20} className="text-green-600" />,
    },
    error: {
      bg: 'bg-red-50',
      border: 'border-red-200',
      text: 'text-red-800',
      icon: <XCircle size={20} className="text-red-600" />,
    },
    info: {
      bg: 'bg-blue-50',
      border: 'border-blue-200',
      text: 'text-blue-800',
      icon: <Info size={20} className="text-blue-600" />,
    },
    warning: {
      bg: 'bg-yellow-50',
      border: 'border-yellow-200',
      text: 'text-yellow-800',
      icon: <AlertCircle size={20} className="text-yellow-600" />,
    },
  };

  const style = styles[type] || styles.info;

  return (
    <div
      className={`
        ${style.bg} ${style.border} ${style.text}
        border rounded-xl shadow-lg p-4 min-w-[300px] max-w-[400px]
        flex items-start gap-3 animate-in slide-in-from-right fade-in
        pointer-events-auto
      `}
    >
      <div className="shrink-0 mt-0.5">{style.icon}</div>
      <div className="flex-1 text-sm font-medium">{message}</div>
      <button
        onClick={() => onRemove(toast.id)}
        className="shrink-0 p-1 hover:bg-black/5 rounded transition"
      >
        <X size={16} className={style.text} />
      </button>
    </div>
  );
};

// Hook - ë‹¤ë¥¸ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‰½ê²Œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í•¨ìˆ˜
export const useToast = () => {
  const context = useContext(ToastContext);
  if (!context) {
    throw new Error('useToast must be used within ToastProvider');
  }
  return context.toast;
};

--- END OF FILE: .\src\components\Toast.jsx ---


--- START OF FILE: .\src\hooks\useDetailFetch.js ---

--- END OF FILE: .\src\hooks\useDetailFetch.js ---


--- START OF FILE: .\src\lib\language.js ---
// src/lib/language.js
// Language utility to get current language from cookies

export const getCurrentLanguage = () => {
  if (typeof document === 'undefined') return 'ENG';
  
  const cookies = document.cookie.split(';');
  const langCookie = cookies.find(row => row.trim().startsWith('googtrans='));
  
  if (langCookie) {
    const langCode = langCookie.split('=')[1].split('/').pop();
    if (langCode === 'ko') return 'KR';
    // For other languages, default to ENG
  }
  
  return 'ENG';
};

// Get location column name based on language
export const getLocationColumn = (lang = null) => {
  const currentLang = lang || getCurrentLanguage();
  return currentLang === 'KR' ? 'location_kr' : 'location_en';
};

--- END OF FILE: .\src\lib\language.js ---


--- START OF FILE: .\src\lib\mapper.js ---
// src/lib/mapper.js

// 1. ì´ë¯¸ì§€ ë°ì´í„° ì •ê·œí™” (ë¬´ì¡°ê±´ ìœ íš¨í•œ URL ë°°ì—´ë¡œ ë°˜í™˜)
export const normalizeImages = (raw) => {
  if (!raw) return [];
  
  // ì´ë¯¸ ë°°ì—´ì´ë©´ ìœ íš¨í•œ ê°’(URL)ë§Œ ë‚¨ê¹€
  if (Array.isArray(raw)) return raw.filter(Boolean);

  // ë¬¸ìì—´ì¸ ê²½ìš° (JSON ìŠ¤íŠ¸ë§ì´ê±°ë‚˜ ë‹¨ì¼ URL ì²˜ë¦¬)
  if (typeof raw === "string") {
    const t = raw.trim();
    
    // JSON ë°°ì—´ í˜•íƒœì¸ ê²½ìš° ("[...]")
    if (t.startsWith("[") && t.endsWith("]")) {
      try {
        const parsed = JSON.parse(t);
        if (Array.isArray(parsed)) return parsed.filter(Boolean);
      } catch (e) {
          console.error("Image parse error:", e);
      }
    }
    
    // ê·¸ëƒ¥ httpë¡œ ì‹œì‘í•˜ëŠ” ë‹¨ì¼ URLì¸ ê²½ìš°
    if (t.startsWith("http")) return [t];
  }
  
  return [];
};

// 2. ë³‘ì› ë°ì´í„° ë³€í™˜ (DB -> UI í‘œì¤€)
export const mapHospitalRow = (h) => {
  if (!h) return null; // ğŸ”¥ ì•ˆì „ì¥ì¹˜: ë°ì´í„° ì—†ìœ¼ë©´ í„°ì§€ì§€ ì•Šê³  null ë°˜í™˜

  return {
    id: h.id,
    name: h.name,
    location: h.location ?? '',
    address_detail: h.address_detail ?? '',
    description: h.description,
    tags: Array.isArray(h.tags) ? h.tags : [], // íƒœê·¸ê°€ ë°°ì—´ì´ ì•„ë‹ˆë©´ ë¹ˆ ë°°ì—´ë¡œ
    rating: h.rating ?? 0, // ê°€ì§œ ë°ì´í„°(4.8) ì œê±° -> 0ìœ¼ë¡œ ì´ˆê¸°í™”
    reviewsCount: h.reviews_count ?? 0, // UI í•„ë“œëª… ëª…í™•í™”
    images: normalizeImages(h.images), // ì´ë¯¸ì§€ ì •ê·œí™” ì ìš©
    latitude: h.latitude ?? null,
    longitude: h.longitude ?? null,
    operating_hours: h.operating_hours ?? null,
    doctorProfile: h.doctor_profile || null,
  };
};

// 3. ì‹œìˆ  ë°ì´í„° ë³€í™˜ (DB -> UI í‘œì¤€)
export const mapTreatmentRow = (t) => {
  if (!t) return null; // ğŸ”¥ ì•ˆì „ì¥ì¹˜

  return {
    id: t.id,
    title: t.name,
    desc: t.description,
    fullDescription: t.full_description,
    hospitalId: t.hospital_id,
    price: t.price_min ? `$${t.price_min.toLocaleString()}` : "Inquire", // ê°€ê²© í¬ë§·íŒ…
    tags: Array.isArray(t.tags) ? t.tags : [],
    images: normalizeImages(t.images), // ì´ë¯¸ì§€ ì •ê·œí™” ì ìš©
    benefits: Array.isArray(t.benefits) ? t.benefits : [],
    
    // Joinëœ ë³‘ì› ì •ë³´ê°€ ìˆë‹¤ë©´ ë§¤í•‘ (ì—†ìœ¼ë©´ ê¸°ë³¸ê°’)
    hospitalName: t.hospitals?.name || "Partner Hospital",
    hospitalLocation: t.hospitals?.location || "Seoul, Korea",
  };
};
--- END OF FILE: .\src\lib\mapper.js ---


--- START OF FILE: .\src\lib\normalizeImages.js ---

--- END OF FILE: .\src\lib\normalizeImages.js ---


--- START OF FILE: .\src\pages\AuthPages.jsx ---
import React, { useState } from 'react';
import { CheckCircle2, Clock, FileText, Sparkles, Check, MessageCircle, Mail, Lock, Eye, EyeOff } from 'lucide-react';
import { supabase } from '../supabase';
import { useToast } from '../components/Toast';
import { PolicyModal } from '../components/Modals';


//  ë¬¸ì˜ ì™„ë£Œ ì„±ê³µ í˜ì´ì§€
export const SuccessPage = ({ setView }) => {
    // ëœë¤ ì ‘ìˆ˜ ë²ˆí˜¸ ìƒì„± (ê°„ì§€ìš©)
    const ticketId = "REQ-" + Math.floor(100000 + Math.random() * 900000);

    return (
        <div className="min-h-[calc(100vh-64px)] flex items-center justify-center bg-gray-50 px-4 py-12 animate-in fade-in slide-in-from-bottom-8 duration-500">
            <div className="max-w-md w-full bg-white rounded-3xl shadow-xl overflow-hidden border border-gray-100 relative">
                
                {/* ìƒë‹¨ ì»¬ëŸ¬ ë¼ì¸ (í¬ì¸íŠ¸) */}
                <div className="absolute top-0 left-0 right-0 h-1.5 bg-gradient-to-r from-teal-400 to-teal-600"></div>

                <div className="p-8 pb-10">
                    {/* 1. ì• ë‹ˆë©”ì´ì…˜ ì•„ì´ì½˜ */}
                    <div className="relative w-24 h-24 mx-auto mb-6">
                        {/* ë’¤ì—ì„œ í¼ì§€ëŠ” íŒŒë™ íš¨ê³¼ */}
                        <div className="absolute inset-0 bg-teal-100 rounded-full animate-ping opacity-20"></div>
                        {/* ë©”ì¸ ì•„ì´ì½˜ */}
                        <div className="relative bg-gradient-to-tr from-teal-500 to-teal-400 w-full h-full rounded-full flex items-center justify-center shadow-lg shadow-teal-200 border-4 border-white">
                            <CheckCircle2 size={40} className="text-white" strokeWidth={3} />
                        </div>
                        {/* ê¹¨ì•Œ ë°ì½” (ë°˜ì§ì´) */}
                        <div className="absolute -right-2 -top-1 bg-yellow-400 p-1.5 rounded-full border-2 border-white shadow-sm animate-bounce">
                            <Sparkles size={14} className="text-white" fill="currentColor"/>
                        </div>
                    </div>

                    <div className="text-center mb-8">
                        <h2 className="text-3xl font-black text-gray-900 mb-2 tracking-tight">Inquiry Received!</h2>
                        <p className="text-gray-500 text-sm">
                            Thank you for choosing HEALO. <br/>We've securely received your request.
                        </p>
                    </div>

                    {/* 2. ì ‘ìˆ˜ì¦ (Ticket Info) */}
                    <div className="bg-gray-50 rounded-2xl p-5 border border-gray-100 mb-8 flex flex-col gap-3 relative overflow-hidden">
                        {/* ë°°ê²½ ë°ì½” íŒ¨í„´ */}
                        <div className="absolute top-0 right-0 p-4 opacity-5">
                            <FileText size={64} className="text-gray-900" />
                        </div>

                        <div className="flex justify-between items-center text-sm relative z-10">
                            <span className="text-gray-500 font-medium">Reference ID</span>
                            <span className="font-mono font-bold text-teal-800 bg-teal-100/50 px-2 py-0.5 rounded border border-teal-100">{ticketId}</span>
                        </div>
                        <div className="flex justify-between items-center text-sm relative z-10">
                            <span className="text-gray-500 font-medium">Est. Response</span>
                            <span className="font-bold text-gray-900 flex items-center gap-1.5">
                                <Clock size={14} className="text-teal-500"/> Within 24 Hours
                            </span>
                        </div>
                    </div>

                    {/* 3. ì§„í–‰ ìƒí™© íƒ€ì„ë¼ì¸ (What's Next) */}
                    <div className="text-left mb-8 px-2">
                        <p className="text-[10px] font-extrabold text-gray-400 uppercase tracking-widest mb-4 ml-1">What happens next?</p>
                        <div className="space-y-0 relative pl-2">
                            {/* ì—°ê²°ì„  */}
                            <div className="absolute left-[11px] top-2 bottom-6 w-0.5 bg-gray-100"></div>

                            {/* Step 1 (ì™„ë£Œ) */}
                            <div className="relative flex gap-4 pb-6">
                                <div className="w-6 h-6 rounded-full bg-teal-600 flex items-center justify-center shrink-0 z-10 ring-4 ring-white shadow-sm">
                                    <Check size={12} className="text-white" strokeWidth={3}/>
                                </div>
                                <div>
                                    <p className="text-sm font-bold text-gray-900 leading-none mb-1">Inquiry Submitted</p>
                                    <p className="text-xs text-gray-500">Your details are sent to our medical team.</p>
                                </div>
                            </div>
                            
                            {/* Step 2 (ì§„í–‰ì¤‘ - ì• ë‹ˆë©”ì´ì…˜) */}
                            <div className="relative flex gap-4 pb-6">
                                <div className="w-6 h-6 rounded-full bg-white border-2 border-teal-500 flex items-center justify-center shrink-0 z-10 ring-4 ring-white">
                                    <div className="w-2 h-2 bg-teal-500 rounded-full animate-pulse"></div>
                                </div>
                                <div>
                                    <p className="text-sm font-bold text-teal-600 leading-none mb-1">Medical Review</p>
                                    <p className="text-xs text-gray-500">Coordinator is matching the best hospital.</p>
                                </div>
                            </div>

                            {/* Step 3 (ì˜ˆì •) */}
                            <div className="relative flex gap-4">
                                <div className="w-6 h-6 rounded-full bg-gray-100 flex items-center justify-center shrink-0 z-10 ring-4 ring-white">
                                    <MessageCircle size={12} className="text-gray-400"/>
                                </div>
                                <div>
                                    <p className="text-sm font-bold text-gray-400 leading-none mb-1">Personalized Quote</p>
                                    <p className="text-xs text-gray-400">You'll receive a quote via your contact method.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* 4. í•˜ë‹¨ ë²„íŠ¼ */}
                    <div className="space-y-3">
                        <button 
                            onClick={() => setView('home')} 
                            className="w-full bg-teal-600 text-white font-bold py-4 rounded-xl hover:bg-teal-700 transition shadow-lg shadow-teal-100 transform active:scale-[0.98] flex items-center justify-center gap-2"
                        >
                            Return to Home
                        </button>
                    </div>
                </div>
            </div>
        </div>
    );
};

// --- 4. ë¡œê·¸ì¸ í˜ì´ì§€ ---
export const LoginPage = ({ setView }) => {
    const toast = useToast(); // Toast ì‚¬ìš© ì¤€ë¹„
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [loading, setLoading] = useState(false);
    const [showPassword, setShowPassword] = useState(false); // ëˆˆì•Œ ì•„ì´ì½˜ìš©

    const handleLogin = async (e) => {
        // í¼ ì „ì†¡ ë°©ì§€ (ì—”í„°í‚¤ ì³ë„ ìƒˆë¡œê³ ì¹¨ ì•ˆë˜ê²Œ)
        if(e) e.preventDefault();
        
        setLoading(true);

        // 1. Supabase ë¡œê·¸ì¸ ì‹œë„
        const { data, error } = await supabase.auth.signInWithPassword({
            email: email,
            password: password,
        });

        if (error) {
            toast.error("Login failed. Please check your email and password.");
        } else {
            // 2. ë¡œê·¸ì¸ ì„±ê³µ! (ì‚¬ì¥ë‹˜ vs ì†ë‹˜ êµ¬ë¶„)
            console.log("Logged in:", data.user.email);
            
            if (data.user.email === 'admin@healo.com') {
                setView('admin'); // ì‚¬ì¥ë‹˜
            } else {
                setView('home');  // ì†ë‹˜
            }
        }
        setLoading(false);
    };

    return (
        <div className="min-h-[calc(100vh-64px)] flex items-center justify-center bg-white px-4 animate-in fade-in slide-in-from-bottom-4">
            <div className="max-w-sm w-full">
                {/* í—¤ë” ë””ìì¸ */}
                <div className="text-center mb-10">
                    <h2 className="text-3xl font-extrabold text-gray-900">Welcome to HEALO</h2>
                    <p className="text-gray-500 mt-2">Start Your Journey</p>
                </div>

                <form onSubmit={handleLogin} className="space-y-6">
                    {/* ì´ë©”ì¼ ì…ë ¥ */}
                    <div>
                        <label className="block text-sm font-bold text-gray-700 mb-1">Email</label>
                        <div className="relative">
                            <Mail className="absolute left-4 top-3.5 text-gray-400" size={20}/>
                            <input 
                                type="email" 
                                required
                                className="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all bg-gray-50"
                                placeholder="name@example.com"
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                            />
                        </div>
                    </div>

                    {/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ */}
                    <div>
                        <div className="flex justify-between items-center mb-1">
                            <label className="block text-sm font-bold text-gray-700">Password</label>
                            <button type="button" onClick={() => toast.info("Coming soon!")} className="text-xs font-bold text-teal-600 hover:underline">Forgot?</button>
                        </div>
                        <div className="relative">
                            <Lock className="absolute left-4 top-3.5 text-gray-400" size={20}/>
                            <input 
                                type={showPassword ? "text" : "password"} 
                                required
                                className="w-full pl-12 pr-12 py-3 rounded-xl border border-gray-200 focus:ring-2 focus:ring-teal-500 focus:border-transparent outline-none transition-all bg-gray-50"
                                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                value={password}
                                onChange={(e) => setPassword(e.target.value)}
                            />
                            <button 
                                type="button"
                                onClick={() => setShowPassword(!showPassword)}
                                className="absolute right-4 top-3.5 text-gray-400 hover:text-gray-600 focus:outline-none"
                            >
                                {showPassword ? <EyeOff size={20}/> : <Eye size={20}/>}
                            </button>
                        </div>
                    </div>

                    {/* ë¡œê·¸ì¸ ë²„íŠ¼ */}
                    <button 
                        type="submit" 
                        disabled={loading}
                        className="w-full bg-teal-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-teal-700 transition-colors shadow-lg shadow-teal-600/20 disabled:bg-gray-400"
                    >
                        {loading ? 'Logging in...' : 'Log In'}
                    </button>
                </form>

                {/* ì†Œì…œ ë¡œê·¸ì¸ (ë””ìì¸ ìœ ì§€) */}
                <div className="mt-8">
                    <div className="relative">
                        <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-gray-200"></div></div>
                        <div className="relative flex justify-center text-sm"><span className="px-2 bg-white text-gray-400">Or continue with</span></div>
                    </div>

                    <div className="mt-6 grid grid-cols-4 gap-3">
                        {['Google', 'Apple', 'WeChat', 'LINE'].map((social) => (
                             <button key={social} onClick={() => toast.info("Coming soon!")} className="flex flex-col items-center justify-center p-2 border border-gray-200 rounded-xl hover:bg-gray-50 transition group">
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs mb-1 group-hover:scale-110 transition ${social === 'Google' ? 'bg-orange-100 text-orange-600' : social === 'Apple' ? 'bg-gray-100 text-black' : 'bg-green-100 text-[#07C160]'}`}>
                                    {social[0]}
                                </div>
                                <span className="text-[10px] font-bold text-gray-500">{social}</span>
                            </button>
                        ))}
                    </div>
                </div>

                <p className="mt-8 text-center text-gray-500">
                    Don't have an account?{' '}
                    <button onClick={() => setView('signup')} className="text-teal-600 font-bold hover:underline">
                        Sign Up
                    </button>
                </p>
            </div>
        </div>
    );
};

// --- 5. íšŒì›ê°€ì… í˜ì´ì§€ ---
export const SignUpPage = ({ setView }) => {
    const toast = useToast(); // Toast ì‚¬ìš© ì¤€ë¹„
    // âœ… Supabase ì—°ê²°ì„ ìœ„í•œ ìƒíƒœê°’
    const [firstName, setFirstName] = useState('');
    const [lastName, setLastName] = useState('');
    const [email, setEmail] = useState('');
    const [loading, setLoading] = useState(false);

    // ê¸°ì¡´ UI ìƒíƒœê°’ (ë””ìì¸ ìœ ì§€)
    const [isAgreed, setIsAgreed] = useState(false);
    const [isMarketing, setIsMarketing] = useState(false);
    const [activeModal, setActiveModal] = useState(null);
    
    // ë¹„ë°€ë²ˆí˜¸ ìƒíƒœê°’
    const [password, setPassword] = useState('');
    const [confirmPassword, setConfirmPassword] = useState('');
    const [showPassword, setShowPassword] = useState(false);
    const [showConfirmPassword, setShowConfirmPassword] = useState(false);

    const handleSignUp = async () => {
        // 1. ìœ íš¨ì„± ê²€ì‚¬
        if (!firstName || !lastName || !email) {
            toast.error("Please fill in all required fields.");
            return;
        }
        if (!isAgreed) {
            toast.error("Please agree to the Terms and Privacy Policy.");
            return;
        }
        if (password.length < 6) {
            toast.error("Password must be at least 6 characters.");
            return;
        }
        if (password !== confirmPassword) {
            toast.error("Passwords do not match.");
            return;
        }

        setLoading(true);

        // 2. ğŸ”¥ Supabase íšŒì›ê°€ì… ìš”ì²­ (ì´ë¦„ ì •ë³´ í¬í•¨)
        const { data, error } = await supabase.auth.signUp({
            email: email,
            password: password,
            options: {
                data: {
                    first_name: firstName,
                    last_name: lastName,
                    is_marketing_agreed: isMarketing,
                },
            },
        });

        if (error) {
            toast.error("Sign up failed: " + error.message);
        } else {
            toast.success("Account created! ğŸ‰\nPlease check your email.");
            setView('login'); // ì„±ê³µ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        }
        setLoading(false);
    };

    return (
        <div className="min-h-[calc(100vh-64px)] flex items-center justify-center bg-gray-50 px-4 animate-in fade-in slide-in-from-bottom-4">
            <div className="bg-white rounded-3xl shadow-xl w-full max-w-md p-8 md:p-10 border border-gray-100">
                <div className="text-center mb-8">
                    <h2 className="text-3xl font-extrabold text-gray-900">Create Account</h2>
                    <p className="text-gray-500 mt-2">Join HEALO for exclusive benefits</p>
                </div>

                {/* ì…ë ¥ í¼ ì„¹ì…˜ */}
                <div className="space-y-4">
                    {/* ì´ë¦„ í•„ë“œ */}
                    <div className="grid grid-cols-2 gap-3">
                        <div>
                            <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">First Name</label>
                            <input 
                                type="text" 
                                placeholder="John" 
                                value={firstName}
                                onChange={(e) => setFirstName(e.target.value)}
                                className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-100 outline-none transition text-sm"
                            />
                        </div>
                        <div>
                            <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Last Name</label>
                            <input 
                                type="text" 
                                placeholder="Doe" 
                                value={lastName}
                                onChange={(e) => setLastName(e.target.value)}
                                className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-100 outline-none transition text-sm"
                            />
                        </div>
                    </div>
                    <p className="text-[10px] text-gray-400 px-1 -mt-2">
                        Make sure this matches the name on your passport.
                    </p>

                    {/* ì´ë©”ì¼ í•„ë“œ */}
                    <div>
                        <div className="relative">
                            <Mail className="absolute left-4 top-3.5 text-gray-400" size={20}/>
                            <input 
                                type="email" 
                                placeholder="Email Address" 
                                value={email}
                                onChange={(e) => setEmail(e.target.value)}
                                className="w-full pl-12 pr-4 py-3 rounded-xl border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-100 outline-none transition text-sm"
                            />
                        </div>
                    </div>
                    
                    {/* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ */}
                    <div className="relative">
                        <Lock className="absolute left-4 top-3.5 text-gray-400" size={20}/>
                        <input 
                            type={showPassword ? "text" : "password"} 
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            placeholder="Password (Min. 6 chars)" 
                            className="w-full pl-12 pr-12 py-3 rounded-xl border border-gray-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-100 outline-none transition text-sm"
                        />
                        <button 
                            type="button"
                            onClick={() => setShowPassword(!showPassword)}
                            className="absolute right-4 top-3.5 text-gray-400 hover:text-gray-600 focus:outline-none"
                        >
                            {showPassword ? <EyeOff size={20}/> : <Eye size={20}/>}
                        </button>
                    </div>

                    {/* ë¹„ë°€ë²ˆí˜¸ í™•ì¸ */}
                    <div className="relative">
                        <Lock className="absolute left-4 top-3.5 text-gray-400" size={20}/>
                        <input 
                            type={showConfirmPassword ? "text" : "password"} 
                            value={confirmPassword}
                            onChange={(e) => setConfirmPassword(e.target.value)}
                            placeholder="Confirm Password" 
                            className={`w-full pl-12 pr-12 py-3 rounded-xl border focus:ring-2 outline-none transition text-sm ${
                                confirmPassword && password !== confirmPassword 
                                ? 'border-red-300 focus:border-red-500 focus:ring-red-100' 
                                : 'border-gray-200 focus:border-teal-500 focus:ring-teal-100'
                            }`}
                        />
                        <button 
                            type="button"
                            onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                            className="absolute right-4 top-3.5 text-gray-400 hover:text-gray-600 focus:outline-none"
                        >
                            {showConfirmPassword ? <EyeOff size={20}/> : <Eye size={20}/>}
                        </button>
                    </div>
                    {confirmPassword && password !== confirmPassword && (
                        <p className="text-[10px] text-red-500 px-1 -mt-2">Passwords do not match.</p>
                    )}

                    {/* ì•½ê´€ ë™ì˜ */}
                    <div className="space-y-3 pt-2">
                        <div className="flex items-start gap-3">
                            <div className="relative flex items-center pt-0.5">
                                <input 
                                    type="checkbox" 
                                    id="terms" 
                                    checked={isAgreed}
                                    onChange={(e) => setIsAgreed(e.target.checked)}
                                    className="peer h-5 w-5 cursor-pointer appearance-none rounded-md border border-gray-300 transition-all checked:border-teal-600 checked:bg-teal-600"
                                />
                                <div className="pointer-events-none absolute top-2/4 left-2/4 -translate-x-2/4 -translate-y-2/4 text-white opacity-0 peer-checked:opacity-100">
                                    <Check size={14} strokeWidth={4} />
                                </div>
                            </div>
                            <label htmlFor="terms" className="text-xs text-gray-500 cursor-pointer select-none leading-snug">
                                I agree to the <span onClick={(e) => { e.preventDefault(); setActiveModal('terms'); }} className="text-teal-600 font-bold hover:underline">Terms</span> and <span onClick={(e) => { e.preventDefault(); setActiveModal('privacy'); }} className="text-teal-600 font-bold hover:underline">Privacy Policy</span>. <span className="text-red-500">*</span>
                            </label>
                        </div>

                        <div className="flex items-start gap-3">
                            <div className="relative flex items-center pt-0.5">
                                <input 
                                    type="checkbox" 
                                    id="marketing" 
                                    checked={isMarketing}
                                    onChange={(e) => setIsMarketing(e.target.checked)}
                                    className="peer h-5 w-5 cursor-pointer appearance-none rounded-md border border-gray-300 transition-all checked:border-teal-600 checked:bg-teal-600"
                                />
                                <div className="pointer-events-none absolute top-2/4 left-2/4 -translate-x-2/4 -translate-y-2/4 text-white opacity-0 peer-checked:opacity-100">
                                    <Check size={14} strokeWidth={4} />
                                </div>
                            </div>
                            <label htmlFor="marketing" className="text-xs text-gray-500 cursor-pointer select-none leading-snug">
                                I want to receive marketing emails including exclusive medical deals.
                            </label>
                        </div>
                    </div>
                    
                    <button 
                        onClick={handleSignUp}
                        disabled={loading}
                        className={`w-full font-bold py-3.5 rounded-xl transition shadow-lg ${isAgreed && !loading ? 'bg-teal-600 text-white hover:bg-teal-700 shadow-teal-100' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}
                    >
                        {loading ? 'Creating Account...' : 'Sign Up'}
                    </button>
                </div>

                {/* í•˜ë‹¨ ì„¹ì…˜ (êµ¬ë¶„ì„ , ì†Œì…œ ë¡œê·¸ì¸ ë“±) */}
                <div className="relative my-8">
                    <div className="absolute inset-0 flex items-center"><div className="w-full border-t border-gray-200"></div></div>
                    <div className="relative flex justify-center text-sm"><span className="px-2 bg-white text-gray-400">Or continue with</span></div>
                </div>

                <div className="grid grid-cols-4 gap-3 mb-8">
                    {['Google', 'Apple', 'WeChat', 'LINE'].map((social, idx) => (
                         <button key={idx} onClick={() => toast.info("Coming soon!")} className="flex flex-col items-center justify-center p-2 border border-gray-200 rounded-xl hover:bg-gray-50 transition group">
                            <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs mb-1 group-hover:scale-110 transition ${social === 'Google' ? 'bg-orange-100 text-orange-600' : social === 'Apple' ? 'bg-gray-100 text-black' : 'bg-green-100 text-[#07C160]'}`}>
                                {social[0]}
                            </div>
                            <span className="text-[10px] font-bold text-gray-500">{social}</span>
                        </button>
                    ))}
                </div>

                <div className="text-center text-sm text-gray-500">
                    Already have an account? <span onClick={() => setView('login')} className="text-teal-600 font-bold cursor-pointer hover:underline">Log In</span>
                </div>
            </div>

            {/* ëª¨ë‹¬ì°½ */}
            <PolicyModal 
                isOpen={activeModal === 'terms'} 
                onClose={() => setActiveModal(null)} 
                title="Terms of Service" 
                content={TERMS_CONTENT} 
            />
            <PolicyModal 
                isOpen={activeModal === 'privacy'} 
                onClose={() => setActiveModal(null)} 
                title="Privacy Policy" 
                content={PRIVACY_CONTENT} 
            />
        </div>
    );
};

--- END OF FILE: .\src\pages\AuthPages.jsx ---


--- START OF FILE: .\src\pages\HospitalDetailPage.jsx ---
// src/pages/HospitalDetailPage.jsx
import React, { useEffect, useMemo, useState } from "react";
import {
  ChevronLeft, MapPin, Star, Shield, Info, FileText, Globe, Stethoscope, Sparkles,
  GraduationCap, Award, ShieldCheck, Check, Building2, Image as ImageIcon, ArrowRight,
  MessageCircle, HelpCircle, CheckCircle2
} from "lucide-react";
import { supabase } from "../supabase";
import { mapHospitalRow, mapTreatmentRow } from "../lib/mapper";
import { getLocationColumn } from "../lib/language";

export const HospitalDetailPage = ({ selectedId, setView, onTreatmentClick }) => {
  // âœ… state (DB single source of truth)
  const [hospital, setHospital] = useState(null);
  const [hospitalTreatments, setHospitalTreatments] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(null);
  const [treatmentsError, setTreatmentsError] = useState(null);

  // âœ… safe defaults for reviews (later DB)
  const [loadingReviews] = useState(false);
  const [realReviews] = useState([]);

  // âœ… normalize images: array | json string | single url
  const normalizeImages = (raw) => {
    if (!raw) return [];
    if (Array.isArray(raw)) return raw.filter(Boolean);

    if (typeof raw === "string") {
      const t = raw.trim();
      if (t.startsWith("[") && t.endsWith("]")) {
        try {
          const parsed = JSON.parse(t);
          if (Array.isArray(parsed)) return parsed.filter(Boolean);
        } catch {}
      }
      if (t.startsWith("http")) return [t];
    }
    return [];
  };

  const getAddressText = (h) => {
    const locationText = (h?.location || "").trim();
    const detailText = (h?.address_detail || "").trim();
    if (locationText) return locationText;
    if (detailText) return detailText;
    return import.meta.env.DEV ? "â€” (address missing)" : "";
  };

  // âœ… fetch hospital + treatments from DB
  useEffect(() => {
    const run = async () => {
      if (!selectedId) return;

      setLoading(true);
      setHospital(null);
      setHospitalTreatments([]);
      setError(null);

      try {
        const locCol = getLocationColumn();
        const { data: hRow, error: hErr } = await supabase
          .from("hospitals")
          .select(`id,name,location:${locCol},address_detail,description,images,tags,rating,reviews_count,doctor_profile,latitude,longitude,operating_hours`)
          .eq("id", selectedId)
          .maybeSingle();

        if (hErr) {
          console.error("[HospitalDetail] Hospital fetch error:", hErr);
          setError(hErr);
          setLoading(false);
          return;
        }
        if (!hRow) {
          const notFoundError = new Error(`Hospital not found for id: ${selectedId}`);
          console.error("[HospitalDetail]", notFoundError.message);
          setError(notFoundError);
          setLoading(false);
          return;
        }

        // mapper ìˆìœ¼ë©´ ì“°ê³ , ì—†ê±°ë‚˜ ê¹¨ì§€ë©´ rawì—ì„œ ìµœì†Œ ê°€ê³µ
        let h;
        try {
          h = mapHospitalRow ? mapHospitalRow(hRow) : hRow;
        } catch (e) {
          console.warn("mapHospitalRow failed, using raw:", e);
          h = hRow;
        }

        setHospital(h);

        const { data: tRows, error: tErr } = await supabase
          .from("treatments")
          .select("id,name,description,images,tags,price_min,hospital_id")
          .eq("hospital_id", selectedId);

        if (tErr) {
          console.error("[HospitalDetail] Treatments fetch error:", tErr);
          setTreatmentsError(tErr);
          setHospitalTreatments([]);
        } else {
          setTreatmentsError(null);
          let mapped = [];
          try {
            mapped = (tRows || []).map((r) => (mapTreatmentRow ? mapTreatmentRow(r) : r));
          } catch (e) {
            console.warn("mapTreatmentRow failed, using raw:", e);
            mapped = tRows || [];
          }
          setHospitalTreatments(mapped);
        }
      } finally {
        setLoading(false);
      }
    };

    run();
  }, [selectedId]);

  // âœ… slideshow images (always 5)
  const placeholder = "https://placehold.co/800x600?text=No+Image";
  const galleryImages = useMemo(() => {
    const imgs = normalizeImages(hospital?.images);
    return [
      imgs[0] || placeholder,
      imgs[1] || placeholder,
      imgs[2] || placeholder,
      imgs[3] || placeholder,
      imgs[4] || placeholder,
    ];
  }, [hospital?.images]);

  const [currentSlide, setCurrentSlide] = useState(0);

  // hospital ë°”ë€Œë©´ ìŠ¬ë¼ì´ë“œ 0
  useEffect(() => {
    setCurrentSlide(0);
  }, [hospital?.id]);

  // autoplay
  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentSlide((prev) => (prev + 1) % galleryImages.length);
    }, 3000);
    return () => clearInterval(timer);
  }, [galleryImages.length]);

  const nextSlide = (e) => {
    e?.stopPropagation();
    setCurrentSlide((prev) => (prev + 1) % galleryImages.length);
  };
  const prevSlide = (e) => {
    e?.stopPropagation();
    setCurrentSlide((prev) => (prev - 1 + galleryImages.length) % galleryImages.length);
  };

  // âœ… doctor profile mapping safe
  const doctor = useMemo(() => {
    // mapperê°€ doctorProfileë¡œ ë°”ê¿¨ì„ ìˆ˜ë„ ìˆê³ , rawëŠ” doctor_profileì¼ ìˆ˜ë„ ìˆìŒ
    const p = hospital?.doctorProfile || hospital?.doctor_profile;
    return p || {
      name: "Medical Team",
      title: "Specialist",
      image: "https://placehold.co/200x200/cccccc/ffffff?text=Doctor",
      years: "10+",
      school: "Certified Medical School",
      specialties: ["General Care", "Consultation"],
      heroMetric: { value: "100%", label: "Satisfaction" },
    };
  }, [hospital]);

  const isPartner = Array.isArray(hospital?.tags) &&
    hospital.tags.some((t) => String(t).toLowerCase().includes("partner"));

  // âœ… FAQ / trust signals
  const faq = [
    { q: "How do I get an estimate?", a: "Submit an inquiry and we will help you compare itemized quotes." },
    { q: "Do you provide interpretation?", a: "Concierge support may be available depending on the clinic and schedule." },
    { q: "Is my information safe?", a: "We only share information with your consent for matching and coordination." },
  ];

  const trustSignals = [
    {
      icon: <ShieldCheck size={16} className={isPartner ? "text-teal-700" : "text-amber-700"} />,
      title: "Consent-based sharing",
      desc: "We only share your information with clinics after you submit an inquiry.",
    },
    {
      icon: <FileText size={16} className={isPartner ? "text-teal-700" : "text-amber-700"} />,
      title: "Clear scope guidance",
      desc: "We encourage itemized estimates so you can compare fairly.",
    },
    {
      icon: <Globe size={16} className={isPartner ? "text-teal-700" : "text-amber-700"} />,
      title: "International support",
      desc: "Coordination support may be available for overseas patients.",
    },
  ];

  // âœ… render branches (after hooks)
  if (loading) {
    return (
      <div className="min-h-[60vh] flex items-center justify-center text-gray-500 font-bold">
        Loading hospital...
      </div>
    );
  }

  if (error || !hospital) {
    return (
      <div className="min-h-[60vh] flex flex-col items-center justify-center text-center px-6">
        <div className="text-teal-700 font-extrabold text-lg mb-2">Hospital not found</div>
        {error && (
          <div className="text-red-500 text-xs mb-2 max-w-md">
            {import.meta.env.DEV && `[DEV] ${error.message || JSON.stringify(error)}`}
          </div>
        )}
        <div className="text-gray-500 text-sm mb-6">selectedId: {String(selectedId)}</div>
        <button
          onClick={() => setView?.("list_hospital")}
          className="px-5 py-3 rounded-xl bg-teal-600 text-white font-bold hover:bg-teal-700"
        >
          Back to Hospitals
        </button>
      </div>
    );
  }

  return (
    <div className="bg-gray-50 min-h-screen pb-24 animate-in fade-in slide-in-from-bottom-4">
      {import.meta.env.DEV && (error || treatmentsError) && (
        <div className="max-w-6xl mx-auto px-4 pt-4">
          {error && <p className="text-xs text-red-500">Hospital error: {error.message}</p>}
          {treatmentsError && <p className="text-xs text-red-500">Treatments error: {treatmentsError.message}</p>}
        </div>
      )}
      <div className="max-w-6xl mx-auto px-4 py-6">
        {/* Mobile slider */}
        <div className="md:hidden w-full aspect-[4/3] relative group overflow-hidden rounded-2xl bg-gray-100 shadow-sm">
          {galleryImages.map((img, index) => (
            <div
              key={index}
              className={`absolute inset-0 transition-opacity duration-700 ease-in-out ${index === currentSlide ? "opacity-100" : "opacity-0"}`}
            >
              <img src={img} className="w-full h-full object-cover" alt={`Slide ${index + 1}`} />
              <div className="absolute inset-0 bg-gradient-to-t from-black/20 via-transparent to-transparent"></div>
            </div>
          ))}
          <button onClick={prevSlide} className="absolute left-3 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white p-1.5 rounded-full backdrop-blur-sm transition z-20">
            <ChevronLeft size={20} />
          </button>
          <button onClick={nextSlide} className="absolute right-3 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white p-1.5 rounded-full backdrop-blur-sm transition z-20">
            <ArrowRight size={20} />
          </button>
          <div className="absolute bottom-3 right-3 z-20">
            <div className="bg-black/60 backdrop-blur-md text-white px-2.5 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1">
              <ImageIcon size={10} /> {currentSlide + 1}/{galleryImages.length}
            </div>
          </div>
        </div>

        {/* Desktop grid */}
        <div className="hidden md:flex flex-row gap-2 h-[500px]">
          <div className="w-1/2 h-full relative group cursor-pointer overflow-hidden rounded-xl">
            <img src={galleryImages[0]} className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" alt="Main" />
            <div className="absolute bottom-4 left-4 bg-black/60 backdrop-blur-md text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 z-10">
              <ImageIcon size={12} /> View All Photos
            </div>
          </div>
          <div className="w-1/2 h-full grid grid-cols-2 grid-rows-2 gap-2">
            {galleryImages.slice(1, 5).map((img, idx) => (
              <div key={idx} className="relative overflow-hidden cursor-pointer group rounded-xl">
                <img src={img} className="w-full h-full object-cover group-hover:scale-105 transition duration-700" alt={`Detail ${idx}`} />
              </div>
            ))}
          </div>
        </div>
      </div>

      <div className="max-w-6xl mx-auto px-4">
        <button onClick={() => setView("list_hospital")} className="flex items-center text-sm font-bold text-gray-500 mb-6 hover:text-teal-600">
          <ChevronLeft size={16} /> Back to Hospitals
        </button>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-10">
          <div className="lg:col-span-2 space-y-12">
            <div>
              <div className="flex items-center gap-2 mb-3 flex-wrap">
                {hospital?.tags?.map((tag, i) => (
                  <span key={i} className="px-2.5 py-0.5 bg-teal-50 text-teal-700 text-xs font-bold rounded-full">{tag}</span>
                ))}
                <span className={`px-2.5 py-0.5 text-xs font-bold rounded-full border flex items-center gap-1 ${isPartner ? "bg-teal-600 text-white border-teal-600" : "bg-gray-100 text-gray-500 border-gray-200"}`}>
                  {isPartner ? <ShieldCheck size={12} /> : <Info size={12} />}
                  {isPartner ? "Verified Partner" : "Public Info"}
                </span>
              </div>

              <h1 className="text-3xl md:text-4xl font-extrabold text-gray-900 mb-2 tracking-tight">{hospital?.name}</h1>

              <div className="flex items-center gap-6 text-sm font-medium text-gray-500">
                <span className="flex items-start gap-1.5 whitespace-normal">
                  <MapPin size={18} className="text-teal-500 mt-0.5" /> 
                  {hospital?.location
                    ? `${hospital.location}${hospital.address_detail ? `, ${hospital.address_detail}` : ''}`
                    : "â€”"}
                </span>
                <div className="h-4 w-px bg-gray-300"></div>
                <span className="flex items-center gap-1.5">
                  <Star size={18} className="text-yellow-400 fill-yellow-400" />
                  <span className="font-bold text-gray-900">{hospital?.rating ?? 0}</span>
                  <span className="opacity-70">({hospital?.reviews_count ?? hospital?.reviews ?? 0} reviews)</span>
                </span>
              </div>
            </div>

            {/* Medical Director */}
            <section>
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-2xl font-bold text-gray-900 flex items-center gap-2">
                  <Stethoscope size={24} className="text-teal-600" /> Medical Director
                </h2>
                <span className="bg-blue-50 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-100">
                  Board Certified
                </span>
              </div>

              <div className="bg-white rounded-3xl border border-gray-100 p-6 shadow-sm flex flex-col md:flex-row gap-6 relative overflow-hidden group hover:shadow-md transition">
                <div className="w-full md:w-40 md:h-40 shrink-0">
                  <div className="w-32 h-32 mx-auto md:w-40 md:h-40 rounded-full p-1 border-2 border-teal-100 relative">
                    <img src={doctor.image} className="w-full h-full object-cover rounded-full" alt="Doctor" />
                    <div className="absolute bottom-1 right-1 bg-teal-600 text-white p-1.5 rounded-full border-2 border-white shadow-sm" title="Verified">
                      <Check size={12} strokeWidth={4} />
                    </div>
                  </div>
                </div>

                <div className="flex-1 text-center md:text-left">
                  <h3 className="text-xl font-extrabold text-gray-900">{doctor.name}</h3>
                  <p className="text-teal-600 font-bold text-sm mb-4">{doctor.title}</p>

                  <div className="flex flex-wrap justify-center md:justify-start gap-2 mb-4">
                    <span className="flex items-center gap-1.5 px-3 py-1 bg-gray-50 rounded-lg text-xs font-bold text-gray-600 border border-gray-100">
                      <GraduationCap size={14} className="text-gray-400" /> {doctor.school}
                    </span>
                    <span className="flex items-center gap-1.5 px-3 py-1 bg-gray-50 rounded-lg text-xs font-bold text-gray-600 border border-gray-100">
                      <Award size={14} className="text-gray-400" /> {doctor.years} Experience
                    </span>
                    <span className="flex items-center gap-1.5 px-3 py-1 bg-gray-50 rounded-lg text-xs font-bold text-gray-600 border border-gray-100">
                      <ShieldCheck size={14} className="text-gray-400" /> Verified Profile
                    </span>
                  </div>

                  <div className="flex flex-wrap justify-center md:justify-start gap-1.5 mb-5">
                    {Array.isArray(doctor.specialties) &&
                      doctor.specialties.map((spec, i) => (
                        <span key={i} className="px-2.5 py-1 bg-teal-50 text-teal-700 text-xs font-bold rounded-md">
                          #{spec}
                        </span>
                      ))}
                  </div>
                </div>
              </div>
            </section>

            {/* About */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <Building2 size={24} className="text-teal-600" /> About Hospital
              </h2>
              <div className="bg-white p-6 rounded-3xl border border-gray-100 shadow-sm space-y-4">
                <p className="text-gray-600 leading-relaxed text-lg">{hospital?.description}</p>
              </div>
            </section>

            {/* Signature Programs */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <Sparkles size={24} className="text-teal-600" /> Signature Programs
              </h2>

              {hospitalTreatments.length > 0 ? (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  {hospitalTreatments.map((item) => {
                    const thumb = normalizeImages(item.images)?.[0] || item.logo || "https://placehold.co/600x600?text=treatment";
                    return (
                      <div
                        key={item.id}
                        onClick={() => onTreatmentClick?.(item.id)}
                        className="flex bg-white border border-gray-100 rounded-2xl overflow-hidden hover:shadow-lg hover:border-teal-200 transition cursor-pointer group"
                      >
                        <div className="w-32 h-24 bg-gray-200 shrink-0 relative">
                          <img src={thumb} className="w-full h-full object-cover group-hover:scale-110 transition duration-500" alt="img" />
                        </div>
                        <div className="p-4 flex flex-col justify-center flex-1">
                          <h4 className="font-bold text-gray-900 text-sm group-hover:text-teal-600 line-clamp-2 mb-1">
                            {item.title || item.name}
                          </h4>
                          <p className="text-xs text-gray-500 line-clamp-1 mb-2">{item.desc || item.description}</p>
                          <div className="flex items-center justify-between mt-auto">
                            <p className="text-teal-600 font-extrabold text-sm">{item.price || item.price_min || ""}</p>
                            <ArrowRight size={14} className="text-gray-300 group-hover:text-teal-500 transition" />
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <div className="bg-gray-100 rounded-xl p-8 text-center text-gray-500">No treatments listed yet.</div>
              )}
            </section>

            {/* Reviews (still empty) */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2">
                <Star size={24} className="text-teal-600" /> Patient Reviews
              </h2>
              <div className="bg-white rounded-3xl border border-gray-100 p-6 shadow-sm">
                {loadingReviews ? (
                  <div className="text-center py-8 text-gray-400 text-sm animate-pulse">Loading reviews...</div>
                ) : realReviews.length > 0 ? (
                  <div className="space-y-6">...</div>
                ) : (
                  <div className="text-center py-8 bg-gray-50 rounded-2xl border border-dashed border-gray-200">
                    <MessageCircle size={32} className="mx-auto text-gray-300 mb-2" />
                    <p className="text-gray-500 font-bold">No reviews yet.</p>
                    <p className="text-xs text-gray-400 mt-1">Be the first to leave a review for this hospital!</p>
                  </div>
                )}
              </div>
            </section>

            {/* FAQ */}
            <section>
              <h2 className="text-2xl font-bold text-gray-900 mb-4 flex items-center gap-2">
                <HelpCircle size={24} className="text-teal-600" /> Frequently Asked Questions
              </h2>

              <div className="bg-white rounded-3xl border border-gray-100 shadow-sm overflow-hidden">
                {faq.map((item, i) => (
                  <div key={i} className={`p-5 ${i !== 0 ? "border-t border-gray-100" : ""}`}>
                    <p className="text-sm font-extrabold text-gray-900">{item.q}</p>
                    <p className="text-xs text-gray-600 leading-relaxed mt-2">{item.a}</p>
                  </div>
                ))}
              </div>
            </section>
          </div>

          {/* RIGHT (CTA) */}
          <div className="lg:col-span-1">
            <div className="sticky top-32 space-y-4">
              <div className="bg-white border border-teal-100 rounded-3xl p-6 shadow-xl">
                <h3 className="font-bold text-lg mb-1">Make an Inquiry</h3>
                <p className="text-xs text-gray-400 mb-6">Direct response within 24 hours.</p>

                <button
                  onClick={() => setView("inquiry")}
                  className="w-full bg-teal-600 text-white font-bold py-4 rounded-xl hover:bg-teal-700 transition shadow-lg transform hover:scale-[1.02] flex items-center justify-center gap-2"
                >
                  <MessageCircle size={20} /> Contact via HEALO
                </button>

                <div className="mt-5 bg-gray-50 border border-gray-100 rounded-2xl p-4">
                  <p className="text-xs font-bold text-gray-900 flex items-center gap-2">
                    <ShieldCheck size={16} className="text-teal-600" /> Why contact via HEALO?
                  </p>
                  <ul className="mt-2 space-y-2 text-[11px] text-gray-600">
                    <li className="flex items-start gap-2">
                      <CheckCircle2 size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      Compare options with an itemized estimate
                    </li>
                    <li className="flex items-start gap-2">
                      <CheckCircle2 size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      Coordinator support for international patients
                    </li>
                    <li className="flex items-start gap-2">
                      <CheckCircle2 size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      Consent-based sharing & privacy guidance
                    </li>
                  </ul>
                </div>
              </div>

              <div className={`rounded-2xl p-5 border ${isPartner ? "bg-teal-50 border-teal-100" : "bg-amber-50 border-amber-100"}`}>
                <div className="flex items-start gap-3 mb-4">
                  <div className={`shrink-0 mt-0.5 ${isPartner ? "text-teal-700" : "text-amber-700"}`}>
                    <Shield size={20} />
                  </div>
                  <div className="min-w-0">
                    <h4 className="font-extrabold text-sm text-gray-900 flex items-center gap-2">
                      Trust & Verification
                      <span className={`px-2 py-0.5 rounded-full text-[10px] font-bold border ${
                        isPartner ? "bg-white/60 text-teal-700 border-teal-200" : "bg-white/60 text-amber-700 border-amber-200"
                      }`}>
                        {isPartner ? "Verified Partner" : "Public Info"}
                      </span>
                    </h4>
                    <p className="text-xs text-gray-600 leading-snug mt-1">
                      {isPartner
                        ? "This clinic has been reviewed for safety & foreign patient coordination standards."
                        : "This page may include publicly available info. Request a plan via HEALO for accurate details."}
                    </p>
                  </div>
                </div>

                <div className="space-y-3">
                  {trustSignals.map((item, idx) => (
                    <div key={idx} className="flex items-start gap-3">
                      <div className="shrink-0 mt-0.5">{item.icon}</div>
                      <div className="min-w-0">
                        <p className="text-xs font-bold text-gray-900">{item.title}</p>
                        <p className="text-[11px] text-gray-600 leading-snug">{item.desc}</p>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="mt-4 pt-4 border-t border-black/5">
                  <p className="text-[10px] text-gray-500 leading-snug mt-2">
                    HEALO provides concierge & lead coordination. Final medical decisions and quotes are provided by the clinic.
                  </p>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>
    </div>
  );
};

--- END OF FILE: .\src\pages\HospitalDetailPage.jsx ---


--- START OF FILE: .\src\pages\InquiryPage.jsx ---
// src/pages/InquiryPage.jsx
import React, { useState, useRef, useEffect } from 'react';
import { ChevronLeft, Bot, MessageCircle, ClipboardList, ArrowRight, AlertCircle, Headset, UploadCloud, File, X, Check } from 'lucide-react';
import { TREATMENTS, PRIVACY_CONTENT, TERMS_CONTENT } from '../data';
import { supabase } from '../supabase'; 
import { PolicyModal } from '../components/Modals';
import { useToast } from '../components/Toast';

// âœ… [ìˆ˜ì • 1] propsì— treatments ì¶”ê°€ (App.jsxì—ì„œ ë°›ì•„ì˜´)
export const InquiryPage = ({ setView, mode, setMode, onClose, treatments }) => {
  const toast = useToast(); // Toast ì‚¬ìš© ì¤€ë¹„
  
  // âœ… [ìˆ˜ì • 2] DB ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì“°ê³ , ì—†ìœ¼ë©´ ê¸°ì¡´ ë°ì´í„° ì‚¬ìš© (ì•ˆì „ì¥ì¹˜)
  const allTreatments = treatments && treatments.length > 0 ? treatments : TREATMENTS;
  
  const [messages, setMessages] = useState([{ role: 'ai', text: "Hello! I'm HEALO AI Agent. Ask me about treatments (e.g., 'anti-aging', 'cancer care')." }]);
  const [input, setInput] = useState('');
  const chatContainerRef = useRef(null);
  const [activeModal, setActiveModal] = useState(null);

  // í¼ ìƒíƒœ ê´€ë¦¬
  const [formData, setFormData] = useState({
      firstName: '', lastName: '', email: '', nationality: '', spokenLanguage: '',
      contactMethod: 'WhatsApp', contactId: '', treatmentType: '', preferredDate: '',
      message: '', file: null, privacyAgreed: false
  });

  // ğŸ‘‡ [í•µì‹¬] ì‹¤ì œ DB ì‹œìˆ  ì •ë³´ ê²€ìƒ‰ ë¡œì§ (RAG ì‹œë®¬ë ˆì´ì…˜)
  const generateAIResponse = (userQuery) => {
      const lowerQuery = userQuery.toLowerCase();
      
      // âœ… [ìˆ˜ì • 3] DB ë°ì´í„°(allTreatments)ì—ì„œ ê²€ìƒ‰í•˜ë„ë¡ ë³€ê²½
      const matches = allTreatments.filter(t => {
          const title = (t.title || "").toLowerCase();
          const desc = (t.desc || "").toLowerCase();
          return title.includes(lowerQuery) || desc.includes(lowerQuery);
      });

      if (matches.length > 0) {
          const bestMatch = matches[0]; 
          return `Recommended: [${bestMatch.title}] at ${bestMatch.hospital || 'Partner Hospital'}.\nPrice: ${bestMatch.price}.\n\nShall we proceed with a consultation?`;
      } else {
          return `I couldn't find an exact match for "${userQuery}". Try keywords like 'Lifting', 'Dental', or 'Checkup'.`;
      }
  };

  const handleSend = () => {
    if (!input.trim()) return;
    const newMessages = [...messages, { role: 'user', text: input }];
    setMessages(newMessages); 
    const userQuery = input;
    setInput('');
    
    setTimeout(() => { 
        const aiResponse = generateAIResponse(userQuery);
        setMessages(prev => [...prev, { role: 'ai', text: aiResponse }]); 
    }, 800);
  };
  
  useEffect(() => { if(chatContainerRef.current) chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight; }, [messages]);

  const handleBack = () => {
      if (mode === 'select') { if (onClose) onClose(); else setView('home'); } else { setMode('select'); }
  };

  const handleFileChange = (e) => {
      const file = e.target.files[0];
      if (file) {
          setFormData({ ...formData, file: file });
      }
  };

  const handleFormSubmit = async () => {
    const requiredFields = [formData.firstName, formData.lastName, formData.email, formData.spokenLanguage];
    if (requiredFields.some(field => !field?.trim())) {
        toast.error("Please fill in all required fields.");
        return;
    }
    if (!formData.privacyAgreed) {
        toast.error("Please agree to the Privacy Policy.");
        return;
    }

    try {
        let attachmentUrl = null;
        if (formData.file) {
            const filePath = `inquiry/${Date.now()}_${formData.file.name}`;
            const { data, error: uploadError } = await supabase.storage
                .from('attachments')
                .upload(filePath, formData.file);

            if (uploadError) throw uploadError;

            const { data: publicUrlData } = supabase
                .storage
                .from('attachments')
                .getPublicUrl(filePath);

            attachmentUrl = publicUrlData.publicUrl;
        }

        // âœ… DB ì»¬ëŸ¼ ì´ë¦„ ë§¤ì¹­
        const { error } = await supabase.from('inquiries').insert([
          {
            first_name: formData.firstName,
            last_name: formData.lastName,
            email: formData.email,
            nationality: formData.nationality,
            spoken_language: formData.spokenLanguage,
            contact_method: formData.contactMethod,
            contact_id: formData.contactId,
            treatment_type: formData.treatmentType,
            preferred_date: formData.preferredDate
              ? new Date(formData.preferredDate).toISOString().split('T')[0]
              : null,
            message: formData.message,
            attachment: attachmentUrl,
            status: 'ëŒ€ê¸°ì¤‘'  
          }
        ]);

        if (error) throw error;
        setView('success');

    } catch (error) {
        console.error('Error:', error);
        toast.error("Failed to submit inquiry. Please try again.");
    }
  };

  return (
    <div className="max-w-5xl mx-auto px-4 py-8 md:py-16 text-center animate-in fade-in slide-in-from-bottom-4">
      <button onClick={handleBack} className="flex items-center text-sm font-bold text-gray-500 mb-6 md:mb-8 hover:text-teal-600">
          <ChevronLeft size={16}/> {mode === 'select' ? 'Back' : 'Back to Options'}
      </button>
      
      {mode === 'select' && (
        <>
          <h1 className="text-2xl md:text-3xl font-bold text-gray-900 mb-8 md:mb-12">How would you like to proceed?</h1>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6">
            <div onClick={() => setMode('ai')} className="bg-white border border-teal-100 rounded-3xl p-6 md:p-8 hover:border-teal-500 hover:shadow-xl transition-all cursor-pointer group flex flex-row md:flex-col items-center text-left md:text-center gap-4 md:gap-0">
                <div className="w-14 h-14 md:w-20 md:h-20 bg-teal-50 rounded-full flex items-center justify-center md:mb-6 shrink-0 group-hover:bg-teal-100 transition-colors"><Bot size={28} className="text-teal-600 md:w-10 md:h-10" /></div>
                <div>
                    <h3 className="text-lg md:text-2xl font-bold text-gray-900 mb-1 md:mb-2">AI Agent</h3>
                    <p className="text-gray-500 text-xs md:text-sm leading-relaxed">Instant answers & recommendations.</p>
                </div>
            </div>

            <div onClick={() => setMode('human')} className="bg-white border border-teal-100 rounded-3xl p-6 md:p-8 hover:border-green-500 hover:shadow-xl transition-all cursor-pointer group flex flex-row md:flex-col items-center text-left md:text-center gap-4 md:gap-0">
                <div className="w-14 h-14 md:w-20 md:h-20 bg-green-50 rounded-full flex items-center justify-center md:mb-6 shrink-0 group-hover:bg-green-100 transition-colors"><MessageCircle size={28} className="text-green-600 md:w-10 md:h-10" /></div>
                <div>
                    <h3 className="text-lg md:text-2xl font-bold text-gray-900 mb-1 md:mb-2">Human Agent</h3>
                    <p className="text-gray-500 text-xs md:text-sm leading-relaxed">Chat via WhatsApp or Line.</p>
                </div>
            </div>

            <div onClick={() => setMode('form')} className="bg-white border border-teal-100 rounded-3xl p-6 md:p-8 hover:border-blue-500 hover:shadow-xl transition-all cursor-pointer group flex flex-row md:flex-col items-center text-left md:text-center gap-4 md:gap-0">
                <div className="w-14 h-14 md:w-20 md:h-20 bg-blue-50 rounded-full flex items-center justify-center md:mb-6 shrink-0 group-hover:bg-blue-100 transition-colors"><ClipboardList size={28} className="text-blue-600 md:w-10 md:h-10" /></div>
                <div>
                    <h3 className="text-lg md:text-2xl font-bold text-gray-900 mb-1 md:mb-2">Inquiry Form</h3>
                    <p className="text-gray-500 text-xs md:text-sm leading-relaxed">Get a specific quote via email.</p>
                </div>
            </div>
          </div>
        </>
      )}

      {mode === 'ai' && (
        <div className="bg-white border border-gray-200 rounded-3xl shadow-xl h-[600px] flex flex-col p-4 animate-in fade-in slide-in-from-right-4">
           <div className="flex-1 overflow-y-auto mb-4 bg-gray-50 rounded-2xl p-4 text-left space-y-4" ref={chatContainerRef}>
             {messages.map((msg, idx) => (
                 <div key={idx} className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}>
                     <div className={`w-8 h-8 rounded-full flex items-center justify-center text-white text-xs font-bold shrink-0 ${msg.role === 'ai' ? 'bg-teal-600' : 'bg-gray-400'}`}> {msg.role === 'ai' ? 'AI' : 'U'} </div>
                     <div className={`p-3 rounded-2xl shadow-sm text-sm border max-w-[80%] ${msg.role === 'ai' ? 'bg-white border-gray-100 rounded-tl-none' : 'bg-teal-600 text-white border-teal-600 rounded-tr-none'}`}> 
                        <p className="whitespace-pre-wrap">{msg.text}</p>
                     </div>
                 </div>
             ))}
           </div>

           <div className="relative">
             <input 
               type="text" 
               value={input} 
               onChange={(e) => setInput(e.target.value)} 
               onKeyPress={(e) => e.key === 'Enter' && handleSend()} 
               placeholder="Ask about 'Lifting' or 'Cancer'..." 
               className="w-full border border-gray-300 rounded-full py-3 px-5 pr-12 focus:outline-none focus:ring-2 focus:ring-teal-500" 
             />
             <button onClick={handleSend} className="absolute right-2 top-1.5 bg-teal-600 text-white p-1.5 rounded-full hover:bg-teal-700 transition"><ArrowRight size={18}/></button>
           </div>

           <div className="mt-4 bg-gray-50 border border-gray-200 rounded-xl p-3 flex items-start gap-2.5 text-left">
                <AlertCircle size={16} className="text-gray-500 shrink-0 mt-0.5" />
                <p className="text-xs text-gray-600 leading-relaxed">
                    <span className="font-bold text-gray-800">Disclaimer:</span> AI may produce inaccurate information. 
                    This is not medical advice. Please consult with our coordinators for confirmation.
                </p>
           </div>
        </div>
      )}

      {mode === 'human' && (
        <div className="animate-in fade-in slide-in-from-right-4">
            <div className="text-center mb-8 md:mb-12">
                <div className="w-14 h-14 md:w-16 md:h-16 bg-teal-50 rounded-full flex items-center justify-center mx-auto mb-4 text-teal-600">
                    <Headset size={28} className="md:w-8 md:h-8" />
                </div>
                <h2 className="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Human Agent</h2>
                <p className="text-gray-500 text-sm md:text-base max-w-lg mx-auto leading-relaxed">
                    Connect directly with our expert medical coordinators.<br className="hidden md:block"/>
                    We reply within 10 mins during business hours.
                </p>
            </div>

            <div className="flex flex-col md:grid md:grid-cols-3 gap-3 md:gap-6 max-w-md md:max-w-none mx-auto">
                <a href="#" className="group bg-white border border-gray-200 rounded-2xl p-4 md:p-8 hover:border-[#25D366] hover:shadow-xl transition-all cursor-pointer flex flex-row md:flex-col items-center gap-4 md:gap-0 text-left md:text-center">
                    <div className="w-12 h-12 md:w-16 md:h-16 bg-[#25D366]/10 rounded-xl md:rounded-2xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <MessageCircle className="w-6 h-6 md:w-8 md:h-8 text-[#25D366]"/>
                    </div>
                    <div className="flex-1">
                        <h3 className="text-base md:text-xl font-bold text-gray-900 md:mb-1">WhatsApp</h3>
                        <p className="text-xs md:text-sm text-gray-400 md:mb-6">Global Support</p>
                    </div>
                    <div className="text-[#25D366] font-bold text-sm flex items-center gap-1 group-hover:gap-2 transition-all">
                        <span className="hidden md:inline">Chat Now</span> <ArrowRight size={20}/>
                    </div>
                </a>
                
                <a href="#" className="group bg-white border border-gray-200 rounded-2xl p-4 md:p-8 hover:border-[#06C755] hover:shadow-xl transition-all cursor-pointer flex flex-row md:flex-col items-center gap-4 md:gap-0 text-left md:text-center">
                    <div className="w-12 h-12 md:w-16 md:h-16 bg-[#06C755]/10 rounded-xl md:rounded-2xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <MessageCircle className="w-6 h-6 md:w-8 md:h-8 text-[#06C755]"/>
                    </div>
                    <div className="flex-1">
                        <h3 className="text-base md:text-xl font-bold text-gray-900 md:mb-1">LINE</h3>
                        <p className="text-xs md:text-sm text-gray-400 md:mb-6">Japan / Thai</p>
                    </div>
                    <div className="text-[#06C755] font-bold text-sm flex items-center gap-1 group-hover:gap-2 transition-all">
                        <span className="hidden md:inline">Chat Now</span> <ArrowRight size={20}/>
                    </div>
                </a>

                <a href="#" className="group bg-white border border-gray-200 rounded-2xl p-4 md:p-8 hover:border-[#07C160] hover:shadow-xl transition-all cursor-pointer flex flex-row md:flex-col items-center gap-4 md:gap-0 text-left md:text-center">
                    <div className="w-12 h-12 md:w-16 md:h-16 bg-[#07C160]/10 rounded-xl md:rounded-2xl flex items-center justify-center shrink-0 group-hover:scale-110 transition-transform duration-300">
                        <MessageCircle className="w-6 h-6 md:w-8 md:h-8 text-[#07C160]"/>
                    </div>
                    <div className="flex-1">
                        <h3 className="text-base md:text-xl font-bold text-gray-900 md:mb-1">WeChat</h3>
                        <p className="text-xs md:text-sm text-gray-400 md:mb-6">China Support</p>
                    </div>
                    <div className="text-[#07C160] font-bold text-sm flex items-center gap-1 group-hover:gap-2 transition-all">
                        <span className="hidden md:inline">Chat Now</span> <ArrowRight size={20}/>
                    </div>
                </a>
            </div>
        </div>
      )}

      {mode === 'form' && (
        <div className="bg-white border border-gray-200 rounded-3xl shadow-xl p-5 md:p-8 text-left max-w-2xl mx-auto animate-in fade-in slide-in-from-right-4 mb-20">
            <div className="mb-6 md:mb-8 border-b border-gray-100 pb-4 md:pb-6">
                <h2 className="text-xl md:text-2xl font-bold text-gray-900 mb-2">Inquiry Form</h2>
                <p className="text-gray-500 text-xs md:text-sm">Fill in the details for a personalized quote.</p>
            </div>
            
            <div className="space-y-4 md:space-y-6">
                {/* ì´ë¦„ */}
                <div className="grid grid-cols-2 gap-3">
                    <div>
                        <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">First Name <span className="text-red-500">*</span></label>
                        <input type="text" value={formData.firstName} onChange={(e)=>setFormData({...formData, firstName: e.target.value})} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-gray-50/50" placeholder="John"/>
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Last Name <span className="text-red-500">*</span></label>
                        <input type="text" value={formData.lastName} onChange={(e)=>setFormData({...formData, lastName: e.target.value})} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-gray-50/50" placeholder="Doe"/>
                    </div>
                </div>

                {/* ì´ë©”ì¼ */}
                <div>
                    <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Email <span className="text-red-500">*</span></label>
                    <input type="email" value={formData.email} onChange={(e)=>setFormData({...formData, email: e.target.value})} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-gray-50/50" placeholder="your@email.com"/>
                </div>

                {/* êµ­ì  & ì–¸ì–´ */}
                <div className="grid grid-cols-2 gap-3">
                    <div>
                        <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Nationality</label>
                        <input type="text" value={formData.nationality} onChange={(e)=>setFormData({...formData, nationality: e.target.value})} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-gray-50/50" placeholder="USA"/>
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Spoken Language <span className="text-red-500">*</span></label>
                        <input type="text" value={formData.spokenLanguage} onChange={(e)=>setFormData({...formData, spokenLanguage: e.target.value})} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-gray-50/50" placeholder="English"/>
                    </div>
                </div>

                {/* ë©”ì‹ ì € */}
                <div>
                    <label className="block text-xs font-bold text-teal-700 mb-1 ml-1 flex gap-1 items-center">
                        <MessageCircle size={12}/> Messenger
                    </label>
                    <div className="flex gap-2">
                        <select value={formData.contactMethod} onChange={(e)=>setFormData({...formData, contactMethod: e.target.value})} className="w-[35%] p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-gray-50 text-gray-700 font-medium">
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="LINE">LINE</option>
                            <option value="WeChat">WeChat</option>
                            <option value="KakaoTalk">KakaoTalk</option>
                        </select>
                        <input type="text" value={formData.contactId} onChange={(e)=>setFormData({...formData, contactId: e.target.value})} className="w-[65%] p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-sm bg-white" placeholder="ID / Phone"/>
                    </div>
                </div>

                {/* ë‚ ì§œ & ì‹œìˆ  */}
                <div className="grid grid-cols-2 gap-3">
                    <div>
                        <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Preferred Date</label>
                        <input type="date" value={formData.preferredDate || ''} onChange={(e) => setFormData({ ...formData, preferredDate: e.target.value })} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-xs md:text-sm bg-white text-gray-700 cursor-pointer"/>
                    </div>
                    <div>
                        <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Interest</label>
                        <select value={formData.treatmentType} onChange={(e)=>setFormData({...formData, treatmentType: e.target.value})} className="w-full p-3 rounded-xl border border-gray-200 focus:border-teal-500 outline-none transition text-xs md:text-sm bg-white text-gray-700">
                            <option value="">Select...</option>
                            <option value="Plastic Surgery">Plastic Surgery</option>
                            <option value="Dermatology">Dermatology</option>
                            <option value="Dental">Dental</option>
                            <option value="Vision">Vision</option>
                            <option value="Checkup">Checkup</option>
                            <option value="Cancer">Cancer</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                {/* ë©”ì‹œì§€ */}
                <div>
                    <label className="block text-xs font-bold text-gray-700 mb-1 ml-1">Message</label>
                    <textarea value={formData.message} onChange={(e)=>setFormData({...formData, message: e.target.value})} className="w-full border border-gray-200 p-3 rounded-xl focus:border-teal-500 outline-none transition text-sm bg-gray-50/50" rows="3" placeholder="Tell us more about your condition..."></textarea>
                </div>

                {/* íŒŒì¼ ì—…ë¡œë“œ */}
                <div>
                    <input type="file" id="fileInput" className="hidden" onChange={handleFileChange} />
                    {formData.file ? (
                        <div className="flex items-center justify-between border border-teal-200 bg-teal-50 rounded-xl p-3">
                            <div className="flex items-center gap-2 overflow-hidden">
                                <div className="bg-teal-100 p-1.5 rounded-lg text-teal-600 shrink-0"><File size={16}/></div>
                                <span className="text-xs font-bold text-teal-800 truncate">{formData.file.name}</span>
                            </div>
                            <button onClick={() => setFormData({...formData, file: null})} className="p-1 hover:bg-teal-100 rounded-full text-teal-500"><X size={16}/></button>
                        </div>
                    ) : (
                        <div onClick={() => document.getElementById('fileInput').click()} className="border border-dashed border-gray-300 rounded-xl p-3 text-center hover:bg-gray-50 transition cursor-pointer flex items-center justify-center gap-2">
                            <UploadCloud className="text-gray-400" size={18}/>
                            <span className="text-xs text-gray-500">Upload Photo / Medical Record (Optional)</span>
                        </div>
                    )}
                </div>

                {/* ì•½ê´€ ë™ì˜ */}
                <div className="flex items-start gap-3 bg-gray-50 p-3 rounded-xl border border-gray-100">
                    <input type="checkbox" id="privacyForm" checked={formData.privacyAgreed} onChange={(e) => setFormData({...formData, privacyAgreed: e.target.checked})} className="mt-0.5 h-4 w-4 cursor-pointer accent-teal-600"/>
                    <label htmlFor="privacyForm" className="text-[11px] text-gray-500 cursor-pointer select-none leading-snug">
                        I agree to the <span onClick={(e) => { e.preventDefault(); setActiveModal('privacy'); }} className="text-teal-600 font-bold hover:underline">Privacy Policy</span>. <span className="text-red-500">*</span>
                    </label>
                </div>

                <button onClick={handleFormSubmit} className="w-full bg-teal-600 text-white py-4 rounded-xl font-bold hover:bg-teal-700 transition transform active:scale-95 shadow-lg shadow-teal-100 mt-2">
                    Send Inquiry
                </button>
            </div>
        </div>
      )}

      {/* ì•½ê´€ íŒì—… */}
      <PolicyModal isOpen={activeModal === 'privacy'} onClose={() => setActiveModal(null)} title="Privacy Policy" content={PRIVACY_CONTENT} />
    </div>
  );
};
--- END OF FILE: .\src\pages\InquiryPage.jsx ---


--- START OF FILE: .\src\pages\TreatmentDetailPage.jsx ---
// src/pages/TreatmentDetailPage.jsx
import React, { useEffect, useMemo, useState } from "react";
import { useParams } from "react-router-dom";
import {
  ChevronLeft,
  MapPin,
  Star,
  Shield,
  Check,
  Image as ImageIcon,
  ArrowRight,
  Sparkles,
  ShieldCheck,
  CheckCircle2,
  MessageCircle,
  ThumbsUp,
  Map,
  UserCheck,
  Clock,
  FileText,
  Globe,
} from "lucide-react";
import { supabase } from "../supabase";
import { ReviewModal } from "../components/Modals";
import { normalizeImages } from "../lib/mapper";
import { GoogleMapComponent } from "../components/GoogleMap";
import { getLocationColumn } from "../lib/language";

export const TreatmentDetailPage = ({
  setView,
  setInquiryMode,
  onHospitalClick,
  onTreatmentClick,
}) => {
  const { id } = useParams();

  const [treatment, setTreatment] = useState(null);
  const [hospital, setHospital] = useState(null);

  const [loading, setLoading] = useState(true);
  const [loadError, setLoadError] = useState(null);
  const [treatmentError, setTreatmentError] = useState(null);
  const [hospitalError, setHospitalError] = useState(null);
  const [relatedError, setRelatedError] = useState(null);

  const [realReviews, setRealReviews] = useState([]);
  const [loadingReviews, setLoadingReviews] = useState(true);
  const [isReviewModalOpen, setIsReviewModalOpen] = useState(false);

  const [relatedTreatments, setRelatedTreatments] = useState([]);
  const [currentSlide, setCurrentSlide] = useState(0);

  // ---- helpers ----
  const formatPrice = (min, max) => {
    const hasMin = min !== null && min !== undefined;
    const hasMax = max !== null && max !== undefined;
    if (hasMin && hasMax) return `$${Number(min).toLocaleString()} - $${Number(max).toLocaleString()}`;
    if (hasMin) return `$${Number(min).toLocaleString()}+`;
    if (hasMax) return `Up to $${Number(max).toLocaleString()}`;
    return "Ask for quote";
  };

  const getAddressText = (h) => {
    const locationText = (h?.location || "").trim();
    const detailText = (h?.address_detail || "").trim();
    if (locationText) return locationText;
    if (detailText) return detailText;
    return import.meta.env.DEV ? "â€” (address missing)" : "";
  };

  const getOperatingHoursRows = (hours) => {
    const data = hours && typeof hours === "object" ? hours : {};
    return [
      { label: "Monâ€“Fri", time: data.mon_fri || "" },
      { label: "Sat", time: data.sat || "" },
      { label: "Sun / Holidays", time: data.sun || data.sun_holidays || data.sun_holiday || "" },
    ];
  };

  const getDayTone = (label) => {
    if (label.toLowerCase().includes("sat")) {
      return { label: "text-amber-600", time: "text-amber-600/70" };
    }
    if (label.toLowerCase().includes("sun")) {
      return { label: "text-red-500", time: "text-red-500/70" };
    }
    return { label: "text-gray-700", time: "text-gray-500" };
  };

  const goBackToTreatments = () => {
    if (setView) setView("list_treatment");
    else window.history.back();
  };

  // ìŠ¤í¬ë¡¤ ì´ˆê¸°í™”
  useEffect(() => {
    window.scrollTo(0, 0);
  }, [id]);

  // 1) Treatment ë‹¨ê±´ fetch (id OR slug)
  useEffect(() => {
    let alive = true;

    const fetchTreatmentAndHospital = async () => {
      if (!id) return;

      setLoading(true);
      setLoadError(null);
      setTreatmentError(null);
      setHospitalError(null);
      setTreatment(null);
      setHospital(null);

      try {
        // âœ… uuidë“  slugë“  ì¡ëŠ”ë‹¤
        const { data: tRow, error: tErr } = await supabase
          .from("treatments")
          .select(
            "id,name,slug,description,full_description,benefits,tags,images,thumbnail,price_min,price_max,hospital_id"
          )
          .or(`id.eq.${id},slug.eq.${id}`)
          .single();

        if (tErr) {
          console.error("[TreatmentDetail] Treatment fetch error:", tErr);
          setTreatmentError(tErr);
          throw tErr;
        }
        if (!tRow) throw new Error("Treatment not found");

        // images fallback: images -> thumbnail
        const imgs = normalizeImages(tRow.images);
        const imgsWithThumbFallback = imgs.length > 0 ? imgs : normalizeImages(tRow.thumbnail);

        const t = {
          id: tRow.id,
          title: tRow.name || "",
          name: tRow.name || "",
          desc: tRow.description || "",
          fullDescription: tRow.full_description || "",
          benefits: Array.isArray(tRow.benefits) ? tRow.benefits : [],
          tags: Array.isArray(tRow.tags) ? tRow.tags : [],
          images: imgsWithThumbFallback,
          thumbnail: tRow.thumbnail || null,
          hospitalId: tRow.hospital_id,
          price: formatPrice(tRow.price_min, tRow.price_max),
          price_min: tRow.price_min,
          price_max: tRow.price_max,
        };

        if (!alive) return;
        setTreatment(t);

        // 2) Hospital ë‹¨ê±´ fetch
        if (t.hospitalId) {
          const locCol = getLocationColumn();
          const { data: hRow, error: hErr } = await supabase
            .from("hospitals")
            .select(`id,name,location:${locCol},address_detail,description,images,thumbnail,tags,rating,reviews_count,latitude,longitude,operating_hours`)
            .eq("id", t.hospitalId)
            .single();

          if (hErr) {
            console.error("[TreatmentDetail] Hospital fetch error:", hErr);
            setHospitalError(hErr);
            throw hErr;
          }

          const hImgs = normalizeImages(hRow.images);
          const hImgsFinal = hImgs.length > 0 ? hImgs : normalizeImages(hRow.thumbnail);

          const h = {
            id: hRow.id,
            name: hRow.name || "",
            location: hRow.location || "",
            address_detail: hRow.address_detail || "",
            description: hRow.description || "",
            tags: Array.isArray(hRow.tags) ? hRow.tags : [],
            rating: hRow.rating ?? null,
            reviews_count: hRow.reviews_count ?? null,
            images: hImgsFinal,
            thumbnail: hRow.thumbnail || null,
            latitude: hRow.latitude || null,
            longitude: hRow.longitude || null,
            operating_hours: hRow.operating_hours || null,
          };

          if (!alive) return;
          setHospital(h);
        }
      } catch (e) {
        console.error("[TreatmentDetail] fetch failed:", e);
        if (!alive) return;
        setLoadError(e);
      } finally {
        if (!alive) return;
        setLoading(false);
      }
    };

    fetchTreatmentAndHospital();

    return () => {
      alive = false;
    };
  }, [id]);

  // 3) ë¦¬ë·° fetch
  useEffect(() => {
    let alive = true;

    const fetchReviews = async () => {
      if (!treatment?.id) return;

      setLoadingReviews(true);
      try {
        const { data: reviews, error } = await supabase
          .from("reviews")
          .select("id,created_at,user_name,country,rating,content,helpful_count,treatment_id")
          .eq("treatment_id", treatment.id)
          .order("created_at", { ascending: false });

        if (error) throw error;
        if (!alive) return;
        setRealReviews(reviews || []);
      } catch (e) {
        console.error("[TreatmentDetail] review fetch failed:", e);
        if (!alive) return;
        setRealReviews([]);
      } finally {
        if (!alive) return;
        setLoadingReviews(false);
      }
    };

    fetchReviews();
    return () => {
      alive = false;
    };
  }, [treatment?.id]);

  // 4) Related treatments fetch (ê°™ì€ ë³‘ì› 4ê°œ)
  useEffect(() => {
    let alive = true;

    const fetchRelated = async () => {
      if (!treatment?.hospitalId || !treatment?.id) return;

      try {
        setRelatedError(null);
        // âœ… ì—¬ê¸°ì„œ price_display ê°™ì€ ì»¬ëŸ¼ ì ˆëŒ€ ì“°ë©´ ì•ˆë¨ (ë„ˆ DBì— ì—†ìŒ)
        const { data: rows, error } = await supabase
          .from("treatments")
          .select("id,name,price_min,price_max,thumbnail,images,hospital_id")
          .eq("hospital_id", treatment.hospitalId)
          .neq("id", treatment.id)
          .limit(4);

        if (error) {
          console.error("[TreatmentDetail] Related treatments fetch error:", error);
          setRelatedError(error);
          throw error;
        }

        const mapped = (rows || []).map((r) => ({
          id: r.id,
          name: r.name || "",
          price: formatPrice(r.price_min, r.price_max),
          images: normalizeImages(r.images),
          thumbnail: r.thumbnail || null,
          hospitalId: r.hospital_id,
        }));

        if (!alive) return;
        setRelatedTreatments(mapped);
      } catch (e) {
        console.error("[TreatmentDetail] related fetch failed:", e);
        if (!alive) return;
        setRelatedTreatments([]);
      }
    };

    fetchRelated();
    return () => {
      alive = false;
    };
  }, [treatment?.hospitalId, treatment?.id]);

  // 5) Gallery 5ì¥ ê°•ì œ ìœ ì§€ (ë””ìì¸ ìœ ì§€)
  const galleryImages = useMemo(() => {
    const imgs = normalizeImages(treatment?.images);
    const base = imgs.length > 0 ? imgs : normalizeImages(treatment?.thumbnail);

    const placeholders = [
      "https://placehold.co/1200x900?text=Procedure+1",
      "https://placehold.co/1200x900?text=Procedure+2",
      "https://placehold.co/1200x900?text=Procedure+3",
      "https://placehold.co/1200x900?text=Procedure+4",
      "https://placehold.co/1200x900?text=Procedure+5",
    ];

    const out = [...base];
    while (out.length < 5) out.push(placeholders[out.length] || placeholders[0]);
    return out.slice(0, 5);
  }, [treatment?.images, treatment?.thumbnail]);

  // ìŠ¬ë¼ì´ë“œ indexê°€ ì´ë¯¸ì§€ ê°œìˆ˜ë³´ë‹¤ ì»¤ì§€ëŠ” ê±° ë°©ì§€
  useEffect(() => {
    setCurrentSlide(0);
  }, [galleryImages.length, id]);

  const nextSlide = (e) => {
    e?.stopPropagation();
    setCurrentSlide((prev) => (prev + 1) % galleryImages.length);
  };
  const prevSlide = (e) => {
    e?.stopPropagation();
    setCurrentSlide((prev) => (prev - 1 + galleryImages.length) % galleryImages.length);
  };

  const averageRating =
    realReviews.length > 0
      ? (realReviews.reduce((acc, r) => acc + (r.rating || 5), 0) / realReviews.length).toFixed(1)
      : null;

  const ServiceBenefits = () => (
    <div className="bg-teal-50/80 rounded-xl p-4 border border-teal-100">
      <p className="text-xs font-bold text-teal-800 mb-3 flex items-center gap-1.5 uppercase tracking-wide">
        <ShieldCheck size={14} /> HEALO Guarantee
      </p>
      <ul className="space-y-2.5">
        <li className="flex items-start gap-2.5">
          <div className="bg-white p-1 rounded-full shadow-sm text-teal-600">
            <CheckCircle2 size={12} />
          </div>
          <div>
            <span className="text-xs font-bold text-gray-800 block">Free Comparison Quote</span>
            <span className="text-[10px] text-gray-500 leading-tight">Compare top 3 clinics at once.</span>
          </div>
        </li>
        <li className="flex items-start gap-2.5">
          <div className="bg-white p-1 rounded-full shadow-sm text-teal-600">
            <UserCheck size={12} />
          </div>
          <div>
            <span className="text-xs font-bold text-gray-800 block">Full Concierge</span>
            <span className="text-[10px] text-gray-500 leading-tight">Translation & pickup included.</span>
          </div>
        </li>
        <li className="flex items-start gap-2.5">
          <div className="bg-white p-1 rounded-full shadow-sm text-teal-600">
            <Clock size={12} />
          </div>
          <div>
            <span className="text-xs font-bold text-gray-800 block">Fast Response</span>
            <span className="text-[10px] text-gray-500 leading-tight">Average reply within 1 hour.</span>
          </div>
        </li>
      </ul>
    </div>
  );

  // ---- render states ----
  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center text-teal-600 font-bold">
        Loading Treatment...
      </div>
    );
  }

  if (!treatment || loadError) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center">
        <div className="text-teal-700 font-extrabold text-lg mb-2">Treatment not found</div>
        {loadError && import.meta.env.DEV && (
          <div className="text-red-500 text-xs mb-2 max-w-md">
            [DEV] {loadError?.message || JSON.stringify(loadError)}
          </div>
        )}
        <div className="text-gray-500 text-sm mb-6">Please go back and try again.</div>
        <button
          onClick={goBackToTreatments}
          className="px-5 py-3 rounded-xl bg-teal-600 text-white font-bold hover:bg-teal-700"
        >
          Back to Treatments
        </button>
      </div>
    );
  }

  return (
    <div className="bg-gray-50 min-h-screen pb-24 animate-in fade-in slide-in-from-bottom-4">
      {import.meta.env.DEV && (treatmentError || hospitalError || relatedError) && (
        <div className="max-w-6xl mx-auto px-4 pt-4">
          {treatmentError && <p className="text-xs text-red-500">Treatment error: {treatmentError.message}</p>}
          {hospitalError && <p className="text-xs text-red-500">Hospital error: {hospitalError.message}</p>}
          {relatedError && <p className="text-xs text-red-500">Related treatments error: {relatedError.message}</p>}
        </div>
      )}
      {/* 1. ì´ë¯¸ì§€ ì„¹ì…˜ */}
      <div className="max-w-6xl mx-auto px-4 py-6">
        {/* Mobile slider */}
        <div className="md:hidden w-full aspect-[4/3] relative group overflow-hidden rounded-2xl bg-gray-100 shadow-sm">
          <img src={galleryImages[currentSlide]} className="w-full h-full object-cover" alt="Main" />
          <button
            onClick={prevSlide}
            className="absolute left-3 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white p-1.5 rounded-full backdrop-blur-sm transition z-20"
          >
            <ChevronLeft size={20} />
          </button>
          <button
            onClick={nextSlide}
            className="absolute right-3 top-1/2 -translate-y-1/2 bg-black/20 hover:bg-black/40 text-white p-1.5 rounded-full backdrop-blur-sm transition z-20"
          >
            <ArrowRight size={20} />
          </button>
          <div className="absolute bottom-3 right-3 z-20">
            <div className="bg-black/60 backdrop-blur-md text-white px-2.5 py-1 rounded-lg text-[10px] font-bold flex items-center gap-1">
              <ImageIcon size={10} /> {currentSlide + 1}/{galleryImages.length}
            </div>
          </div>
        </div>

        {/* Desktop grid (5ì¥ ìœ ì§€) */}
        <div className="hidden md:flex flex-row gap-2 h-[500px]">
          <div className="w-1/2 h-full relative group cursor-pointer overflow-hidden rounded-xl">
            <img
              src={galleryImages[0]}
              className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
              alt="Main"
            />
            <div className="absolute bottom-4 left-4 bg-black/60 backdrop-blur-md text-white px-3 py-1 rounded-full text-xs font-bold flex items-center gap-1 z-10">
              <ImageIcon size={12} /> View All Photos
            </div>
          </div>
          <div className="w-1/2 h-full grid grid-cols-2 grid-rows-2 gap-2">
            {galleryImages.slice(1, 5).map((img, idx) => (
              <div key={idx} className="relative overflow-hidden cursor-pointer group rounded-xl">
                <img
                  src={img}
                  className="w-full h-full object-cover group-hover:scale-105 transition duration-700"
                  alt={`Detail ${idx + 1}`}
                />
                {idx === 3 && (
                  <div className="absolute inset-0 bg-black/40 flex items-center justify-center text-white font-bold text-sm">
                    + More
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* 2. ì»¨í…ì¸  ì„¹ì…˜ */}
      <div className="max-w-6xl mx-auto px-4">
        <button
          onClick={goBackToTreatments}
          className="flex items-center text-sm font-bold text-gray-500 mb-6 hover:text-teal-600"
        >
          <ChevronLeft size={16} /> Back to Treatments
        </button>

        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
          {/* Main Content */}
          <div className="lg:col-span-2 space-y-10">
            {/* Header */}
            <div>
              <div className="flex gap-2 mb-3 flex-wrap">
                {(treatment.tags || []).map((tag, i) => (
                  <span key={i} className="px-3 py-1 bg-teal-100 text-teal-700 text-xs font-bold rounded-full">
                    {tag}
                  </span>
                ))}
              </div>

              <h1 className="text-3xl md:text-4xl font-extrabold text-gray-900 mb-2">{treatment.title}</h1>

              <div className="flex items-center gap-2 text-sm text-gray-600">
                Provided by{" "}
                <span
                  onClick={() => onHospitalClick?.(treatment.hospitalId)}
                  className="font-bold text-teal-600 underline cursor-pointer hover:text-teal-800 ml-1"
                >
                  {hospital?.name || "Hospital"}
                </span>
                <Shield size={14} className="text-teal-500 fill-teal-500 ml-1" />
              </div>
            </div>

            {/* Overview */}
            <section>
              <h3 className="text-xl font-bold text-gray-900 mb-4">Treatment Overview</h3>
              <p className="text-gray-600 leading-relaxed mb-6 whitespace-pre-wrap">
                {treatment.fullDescription || treatment.desc}
              </p>

              {Array.isArray(treatment.benefits) && treatment.benefits.length > 0 && (
                <div className="bg-white rounded-2xl p-6 border border-gray-100 shadow-sm">
                  <h4 className="font-bold text-gray-900 mb-4 flex items-center gap-2">
                    <Sparkles size={18} className="text-teal-500 fill-teal-500" /> Key Benefits
                  </h4>
                  <ul className="space-y-3">
                    {treatment.benefits.map((benefit, idx) => (
                      <li key={idx} className="flex items-start gap-3">
                        <div className="mt-0.5 bg-teal-50 rounded-full p-1 shrink-0">
                          <Check size={12} className="text-teal-600 stroke-[3]" />
                        </div>
                        <span className="text-gray-700 font-medium text-sm leading-snug">{benefit}</span>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </section>

            {/* Reviews */}
            <section className="bg-white border border-gray-100 rounded-3xl p-6 shadow-sm">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h3 className="text-xl font-bold text-gray-900 flex items-center gap-2">
                    Verified Reviews
                    {realReviews.length > 0 ? (
                      <span className="bg-yellow-100 text-yellow-700 text-xs px-2 py-0.5 rounded-full">
                        {averageRating}/5.0
                      </span>
                    ) : (
                      <span className="bg-teal-50 text-teal-600 text-xs px-2 py-0.5 rounded-full border border-teal-100">
                        New Treatment
                      </span>
                    )}
                  </h3>
                  <p className="text-xs text-gray-500 mt-1">
                    From real patients who visited through HEALO
                  </p>
                </div>

                {realReviews.length > 0 && (
                  <span
                    onClick={() => setIsReviewModalOpen(true)}
                    className="text-teal-600 text-sm font-bold cursor-pointer hover:underline"
                  >
                    View All ({realReviews.length})
                  </span>
                )}
              </div>

              {loadingReviews ? (
                <div className="text-center py-8 text-gray-400 text-sm animate-pulse">Checking verified reviews...</div>
              ) : realReviews.length > 0 ? (
                <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                  {realReviews.slice(0, 3).map((review) => (
                    <div
                      key={review.id}
                      className="bg-white p-5 rounded-2xl border border-gray-100 shadow-sm flex flex-col h-full hover:shadow-md transition"
                    >
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center gap-3">
                          <div className="w-10 h-10 bg-teal-50 rounded-full flex items-center justify-center text-teal-600 font-bold text-sm uppercase">
                            {review.user_name?.[0] || "U"}
                          </div>
                          <div>
                            <div className="flex items-center gap-2">
                              <p className="font-bold text-gray-900 line-clamp-1">{review.user_name}</p>
                              <span className="text-[10px] text-gray-400 font-bold uppercase shrink-0">
                                {review.country}
                              </span>
                            </div>
                            <p className="text-xs text-gray-400">
                              {review.created_at ? new Date(review.created_at).toLocaleDateString() : ""}
                            </p>
                          </div>
                        </div>
                        <div className="flex text-yellow-400 gap-0.5 shrink-0">
                          {[...Array(review.rating || 5)].map((_, i) => (
                            <Star key={i} size={12} fill="currentColor" />
                          ))}
                        </div>
                      </div>

                      <p className="text-sm text-gray-600 leading-relaxed mb-4 line-clamp-4">
                        "{review.content}"
                      </p>

                      {/* Review Images (if available) */}
                      <div className="flex gap-2 mb-3">
                        <div className="w-16 h-16 bg-gray-200 rounded-xl flex items-center justify-center text-[10px] text-gray-500 font-bold cursor-pointer hover:bg-gray-300 transition">
                          Review 1
                        </div>
                        {review.id === realReviews[0]?.id && (
                          <div className="w-16 h-16 bg-gray-200 rounded-xl flex items-center justify-center text-[10px] text-gray-500 font-bold cursor-pointer hover:bg-gray-300 transition">
                            Result
                          </div>
                        )}
                      </div>

                      <div className="mt-auto flex items-center gap-1 text-xs text-gray-400">
                        <ThumbsUp size={12} /> Helpful ({review.helpful_count || 0})
                      </div>
                    </div>
                  ))}
                </div>
              ) : (
                <div className="text-center py-8 bg-gray-50 rounded-2xl border border-dashed border-gray-200">
                  <MessageCircle size={32} className="mx-auto text-gray-300 mb-2" />
                  <p className="text-gray-500 font-bold">No reviews yet.</p>
                  <p className="text-xs text-gray-400 mt-1">Be the first to share your experience with this treatment!</p>
                </div>
              )}
            </section>

            {/* Hospital Overview */}
            <section>
              <h3 className="text-xl font-bold text-gray-900 mb-4">Hospital Overview</h3>
              <div className="bg-white border border-gray-200 rounded-3xl overflow-hidden shadow-sm flex flex-col md:flex-row">
                <div className="p-6 md:w-1/2 flex flex-col justify-between bg-white">
                  <div>
                    <h4 className="font-bold text-lg text-gray-900 mb-1">{hospital?.name || "Hospital"}</h4>
                    <div className="flex items-start gap-2 text-xs text-gray-500 mb-3">
                      <MapPin size={14} className="mt-0.5" /> 
                      <div className="min-w-0">
                        <span className="line-clamp-2 whitespace-normal">{getAddressText(hospital)}</span>
                        {hospital?.address_detail && (
                          <span className="inline-block ml-2 bg-gray-100 text-gray-700 text-xs font-bold px-2 py-0.5 rounded">
                            {hospital.address_detail}
                          </span>
                        )}
                      </div>
                    </div>
                    <p className="text-xs text-gray-500 leading-relaxed mb-3 line-clamp-3">
                      {hospital?.description || "â€”"}
                    </p>

                    <button
                      onClick={() => onHospitalClick?.(treatment.hospitalId)}
                      className="text-teal-600 font-bold text-xs hover:underline flex items-center gap-1"
                    >
                      View Hospital Details <ArrowRight size={12} />
                    </button>
                  </div>

                  {/* Operating Hours */}
                  <div className="mt-6 pt-6 border-t border-gray-100">
                    <h5 className="text-sm font-bold text-gray-900 mb-3">Operating Hours</h5>
                    <div className="space-y-2 text-xs">
                      {getOperatingHoursRows(hospital?.operating_hours).map((row) => {
                        const tone = getDayTone(row.label);
                        return (
                          <div key={row.label} className="flex justify-between">
                            <span className={`font-medium ${tone.label}`}>{row.label}:</span>
                            <span className={tone.time}>{row.time || "â€”"}</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                </div>

                <div className="bg-gray-100 md:w-1/2 min-h-[200px] rounded-r-3xl overflow-hidden">
                  <GoogleMapComponent 
                    location={hospital?.location} 
                    hospitalName={hospital?.name}
                    latitude={hospital?.latitude}
                    longitude={hospital?.longitude}
                  />
                </div>
              </div>
            </section>

            {/* Related treatments */}
            <section>
              <h3 className="text-xl font-bold text-gray-900 mb-4">More from {hospital?.name || "this hospital"}</h3>

              {relatedTreatments.length > 0 ? (
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                  {relatedTreatments.map((item) => {
                    const thumb =
                      normalizeImages(item.images)?.[0] ||
                      item.thumbnail ||
                      "https://placehold.co/600x600?text=treatment";

                    return (
                      <div
                        key={item.id}
                        onClick={() => onTreatmentClick?.(item.id)}
                        className="bg-white border border-gray-100 rounded-2xl overflow-hidden shadow-sm hover:shadow-lg transition cursor-pointer group flex flex-col"
                      >
                        <div className="aspect-[4/3] bg-gray-200 overflow-hidden relative">
                          <img
                            src={thumb}
                            className="w-full h-full object-cover group-hover:scale-110 transition duration-500"
                            alt={item.name}
                          />
                        </div>
                        <div className="p-4 flex flex-col flex-1">
                          <h4 className="font-bold text-sm text-gray-900 line-clamp-2 mb-2 group-hover:text-teal-600">
                            {item.name}
                          </h4>
                          <p className="text-teal-600 font-extrabold text-sm mt-auto">{item.price}</p>
                        </div>
                      </div>
                    );
                  })}
                </div>
              ) : (
                <div className="text-gray-400 text-sm">No other treatments available.</div>
              )}
            </section>
          </div>

          {/* Sidebar */}
          <div className="hidden lg:block lg:col-span-1">
            <div className="sticky top-24 space-y-4">
              <div className="bg-white border border-teal-100 rounded-3xl p-6 shadow-xl text-center">
                <p className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">Estimated Price</p>
                <div className="text-3xl font-extrabold text-teal-600 mb-6">{treatment.price}</div>

                <div className="space-y-3">
                  <button
                    onClick={() => {
                      setInquiryMode?.("select");
                      setView?.("inquiry");
                    }}
                    className="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-[1.02] flex items-center justify-center gap-2"
                  >
                    <MessageCircle size={20} /> Contact Via HEALO
                  </button>

                  <button
                    onClick={() => onHospitalClick?.(treatment.hospitalId)}
                    className="w-full bg-white border-2 border-teal-100 text-teal-700 font-bold py-3 rounded-xl hover:bg-teal-50 transition"
                  >
                    View Hospital Profile
                  </button>
                </div>

                <div className="mt-6 text-left">
                  <ServiceBenefits />
                </div>

                {/* Trust & Verification */}
                <div className="mt-6 pt-6 border-t border-gray-100">
                  <h4 className="text-sm font-bold text-gray-900 mb-4 flex items-center gap-2">
                    Trust & Verification
                  </h4>
                  <div className="space-y-4 text-xs">
                    <div className="flex items-start gap-3">
                      <ShieldCheck size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      <div className="leading-snug">
                        <p className="font-bold text-gray-900">Publicly available info.</p>
                        <p className="text-gray-500 text-[10px] mt-1">Information may vary. Request a plan for accurate details.</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <Shield size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      <div className="leading-snug">
                        <p className="font-bold text-gray-900">Licensed Medical Institution</p>
                        <p className="text-gray-500 text-[10px] mt-1">Verified by Korean medical authorities</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <CheckCircle2 size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      <div className="leading-snug">
                        <p className="font-bold text-gray-900">Consent-based Sharing</p>
                        <p className="text-gray-500 text-[10px] mt-1">Your information is shared only with your consent</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <FileText size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      <div className="leading-snug">
                        <p className="font-bold text-gray-900">Transparent Quote</p>
                        <p className="text-gray-500 text-[10px] mt-1">Itemized estimates for fair comparison</p>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <Globe size={14} className="text-teal-600 mt-0.5 shrink-0" />
                      <div className="leading-snug">
                        <p className="font-bold text-gray-900">Global Support</p>
                        <p className="text-gray-500 text-[10px] mt-1">Coordination for international patients</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Mobile Benefits */}
        <div className="lg:hidden mt-8 mb-4">
          <ServiceBenefits />
        </div>
      </div>

      <ReviewModal
        isOpen={isReviewModalOpen}
        onClose={() => setIsReviewModalOpen(false)}
        reviews={realReviews}
      />
    </div>
  );
};

--- END OF FILE: .\src\pages\TreatmentDetailPage.jsx ---


--- START OF FILE: .\src\pages\admin\AnalyticsTab.jsx ---
import React from 'react';
import { TrendingUp, DollarSign, Target, AlertCircle, Activity, Info, ArrowRightCircle } from 'lucide-react';

export const AnalyticsTab = ({ analytics }) => (
  <div className="animate-in fade-in space-y-8">
    <div className="flex justify-between items-end border-b border-gray-200 pb-6">
      <div>
        <h1 className="text-3xl font-black text-gray-900 tracking-tight">Market Intelligence (ì‹œì¥ ë¶„ì„)</h1>
        <p className="text-gray-500 mt-2 text-sm max-w-xl leading-relaxed">
          ì‹¤ì‹œê°„ <span className="font-bold text-gray-800">í™˜ì ìˆ˜ìš” íŠ¸ë Œë“œ</span> ë° <span className="font-bold text-gray-800">ì‹œì¥ ê¸°íšŒ(Opportunity)</span> ë¶„ì„ ë³´ê³ ì„œì…ë‹ˆë‹¤.<br/>
          ë¯¸ì²´ê²° ìˆ˜ìš”ë¥¼ í™•ì¸í•˜ê³  ì œíœ´ ì˜ì—… ìš°ì„ ìˆœìœ„ë¥¼ ì„ ì •í•˜ì„¸ìš”.
        </p>
      </div>
    </div>

    {/* KPI Cards: Market Level */}
    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
      {/* Card 1: Volume */}
      <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm relative overflow-hidden">
        <div className="flex justify-between items-start mb-4">
          <div className="p-3 bg-teal-50 rounded-xl text-teal-700"><TrendingUp size={24}/></div>
          <span className="text-[10px] font-bold bg-green-100 text-green-700 px-2 py-0.5 rounded-full">+12% ì„±ì¥</span>
        </div>
        <p className="text-xs text-gray-500 font-bold uppercase tracking-wider">ì´ í™œì„± ë¬¸ì˜ (Active Leads)</p>
        <p className="text-3xl font-black text-gray-900 mt-1">{analytics.totalLeads} ê±´</p>
        <p className="text-[11px] text-gray-400 mt-2">í˜„ì¬ ìœ íš¨í•œ í™˜ì ìƒë‹´ ìˆ˜ìš”</p>
      </div>

      {/* Card 2: Value (Reframed as Market Opportunity) */}
      <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm relative overflow-hidden">
        <div className="flex justify-between items-start mb-4">
          <div className="p-3 bg-blue-50 rounded-xl text-blue-700"><DollarSign size={24}/></div>
        </div>
        <p className="text-xs text-gray-500 font-bold uppercase tracking-wider">ì‹œì¥ ê¸°íšŒ ì´ì•¡ (Est. Opportunity)</p>
        <p className="text-3xl font-black text-gray-900 mt-1">${analytics.totalRevenue.toLocaleString()}</p>
        <div className="flex items-center gap-1 mt-2 text-[11px] text-gray-400">
          <Info size={12}/> ë¬¸ì˜ë‹¹ í‰ê·  ì‹œìˆ ê°€ $3,500 ê¸°ì¤€
        </div>
      </div>

      {/* Card 3: Demand Spike */}
      <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm relative overflow-hidden">
        <div className="flex justify-between items-start mb-4">
          <div className="p-3 bg-purple-50 rounded-xl text-purple-700"><Target size={24}/></div>
        </div>
        <p className="text-xs text-gray-500 font-bold uppercase tracking-wider">ìµœë‹¤ ìˆ˜ìš” ì¹´í…Œê³ ë¦¬</p>
        <p className="text-2xl font-black text-gray-900 mt-1 truncate">{analytics.topTreatment}</p>
        <p className="text-[11px] text-purple-600 font-bold mt-2 flex items-center gap-1">
          Action: í•´ë‹¹ ë¶„ì•¼ ì „ë¬¸ ë³‘ì› í™•ë³´ ì‹œê¸‰
        </p>
      </div>
    </div>

    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
      {/* 1. Unmet Demand & Opportunity (Leakage Analysis) */}
      <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm">
        <h3 className="text-lg font-bold text-gray-900 mb-2 flex items-center gap-2">
          <AlertCircle size={20} className="text-red-500"/> 
          ê¸°íšŒ ë¹„ìš© ë° ìˆ˜ìš” ë¶„ì„ (Opportunity Analysis)
        </h3>
        <p className="text-xs text-gray-500 mb-6">
          í˜„ì¬ ë°œìƒ ì¤‘ì¸ ìˆ˜ìš”ê°€ ì–´ë””ë¡œ íë¥´ê³  ìˆëŠ”ì§€ ë¶„ì„í•©ë‹ˆë‹¤. 'ë¯¸ì²´ê²° ìˆ˜ìš”'ëŠ” ì¦‰ì‹œ ë§¤ì¶œí™” ê°€ëŠ¥í•œ ê¸°íšŒì…ë‹ˆë‹¤.
        </p>
        
        <div className="overflow-hidden border border-gray-100 rounded-xl">
          <table className="w-full text-sm">
            <thead className="bg-gray-50 text-gray-500 text-xs uppercase font-bold">
              <tr>
                <th className="py-3 px-4 text-left">íƒ€ê²Ÿ ë³‘ì› / ê·¸ë£¹</th>
                <th className="py-3 px-4 text-center">ë¬¸ì˜ ìˆ˜</th>
                <th className="py-3 px-4 text-right">ì ì¬ ë§¤ì¶œ ê¸°íšŒ</th>
                <th className="py-3 px-4 text-left">ëŒ€ì‘ ì „ëµ</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-100">
              {analytics.hospitalOpportunities.map((h) => (
                <tr key={h.id} className={`hover:bg-gray-50 transition ${h.status === 'ê¸°íšŒ ë¹„ìš© (Missed)' ? 'bg-red-50/30' : ''}`}>
                  <td className="py-4 px-4">
                    <div className="font-bold text-gray-800">{h.name}</div>
                    <div className="text-[10px] text-gray-400 font-medium uppercase mt-0.5">{h.status}</div>
                  </td>
                  <td className="py-4 px-4 text-center">
                    <span className={`font-bold px-2 py-1 rounded-md ${h.status==='ê¸°íšŒ ë¹„ìš© (Missed)' ? 'text-red-600 bg-red-100' : 'text-gray-700 bg-gray-100'}`}>
                      {h.count}
                    </span>
                  </td>
                  <td className="py-4 px-4 text-right font-black text-gray-700">
                    ${h.marketValue.toLocaleString()}
                  </td>
                  <td className="py-4 px-4">
                    <span className={`text-[10px] font-bold px-2 py-1 rounded border flex items-center w-fit gap-1
                        ${h.status === 'ë§¤ì¹­ ì™„ë£Œ' ? 'bg-teal-50 text-teal-700 border-teal-100' : 
                          h.status === 'ê¸°íšŒ ë¹„ìš© (Missed)' ? 'bg-blue-50 text-blue-700 border-blue-100 cursor-pointer hover:bg-blue-100' : 
                          'bg-orange-50 text-orange-700 border-orange-100 cursor-pointer hover:bg-orange-100'}`}>
                      {h.action}
                      {h.status !== 'ë§¤ì¹­ ì™„ë£Œ' && <ArrowRightCircle size={10}/>}
                    </span>
                  </td>
                </tr>
              ))}
              {analytics.hospitalOpportunities.length === 0 && (
                <tr><td colSpan="4" className="py-8 text-center text-gray-400">ë°ì´í„° ìˆ˜ì§‘ ì¤‘...</td></tr>
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* 2. Market Demand Trends */}
      <div className="bg-white p-6 rounded-2xl border border-gray-200 shadow-sm flex flex-col">
        <h3 className="text-lg font-bold text-gray-900 mb-2 flex items-center gap-2">
          <Activity size={20} className="text-teal-600"/> 
          ì‹œì¥ ìˆ˜ìš” íŠ¸ë Œë“œ (Market Trends)
        </h3>
        <p className="text-xs text-gray-500 mb-6">
          í•´ì™¸ í™˜ìë“¤ì´ í˜„ì¬ ê°€ì¥ ë§ì´ ì°¾ê³  ìˆëŠ” ì‹œìˆ  ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.
        </p>

        <div className="flex-1 space-y-6">
          {analytics.treatmentTrends.slice(0, 5).map((t, i) => (
            <div key={i}>
              <div className="flex justify-between text-xs font-bold mb-1.5">
                <span className="text-gray-800">{t.name}</span>
                <span className="text-teal-600">{t.percent}% ì ìœ ìœ¨</span>
              </div>
              <div className="w-full bg-gray-100 rounded-full h-2.5">
                <div 
                  className="bg-teal-500 h-2.5 rounded-full shadow-sm" 
                  style={{ width: `${t.percent}%` }}
                ></div>
              </div>
              <p className="text-[10px] text-gray-400 mt-1 text-right">{t.count}ê±´ì˜ í™œì„± ë¬¸ì˜</p>
            </div>
          ))}
          {analytics.treatmentTrends.length === 0 && <div className="text-center text-gray-400 py-10">ë°ì´í„° ëŒ€ê¸° ì¤‘...</div>}
        </div>
        
        <div className="mt-8 pt-6 border-t border-gray-100">
          <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
            <p className="text-xs font-bold text-blue-800 mb-1 flex items-center gap-2"><Info size={14}/> Strategic Insight</p>
            <p className="text-[11px] text-blue-700 leading-snug">
              í˜„ì¬ <span className="font-bold">"{analytics.topTreatment}"</span> ì¹´í…Œê³ ë¦¬ì˜ ìˆ˜ìš”ê°€ ì‹œì¥ì„ ì£¼ë„í•˜ê³  ìˆìŠµë‹ˆë‹¤. 
              ë¦¬ë“œ ì´íƒˆ(Leakage)ì„ ë§‰ê¸° ìœ„í•´ í•´ë‹¹ ë¶„ì•¼ ì „ë¬¸ íŒŒíŠ¸ë„ˆ ë³‘ì›ì„ ìµœì†Œ 3ê³³ ì´ìƒ í™•ë³´í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
);

--- END OF FILE: .\src\pages\admin\AnalyticsTab.jsx ---


--- START OF FILE: .\src\pages\admin\HospitalManager.jsx ---
import React from 'react';
import { Plus, Trash2, Loader2, Save, Globe, Coffee, Trophy, Info, User, X } from 'lucide-react';

export const HospitalManager = ({
  hospitalsList,
  hospitalsError,
  handleEditHospital,
  editingHospitalId,
  setEditingHospitalId,
  hospitalForm,
  setHospitalForm,
  uploading,
  loading,
  handleSaveHospital,
  handleDelete,
  fetchHospitals,
  uploadToSupabase,
  DynamicListInput,
  ImageUploader,
  AddressInput,
  toast,
}) => (
  <div className="grid grid-cols-12 gap-8 animate-in fade-in">
    <div className="col-span-4 bg-white rounded-2xl border border-gray-200 p-4 h-[calc(100vh-100px)] overflow-y-auto">
      <div className="flex justify-between items-center mb-4">
        <h2 className="font-bold">ë“±ë¡ëœ ë³‘ì›</h2>
        <button
          onClick={() => {
            setEditingHospitalId(null);
            setHospitalForm({ name: '', location_kr: '', location_en: '', address_detail: '', description: '', latitude: null, longitude: null, tags: [], images: [], languages: [], amenities: [], hoursMonFri: '', hoursSat: '', doctorName: '', doctorTitle: '', doctorImage: '', doctorSchool: '', doctorYears: '', doctorSpecialties: [], doctorMetricValue: '99%', doctorMetricLabel: 'ë§Œì¡±ë„' });
          }}
          className="bg-teal-600 text-white p-1 rounded"
        >
          <Plus size={16}/>
        </button>
      </div>
      {import.meta.env.DEV && hospitalsError && (
        <p className="text-xs text-red-500 mb-2">Hospitals error: {hospitalsError.message}</p>
      )}
      {hospitalsList.map(h => {
        const locationText = h.location_kr || h.location_en || h.location || '';
        return (
          <div key={h.id} onClick={()=>handleEditHospital(h)} className={`p-3 border-b cursor-pointer hover:bg-gray-50 ${editingHospitalId===h.id?'bg-teal-50 border-l-4 border-l-teal-500':''}`}>
            <div className="font-bold">{h.name}</div>
            <div className="text-xs text-gray-500">{locationText || (import.meta.env.DEV ? 'â€” (ì£¼ì†Œ ì—†ìŒ)' : '')}</div>
          </div>
        );
      })}
    </div>

    <div className="col-span-8 relative">
      {/* ì €ì¥ ë²„íŠ¼ - ìš°ì¸¡ ìƒë‹¨ ê³ ì • */}
      <div className="sticky top-0 z-10 bg-white border-b border-gray-200 p-4 mb-4 rounded-t-2xl flex justify-between items-center shadow-sm">
        <h2 className="text-xl font-bold">{editingHospitalId?'ë³‘ì› ì •ë³´ ìˆ˜ì •':'ì‹ ê·œ ë³‘ì› ë“±ë¡'}</h2>
        <div className="flex items-center gap-3">
          {editingHospitalId && (
            <button 
              onClick={()=>handleDelete('hospitals', editingHospitalId, fetchHospitals)}
              className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition"
              title="ì‚­ì œ"
            >
              <Trash2 size={20}/>
            </button>
          )}
          <button 
            onClick={handleSaveHospital} 
            disabled={loading}
            className="bg-teal-600 text-white px-6 py-2.5 rounded-lg font-bold shadow-md hover:bg-teal-700 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            {loading ? <Loader2 size={18} className="animate-spin"/> : <Save size={18}/>}
            {loading ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
          </button>
        </div>
      </div>
      
      <div className="bg-white rounded-2xl border border-gray-200 p-8 h-[calc(100vh-180px)] overflow-y-auto">
        <div className="space-y-6">
          <div className="space-y-3">
            <h3 className="text-sm font-bold text-gray-400">ê¸°ë³¸ ì •ë³´ (í•„ìˆ˜)</h3>
            <input type="text" placeholder="ë³‘ì›ëª… (ì˜ì–´/í•œêµ­ì–´)" value={hospitalForm.name} onChange={e=>setHospitalForm({...hospitalForm, name: e.target.value})} className="w-full p-2 border rounded"/>
            
            {/* ì£¼ì†Œ ì…ë ¥ (Korean search + English auto) */}
            <AddressInput
              value={hospitalForm.location_kr || ''}
              onChange={(address) => setHospitalForm({ ...hospitalForm, location_kr: address })}
              onLocationSelect={(location) => {
                if (location) {
                  setHospitalForm(prev => ({
                    ...prev,
                    location_kr: location.koAddress || prev.location_kr,
                    location_en: location.enAddress || prev.location_en
                  }));
                  toast.success("ì£¼ì†Œê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                }
              }}
              placeholder="í•œêµ­ì–´ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123)"
              language="ko"
            />

            <input
              type="text"
              placeholder="ì˜ë¬¸ ì£¼ì†Œ (ìë™ ì…ë ¥ë¨, í•„ìš” ì‹œ ìˆ˜ì •)"
              value={hospitalForm.location_en || ''}
              onChange={(e) => setHospitalForm({ ...hospitalForm, location_en: e.target.value })}
              className="w-full p-2 border rounded text-sm"
            />

            <input
              type="text"
              placeholder="ìƒì„¸ ì£¼ì†Œ (ì¸µ/í˜¸ìˆ˜ ë“±)"
              value={hospitalForm.address_detail || ''}
              onChange={(e) => setHospitalForm({ ...hospitalForm, address_detail: e.target.value })}
              className="w-full p-2 border rounded text-sm"
            />

            <textarea placeholder="ë³‘ì› ì†Œê°œ (ìƒì„¸ í˜ì´ì§€ìš© ì„¤ëª…)" value={hospitalForm.description} onChange={e=>setHospitalForm({...hospitalForm, description: e.target.value})} className="w-full p-2 border rounded" rows="3"/>
          </div>

          <div className="grid grid-cols-2 gap-6">
            <div>
              <h3 className="text-sm font-bold text-teal-600 mb-2 flex items-center gap-1"><Globe size={14}/> í†µì—­ ê°€ëŠ¥ ì–¸ì–´</h3>
              <DynamicListInput items={hospitalForm.languages} onAdd={t=>setHospitalForm({...hospitalForm, languages:[...hospitalForm.languages, t]})} onRemove={i=>setHospitalForm({...hospitalForm, languages:hospitalForm.languages.filter((_,x)=>x!==i)})} placeholder="ì˜ˆ: ì˜ì–´, ì¤‘êµ­ì–´"/>
            </div>
            <div>
              <h3 className="text-sm font-bold text-teal-600 mb-2 flex items-center gap-1"><Coffee size={14}/> í¸ì˜ ì‹œì„¤</h3>
              <DynamicListInput items={hospitalForm.amenities} onAdd={t=>setHospitalForm({...hospitalForm, amenities:[...hospitalForm.amenities, t]})} onRemove={i=>setHospitalForm({...hospitalForm, amenities:hospitalForm.amenities.filter((_,x)=>x!==i)})} placeholder="ì˜ˆ: ì™€ì´íŒŒì´, í”½ì—…"/>
            </div>
          </div>

          <div className="space-y-3">
            <h3 className="text-sm font-bold text-gray-400">ì´ë¯¸ì§€ ë° íƒœê·¸</h3>
            <DynamicListInput items={hospitalForm.tags} onAdd={t=>setHospitalForm({...hospitalForm, tags:[...hospitalForm.tags, t]})} onRemove={i=>setHospitalForm({...hospitalForm, tags:hospitalForm.tags.filter((_,x)=>x!==i)})} placeholder="íƒœê·¸ ì…ë ¥ (ì˜ˆ: í”¼ë¶€ê³¼)"/>
            
            <label className="block text-sm font-bold text-gray-500 mt-2">ë³‘ì› ê°¤ëŸ¬ë¦¬ ì´ë¯¸ì§€</label>
            <p className="text-xs text-teal-600 bg-teal-50 p-2 rounded-lg mb-2 flex items-center gap-2">
              <Info size={14}/> ğŸ’¡ ê¶Œì¥: 1200x900px (4:3 ë¹„ìœ¨)
            </p>
            <ImageUploader 
              images={hospitalForm.images} 
              onUpload={async (file) => {
                const url = await uploadToSupabase(file);
                if (url) setHospitalForm(prev => ({...prev, images: [...prev.images, url]}));
              }}
              onRemove={(idx) => setHospitalForm(prev => ({...prev, images: prev.images.filter((_, i) => i !== idx)}))}
              uploading={uploading}
            />
          </div>

          <div className="space-y-3 bg-gray-50 p-4 rounded-xl border border-gray-100">
            <h3 className="text-sm font-bold text-gray-900 flex items-center gap-2"><User size={16}/> ëŒ€í‘œ ì›ì¥ ì •ë³´</h3>
            <div className="grid grid-cols-2 gap-3">
              <input placeholder="ì´ë¦„ (ì˜ë¬¸/í•œê¸€)" value={hospitalForm.doctorName} onChange={e=>setHospitalForm({...hospitalForm, doctorName: e.target.value})} className="border p-2 rounded"/>
              <input placeholder="ì§í•¨ (ì˜ˆ: ëŒ€í‘œì›ì¥)" value={hospitalForm.doctorTitle} onChange={e=>setHospitalForm({...hospitalForm, doctorTitle: e.target.value})} className="border p-2 rounded"/>
            </div>
            <div className="grid grid-cols-2 gap-3">
              <input placeholder="ì¶œì‹  í•™êµ (ì˜ˆ: ì„œìš¸ëŒ€)" value={hospitalForm.doctorSchool} onChange={e=>setHospitalForm({...hospitalForm, doctorSchool: e.target.value})} className="border p-2 rounded"/>
              <input placeholder="ê²½ë ¥ (ì˜ˆ: 15ë…„ ì´ìƒ)" value={hospitalForm.doctorYears} onChange={e=>setHospitalForm({...hospitalForm, doctorYears: e.target.value})} className="border p-2 rounded"/>
            </div>
            <DynamicListInput items={hospitalForm.doctorSpecialties} onAdd={t=>setHospitalForm({...hospitalForm, doctorSpecialties:[...hospitalForm.doctorSpecialties, t]})} onRemove={i=>setHospitalForm({...hospitalForm, doctorSpecialties:hospitalForm.doctorSpecialties.filter((_,x)=>x!==i)})} placeholder="ì „ë¬¸ ë¶„ì•¼ (ì˜ˆ: ì½”ì„±í˜•)" icon={Trophy}/>
            
            <div className="mt-2">
              <label className="text-xs text-gray-400 font-bold mb-1 block">ì›ì¥ë‹˜ í”„ë¡œí•„ ì‚¬ì§„</label>
              <p className="text-[10px] text-teal-600 mb-2">ğŸ’¡ 1:1 ì •ë°©í˜• (400x400px) í•„ìˆ˜ - ì–¼êµ´ì´ ì¤‘ì•™ì— ì˜¤ë„ë¡</p>
              <div className="flex gap-2 items-center">
                {hospitalForm.doctorImage ? (
                  <div className="relative group w-16 h-16 rounded-full overflow-hidden border">
                    <img src={hospitalForm.doctorImage} alt="doc" className="w-full h-full object-cover"/>
                    <button onClick={() => setHospitalForm({...hospitalForm, doctorImage: ''})} className="absolute inset-0 bg-black/50 text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition"><X size={16}/></button>
                  </div>
                ) : (
                  <div onClick={() => document.getElementById('doc-upload').click()} className="w-16 h-16 rounded-full border border-dashed flex items-center justify-center text-gray-400 cursor-pointer hover:bg-white hover:border-teal-500">
                    {uploading ? <Loader2 size={16} className="animate-spin"/> : <Plus size={16}/>}
                    <input id="doc-upload" type="file" accept="image/*" className="hidden" disabled={uploading} onChange={async(e)=>{ const url=await uploadToSupabase(e.target.files[0]); if(url) setHospitalForm(prev=>({...prev, doctorImage: url})); }} />
                  </div>
                )}
              </div>
            </div>
          </div>

          <div className="grid grid-cols-2 gap-2">
            <input placeholder="í‰ì¼ ìš´ì˜ì‹œê°„ (09:00 - 18:00)" value={hospitalForm.hoursMonFri} onChange={e=>setHospitalForm({...hospitalForm, hoursMonFri: e.target.value})} className="border p-2 rounded"/>
            <input placeholder="ì£¼ë§ ìš´ì˜ì‹œê°„ (09:00 - 13:00)" value={hospitalForm.hoursSat} onChange={e=>setHospitalForm({...hospitalForm, hoursSat: e.target.value})} className="border p-2 rounded"/>
          </div>
        </div>
      </div>
    </div>
  </div>
);

--- END OF FILE: .\src\pages\admin\HospitalManager.jsx ---


--- START OF FILE: .\src\pages\admin\InquiryManager.jsx ---
import React from 'react';
import { RefreshCw, Paperclip } from 'lucide-react';

export const InquiryManager = ({ inquiries, fetchInquiries, handleStatusChange, handleFileClick }) => {
  const InquiryRow = ({ item }) => (
    <tr className="border-b hover:bg-gray-50">
      <td className="px-6 py-4 text-gray-500 text-sm">{new Date(item.created_at).toLocaleDateString()}</td>
      <td className="px-6 py-4">
        <div className="font-bold">{item.first_name} {item.last_name}</div>
        <div className="text-xs text-teal-600">{item.email}</div>
      </td>
      <td className="px-6 py-4 text-sm text-gray-600">
        <div>{item.treatment_type}</div>
        <div className="text-xs text-gray-400">{item.contact_method}</div>
      </td>
      <td className="px-6 py-4">
        <div className="p-2 bg-gray-50 rounded text-xs text-gray-700 max-h-20 overflow-y-auto">{item.message}</div>
      </td>
      <td className="px-6 py-4 text-center">
        {item.attachment ? <button onClick={()=>handleFileClick(item.attachment)}><Paperclip size={16}/></button> : '-'}
      </td>
      <td className="px-6 py-4">
        <select value={item.status||'ëŒ€ê¸°ì¤‘'} onChange={e=>handleStatusChange(item.id, e.target.value)} className="border rounded p-1 text-xs">
          <option>ëŒ€ê¸°ì¤‘</option>
          <option>ì§„í–‰ì¤‘</option>
          <option>ì™„ë£Œ</option>
        </select>
      </td>
    </tr>
  );

  return (
    <div className="animate-in fade-in">
      <div className="flex justify-between items-center mb-6">
        <h1 className="text-2xl font-bold">ê³ ê° ë¬¸ì˜ í˜„í™©</h1>
        <button onClick={fetchInquiries}><RefreshCw/></button>
      </div>
      <div className="bg-white rounded-xl border shadow-sm overflow-hidden">
        <table className="w-full text-sm text-left">
          <thead className="bg-gray-50 text-gray-500 uppercase text-xs">
            <tr>
              <th className="px-6 py-3">ë‚ ì§œ</th>
              <th className="px-6 py-3">ê³ ê° ì •ë³´</th>
              <th className="px-6 py-3">ê´€ì‹¬ ë¶„ì•¼</th>
              <th className="px-6 py-3">ë©”ì‹œì§€</th>
              <th className="px-6 py-3 text-center">ì²¨ë¶€</th>
              <th className="px-6 py-3">ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody>{inquiries.map(i => <InquiryRow key={i.id} item={i}/>)}</tbody>
        </table>
      </div>
    </div>
  );
};

--- END OF FILE: .\src\pages\admin\InquiryManager.jsx ---


--- START OF FILE: .\src\pages\admin\SiteSettings.jsx ---
import React from 'react';
import { Settings } from 'lucide-react';

export const SiteSettings = ({
  siteSettings,
  setSiteSettings,
  uploadToSupabase,
  uploading,
  handleSaveSettings,
  ImageUploader,
}) => (
  <div className="max-w-2xl bg-white rounded-2xl border border-gray-200 p-8 shadow-sm animate-in fade-in">
    <h2 className="text-xl font-bold mb-6 flex items-center gap-2"><Settings className="text-teal-600"/> ì‚¬ì´íŠ¸ ë””ìì¸ ì„¤ì •</h2>
    <div className="space-y-8">
      <div>
        <label className="block text-sm font-bold text-gray-700 mb-2">ìƒë‹¨ ë¡œê³  ì´ë¯¸ì§€ (Logo)</label>
        <p className="text-xs text-gray-400 mb-3">ë¹„ì›Œë‘ë©´ í…ìŠ¤íŠ¸(HEALO)ê°€ í‘œì‹œë©ë‹ˆë‹¤. íˆ¬ëª… ë°°ê²½ PNG ì¶”ì²œ.</p>
        <div className="flex items-center gap-4 mb-3 p-4 bg-teal-600 rounded-lg">
          <span className="text-white text-xs opacity-70">ë¯¸ë¦¬ë³´ê¸° (Dark ë°°ê²½):</span>
          {siteSettings.logo_url ? (
            <img src={siteSettings.logo_url} className="h-8 object-contain" alt="Logo Preview" />
          ) : (
            <span className="text-xl font-extrabold text-white">HEALO</span>
          )}
        </div>
        <ImageUploader 
          images={siteSettings.logo_url ? [siteSettings.logo_url] : []} 
          onUpload={async (file) => {
            const url = await uploadToSupabase(file);
            if (url) setSiteSettings(prev => ({...prev, logo_url: url}));
          }}
          onRemove={() => setSiteSettings(prev => ({...prev, logo_url: null}))}
          uploading={uploading}
        />
      </div>
      <hr className="border-gray-100"/>
      <div>
        <label className="block text-sm font-bold text-gray-700 mb-2">ë©”ì¸ ë°°ê²½ ì´ë¯¸ì§€ (Hero Background)</label>
        <p className="text-xs text-gray-400 mb-3">ë©”ì¸ ê²€ìƒ‰ì°½ ë’¤ì— ê¹”ë¦¬ëŠ” ì´ë¯¸ì§€ì…ë‹ˆë‹¤.</p>
        {siteSettings.hero_background_url && (
          <div className="mb-3 w-full h-40 rounded-lg overflow-hidden relative">
            <img src={siteSettings.hero_background_url} className="w-full h-full object-cover" alt="Hero BG" />
          </div>
        )}
        <ImageUploader 
          images={siteSettings.hero_background_url ? [siteSettings.hero_background_url] : []} 
          onUpload={async (file) => {
            const url = await uploadToSupabase(file);
            if (url) setSiteSettings(prev => ({...prev, hero_background_url: url}));
          }}
          onRemove={() => setSiteSettings(prev => ({...prev, hero_background_url: null}))}
          uploading={uploading}
        />
      </div>
      <button onClick={handleSaveSettings} className="w-full bg-teal-600 text-white py-3 rounded-xl font-bold hover:bg-teal-700 transition shadow-lg">
        ì„¤ì • ì €ì¥í•˜ê¸°
      </button>
    </div>
  </div>
);

--- END OF FILE: .\src\pages\admin\SiteSettings.jsx ---


--- START OF FILE: .\src\pages\admin\TreatmentManager.jsx ---
import React from 'react';
import { Plus, Trash2, Loader2, Save, Info } from 'lucide-react';

export const TreatmentManager = ({
  hospitalsList,
  selectedHospitalId,
  setSelectedHospitalId,
  fetchTreatments,
  treatmentsList,
  treatmentsError,
  editingTreatmentId,
  setEditingTreatmentId,
  treatmentForm,
  setTreatmentForm,
  handleEditTreatment,
  handleSaveTreatment,
  handleDelete,
  loading,
  uploadToSupabase,
  uploading,
  DynamicListInput,
  ImageUploader,
}) => (
  <div className="grid grid-cols-12 gap-8 animate-in fade-in">
    <div className="col-span-4 bg-white rounded-2xl border border-gray-200 p-4 h-[calc(100vh-100px)] overflow-y-auto">
      <select
        className="w-full border p-2 rounded mb-4"
        value={selectedHospitalId}
        onChange={e=>{setSelectedHospitalId(e.target.value); fetchTreatments(e.target.value);}}
      >
        <option value="">ë³‘ì›ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</option>
        {hospitalsList.map(h=><option key={h.id} value={h.id}>{h.name}</option>)}
      </select>
      {import.meta.env.DEV && treatmentsError && (
        <p className="text-xs text-red-500 mb-2">Treatments error: {treatmentsError.message}</p>
      )}
      <div className="flex justify-between items-center mb-4">
        <h2 className="font-bold">ì‹œìˆ  ëª©ë¡</h2>
        {selectedHospitalId && (
          <button onClick={()=>{setEditingTreatmentId(null); setTreatmentForm({ title: '', desc: '', fullDescription: '', priceMin: '', recoveryTime: '', benefits: [], tags: [], images: [] });}} className="bg-teal-600 text-white p-1 rounded">
            <Plus size={16}/>
          </button>
        )}
      </div>
      {treatmentsList.map(t=>(
        <div key={t.id} onClick={()=>handleEditTreatment(t)} className={`p-3 border-b cursor-pointer hover:bg-gray-50 ${editingTreatmentId===t.id?'bg-teal-50 border-l-4 border-l-teal-500':''}`}>
          <div className="font-bold">{t.name}</div>
          <div className="text-xs text-teal-600">${t.price_min}</div>
        </div>
      ))}
    </div>

    <div className="col-span-8 relative">
      {!selectedHospitalId ? (
        <div className="bg-white rounded-2xl border border-gray-200 p-8 h-[calc(100vh-100px)] flex items-center justify-center">
          <div className="text-center text-gray-400">ì™¼ìª½ì—ì„œ ë³‘ì›ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.</div>
        </div>
      ) : (
        <>
          {/* ì €ì¥ ë²„íŠ¼ - ìš°ì¸¡ ìƒë‹¨ ê³ ì • */}
          <div className="sticky top-0 z-10 bg-white border-b border-gray-200 p-4 mb-4 rounded-t-2xl flex justify-between items-center shadow-sm">
            <h2 className="text-xl font-bold">{editingTreatmentId?'ì‹œìˆ  ì •ë³´ ìˆ˜ì •':'ì‹ ê·œ ì‹œìˆ  ë“±ë¡'}</h2>
            <div className="flex items-center gap-3">
              {editingTreatmentId && (
                <button 
                  onClick={()=>handleDelete('treatments', editingTreatmentId, ()=>fetchTreatments(selectedHospitalId))}
                  className="p-2 text-red-500 hover:bg-red-50 rounded-lg transition"
                  title="ì‚­ì œ"
                >
                  <Trash2 size={20}/>
                </button>
              )}
              <button 
                onClick={handleSaveTreatment} 
                disabled={loading}
                className="bg-teal-600 text-white px-6 py-2.5 rounded-lg font-bold shadow-md hover:bg-teal-700 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                {loading ? <Loader2 size={18} className="animate-spin"/> : <Save size={18}/>}
                {loading ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥'}
              </button>
            </div>
          </div>
          
          <div className="bg-white rounded-2xl border border-gray-200 p-8 h-[calc(100vh-180px)] overflow-y-auto">
            <div className="space-y-4">
              <div className="grid grid-cols-3 gap-2">
                <div className="col-span-2">
                  <input placeholder="ì‹œìˆ ëª… (ì˜ì–´/í•œê¸€)" value={treatmentForm.title} onChange={e=>setTreatmentForm({...treatmentForm, title: e.target.value})} className="w-full p-2 border rounded"/>
                </div>
                <div>
                  <input type="number" placeholder="ìµœì†Œ ê°€ê²© ($)" value={treatmentForm.priceMin} onChange={e=>setTreatmentForm({...treatmentForm, priceMin: e.target.value})} className="w-full p-2 border rounded"/>
                </div>
              </div>
              <input placeholder="ê°„ëµ ì„¤ëª… (ì¹´ë“œìš©)" value={treatmentForm.desc} onChange={e=>setTreatmentForm({...treatmentForm, desc: e.target.value})} className="w-full p-2 border rounded"/>
              <textarea placeholder="ìƒì„¸ ì„¤ëª… (í˜ì´ì§€ìš©)" rows="4" value={treatmentForm.fullDescription} onChange={e=>setTreatmentForm({...treatmentForm, fullDescription: e.target.value})} className="w-full p-2 border rounded"/>
              <div className="grid grid-cols-2 gap-2">
                <input placeholder="ì†Œìš” ì‹œê°„ (ì˜ˆ: 1ì‹œê°„)" value={treatmentForm.recoveryTime} onChange={e=>setTreatmentForm({...treatmentForm, recoveryTime: e.target.value})} className="w-full p-2 border rounded"/>
                <input placeholder="ë§ˆì·¨ ë°©ë²•" value={treatmentForm.anesthesia} onChange={e=>setTreatmentForm({...treatmentForm, anesthesia: e.target.value})} className="w-full p-2 border rounded"/>
              </div>
              <DynamicListInput items={treatmentForm.benefits} onAdd={t=>setTreatmentForm({...treatmentForm, benefits:[...treatmentForm.benefits, t]})} onRemove={i=>setTreatmentForm({...treatmentForm, benefits:treatmentForm.benefits.filter((_,x)=>x!==i)})} placeholder="ì£¼ìš” íš¨ê³¼ (Benefit)"/>
              <DynamicListInput items={treatmentForm.tags} onAdd={t=>setTreatmentForm({...treatmentForm, tags:[...treatmentForm.tags, t]})} onRemove={i=>setTreatmentForm({...treatmentForm, tags:treatmentForm.tags.filter((_,x)=>x!==i)})} placeholder="ê²€ìƒ‰ íƒœê·¸"/>
              
              <label className="block text-sm font-bold text-gray-500 mt-2">ì‹œìˆ  ê´€ë ¨ ì´ë¯¸ì§€</label>
              <p className="text-xs text-teal-600 bg-teal-50 p-2 rounded-lg mb-2 flex items-center gap-2">
                <Info size={14}/> ğŸ’¡ ê¶Œì¥: 800x600px (4:3 ë¹„ìœ¨)
              </p>
              <ImageUploader 
                images={treatmentForm.images} 
                onUpload={async (file) => {
                  const url = await uploadToSupabase(file);
                  if (url) setTreatmentForm(prev => ({...prev, images: [...prev.images, url]}));
                }}
                onRemove={(idx) => setTreatmentForm(prev => ({...prev, images: prev.images.filter((_, i) => i !== idx)}))}
                uploading={uploading}
              />
            </div>
          </div>
        </>
      )}
    </div>
  </div>
);

--- END OF FILE: .\src\pages\admin\TreatmentManager.jsx ---
