module.exports=[18622,(e,t,n)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(e,t,n)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},93695,(e,t,n)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},96670,e=>{"use strict";var t=e.i(24389);let n="https://xppnvkuahlrdyfvabzur.supabase.co",r=process.env.SUPABASE_SERVICE_ROLE_KEY;if(!n||!r){let e=[];throw r||e.push("SUPABASE_SERVICE_ROLE_KEY"),Error(`Supabase admin env missing: ${e.join(", ")}`)}let a=(0,t.createClient)(n,r,{auth:{persistSession:!1}});e.s(["supabaseAdmin",0,a])},58325,e=>{"use strict";var t=e.i(47909),n=e.i(74017),r=e.i(96250),a=e.i(84243),i=e.i(61916),s=e.i(74677),o=e.i(69741),l=e.i(16795),u=e.i(87718),d=e.i(95169),c=e.i(47587),p=e.i(66012),g=e.i(70101),m=e.i(26937),_=e.i(10372),h=e.i(93695);e.i(52474);var f=e.i(5232),v=e.i(96670);let y=e=>e.filter(Boolean).join("\n").trim(),R=(e,t)=>{switch(e){case"treatment":{let n=t?.name||null,r=y([`Treatment: ${t?.name||""}`,t?.slug?`Slug: ${t.slug}`:null,t?.description?`Summary: ${t.description}`:null,t?.full_description?`Details: ${t.full_description}`:null,t?.tags?.length?`Tags: ${t.tags.join(", ")}`:null,t?.benefits?.length?`Benefits: ${t.benefits.join(", ")}`:null,t?.price_min!=null?`Price Min: ${t.price_min}`:null,t?.price_max!=null?`Price Max: ${t.price_max}`:null,t?.hospitals?.name?`Hospital: ${t.hospitals.name}`:null,t?.hospitals?.location_en?`Hospital Location (EN): ${t.hospitals.location_en}`:null,t?.hospitals?.location_kr?`Hospital Location (KR): ${t.hospitals.location_kr}`:null]);return{source_type:e,source_id:t.id,lang:"en",title:n,content:r}}case"hospital":{let n=t?.name||null,r=y([`Hospital: ${t?.name||""}`,t?.slug?`Slug: ${t.slug}`:null,t?.description?`Summary: ${t.description}`:null,t?.location_en?`Location (EN): ${t.location_en}`:null,t?.location_kr?`Location (KR): ${t.location_kr}`:null,t?.address_detail?`Address Detail: ${t.address_detail}`:null,t?.tags?.length?`Tags: ${t.tags.join(", ")}`:null,t?.operating_hours?`Operating Hours: ${JSON.stringify(t.operating_hours)}`:null,t?.doctor_profile?`Doctor Profile: ${t.doctor_profile}`:null]);return{source_type:e,source_id:t.id,lang:"en",title:n,content:r}}case"review":{let n=t?.user_name?`Review by ${t.user_name}`:"Review",r=y([t?.treatment_id?`Treatment ID: ${t.treatment_id}`:null,t?.user_name?`User: ${t.user_name}`:null,t?.country?`Country: ${t.country}`:null,t?.rating!=null?`Rating: ${t.rating}`:null,t?.created_at?`Created: ${t.created_at}`:null,t?.content?`Review: ${t.content}`:null]);return{source_type:e,source_id:t.id,lang:"en",title:n,content:r}}case"normalized_inquiry":{let n=t?.objective||(t?.treatment_slug?`Inquiry about ${t.treatment_slug}`:null)||"Inquiry",r=y([t?.language?`Language: ${t.language}`:null,t?.country?`Country: ${t.country}`:null,t?.treatment_id?`Treatment ID: ${t.treatment_id}`:null,t?.treatment_slug?`Treatment Slug: ${t.treatment_slug}`:null,t?.objective?`Objective: ${t.objective}`:null,t?.constraints?`Constraints: ${JSON.stringify(t.constraints)}`:null,t?.raw_message?`Raw Message: ${t.raw_message}`:null,t?.extraction_confidence!=null?`Extraction Confidence: ${t.extraction_confidence}`:null,t?.missing_fields?.length?`Missing Fields: ${t.missing_fields.join(", ")}`:null,t?.contact?`Contact: ${JSON.stringify(t.contact)}`:null]);return{source_type:e,source_id:t.id,lang:t?.language||"en",title:n,content:r}}default:{let n=y([t?.content||""]);return{source_type:e,source_id:t.id,lang:t?.lang||"en",title:t?.title||null,content:n}}}},w=()=>new Date().toISOString(),x=async(e,t)=>{switch(e){case"treatment":{let e=v.supabaseAdmin.from("treatments").select("id, slug, name, description, full_description, tags, benefits, price_min, price_max, hospitals(name, location_en, location_kr)");return t&&(e=e.eq("id",t)),e}case"hospital":{let e=v.supabaseAdmin.from("hospitals").select("id, slug, name, description, location_en, location_kr, address_detail, tags, operating_hours, doctor_profile");return t&&(e=e.eq("id",t)),e}case"review":{let e=v.supabaseAdmin.from("reviews").select("id, treatment_id, user_name, country, rating, content, created_at");return t&&(e=e.eq("id",t)),e}case"normalized_inquiry":{let e=v.supabaseAdmin.from("normalized_inquiries").select("id, language, country, treatment_id, treatment_slug, objective, constraints, raw_message, extraction_confidence, missing_fields, contact");return t&&(e=e.eq("id",t)),e}default:return{data:[],error:null}}},E=async e=>{let{data:t,error:n}=await v.supabaseAdmin.from("rag_documents").select("id, content, version").eq("source_type",e.source_type).eq("source_id",e.source_id).eq("lang",e.lang).maybeSingle();if(n)throw n;let r=!t||t.content!==e.content,a=t?.id,i=t?.version??1;if(t){if(r){let{data:n,error:r}=await v.supabaseAdmin.from("rag_documents").update({title:e.title,content:e.content,version:i+1,updated_at:w()}).eq("id",t.id).select("id, version").single();if(r)throw r;a=n.id,i=n.version}}else{let{data:t,error:n}=await v.supabaseAdmin.from("rag_documents").insert({source_type:e.source_type,source_id:e.source_id,lang:e.lang,title:e.title,content:e.content,version:1,created_at:w(),updated_at:w()}).select("id, version").single();if(n)throw n;a=t.id,i=t.version}if(!a)return{updated:!1,documentId:null};if(r){await v.supabaseAdmin.from("rag_chunks").delete().eq("document_id",a);let t=((e,t=800)=>{let n=e.replace(/\s+/g," ").trim();if(!n)return[];let r=n.replace(/\s+/g," ").trim().split(/(?<=[.!?])\s+/),a=[],i="",s=0,o=e=>{let t=e.trim();t&&(a.push({index:s,content:t}),s+=1)};for(let e of r)if(e){if(e.length>t){i&&(o(i),i="");for(let n=0;n<e.length;n+=t)o(e.slice(n,n+t));continue}(i+" "+e).trim().length>t?(o(i),i=e):i=i?`${i} ${e}`:e}return i&&o(i),a})(e.content);if(t.length>0){let n=t.map(t=>({document_id:a,chunk_index:t.index,content:t.content,metadata:{source_type:e.source_type,source_id:e.source_id,lang:e.lang,title:e.title,version:i}})),{error:r}=await v.supabaseAdmin.from("rag_chunks").insert(n);if(r)throw r}}return{updated:r,documentId:a}},b=async(e=["treatment","hospital","review","normalized_inquiry"],t)=>{let n={};for(let r of e){let{data:e,error:a}=await x(r,t);if(a)throw a;let i=0;for(let t of e||[]){let e=R(r,t);e.content&&(await E(e)).updated&&(i+=1)}n[r]=i}return n};async function $(e){try{let t=await e.json().catch(()=>({})),n=Array.isArray(t?.sourceTypes)?t.sourceTypes:void 0,r=t?.source_id?String(t.source_id):void 0,a=await b(n,r);return Response.json({ok:!0,results:a})}catch(e){return Response.json({ok:!1,error:e?.message||"ingest_failed"},{status:500})}}e.s(["POST",()=>$],49567);var A=e.i(49567);let C=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/rag/ingest/route",pathname:"/api/rag/ingest",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/rag/ingest/route.ts",nextConfigOutput:"",userland:A}),{workAsyncStorage:S,workUnitAsyncStorage:q,serverHooks:T}=C;function k(){return(0,r.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:q})}async function O(e,t,r){C.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/rag/ingest/route";v=v.replace(/\/index$/,"")||"/";let y=await C.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:R,params:w,nextConfig:x,parsedUrl:E,isDraftMode:b,prerenderManifest:$,routerServerContext:A,isOnDemandRevalidate:S,revalidateOnlyGenerated:q,resolvedPathname:T,clientReferenceManifest:k,serverActionsManifest:O}=y,j=(0,o.normalizeAppPath)(v),P=!!($.dynamicRoutes[j]||$.routes[T]),N=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,E,!1):t.end("This page could not be found"),null);if(P&&!b){let e=!!$.routes[T],t=$.dynamicRoutes[j];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await N();throw new h.NoFallbackError}}let I=null;!P||C.isDev||b||(I="/index"===(I=T)?"/":I);let H=!0===C.isDev||!P,D=P&&!H;O&&k&&(0,s.setManifestsSingleton)({page:v,clientReferenceManifest:k,serverActionsManifest:O});let U=e.method||"GET",M=(0,i.getTracer)(),K=M.getActiveScopeSpan(),L={params:w,prerenderManifest:$,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,n,r,a)=>C.onRequestError(e,t,r,a,A)},sharedContext:{buildId:R}},B=new l.NodeNextRequest(e),F=new l.NodeNextResponse(t),z=u.NextRequestAdapter.fromNodeNextRequest(B,(0,u.signalFromNodeResponse)(t));try{let s=async e=>C.handle(z,L).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let n=M.getRootSpanAttributes();if(!n)return;if(n.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${n.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=n.get("next.route");if(r){let t=`${U} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${v}`)}),o=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let u=async({previousCacheEntry:n})=>{try{if(!o&&S&&q&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await s(a);e.fetchMetrics=L.renderOpts.fetchMetrics;let l=L.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let u=L.renderOpts.collectedTags;if(!P)return await (0,p.sendResponse)(B,F,i,L.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,g.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[_.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let n=void 0!==L.renderOpts.collectedRevalidate&&!(L.renderOpts.collectedRevalidate>=_.INFINITE_CACHE)&&L.renderOpts.collectedRevalidate,r=void 0===L.renderOpts.collectedExpire||L.renderOpts.collectedExpire>=_.INFINITE_CACHE?void 0:L.renderOpts.collectedExpire;return{value:{kind:f.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:n,expire:r}}}}catch(t){throw(null==n?void 0:n.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:S})},!1,A),t}},d=await C.handleResponse({req:e,nextConfig:x,cacheKey:I,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:$,isRoutePPREnabled:!1,isOnDemandRevalidate:S,revalidateOnlyGenerated:q,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:o});if(!P)return null;if((null==d||null==(i=d.value)?void 0:i.kind)!==f.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==d||null==(l=d.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",S?"REVALIDATED":d.isMiss?"MISS":d.isStale?"STALE":"HIT"),b&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let h=(0,g.fromNodeOutgoingHttpHeaders)(d.value.headers);return o&&P||h.delete(_.NEXT_CACHE_TAGS_HEADER),!d.cacheControl||t.getHeader("Cache-Control")||h.get("Cache-Control")||h.set("Cache-Control",(0,m.getCacheControlHeader)(d.cacheControl)),await (0,p.sendResponse)(B,F,new Response(d.value.body,{headers:h,status:d.value.status||200})),null};K?await l(K):await M.withPropagatedContext(e.headers,()=>M.trace(d.BaseServerSpan.handleRequest,{spanName:`${U} ${v}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof h.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:j,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:D,isOnDemandRevalidate:S})},!1,A),P)throw t;return await (0,p.sendResponse)(B,F,new Response(null,{status:500})),null}}e.s(["handler",()=>O,"patchFetch",()=>k,"routeModule",()=>C,"serverHooks",()=>T,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>q],58325)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__993734ff._.js.map