"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[212],{5255:(e,t,a)=>{a.d(t,{Y_:()=>et});var r,o,n,s,l=a(2115),i="vercel.ai.error",c=Symbol.for(i),u=class e extends Error{constructor({name:e,message:t,cause:a}){super(t),this[r]=!0,this.name=e,this.cause=a}static isInstance(t){return e.hasMarker(t,i)}static hasMarker(e,t){let a=Symbol.for(t);return null!=e&&"object"==typeof e&&a in e&&"boolean"==typeof e[a]&&!0===e[a]}};r=c;var p=u;function d(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}Symbol.for("vercel.ai.error.AI_APICallError"),Symbol.for("vercel.ai.error.AI_EmptyResponseBodyError");var f="AI_InvalidArgumentError",g=`vercel.ai.error.${f}`,h=Symbol.for(g),I=class extends p{constructor({message:e,cause:t,argument:a}){super({name:f,message:e,cause:t}),this[o]=!0,this.argument=a}static isInstance(e){return p.hasMarker(e,g)}};o=h,Symbol.for("vercel.ai.error.AI_InvalidPromptError"),Symbol.for("vercel.ai.error.AI_InvalidResponseDataError");var m="AI_JSONParseError",y=`vercel.ai.error.${m}`,_=Symbol.for(y),E=class extends p{constructor({text:e,cause:t}){super({name:m,message:`JSON parsing failed: Text: ${e}.
Error message: ${d(t)}`,cause:t}),this[n]=!0,this.text=e}static isInstance(e){return p.hasMarker(e,y)}};n=_,Symbol.for("vercel.ai.error.AI_LoadAPIKeyError"),Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError"),Symbol.for("vercel.ai.error.AI_NoSuchModelError"),Symbol.for("vercel.ai.error.AI_TooManyEmbeddingValuesForCallError");var v="AI_TypeValidationError",b=`vercel.ai.error.${v}`,A=Symbol.for(b),T=class e extends p{constructor({value:e,cause:t}){super({name:v,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${d(t)}`,cause:t}),this[s]=!0,this.value=e}static isInstance(e){return p.hasMarker(e,b)}static wrap({value:t,cause:a}){return e.isInstance(a)&&a.value===t?a:new e({value:t,cause:a})}};s=A,Symbol.for("vercel.ai.error.AI_UnsupportedFunctionalityError");var w=a(4953),k=a(6844);a(1463);var R=(({prefix:e,size:t=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let o=(0,w.d)(a,t);if(null==e)return o;if(a.includes(r))throw new I({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return t=>`${e}${r}${o(t)}`})(),S=Symbol.for("vercel.ai.validator");function N({text:e,schema:t}){try{let a=k.parse(e);if(null==t)return{success:!0,value:a,rawValue:a};let r=function({value:e,schema:t}){var a;let r="object"==typeof t&&null!==t&&S in t&&!0===t[S]&&"validate"in t?t:(a=t,{[S]:!0,validate:e=>{let t=a.safeParse(e);return t.success?{success:!0,value:t.data}:{success:!1,error:t.error}}});try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:T.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:T.wrap({value:e,cause:t})}}}({value:a,schema:t});return r.success?{...r,rawValue:a}:r}catch(t){return{success:!1,error:E.isInstance(t)?t:new E({text:e,cause:t})}}}var{btoa:C,atob:x}=globalThis;a(1922);var D={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},O={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},j={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},F={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},M={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},B=[D,O,j,F,M];D.code,O.code,j.code,F.code,M.code,D.name,D.code,O.name,O.code,j.name,j.code,F.name,F.code,M.name,M.code,B.map(e=>e.code);var L=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data||!("mimeType"in e)||"string"!=typeof e.mimeType)throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],J=Object.fromEntries(L.map(e=>[e.code,e]));Object.fromEntries(L.map(e=>[e.name,e.code]));var P=L.map(e=>e.code),U=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let a=e.slice(0,t);if(!P.includes(a))throw Error(`Failed to parse stream string. Invalid code ${a}.`);let r=JSON.parse(e.slice(t+1));return J[a].parse(r)};async function Y({stream:e,onTextPart:t,onReasoningPart:a,onReasoningSignaturePart:r,onRedactedReasoningPart:o,onSourcePart:n,onFilePart:s,onDataPart:l,onErrorPart:i,onToolCallStreamingStartPart:c,onToolCallDeltaPart:u,onToolCallPart:p,onToolResultPart:d,onMessageAnnotationsPart:f,onFinishMessagePart:g,onFinishStepPart:h,onStartStepPart:I}){let m=e.getReader(),y=new TextDecoder,_=[],E=0;for(;;){let{value:e}=await m.read();if(e&&(_.push(e),E+=e.length,10!==e[e.length-1]))continue;if(0===_.length)break;let v=function(e,t){let a=new Uint8Array(t),r=0;for(let t of e)a.set(t,r),r+=t.length;return e.length=0,a}(_,E);for(let{type:e,value:m}of(E=0,y.decode(v,{stream:!0}).split("\n").filter(e=>""!==e).map(U)))switch(e){case"text":await (null==t?void 0:t(m));break;case"reasoning":await (null==a?void 0:a(m));break;case"reasoning_signature":await (null==r?void 0:r(m));break;case"redacted_reasoning":await (null==o?void 0:o(m));break;case"file":await (null==s?void 0:s(m));break;case"source":await (null==n?void 0:n(m));break;case"data":await (null==l?void 0:l(m));break;case"error":await (null==i?void 0:i(m));break;case"message_annotations":await (null==f?void 0:f(m));break;case"tool_call_streaming_start":await (null==c?void 0:c(m));break;case"tool_call_delta":await (null==u?void 0:u(m));break;case"tool_call":await (null==p?void 0:p(m));break;case"tool_result":await (null==d?void 0:d(m));break;case"finish_message":await (null==g?void 0:g(m));break;case"finish_step":await (null==h?void 0:h(m));break;case"start_step":await (null==I?void 0:I(m));break;default:throw Error(`Unknown stream part type: ${e}`)}}}async function V({stream:e,update:t,onToolCall:a,onFinish:r,generateId:o=R,getCurrentDate:n=()=>new Date,lastMessage:s}){var l,i;let c,u,p,d=(null==s?void 0:s.role)==="assistant",f=d?1+(null!=(i=null==(l=s.toolInvocations)?void 0:l.reduce((e,t)=>{var a;return Math.max(e,null!=(a=t.step)?a:0)},0))?i:0):0,g=d?structuredClone(s):{id:o(),createdAt:n(),role:"assistant",content:"",parts:[]};function h(e,t){let a=g.parts.find(t=>"tool-invocation"===t.type&&t.toolInvocation.toolCallId===e);null!=a?a.toolInvocation=t:g.parts.push({type:"tool-invocation",toolInvocation:t})}let I=[],m=d?null==s?void 0:s.annotations:void 0,y={},_={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},E="unknown";function v(){let e=[...I];(null==m?void 0:m.length)&&(g.annotations=m),t({message:{...structuredClone(g),revisionId:o()},data:e,replaceLastMessage:d})}await Y({stream:e,onTextPart(e){null==c?(c={type:"text",text:e},g.parts.push(c)):c.text+=e,g.content+=e,v()},onReasoningPart(e){var t;null==p?(p={type:"text",text:e},null!=u&&u.details.push(p)):p.text+=e,null==u?(u={type:"reasoning",reasoning:e,details:[p]},g.parts.push(u)):u.reasoning+=e,g.reasoning=(null!=(t=g.reasoning)?t:"")+e,v()},onReasoningSignaturePart(e){null!=p&&(p.signature=e.signature)},onRedactedReasoningPart(e){null==u&&(u={type:"reasoning",reasoning:"",details:[]},g.parts.push(u)),u.details.push({type:"redacted",data:e.data}),p=void 0,v()},onFilePart(e){g.parts.push({type:"file",mimeType:e.mimeType,data:e.data}),v()},onSourcePart(e){g.parts.push({type:"source",source:e}),v()},onToolCallStreamingStartPart(e){null==g.toolInvocations&&(g.toolInvocations=[]),y[e.toolCallId]={text:"",step:f,toolName:e.toolName,index:g.toolInvocations.length};let t={state:"partial-call",step:f,toolCallId:e.toolCallId,toolName:e.toolName,args:void 0};g.toolInvocations.push(t),h(e.toolCallId,t),v()},onToolCallDeltaPart(e){let t=y[e.toolCallId];t.text+=e.argsTextDelta;let{value:a}=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=N({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=N({text:function(e){let t=["ROOT"],a=-1,r=null;function o(e,o,n){switch(e){case'"':a=o,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=o,r=o,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=o,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":a=o,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":a=o,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function s(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let l=0;l<e.length;l++){let i=e[l];switch(t[t.length-1]){case"ROOT":o(i,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(i){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=l,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===i&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===i&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(i,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(i,l);break;case"INSIDE_STRING":switch(i){case'"':t.pop(),a=l;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":"]"===i?(a=l,t.pop()):(a=l,o(i,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(i){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,t.pop();break;default:a=l}break;case"INSIDE_ARRAY_AFTER_COMMA":o(i,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=l;break;case"INSIDE_NUMBER":switch(i){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(i,l),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(i,l);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(i,l);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(i,l);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(r,l+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?a=l:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(i,l):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&s(i,l))}}}let l=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":l+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":l+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":l+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?l+="true".slice(t.length):"false".startsWith(t)?l+="false".slice(t.length):"null".startsWith(t)&&(l+="null".slice(t.length))}}return l}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}(t.text),r={state:"partial-call",step:t.step,toolCallId:e.toolCallId,toolName:t.toolName,args:a};g.toolInvocations[t.index]=r,h(e.toolCallId,r),v()},async onToolCallPart(e){let t={state:"call",step:f,...e};if(null!=y[e.toolCallId]?g.toolInvocations[y[e.toolCallId].index]=t:(null==g.toolInvocations&&(g.toolInvocations=[]),g.toolInvocations.push(t)),h(e.toolCallId,t),v(),a){let t=await a({toolCall:e});if(null!=t){let a={state:"result",step:f,...e,result:t};g.toolInvocations[g.toolInvocations.length-1]=a,h(e.toolCallId,a),v()}}},onToolResultPart(e){let t=g.toolInvocations;if(null==t)throw Error("tool_result must be preceded by a tool_call");let a=t.findIndex(t=>t.toolCallId===e.toolCallId);if(-1===a)throw Error("tool_result must be preceded by a tool_call with the same toolCallId");let r={...t[a],state:"result",...e};t[a]=r,h(e.toolCallId,r),v()},onDataPart(e){I.push(...e),v()},onMessageAnnotationsPart(e){null==m?m=[...e]:m.push(...e),v()},onFinishStepPart(e){f+=1,c=e.isContinued?c:void 0,u=void 0,p=void 0},onStartStepPart(e){d||(g.id=e.messageId),g.parts.push({type:"step-start"}),v()},onFinishMessagePart(e){E=e.finishReason,null!=e.usage&&(_=function({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}(e.usage))},onErrorPart(e){throw Error(e)}}),null==r||r({message:g,finishReason:E,usage:_})}async function $({stream:e,onTextPart:t}){let a=e.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:e,value:r}=await a.read();if(e)break;await t(r)}}async function K({stream:e,update:t,onFinish:a,getCurrentDate:r=()=>new Date,generateId:o=R}){let n={type:"text",text:""},s={id:o(),createdAt:r(),role:"assistant",content:"",parts:[n]};await $({stream:e,onTextPart:e=>{s.content+=e,n.text+=e,t({message:{...s},data:[],replaceLastMessage:!1})}}),null==a||a(s,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}async function G({api:e,body:t,streamProtocol:a="data",credentials:r,headers:o,abortController:n,restoreMessagesOnFailure:s,onResponse:l,onUpdate:i,onFinish:c,onToolCall:u,generateId:p,fetch:d=fetch,lastMessage:f,requestType:g="generate"}){var h,I,m;let y="resume"===g?d(`${e}?chatId=${t.id}`,{method:"GET",headers:{"Content-Type":"application/json",...o},signal:null==(h=null==n?void 0:n())?void 0:h.signal,credentials:r}):d(e,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",...o},signal:null==(I=null==n?void 0:n())?void 0:I.signal,credentials:r}),_=await y.catch(e=>{throw s(),e});if(l)try{await l(_)}catch(e){throw e}if(!_.ok)throw s(),Error(null!=(m=await _.text())?m:"Failed to fetch the chat response.");if(!_.body)throw Error("The response body is empty.");switch(a){case"text":return void await K({stream:_.body,update:i,onFinish:c,generateId:p});case"data":return void await V({stream:_.body,update:i,lastMessage:f,onToolCall:u,onFinish({message:e,finishReason:t,usage:a}){c&&null!=e&&c(e,{usage:a,finishReason:t})},generateId:p});default:throw Error(`Unknown stream protocol: ${a}`)}}function W(e){return null==e?void 0:e.reduce((e,t)=>{var a;return Math.max(e,null!=(a=t.step)?a:0)},0)}function q(e){var t;return null!=(t=e.parts)?t:[...e.toolInvocations?e.toolInvocations.map(e=>({type:"tool-invocation",toolInvocation:e})):[],...e.reasoning?[{type:"reasoning",reasoning:e.reasoning,details:[{type:"text",text:e.reasoning}]}]:[],...e.content?[{type:"text",text:e.content}]:[]]}function z(e){return e.map(e=>({...e,parts:q(e)}))}async function H(e){if(!e)return[];if(globalThis.FileList&&e instanceof globalThis.FileList)return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{name:t,contentType:a,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}));if(Array.isArray(e))return e;throw Error("Invalid attachments type")}function Q(e){if("assistant"!==e.role)return!1;let t=e.parts.reduce((e,t,a)=>"step-start"===t.type?a:e,-1),a=e.parts.slice(t+1).filter(e=>"tool-invocation"===e.type);return a.length>0&&a.every(e=>"result"in e.toolInvocation)}Symbol.for("vercel.ai.schema");var X=a(7536),Z=a(2707);function ee(e,t){return null!=t?Z(e,t):e}var et=function({api:e="/api/chat",id:t,initialMessages:a,initialInput:r="",sendExtraMessageFields:o,onToolCall:n,experimental_prepareRequestBody:s,maxSteps:i=1,streamProtocol:c="data",onResponse:u,onFinish:p,onError:d,credentials:f,headers:g,body:h,generateId:I=R,fetch:m,keepLastMessageOnError:y=!0,experimental_throttle:_}={}){let[E]=(0,l.useState)(I),v=null!=t?t:E,b="string"==typeof e?[e,v]:v,A=function(e){let[t,a]=(0,l.useState)(e);return(0,l.useEffect)(()=>{!function e(t,a){if(t===a)return!0;if(null==t||null==a)return!1;if("object"!=typeof t&&"object"!=typeof a)return t===a;if(t.constructor!==a.constructor)return!1;if(t instanceof Date&&a instanceof Date)return t.getTime()===a.getTime();if(Array.isArray(t)){if(t.length!==a.length)return!1;for(let r=0;r<t.length;r++)if(!e(t[r],a[r]))return!1;return!0}let r=Object.keys(t),o=Object.keys(a);if(r.length!==o.length)return!1;for(let n of r)if(!o.includes(n)||!e(t[n],a[n]))return!1;return!0}(e,t)&&a(e)},[e,t]),t}(null!=a?a:[]),T=(0,l.useMemo)(()=>z(A),[A]),{data:w,mutate:k}=(0,X.Ay)([b,"messages"],null,{fallbackData:T}),S=(0,l.useRef)(w||[]);(0,l.useEffect)(()=>{S.current=w||[]},[w]);let{data:N,mutate:C}=(0,X.Ay)([b,"streamData"],null),x=(0,l.useRef)(N);(0,l.useEffect)(()=>{x.current=N},[N]);let{data:D="ready",mutate:O}=(0,X.Ay)([b,"status"],null),{data:j,mutate:F}=(0,X.Ay)([b,"error"],null),M=(0,l.useRef)(null),B=(0,l.useRef)({credentials:f,headers:g,body:h});(0,l.useEffect)(()=>{B.current={credentials:f,headers:g,body:h}},[f,g,h]);let L=(0,l.useCallback)(async(t,a="generate")=>{var r,l;O("submitted"),F(void 0);let f=z(t.messages),g=f.length,h=W(null==(r=f[f.length-1])?void 0:r.toolInvocations);try{M.current=new AbortController;let r=ee(k,_),i=ee(C,_),d=S.current;r(f,!1);let g=o?f:f.map(({role:e,content:t,experimental_attachments:a,data:r,annotations:o,toolInvocations:n,parts:s})=>({role:e,content:t,...void 0!==a&&{experimental_attachments:a},...void 0!==r&&{data:r},...void 0!==o&&{annotations:o},...void 0!==n&&{toolInvocations:n},...void 0!==s&&{parts:s}})),h=x.current;await G({api:e,body:null!=(l=null==s?void 0:s({id:v,messages:f,requestData:t.data,requestBody:t.body}))?l:{id:v,messages:g,data:t.data,...B.current.body,...t.body},streamProtocol:c,credentials:B.current.credentials,headers:{...B.current.headers,...t.headers},abortController:()=>M.current,restoreMessagesOnFailure(){y||r(d,!1)},onResponse:u,onUpdate({message:e,data:t,replaceLastMessage:a}){O("streaming"),r([...a?f.slice(0,f.length-1):f,e],!1),(null==t?void 0:t.length)&&i([...null!=h?h:[],...t],!1)},onToolCall:n,onFinish:p,generateId:I,fetch:m,lastMessage:f[f.length-1],requestType:a}),M.current=null,O("ready")}catch(e){if("AbortError"===e.name)return M.current=null,O("ready"),null;d&&e instanceof Error&&d(e),F(e),O("error")}let E=S.current;(function({originalMaxToolInvocationStep:e,originalMessageCount:t,maxSteps:a,messages:r}){var o;let n=r[r.length-1];return a>1&&null!=n&&(r.length>t||W(n.toolInvocations)!==e)&&Q(n)&&(null!=(o=W(n.toolInvocations))?o:0)<a})({originalMaxToolInvocationStep:h,originalMessageCount:g,maxSteps:i,messages:E})&&await L({messages:E})},[k,O,e,B,u,p,d,F,C,x,c,o,s,n,i,S,M,I,m,y,_,v]),J=(0,l.useCallback)(async(e,{data:t,headers:a,body:r,experimental_attachments:o=e.experimental_attachments}={})=>{var n,s;let l=await H(o);return L({messages:S.current.concat({...e,id:null!=(n=e.id)?n:I(),createdAt:null!=(s=e.createdAt)?s:new Date,experimental_attachments:l.length>0?l:void 0,parts:q(e)}),headers:a,body:r,data:t})},[L,I]),P=(0,l.useCallback)(async({data:e,headers:t,body:a}={})=>{let r=S.current;return 0===r.length?null:L({messages:"assistant"===r[r.length-1].role?r.slice(0,-1):r,headers:t,body:a,data:e})},[L]),U=(0,l.useCallback)(()=>{M.current&&(M.current.abort(),M.current=null)},[]),Y=(0,l.useCallback)(async()=>{L({messages:S.current},"resume")},[L]),V=(0,l.useCallback)(e=>{"function"==typeof e&&(e=e(S.current));let t=z(e);k(t,!1),S.current=t},[k]),$=(0,l.useCallback)(e=>{"function"==typeof e&&(e=e(x.current)),C(e,!1),x.current=e},[C]),[K,Z]=(0,l.useState)(r),et=(0,l.useCallback)(async(e,t={},a)=>{var r;if(null==(r=null==e?void 0:e.preventDefault)||r.call(e),!K&&!t.allowEmptySubmit)return;a&&(B.current={...B.current,...a});let o=await H(t.experimental_attachments);L({messages:S.current.concat({id:I(),createdAt:new Date,role:"user",content:K,experimental_attachments:o.length>0?o:void 0,parts:[{type:"text",text:K}]}),headers:t.headers,body:t.body,data:t.data}),Z("")},[K,I,L]),ea=(0,l.useCallback)(({toolCallId:e,result:t})=>{let a=S.current;!function({messages:e,toolCallId:t,toolResult:a}){var r;let o=e[e.length-1],n=o.parts.find(e=>"tool-invocation"===e.type&&e.toolInvocation.toolCallId===t);if(null==n)return;let s={...n.toolInvocation,state:"result",result:a};n.toolInvocation=s,o.toolInvocations=null==(r=o.toolInvocations)?void 0:r.map(e=>e.toolCallId===t?s:e)}({messages:a,toolCallId:e,toolResult:t}),k([...a.slice(0,a.length-1),{...a[a.length-1]}],!1),"submitted"===D||"streaming"===D||Q(a[a.length-1])&&L({messages:a})},[k,D,L]);return{messages:null!=w?w:[],id:v,setMessages:V,data:N,setData:$,error:j,append:J,reload:P,stop:U,experimental_resume:Y,input:K,setInput:Z,handleInputChange:e=>{Z(e.target.value)},handleSubmit:et,isLoading:"submitted"===D||"streaming"===D,status:D,addToolResult:ea}}}}]);